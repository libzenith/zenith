56aaf3afd Fri Mar 26 07:20:47 2021 -0700 Initial commit
253fc123e Fri Mar 26 10:54:25 2021 -0700 Initial repo structure
05a7ea0a2 Mon Mar 29 15:12:34 2021 +0300 Merge pull request #1 from adsharma/main
c856a2f2d Mon Mar 29 15:57:15 2021 +0300 pageserver stub
9a9480e8c Mon Mar 29 15:57:15 2021 +0300 Add WIP support for decoding WAL records.
eac04d7f1 Mon Mar 29 15:57:15 2021 +0300 Remove leftover duplicated code to start replication connection
cdb20bf2a Mon Mar 29 15:57:15 2021 +0300 More work on the page server's WAL receiver
d6ba1e6b7 Mon Mar 29 15:57:15 2021 +0300 Silence compiler warnings
3058021ca Mon Mar 29 15:57:15 2021 +0300 WIP: beginnings of page server page cache
a5822a5d8 Mon Mar 29 15:57:15 2021 +0300 fix compilation
626b4e998 Mon Mar 29 15:59:27 2021 +0300 basic support of postgres backend protocol
af7ebb639 Mon Mar 29 15:59:27 2021 +0300 Implement WAL redo.
3de014823 Mon Mar 29 15:59:27 2021 +0300 Misc page server cleanup
ceb642e24 Mon Mar 29 15:59:27 2021 +0300 Make test output less noisy
939281101 Mon Mar 29 15:59:27 2021 +0300 page server: retry WAL streaming connection on error.
bc4b2787f Mon Mar 29 15:59:27 2021 +0300 page server: Minor code cleanup
b16462268 Mon Mar 29 15:59:27 2021 +0300 Add README to provide an overview of the Page Server.
ab432dff0 Mon Mar 29 15:59:27 2021 +0300 page server: Track the range of valid LSNs that we hold
5d0ee11cd Mon Mar 29 15:59:27 2021 +0300 page server: If WAL receiver dies, restart from where it left off
ea38ed223 Mon Mar 29 15:59:27 2021 +0300 support negative ssl negotiation
a11ef162f Mon Mar 29 15:59:27 2021 +0300 stubs for smgr proto
1016e69bb Mon Mar 29 15:59:27 2021 +0300 Add instructions on how to run the Page Server
ab3434f30 Mon Mar 29 15:59:27 2021 +0300 Fix instructions in the page server README
0298a6dad Mon Mar 29 15:59:27 2021 +0300 smgr <-> page service
8bb282dca Mon Mar 29 15:59:28 2021 +0300 page server: Restore base backup from S3 at page server startup
851e91032 Mon Mar 29 15:59:28 2021 +0300 WIP: local control plane
6fc00e855 Mon Mar 29 15:59:28 2021 +0300 [WIP] local control plane: clean up on exit, use whoami user name
e7694a1d5 Mon Mar 29 15:59:28 2021 +0300 page server: use logger module
1c1812df0 Mon Mar 29 15:59:28 2021 +0300 Fix decoding WAL segment header
303a546ab Mon Mar 29 15:59:28 2021 +0300 Refactor locking in page cache, and use async I/O for WAL redo
375f8e313 Mon Mar 29 15:59:28 2021 +0300 add comment
22a0da114 Mon Mar 29 15:59:28 2021 +0300 page server: Name the threads for debugging.
efe9fdbbe Mon Mar 29 15:59:28 2021 +0300 Add 'make postgres' Makefile target.
a522961d0 Mon Mar 29 15:59:28 2021 +0300 add test stubs
9e89c1e2c Mon Mar 29 15:59:28 2021 +0300 add CLI options to pageserver
4c0be32bf Mon Mar 29 15:59:28 2021 +0300 Implement Text User Interface to show log streams in multiple "windows"
0cec3b5ed Mon Mar 29 15:59:28 2021 +0300 Update dependencies with "cargo update".
8a80d055b Mon Mar 29 15:59:28 2021 +0300 daemon mode for pageserver
667ec0db6 Mon Mar 29 15:59:28 2021 +0300 start pageserver and pg on top of it
bfc2ed26c Mon Mar 29 15:59:28 2021 +0300 Reuse postgres --wal-redo process.
53b31f60b Mon Mar 29 15:59:28 2021 +0300 Add basic metrics to page cache, and show them in the TUI.
e74a81285 Mon Mar 29 15:59:28 2021 +0300 Handle WAL redo errors more gracefully.
a0de2b625 Mon Mar 29 15:59:28 2021 +0300 redirect logging to file in daemon mode
d42f2b431 Mon Mar 29 15:59:28 2021 +0300 pg + pageserver integration testing
6e29523fb Mon Mar 29 15:59:28 2021 +0300 If GetPage@LSN fails, print an error to the log, too.
c8eeb8573 Mon Mar 29 15:59:28 2021 +0300 add 'test_' prexix to test files to avoid lots of similarly-name files in repo
a482c3256 Mon Mar 29 15:59:28 2021 +0300 clean up tests a bit; drop username dependency
95c1ef5bb Mon Mar 29 15:59:28 2021 +0300 Don't panic if we receive a duplicate WAL record.
e4d90fe0b Mon Mar 29 15:59:28 2021 +0300 Add timeouts to WAL redo, to prevent it from getting stuck.
c018247c5 Mon Mar 29 15:59:28 2021 +0300 [issue #7] CLI first commit
853c130ff Mon Mar 29 15:59:28 2021 +0300 [issue #7] CLI parse subcommands
d1ef8a178 Mon Mar 29 15:59:28 2021 +0300 [issue #7] CLI parse args for pg subcommand
903811671 Mon Mar 29 15:59:28 2021 +0300 dockerfile
5912d0b9d Mon Mar 29 17:56:19 2021 +0300 switch pg submodule to our branch
98b0d3d32 Mon Mar 29 22:40:10 2021 +0300 run tests with github actions
50b3b4a3c Mon Mar 29 22:43:16 2021 +0300 run tests with github actions, take 2
4ea713b72 Mon Mar 29 22:46:58 2021 +0300 run tests with github actions, take 3
924962de0 Tue Mar 30 03:22:07 2021 +0300 Update README.md
e84e2d7d4 Tue Mar 30 17:02:09 2021 +0300 make pgbuild.sh less noisy
91700e56d Tue Mar 30 18:59:35 2021 +0300 fix postgres submodule state
134891565 Wed Mar 31 12:13:10 2021 +0300 add regression tests runner
98fd4aeff Wed Mar 31 12:13:10 2021 +0300 Use write_all() when sending messages to Postgres WAL process.
9a8bda293 Wed Mar 31 12:13:10 2021 +0300 Break out of busy loop, if the page-service connection is lost.
cd98818a2 Wed Mar 31 12:13:10 2021 +0300 Add @LSN argument to GetPage requests
98cc8400f Wed Mar 31 15:13:50 2021 +0300 Move regression tests output to tmp_check/regress
98b842678 Wed Mar 31 15:30:35 2021 +0300 Ignore test_pageserver::test_regress as it fails now
52e754f30 Wed Mar 31 16:53:29 2021 +0300 Make page server startup less noisy.
bfb20522e Wed Mar 31 16:54:20 2021 +0300 Advance "last valid LSN", even if it's not at WAL record boundary.
d97bd869a Wed Mar 31 16:54:31 2021 +0300 Fix confusion on what record's LSN means.
bef273188 Wed Mar 31 16:55:15 2021 +0300 bump vendor/postgres
9175fb5ea Wed Mar 31 17:01:00 2021 +0300 enable test_regress in CI
7353098b4 Wed Mar 31 18:50:22 2021 +0300 Fix typo
5f272380a Wed Mar 31 20:00:02 2021 +0300 Don't panic on XLOG_SWITCH records.
08e59f567 Wed Mar 31 21:27:26 2021 +0300 If WAL streaming connection is lost, restart at right place.
02ca24508 Fri Apr 2 10:30:56 2021 +0300 Port wal_acceptor to rust
13f507f0b Fri Apr 2 10:30:56 2021 +0300 Calculate records CRC in wal decoder
e2ce9e562 Fri Apr 2 10:38:51 2021 +0300 remove unused modules
2d8a19aff Fri Apr 2 14:56:32 2021 +0300 add protocol message to receive pg_control
9fdf1964a Fri Apr 2 14:57:16 2021 +0300 generate controlfile using pg_resetwal
dc4b5f5f2 Fri Apr 2 15:09:20 2021 +0300 use pg_resetwal to generate pg_control in the test
4566a0a16 Fri Apr 2 15:19:16 2021 +0300 update vendor/postres: merge compute_node branch
6eabe17e9 Fri Apr 2 20:13:20 2021 +0300 Fix bugs in wal_acceptor WAL parser
2c308da4d Sat Apr 3 19:02:44 2021 +0300 Support several postgres instances on top of a single pageserver.
da0decc24 Sat Apr 3 19:15:15 2021 +0300 bump pg version: include system_id in getPage requests
decb04fc4 Sat Apr 3 19:42:45 2021 +0300 fix build
2c7ed574b Sun Apr 4 08:58:23 2021 +0300 Fix bug XLogFromFileName
a555b5917 Sun Apr 4 10:50:51 2021 +0300 bump pg commit
bd606ab37 Mon Apr 5 12:37:45 2021 +0300 Start pageserver walreceiver from predefined "-inf" lsn.
79e4110cf Mon Apr 5 14:11:05 2021 +0300 Use immediate postgres stop in tests.
0bf3c3224 Mon Apr 5 17:35:28 2021 +0300 Make the debugging output from WAL receiver a bit nicer.
412e4a2ee Mon Apr 5 21:27:40 2021 +0300 Move the mgmt-console code from vendor/postgres repository.
dab1f0381 Mon Apr 5 22:59:49 2021 +0300 Cache postgres build and cargo deps in CI builds
b5c49b248 Tue Apr 6 00:51:22 2021 +0300 Add safekeeper tests
abbbdc401 Tue Apr 6 11:48:25 2021 +0300 Don't panic in test if data directory is missing.
012c52874 Tue Apr 6 11:58:48 2021 +0300 Add race condition test for safekeeper
136733244 Tue Apr 6 13:15:26 2021 +0300 Separate walkeeper and pageserver sources into different directories.
37e258edf Tue Apr 6 13:55:29 2021 +0300 Add a brief overview of the source code layout in README
4706ed423 Tue Apr 6 14:00:37 2021 +0300 Add --test-threads=1 to instructions on how to run tests.
494b95886 Tue Apr 6 14:05:43 2021 +0300 Move launch.sh into 'pageserver' directory.
c0fcbbbe0 Tue Apr 6 14:42:13 2021 +0300 Cargo fmt pass over a codebase
dc1638663 Tue Apr 6 15:45:21 2021 +0300 Fix wal_accetor tests
854718483 Tue Apr 6 15:55:55 2021 +0300 Fix merge conflicts
3fea78d68 Wed Apr 7 13:43:40 2021 +0300 Multitenant wal_acceptor
6b9fc3aff Wed Apr 7 16:39:37 2021 +0300 Fix minor typos and copy-pastos
abaa36a15 Wed Apr 7 16:50:58 2021 +0300 Format code according to rust style guide
198fc9ea5 Wed Apr 7 18:51:34 2021 +0300 Capture initdb's stdout/stderr, to avoid messing with log formatting.
0c6471ca0 Wed Apr 7 19:05:28 2021 +0300 Print a few more LSNs in the standard format.
3e09cb571 Thu Apr 8 13:30:10 2021 +0300 Add README to give an overview of the WAL safekeeper.
ba4f8e94a Thu Apr 8 13:30:42 2021 +0300 Minor comment fixes.
07fb30747 Thu Apr 8 19:39:30 2021 +0300 Store pageserver data in RocksDB
542dffa4a Thu Apr 8 20:34:24 2021 +0300 Set LD_LIBRARY_PATH for tests
1816c4ca0 Fri Apr 9 15:00:33 2021 +0300 Merge with master
a60633607 Fri Apr 9 20:31:34 2021 +0300 Fix bug in WALRecord serializer
59163cf3b Sat Apr 10 12:09:20 2021 +0300 Rework controle_plane code to reuse it in CLI.
6264dc6aa Sat Apr 10 13:56:19 2021 +0300 Move control_plane code out of lib.rs and split up control plane into compute and storage parts.
39ebec51d Sat Apr 10 19:03:40 2021 +0300 Return Result<()> from pageserver start/stop.
c5f379bff Tue Apr 13 18:58:22 2021 +0300 [WIP] Implement CLI pg part
f35d13183 Tue Apr 13 18:58:22 2021 +0300 fixup, check testing in CI
b07fa4c89 Tue Apr 13 18:58:22 2021 +0300 update readme
46543f54a Tue Apr 13 11:45:27 2021 -0700 pgbuild.sh: halt if a subcommand fails
3c4ebc403 Tue Apr 13 14:06:14 2021 -0700 init_logging: return Result, print error on file create
d1d6c968d Tue Apr 13 14:30:48 2021 -0700 control_plane: add error handling to reading pid files
d9bc2109b Wed Apr 14 14:33:55 2021 +0300 Reduce size of shared buffers for wal-redo-postgtes
6266fd102 Wed Apr 14 18:18:38 2021 +0300 Avoid short writes if a buffer is full.
2e9c730dd Wed Apr 14 20:12:50 2021 +0300 Cargo fmt pass
82dc1e82b Wed Apr 14 21:14:10 2021 +0300 Restore pageserver from s3 or local datadir (#9)
24b925d52 Thu Apr 15 15:50:47 2021 +0300 Support truncate WAL record
913a91c54 Thu Apr 15 16:20:23 2021 +0300 bump vendor/postgres
119003087 Thu Apr 15 16:43:03 2021 +0300 handle SLRU in restore_datadir
d7eeaec70 Thu Apr 15 16:43:03 2021 +0300 add test for restore from local pgdata
05886b33e Thu Apr 15 16:43:03 2021 +0300 fix typo
92fb7a164 Thu Apr 15 16:43:03 2021 +0300 don't ignore multitenancy test
24c3e961e Thu Apr 15 16:43:03 2021 +0300 Always run cargo build before tests in CI
b67df00bf Thu Apr 15 17:09:30 2021 +0300 Fix bug in decoding of truncate record
b4c5cb277 Fri Apr 16 10:42:25 2021 +0300 Clean up error types a little bit.
d2c3ad162 Fri Apr 16 10:42:41 2021 +0300 Prefer passing PageServerConf by reference.
e8032f26e Fri Apr 16 08:29:47 2021 -0700 adopt new tokio-postgres:replication branch
2246b4834 Fri Apr 16 08:29:47 2021 -0700 handle keepalive messages
8b70ea4d7 Fri Apr 16 22:54:11 2021 +0300 Undo debugg settings for computation node
4ff248515 Fri Apr 16 15:25:43 2021 -0700 remote unnecessary dependencies between peer crates
35e0099ac Fri Apr 16 15:26:11 2021 -0700 pin remote rust-s3 dependency to a git hash
639c9e826 Fri Apr 16 15:36:36 2021 -0700 .gitignore vscode files
52d627581 Fri Apr 16 15:59:32 2021 -0700 drop nonfunctional attributes allow(dead_code)
33ee5b6ba Sat Apr 17 15:54:57 2021 +0300 Skip truncate records when calculating relation size
e03417a7c Sat Apr 17 14:14:27 2021 -0700 suppress dead_code warnings on nightly
1e6584855 Sun Apr 18 13:13:13 2021 +0300 Add pgbench test
3c7f81084 Sun Apr 18 19:15:06 2021 -0700 clippy cleanup #1
b32cc6a08 Sun Apr 18 23:06:35 2021 -0700 pageserver: change over some error handling to anyhow+thiserror
372581593 Sun Apr 18 23:06:35 2021 -0700 pageserver: propage errors instead of calling .unwrap()
8d1bf152c Sun Apr 18 23:06:35 2021 -0700 fix up logged error for walreceiver connection failed
9809613c6 Mon Apr 19 10:34:51 2021 +0300 Don't try to read from two WAL files in one read() call.
8879f747e Mon Apr 19 14:30:42 2021 +0300 Add multitenancy test for wal_acceptor
8aa3013ec Mon Apr 19 16:28:29 2021 +0300 Merge branch 'main' into rocksdb_pageserver
95160dee6 Mon Apr 19 17:00:30 2021 +0300 Merge with main branch
533087fd5 Mon Apr 19 23:26:13 2021 -0700 cargo fmt
b451ede19 Tue Apr 20 15:57:05 2021 +0300 Use rust bindgen for reading/writing the PostgreSQL control file.
c5d56ffe2 Tue Apr 20 15:57:05 2021 +0300 Fix build: configure postgres in vendor/postgres directory for postgres_ffi
583f64768 Tue Apr 20 17:35:27 2021 +0300 Fix wal safekeeper's reply to IDENTIFY_SYSTEM command.
fa5d31056 Tue Apr 20 17:35:32 2021 +0300 Remove unimplemented "snapshot" subcommand from --help
936cad17e Tue Apr 20 18:28:35 2021 +0300 LSN-aware smgrnblock/smgrexists  implementations
8604bb875 Tue Apr 20 18:46:31 2021 +0300 Increase timeout for running github tests
2c5fb6d6c Tue Apr 20 19:10:37 2021 +0300 Change 'relsize_inc' signature to be a bit nicer.
3600b33f1 Tue Apr 20 19:11:27 2021 +0300 Implement "timelines" in page server
f69db1740 Tue Apr 20 19:11:29 2021 +0300 Make WAL safekeeper work with zenith timelines
d047a3abf Tue Apr 20 19:11:29 2021 +0300 Fixes, per Eric's and Konstantin's comments
f520ef9a6 Tue Apr 20 19:26:27 2021 +0300 Update 'postgres' submodule
d8ab2e00c Tue Apr 20 19:34:48 2021 +0300 Fix compilation failure caused by last minute change in relsize_inc()
7f777a485 Tue Apr 20 20:27:22 2021 +0300 Fix caching of 'postgres' build in github action.
f38776920 Tue Apr 20 11:11:29 2021 -0700 add zenith_utils crate
b5a5ea583 Tue Apr 20 13:21:02 2021 -0700 update README: "zenith pageserver start"
92e4f4b3b Tue Apr 20 17:59:56 2021 -0700 cargo fmt
07507274c Wed Apr 21 16:06:31 2021 +0300 Merge branch 'main' into rocksdb_pageserver
d8fa2ec36 Wed Apr 21 16:10:05 2021 +0300 Merge with main branch
eb42fbade Wed Apr 21 16:30:15 2021 +0300 Re-enable test_redo_cases() test.
e91142787 Wed Apr 21 16:42:12 2021 +0300 Remove some unnecessary dependencies
220a023e5 Wed Apr 21 17:12:43 2021 +0300 Fix typo in error message
c794f128c Wed Apr 21 17:12:43 2021 +0300 Fix a few cargo clippy warnings in tui code
c981f4ad6 Wed Apr 21 19:04:30 2021 +0300 Implement garbage collection of unused versions
4f3f0304c Wed Apr 21 19:05:02 2021 +0300 Merge branch 'main' into rocksdb_pageserver
69b786040 Wed Apr 21 19:33:29 2021 +0300 Decode main_data in decode_wal_record(). Replay XLOG_XACT_COMMIT and XLOG_XACT_ABORT records in walredo. Don't wait for lsn catchup before walreceiver connected. Use 'request_nonrel' branch of vendor/postgres
785502c92 Wed Apr 21 19:52:28 2021 +0300 New version of postgres
a22cb7acc Wed Apr 21 20:19:34 2021 +0300 Merge with main branch
1f3f4cfaf Wed Apr 21 17:56:58 2021 -0700 clippy cleanup #2
8060e17b5 Wed Apr 21 18:02:13 2021 -0700 add SeqWait
2cd730d31 Wed Apr 21 18:02:13 2021 -0700 page_cache: replace long mutex sleep with SeqWait
9b71ae7dc Wed Apr 21 18:02:13 2021 -0700 page_cache: add an assert on the last_valid_lsn
a4fd1e1a8 Thu Apr 22 09:20:05 2021 +0300 Cleanup more issues noted by 'clippy'
18ba16aaa Thu Apr 22 09:25:53 2021 +0300 Fix and improve comment on ZTimelineId.
9e7c45cb7 Thu Apr 22 09:45:13 2021 +0300 Merge with master
f3192ee41 Thu Apr 22 09:45:42 2021 +0300 Merge branch 'main' into rocksdb_pageserver
2dbbb8c59 Thu Apr 22 10:12:22 2021 +0300 Address issues from Eric's review
da9508716 Thu Apr 22 10:37:52 2021 +0300 Address issues from Eric's review
ed30f2096 Thu Apr 22 11:30:27 2021 +0300 Disable GC by default
3ded55027 Thu Apr 22 11:32:40 2021 +0300 Use postgres version with computenode_mode defaulted to false as it has ongoing issues. In a passing also fix test tests on macOS.
bab954b87 Thu Apr 22 11:45:06 2021 +0300 Fix error message wording introduced in previous commit
c5a8c31b8 Thu Apr 22 11:46:20 2021 +0300 Update comments
546266b86 Thu Apr 22 11:53:22 2021 +0300 Merge with main branch
2ca8fbb6f Thu Apr 22 12:01:25 2021 +0300 Fix DEFAULT_GC_PERIOD_SEC type
75baf670f Thu Apr 22 12:42:11 2021 +0300 Remove extra trace
8af5cbedb Thu Apr 22 13:22:34 2021 +0300 Move xlog_utils.rs to postgres_ffi module.
28f280027 Thu Apr 22 14:00:57 2021 +0300 Merge branch 'main' into rocksdb_pageserver
6aa38d3f7 Thu Apr 22 14:08:00 2021 +0300 Merge pull request #54 from zenithdb/rocksdb_pageserver
4a0a9e748 Thu Apr 22 17:52:15 2021 +0300 Enable garbage collector
ff3488fad Thu Apr 22 19:37:33 2021 +0300 Fix bug in do_gc
ee87e6aad Thu Apr 22 22:14:41 2021 +0300 Sum log files in case of test failure
5f277755b Thu Apr 22 22:27:12 2021 +0300 Sum log files in case of test failure
db5712f28 Fri Apr 23 09:41:08 2021 +0300 Dump pageserver.log in case of test errors
0eaff5aa7 Fri Apr 23 11:37:28 2021 +0300 Fix pageserver.log path
59b23fef6 Fri Apr 23 12:40:29 2021 +0300 Wait for WAL receiver to start
904ccbdb7 Fri Apr 23 12:45:59 2021 +0300 Merge pull request #62 from zenithdb/dump_log_files
573f1ada8 Fri Apr 23 13:35:30 2021 +0300 [issue #56] Fix race at postgres instance + walreceiver start. Uses postgres/vendor issue_56_rebased branch.
b64bd2a8a Fri Apr 23 14:06:09 2021 +0300 handle XLOG_DBASE_CREATE in waldecoder
52ee3a2ba Fri Apr 23 17:03:56 2021 +0300 Support CREATE DATABASE command
499b4f7eb Fri Apr 23 18:02:58 2021 +0300 Log garbage collection statistics
8beaf76c8 Fri Apr 23 14:16:34 2021 -0700 SeqWait: don't do wakeups under the lock
6dfe196c4 Fri Apr 23 14:19:24 2021 -0700 add .zenith to .gitignore
fe79082e2 Fri Apr 23 15:01:22 2021 -0700 require documentation in seqwait.rs
93d7d2ae2 Sat Apr 24 12:24:04 2021 +0300 Refactor pagecache <-> Wal redo communication
021462da3 Sat Apr 24 17:54:26 2021 +0300 Refactor put_wal_record() so that it doesn't need to be marked 'async'.
0fc05569e Sat Apr 24 17:54:28 2021 +0300 Improve comments in page_cache.rs.
5e0cc89de Sat Apr 24 17:54:31 2021 +0300 Re-group functions in page_cache.rs, and add comments.
3e007b0eb Sat Apr 24 22:32:22 2021 +0300 Do not delete versions in GC
968cd8f20 Sat Apr 24 23:52:50 2021 +0300 Do not delete versions in GC
1cb9b5523 Sat Apr 24 16:03:44 2021 -0700 cargo fmt
da9bf5dc6 Sun Apr 25 14:11:31 2021 +0300 Store atomic last_valid_lsn after seqwait_lsn.advance
3d3eb0ed1 Sun Apr 25 19:37:02 2021 -0700 add Lsn type
f62ce4bcf Sun Apr 25 19:37:02 2021 -0700 make seqwait generic
01e239afa Sun Apr 25 19:37:02 2021 -0700 apply Lsn type everywhere
d76044605 Sun Apr 25 19:37:02 2021 -0700 remove Lsn::sub in favor of sub_checked
07d024107 Sun Apr 25 19:37:02 2021 -0700 add AtomicLsn
1c775bdca Sun Apr 25 19:37:02 2021 -0700 Drop LSNs from PageCacheStats
648755a25 Sun Apr 25 19:37:02 2021 -0700 add Lsn::block_offset, remaining_in_block, calc_padding
96b6f350a Sun Apr 25 19:37:02 2021 -0700 add test cases for Lsn math and AtomicLsn
abcecc992 Mon Apr 26 09:30:03 2021 +0300 [refer #67] Replace File.write with File.write_all
5292b502f Mon Apr 26 11:06:31 2021 +0300 Check regression test exit status
3b9e7fc5e Mon Apr 26 13:07:51 2021 +0300 Use explicit threads.
bc652e965 Mon Apr 26 13:30:10 2021 +0300 Save old 'async' version of SeqWait, in case we need it later.
4f529b7d4 Mon Apr 26 13:54:06 2021 +0300 Remove unused function.
f61711546 Mon Apr 26 14:12:57 2021 +0300 Remove obsolete comment on async usage in the page cache
3b09a74f5 Mon Apr 26 16:23:00 2021 +0300 Implement offloading of old WAL files to S3 in walkeeper
636194406 Mon Apr 26 17:04:26 2021 +0300 Dump log files in case of regress_tests failure
c59830fd0 Mon Apr 26 17:57:29 2021 +0300 Do not restart wal-redo-postgres
b361558a8 Mon Apr 26 18:35:26 2021 +0300 fix typo in transaction replay code
fdf6829de Mon Apr 26 09:36:22 2021 -0700 cargo fmt
4acdcbe90 Mon Apr 26 12:35:35 2021 -0700 clippy cleanup #3
cff671c1b Tue Apr 27 10:32:39 2021 +0300 Remove duplicated LSN fields from the page cache.
96beffb3c Tue Apr 27 13:43:39 2021 +0300 Add tests for the `Lsn::fetch_max` function.
44a85d917 Tue Apr 27 15:33:38 2021 +0300 Put back 'pgbuild.sh', which was removed accidentally.
c7f54af1f Tue Apr 27 21:43:56 2021 +0300 Refactor page_cache <-> walredo interface.
d311f708b Wed Apr 28 13:56:27 2021 +0300 handle subtrans in COMMIT/ABORT records
ef37eb96b Wed Apr 28 13:56:27 2021 +0300 refactor XLogRecord reading
421d58695 Wed Apr 28 13:56:27 2021 +0300 code cleanup for XLogRecord decoding
bbec5a13b Wed Apr 28 15:26:08 2021 +0300 Extract appname from startup package
41a3772e9 Wed Apr 28 16:54:45 2021 +0300 Replace pgbuild.sh with a Makefile
34d55b09a Wed Apr 28 17:24:31 2021 +0300 [issue #73] fix wal_acceptor merge problem caused by 3fea78d6
7a8501d12 Wed Apr 28 17:24:31 2021 +0300 [issue #73] fix race in test_acceptors_unavailability test
14168c7aa Wed Apr 28 17:24:31 2021 +0300 Increase downtime timeout to avoid address already in use error and fix checking for elapsed time
ab61ce226 Wed Apr 28 17:24:31 2021 +0300 Fix merge conflict, add more comments to test_acceptors_unavailability
975b2d12d Wed Apr 28 10:01:58 2021 -0700 cargo fmt
61aee52a9 Wed Apr 28 12:14:03 2021 -0700 split github jobs
69df9f10e Wed Apr 28 12:30:06 2021 -0700 limit github actions to main branch
6a43b293a Wed Apr 28 14:32:58 2021 -0700 fix a few CLI typos
158d1bbbb Thu Apr 29 09:02:51 2021 +0300 Don't create temp dir under current dir in 'zenith init'.
26115818b Thu Apr 29 10:48:56 2021 +0300 Test for embedded wal acceptor
f491a22d8 Thu Apr 29 14:41:13 2021 +0300 Add test for embedded WAL acceptor
e7b112aac Thu Apr 29 18:41:42 2021 +0300 Refactor pg_constants. Move them to postgres_ffi/
b49164a1d Thu Apr 29 18:41:42 2021 +0300 cargo fmt
1369145e8 Thu Apr 29 18:41:42 2021 +0300 code cleanup
68aa2febc Thu Apr 29 19:27:17 2021 +0300 Disable test_embedded_wal_proposer test
b77597bd9 Thu Apr 29 10:31:01 2021 -0700 remove old Cargo.lock files
6c7ea82a6 Thu Apr 29 15:10:04 2021 -0700 Disable test_embedded_wal_proposer without compiler warning
086c0ad82 Fri Apr 30 12:44:06 2021 +0300 Remove unused 'apply_pending' field.
eea6f0898 Fri Apr 30 14:22:47 2021 +0300 Restore CLOG from snapshot
f82c3eb5e Fri Apr 30 15:18:32 2021 +0300 Enable wal proposer test
651a8139f Fri Apr 30 19:24:00 2021 +0300 Fix bug in transaction_id_set_status_bit
9ad99152b Fri Apr 30 19:50:27 2021 +0300 Merge pull request #84 from zenithdb/embedded_wal_proposer
3762b5398 Sat May 1 03:32:48 2021 +0300 show branch name in "zenith pg list"
da9696589 Sun May 2 17:19:09 2021 +0300 Remove assert(is_ok) before unwrap.
49530145d Sun May 2 11:03:58 2021 -0700 cargo fmt
7d104e566 Sun May 2 16:01:18 2021 -0700 update dependencies
1cdeba9db Mon May 3 15:17:51 2021 +0300 [issue #18] log module name and position in the file
277a4d458 Mon May 3 11:31:32 2021 -0700 allow zenith to run using arbitrary paths
37cd662ab Mon May 3 11:31:32 2021 -0700 add pytest integration tests
790f1b05c Mon May 3 11:31:32 2021 -0700 Add circleCI build & test jobs
129f85f65 Mon May 3 11:31:32 2021 -0700 circleci: shallow clone the postgres repo
219cbe2d9 Mon May 3 11:31:32 2021 -0700 pytest: improve documentation and protect against wrong versions
a3818dee5 Mon May 3 14:02:10 2021 -0700 pin dependencies to versions
a08dfb1c2 Mon May 3 14:07:46 2021 -0700 gitignore .zenith only in git root
effcabb59 Mon May 3 14:29:29 2021 -0700 circleci: do builds on a bigger container.
ce646ea84 Mon May 3 18:46:10 2021 -0700 use tokio::try_join instead of futures::try_join
3e15a5c32 Mon May 3 18:46:50 2021 -0700 test_runner fixtures: feedback from review
4e2e5bb4e Mon May 3 19:54:13 2021 -0700 implement "zenith pageserver stop"
aac913f9d Mon May 3 23:20:51 2021 -0700 use nix kill instead of spawning a process
aa6439126 Mon May 3 23:20:51 2021 -0700 fix clippy warning about redundant clone
e6a098718 Mon May 3 23:32:06 2021 -0700 python fixtures: enable "zenith pageserver stop"
f5b45a172 Mon May 3 23:51:10 2021 -0700 circleci: flush caches
86932c20e Mon May 3 23:53:59 2021 -0700 circleci: disable imperfect match on the rust cache
2e0d45d09 Tue May 4 12:02:00 2021 -0700 Switch to upstream rust-s3
b9c0d2204 Tue May 4 12:43:36 2021 -0700 circleci: shrink python tracebacks
e5413be5f Wed May 5 00:37:28 2021 +0300 Update 'postgres' submodule to latest version.
b484b896b Wed May 5 10:37:36 2021 +0300 Refactor the functionality page_cache.rs.
eeec1a3dc Wed May 5 10:39:28 2021 +0300 Refactor the way truncations are handled.
4dd63821b Wed May 5 10:39:28 2021 +0300 Improve trace log messages in page server
8e57c2e41 Wed May 5 15:47:11 2021 +0300 Provide more context to a panic.
efa4ecaa7 Wed May 5 15:47:13 2021 +0300 Reduce the duration of the pgbench test.
1591f058c Wed May 5 16:38:32 2021 +0300 implement Debug for Lsn type
0fe5abadf Wed May 5 17:29:10 2021 +0300 Remove dead code around tracking first valid LSN.
bf0a0cb55 Wed May 5 20:14:09 2021 +0300 Remove unused struct
29f122009 Thu May 6 11:34:28 2021 +0300 Don't restart WAL streaming in the middle of a record.
15db0d1d6 Thu May 6 12:58:08 2021 +0300 refactor walreciever and restore_local_repo
33d126ecb Thu May 6 21:57:01 2021 +0300 Tidy up usage of a few constants from PostgreSQL headers.
e7ca58092 Thu May 6 21:57:04 2021 +0300 Improve comments.
a68f60415 Thu May 6 21:57:07 2021 +0300 Change a few remaining functions to use the Lsn datatype for LSNs.
61af9bb88 Thu May 6 21:57:10 2021 +0300 Move a few functions that have been copy-pasted around to shared module.
77fd24b95 Thu May 6 21:57:13 2021 +0300 Fix a few clippy warnings.
b7575582b Thu May 6 23:02:11 2021 +0300 Add comments to the Repository/Timeline traits.
e5e5c3e06 Fri May 7 11:01:34 2021 +0300 Tidy up the `parse_relfilename` function.
df5a55c44 Fri May 7 13:08:31 2021 -0700 add workspace_hack crate
d26b76fe7 Fri May 7 13:11:44 2021 -0700 cargo fmt
8952066ec Sun May 9 22:20:58 2021 -0700 circleci: Save the postgres logs as artifacts
4b46693c8 Mon May 10 15:24:55 2021 -0700 adapt to new upstream tokio-postgres replication interface
6c825dcba Mon May 10 15:24:55 2021 -0700 switch walkeeper over to new postgres blocking interface
d25656797 Mon May 10 15:24:55 2021 -0700 switch pageserver to blocking postgres interface
176720856 Mon May 10 15:24:55 2021 -0700 remove tokio-postgres from dependencies
36c12247b Mon May 10 16:21:05 2021 -0700 add bin_ser module
0cbb3798d Mon May 10 16:21:05 2021 -0700 try using serde to do all the serialization in wal_service
4788248e1 Mon May 10 16:21:05 2021 -0700 wal_service: remove manual serialization code
8d8bc304c Mon May 10 16:21:05 2021 -0700 work around NodeId endian issues
28b4d9abb Mon May 10 16:21:05 2021 -0700 wal_service: use anyhow for error handling
294320e6a Mon May 10 16:21:05 2021 -0700 wal_service: drop repr(C)
60d66267a Mon May 10 16:21:05 2021 -0700 add serde support to Lsn type
bace19ffb Mon May 10 16:21:05 2021 -0700 wal_service: switch to Lsn type
95db33f3f Mon May 10 16:21:05 2021 -0700 wal_service: comment cleanup
73647e571 Mon May 10 16:21:05 2021 -0700 wal_service: fix NodeId order/endian issues
e5df42fee Mon May 10 18:21:45 2021 -0700 add workspace_hack dependency to zenith_utils
6e748147b Tue May 11 00:09:39 2021 -0700 test_runner: fix relative import syntax
ff76226a3 Tue May 11 10:54:41 2021 +0300 Remove obsolete mgmt-console.
fb71c85a7 Tue May 11 10:55:51 2021 +0300 Implement std::fmt::Display for RelTag, for debug messages.
5f4e32f50 Tue May 11 11:12:14 2021 +0300 Require valid WAL streaming point.
8fff26ad4 Tue May 11 15:27:23 2021 +0300 Make Repository API return abstract dyn Timeline.
d5bfe84d9 Tue May 11 12:35:09 2021 -0400 cargo fmt
d8e509d29 Tue May 11 14:11:10 2021 -0400 page_service - use anyhow for error handling
49d1921a2 Tue May 11 14:16:22 2021 -0400 page_server - add python api tests
372617a4f Tue May 11 17:52:22 2021 -0400 test_runner - pgrep remove -c arg
22e7fcbf2 Wed May 12 10:38:43 2021 +0300 Handle visbility map updates in WAL redo
2f2dff4c8 Wed May 12 10:46:01 2021 +0300 Merge with main brnach
99d80aba5 Wed May 12 12:34:03 2021 +0300 use pageserver for pg list command
4c5e23d01 Wed May 12 20:59:04 2021 -0400 pageserver - fix ParameterStatus write call
6ff3f1b9f Thu May 13 00:32:39 2021 -0700 don't open log files multiple times
38c4b6f02 Thu May 13 16:23:21 2021 +0300 Move postgres code related to zenith pageserver to contrib/zenith.
4dccdb33a Thu May 13 22:06:05 2021 +0300 Fix comment formatting.
54d52e07d Thu May 13 13:47:22 2021 -0700 .gitignore integration_tests/.zenith
71e93faed Thu May 13 19:04:17 2021 -0700 fix endian typos in BeSer
c2db82848 Fri May 14 12:44:44 2021 +0300 Create RocksDB databases under correct path.
270356ec3 Fri May 14 12:44:49 2021 +0300 Refactor WalRedoManager for easier testing.
97992226d Fri May 14 12:44:52 2021 +0300 Add some unit tests for the Repository/Timeline interface.
7b281900f Fri May 14 13:55:02 2021 +0300 Add a function to change postgresql.conf in python tests. Add test_config as an example
287015036 Fri May 14 13:55:02 2021 +0300 bump vendor/postgres
9ece1e863 Fri May 14 16:35:09 2021 +0300 Compute and restore pg_xact, pg_multixact and pg_filenode.map files
15d1c1f8b Fri May 14 17:15:14 2021 +0300 Update submodule version
6b11b4250 Sat May 15 01:42:33 2021 +0300 Fix compilation with older rust version.
04dc698d4 Sun May 16 00:03:20 2021 +0300 Add support of twophase transactions
b266c2834 Mon May 17 10:07:42 2021 +0300 Use common Lsn datatype in a few more places
532918e13 Mon May 17 10:09:34 2021 +0300 Fix branch creation at a point other than end-of-WAL
d737c40ee Mon May 17 11:43:18 2021 +0300 copy safekeeper README from older C version to current Rust version
952424b78 Mon May 17 15:16:28 2021 +0300 Move save_decoded_record() function to Repository trait.
53ea6702b Mon May 17 11:14:01 2021 -0400 zenith - pg list relax pageserver dependency
746f66731 Mon May 17 19:17:51 2021 +0300 Refactor CLI and CLI<->pageserver interfaces to support remote pageserver
398d522d8 Mon May 17 09:29:58 2021 -0700 cargo fmt
e60280747 Mon May 17 20:44:00 2021 +0300 Be more lenient with branch names.
52fbcbde0 Mon May 17 20:44:00 2021 +0300 Add junit.xml file to pytest output, to show more info in CircleCI
ab2f0ad1a Mon May 17 20:44:00 2021 +0300 Fix and reorganize python tests.
f954d5c50 Mon May 17 17:17:08 2021 -0400 pageserver - separate pagestream messages
23be5021f Tue May 18 01:04:00 2021 -0400 Remote CLI command
45b1495f3 Tue May 18 01:04:00 2021 -0400 store remotes in main config file
8624bddc7 Tue May 18 09:48:42 2021 +0300 Rearrange "use" lines, mostly by cargo fmt.
9ba7bc269 Tue May 18 14:48:46 2021 +0300 update vendor/postgres
66bced0f3 Tue May 18 20:47:35 2021 +0300 Fix leftover comment about async I/O
2b2d24433 Tue May 18 20:49:59 2021 +0300 Don't panic on zenith-specific "fork numbers".
21ea70c8f Tue May 18 21:32:16 2021 +0300 Fix test_acceptors_restarts.
2ff16da6a Wed May 19 08:35:12 2021 +0300 Remove redundant cargo tests.
a6178c135 Wed May 19 08:49:09 2021 +0300 Fix starting page server in non-daemonize mode.
1912546e5 Wed May 19 08:49:16 2021 +0300 Change the meaning of PageServerConf.workdir
aa8debf4e Wed May 19 09:22:17 2021 +0300 Add test for a relation that's larger than 1 GB.
709b77890 Wed May 19 12:32:57 2021 +0300 Show help in CLI when no arguments provided
e6a7241c3 Wed May 19 12:33:38 2021 +0300 Simplify construction of rocksdb keys and values.
538f90386 Wed May 19 14:08:37 2021 +0300 Optimize parse_relfilename() function.
31462f4b7 Wed May 19 22:17:48 2021 +0300 Reuse page_server.branches_list in CLI code
58f34a8d7 Wed May 19 22:17:48 2021 +0300 Rework pg subcommand in CLI.
d59cb2ca7 Wed May 19 22:17:48 2021 +0300 clean up some leftovers after 746f66731
c12e393e7 Wed May 19 22:17:48 2021 +0300 move cargo_bin_dir() to integration_tests crate as is it used only there
e3e593f57 Wed May 19 22:31:28 2021 +0300 Don't send spurious ReadyForQuery messages in extended query protocol.
cedc2eb5c Wed May 19 14:36:41 2021 -0700 wal_service: add BufReader
513696a48 Wed May 19 14:36:41 2021 -0700 break wal_service into multiple pieces
a11558b84 Wed May 19 14:36:41 2021 -0700 break wal_service into multiple files
74b78608d Wed May 19 14:36:41 2021 -0700 split timeline code into a separate file
78dcf2207 Wed May 19 14:36:41 2021 -0700 replace manual deserialization with serde + BeSer
2148ae78a Wed May 19 14:36:41 2021 -0700 wal_service: remove manual output buffering
3296b7d77 Wed May 19 14:36:41 2021 -0700 wal_service: permit I/O errors while reading control file
d744ddee7 Wed May 19 14:36:41 2021 -0700 bin_ser: preserve IO errors on deserialization
858ca3a4c Wed May 19 14:36:41 2021 -0700 bin_ser: simplify ser_into_slice
1ec157653 Wed May 19 14:36:41 2021 -0700 bin_ser: expand serialize error type, add serialized_size
cf30303d8 Wed May 19 14:36:41 2021 -0700 extract protocol peek code; rename Connection -> ReceiveWalConn
8f43d7637 Wed May 19 14:36:41 2021 -0700 wal_service: move code around some more
fbb04c592 Wed May 19 14:36:41 2021 -0700 wal_service: change error message at thread exit
e0146304e Wed May 19 14:36:41 2021 -0700 timeline: make SharedState and some constructors private
9fe3b73e1 Wed May 19 14:36:41 2021 -0700 walkeeper replication: remove the lock from the send stream.
4c35b2262 Wed May 19 14:36:41 2021 -0700 Remove FIXME about buffer pools
4d5a41301 Thu May 20 00:37:46 2021 +0300 Support returning errors from page service
8faa6fa39 Thu May 20 00:37:46 2021 +0300 Accept semicolon right after branch_create command
2f25d17e1 Thu May 20 00:37:46 2021 +0300 Set more error fields to satisfy rust-postgres parser
872ed2440 Thu May 20 00:37:46 2021 +0300 Manually handle all error throwing for branch and init commands
9c0ac251d Thu May 20 00:37:46 2021 +0300 Describe BeMessage::ErrorResponse format in comments
9c94a34ae Wed May 19 15:26:21 2021 -0700 cargo fmt
600e1a008 Thu May 20 09:11:36 2021 +0300 Pass PageServerConf as static ref.
0ec56cd21 Thu May 20 12:49:04 2021 +0300 Issue #144: Branching output of `zenith branch`
b5f60f387 Thu May 20 12:49:04 2021 +0300 Issue #144: Refactor errors handling during branches tree printing
06f96f960 Thu May 20 14:13:47 2021 +0300 Do not transfer WAL to computation nodes: use pg_resetwal for node startup
20b6279be Thu May 20 14:14:52 2021 +0300 Fix restoring non-relational data during compute node startup
364513370 Thu May 20 14:39:27 2021 +0300 Fix conflicts with main branch
874d82fd4 Thu May 20 14:45:09 2021 +0300 Fix tests in lsn.rs after changing wal_seg_size type
2bf2dd1d8 Thu May 20 14:48:55 2021 +0300 Add nonrelfile_utils.rs file
86056abd0 Thu May 20 15:26:39 2021 +0300 Fix merge conflict: set initial WAL position to second segment because of pg_resetwal
f38c2e620 Thu May 20 17:24:39 2021 +0300 Add test_zenith_regress.py that runs pg_regress styled tests from test_runner/zenith_regress. TODO: remove similar tests from vendor/postgres testset
87d7ce816 Thu May 20 17:42:07 2021 +0300 Add pause in pageserver stop method to avoid address already in use errors
8465738aa Thu May 20 19:16:16 2021 +0300 [refer #167] Fix handling of pg_filenode.map files in page server
c1bfa3277 Thu May 20 19:25:25 2021 +0300 Follow up for issue #144, better graphics in branches tree
ecf2d181c Thu May 20 19:28:57 2021 +0300 Tidy up the code to create PageServerConf
2127a65e2 Thu May 20 19:29:00 2021 +0300 Tidy up the code to launch WAL redo process a little bit
1f6ca23db Fri May 21 00:26:31 2021 +0300 Be slightly more vocal about pageserver start/stop
d45839879 Fri May 21 00:26:31 2021 +0300 Bind to socket earlier during pageserver init.
d534aeb9e Fri May 21 00:26:31 2021 +0300 Properly propagate control plane errors to CLI.
6ad6e5bd8 Fri May 21 00:26:31 2021 +0300 Add --destroy flag to "pg stop" CLI command
c2b2ab974 Fri May 21 00:26:31 2021 +0300 Hide initdb output from "zenith init" command
42f3dd47d Fri May 21 00:26:31 2021 +0300 update README.md according to recent CLI changes
40d047c14 Fri May 21 00:26:31 2021 +0300 Remove double "zenith" mention in CLI header
d95e1da74 Fri May 21 12:06:46 2021 +0300 Fix issue with propagation of CREATE DATABASE to the branch
22b7e74c8 Fri May 21 12:13:47 2021 +0300 Add test for following relmapper files at CREATE DATABASE
35a1c3d52 Fri May 21 12:20:38 2021 +0300 Specify right LSN in test_createdb.py
610e14a7f Fri May 21 12:36:24 2021 +0300 Use new version of postgres
ce54133ec Fri May 21 12:46:17 2021 +0300 Use zenith smgr for global relations
7685372ca Fri May 21 13:04:56 2021 +0300 Fix warning in test_wal_acceptor
c093ee5e4 Fri May 21 14:07:16 2021 +0300 Fix start_node_with_wal_proposer test
4b78a16b8 Fri May 21 09:17:11 2021 -0700 break circleci build into two jobs
d6ee61b5c Fri May 21 09:17:11 2021 -0700 circleci: build & test debug + release
064aa44a0 Fri May 21 09:17:11 2021 -0700 fix `cargo install` to honor build_type
eb1f1a347 Fri May 21 09:17:11 2021 -0700 rust builds: disable incremental builds
0fe81b299 Sat May 22 00:30:44 2021 +0300 Update postgres submodule
4aabc9a68 Sun May 23 13:17:15 2021 -0700 easy clippy cleanups
fb230dcf3 Mon May 24 15:17:35 2021 +0300 Add test_multixact to check that we replay multixact and advance next_multixact_id correctly
84508d4f6 Mon May 24 15:17:35 2021 +0300 fix replay of nextMulti and nextMultiOffset fields
a0e23e6f3 Mon May 24 15:29:16 2021 +0300 Debug Timed out while waiting for WAL record problem
6f9a58297 Mon May 24 15:29:16 2021 +0300 increase wait_lsn timeout to make tests more stable
6a9c036ac Mon May 24 16:05:45 2021 +0300 Revert all changes related to storing and restoring non-rel data in page server
d5fe51536 Mon May 24 17:02:05 2021 +0300 Implement "checkpointing" in the page server.
69fa10ff8 Mon May 24 17:12:18 2021 +0300 Fix rocksdb get_relsize() implementation to work with historic LSNs.
6f9175ca2 Mon May 24 17:28:56 2021 -0700 cargo fmt
e8f0a9bb8 Tue May 25 11:11:32 2021 +0300 Add test for prepared transactions.
7c73afc1a Tue May 25 14:56:19 2021 -0700 switch repository types to serde
263acef1c Tue May 25 16:41:15 2021 -0700 README updates
b1a424dfa Wed May 26 12:05:13 2021 +0300 Add more info about borrowed from Postgres structures (RelTag and BufferTag)
1ccf82f93 Wed May 26 12:05:13 2021 +0300 More info about branches tree drawing routines
cb6e2d9dd Thu May 27 09:44:46 2021 +0300 Minor refactoring and cleanup of the Timeline interface.
1af6607fc Thu May 27 12:59:45 2021 +0300 Add a test for restarting and recreating compute node.
cffc97905 Thu May 27 14:32:04 2021 +0300 Fix a couple of typos in comments.
60ea26316 Thu May 27 15:33:08 2021 +0300 Add LICENSE and COPYRIGHT files.
d1d2d5ce6 Thu May 27 20:00:52 2021 +0300 Make multixact test more robust
34f420750 Thu May 27 20:07:50 2021 +0300 Refactoring of the Repository/Timeline stuff
4b6563a55 Thu May 27 20:50:45 2021 +0300 Little cleanup on `save_decoded_record` function
78e3edf2e Thu May 27 23:07:37 2021 +0300 Add CONTRIBUTING.md with some ground rules for submitting PRs.
adc0e0420 Thu May 27 23:12:02 2021 +0300 Misc cleanup of the 'zenith_regress' tests
6b615cbde Thu May 27 23:16:54 2021 +0300 Remove Copy marker from large ServerInfo struct.
ccb2eea7f Fri May 28 11:38:46 2021 +0300 Add test_isolation that runs pg_isolation_regress for zenith
4608b1ec7 Fri May 28 11:38:46 2021 +0300 Set wal_log_hints=on
5a73a6fdf Fri May 28 20:33:16 2021 +0300 add -w flag to wait till pg_ctl actually finishes what was asked
fd20101e5 Mon May 31 16:43:01 2021 +0300 Configure pipenv for python tests.
e0cc4dee4 Mon May 31 21:37:07 2021 +0300 [refer #182] Make walkeeper periodically send callme requests to pageserver
1aceea1bd Mon May 31 21:37:07 2021 +0300 Shutdown socket in ReplicationConn
ac60b68d5 Mon May 31 23:36:17 2021 +0300 Handle VM and FSM truncation WAL records in the page server.
922715a92 Tue Jun 1 09:37:54 2021 +0300 Use Timeline::get_last_record_lsn() to find end-of-WAL.
0b9bbdc4e Tue Jun 1 16:08:32 2021 +0300 Remove libxml2 and curl from postgres dependencies.
588a03080 Tue Jun 1 16:08:32 2021 +0300 Clean up control_plane's Cargo.toml
002cd8ed5 Tue Jun 1 16:08:32 2021 +0300 Dockerfile for pageserver.
e12cab7c1 Tue Jun 1 17:07:10 2021 +0300 fix dockerfile comments
31815bccc Tue Jun 1 18:27:54 2021 +0300 Remove obsolete script.
558a2214b Tue Jun 1 18:28:01 2021 +0300 Fix comment
fc01fae9b Tue Jun 1 18:50:24 2021 +0300 Remove leftover references to safekeeper_proxy.
0c74f6fa4 Tue Jun 1 19:38:42 2021 +0300 Update README about source tree layout
0e423d481 Tue Jun 1 19:38:42 2021 +0300 Update rustdoc comments and README for pageserver crate
bed75f800 Tue Jun 1 20:04:22 2021 +0300 Bump vendor/postgres to use rebased on top of REL_14_BETA1 version
7d5f7462c Tue Jun 1 21:09:09 2021 +0300 Tidy up pytest-based tests
00ce635da Tue Jun 1 21:09:09 2021 +0300 Reformat tests using yapf
8c3c9c339 Tue Jun 1 21:31:29 2021 +0300 Update README.md
244fcffc5 Tue Jun 1 21:43:26 2021 +0300 Fix typos found by codespell
f2243d745 Tue Jun 1 22:06:13 2021 +0300 Merge pull request #219 from zenithdb/tidy-up-tests
3364a8d44 Wed Jun 2 16:20:26 2021 -0400 pageserver - timeline history api
47694ea4f Wed Jun 2 17:20:49 2021 -0400 zenith push
445e88f50 Thu Jun 3 15:54:59 2021 +0300 Minor fix: preserve log of regression tests in circleci
063429aad Fri Jun 4 20:11:56 2021 +0300 Implement GC for new object_store API (#229)
924261f7d Fri Jun 4 23:05:02 2021 +0300 Remove unused ControlFile::new() constructor.
762e9859d Fri Jun 4 23:05:05 2021 +0300 Move functions for reading/writing control file to separate source file.
d18cc8a3a Fri Jun 4 23:05:11 2021 +0300 Update 'postgres_ffi' module's readme file and comments.
8147aa7e9 Fri Jun 4 23:05:20 2021 +0300 Use u8 slice instead of Bytes in function argument.
8b5a061c8 Fri Jun 4 23:05:26 2021 +0300 Add comments on the unsafe use of transmute in encode/decode_pg_control
a7ae55285 Fri Jun 4 23:05:28 2021 +0300 Use rust memoffset crate to replace C offsetof().
434374ebb Fri Jun 4 23:05:30 2021 +0300 Turn encode/decode into methods
9b8e82c6c Mon Jun 7 19:24:20 2021 +0300 Fix makefile for out-of-tree compiling of contrib/zenith
d85d67a6f Tue Jun 8 13:08:57 2021 +0300 use constants defined in xlog_utils for waldecoder
c31a5e2c8 Tue Jun 8 13:08:57 2021 +0300 move XLogPageHeader structs to xlog_utils
2b0193e6b Tue Jun 8 13:08:57 2021 +0300 implement from_bytes for XLogPageHeader structs
b2f51026a Tue Jun 8 17:31:40 2021 +0300 Consolidate PG proto parsing-deparsing and backend code.
507c1fbba Tue Jun 8 17:46:43 2021 +0300 bump vendor/postgres
05a681be2 Wed Jun 9 00:31:09 2021 +0300 add createuser test to test shared catalog restore
0969574d4 Wed Jun 9 01:00:42 2021 +0300 Use bindgen for various xlog structures and checkpoint. Implement encode/decode methods for them.
bb1446e33 Wed Jun 9 11:24:55 2021 +0300 Change behavior of ComputeControlPlane::new_node() (#235)
bf56ea8c4 Wed Jun 9 20:17:27 2021 +0300 Locate postgres binary and libs for 'postgres --wal-redo' based on POSTGRES_DISTRIB_DIR.
7a3794ef1 Thu Jun 10 12:04:52 2021 -0700 tui_event: unwrap result of stdin.keys()
96c7594d2 Thu Jun 10 22:53:15 2021 +0300 Enable some kind of gradual typing in test_runner (#222)
1c5be1251 Fri Jun 11 10:37:25 2021 +0300 Fix compilation with Rust versions < 1.50
78aad4fe3 Mon Jun 14 11:58:53 2021 +0300 Show initdb stderr for unsuccessful runs
da117f431 Mon Jun 14 11:58:53 2021 +0300 run & init from dockerfile
c3011359a Mon Jun 14 11:58:53 2021 +0300 remove --systemid from walkeeper
2b66049b2 Mon Jun 14 11:58:53 2021 +0300 add wal_acceptor binary to docker image
19602dc88 Mon Jun 14 11:58:53 2021 +0300 add wal_acceptor binary in Dockerfile
5c70b52f4 Mon Jun 14 11:58:53 2021 +0300 remove --systemid flag from wal_acceptor
09b2c66cf Mon Jun 14 12:38:29 2021 +0300 Cache relation size
6d7942ece Mon Jun 14 12:38:29 2021 +0300 Use RwLock instead of mutex for relation metadata cache
6403f1745 Mon Jun 14 12:38:29 2021 +0300 Replace rel_meta.range() with rel_meta.get()
cb4f5e911 Mon Jun 14 12:38:29 2021 +0300 Fix problem with rel_meta.get
9b7b31181 Mon Jun 14 12:38:29 2021 +0300 New version of postgres
9af04b3b8 Mon Jun 14 12:38:29 2021 +0300 Do not cache dropped relation metadata
77366b7a7 Mon Jun 14 09:40:22 2021 -0700 pageserver - remove env variables
cc169a689 Mon Jun 14 09:40:22 2021 -0700 pageserver - config file
37b0236e9 Tue Jun 15 15:14:27 2021 +0300 Move wal acceptor tests to python.
36d6c401b Tue Jun 15 15:14:27 2021 +0300 bump vendor/postgres
d2d5a0152 Tue Jun 15 10:52:11 2021 -0700 minor clippy fixes
39c1d4896 Tue Jun 15 10:52:11 2021 -0700 add a clippy shell script
7c5532303 Wed Jun 16 14:45:43 2021 +0300 Preserve wal acceptor logs in CI.
11efafb05 Wed Jun 16 14:45:43 2021 +0300 Don't capture pytest output in CI.
f923464b9 Wed Jun 16 18:52:36 2021 +0300 Remove pq_protocol.rs.
43ece6e2a Thu Jun 17 20:19:04 2021 +0300 Fix test_runner's fixtures for python 3.6
257ade068 Thu Jun 17 20:19:04 2021 +0300 Extract PostgreSQL connection logic into PgProtocol
4f1b22a2c Tue Jun 22 21:34:31 2021 +0300 Use ObjectTag enum instead of special fork number to store metadata objects.
226204094 Fri Jun 25 09:43:55 2021 +0300 Fix recall parmeter handling in walkeeper
183a3022a Fri Jun 25 11:47:59 2021 +0300 cargo fmt
b314311f4 Sun Jun 27 16:14:24 2021 +0300 fix dockerfile with new init cli keys
eb7388e3e Mon Jun 28 14:21:30 2021 +0300 Add debug info to release builds
cb2ddf06d Mon Jun 28 16:49:21 2021 +0300 Refactor code to do one iteration of GC to separate function.
0dd46061a Mon Jun 28 16:53:13 2021 +0300 Improve logging and comments in GC.
a31bba19b Mon Jun 28 16:53:26 2021 +0300 Compact RocksDB database after garbage collection.
ec44f4b29 Mon Jun 28 17:07:28 2021 +0300 Add test for Garbage Collection.
44c35722d Tue Jun 29 00:26:53 2021 +0300 Remove a bunch of dead code
ced338fd2 Tue Jun 29 00:27:10 2021 +0300 Handle relation DROPs in page server.
d4329887b Tue Jun 29 18:12:32 2021 +0300 remove restore_s3.rs that uses obsolete data format
9c856ecf4 Wed Jun 30 12:50:32 2021 +0300 Update TODO comment now that we handle relation drops
3386ce6f3 Wed Jun 30 12:50:35 2021 +0300 Introduce common enum ObjectVal for all values stored in ObjectStore.
96f4ddd24 Mon Jul 5 21:50:42 2021 -0700 cargo fmt
2712eaee1 Fri Jul 9 14:59:45 2021 +0300 [postgres] Enable seccomp bpf
462b8801d Fri Jul 9 15:25:53 2021 +0300 Fix list_rels visibility check: some relations after initdb may have lsn equal to last_valid_lsn()
4987d5ee1 Fri Jul 9 16:45:48 2021 +0300 reduce lodding in wal_acceptor
75e717fe8 Fri Jul 9 16:46:21 2021 +0300 allow both domains and ip addresses in connection options for pageserver and wal keeper. Also updated PageServerNode definition in control plane to account for that. resolves #303
577af8a45 Fri Jul 9 17:24:25 2021 +0300 Store page image with the same LSN as replaced WAL record
baf8800b9 Sat Jul 10 10:09:56 2021 +0300 Fix incorrect mask in wldecoder
97681acfc Sat Jul 10 10:09:56 2021 +0300 Replace XLR_RMGR_INFO_MASK with XLOG_HEAP_OPMASK
3e69c41a4 Sat Jul 10 10:09:56 2021 +0300 Add XLOG_HEAP_OPMASK to pg_contants
19528de03 Sat Jul 10 18:30:47 2021 +0300 Fix inaccurate comment on how often we checkpoint the repository.
bfc27bee5 Sat Jul 10 18:53:47 2021 +0300 Revert the fix to allegedly inaccurate comment.
038dc6c62 Mon Jul 12 21:30:52 2021 +0300 Symlink Pipfile (& Pipfile.lock) at the top level
d119f2bcc Tue Jul 13 09:54:27 2021 +0300 Add unit test for branch creation.
ad92b66ee Wed Jul 14 15:55:12 2021 +0300 Fix TimestampTz type to i64 to be compatbile with Postgres
befefe8d8 Wed Jul 14 22:03:14 2021 +0300 Run 'cargo fmt'.
c5509b05d Fri Jul 16 12:37:10 2021 +0300 Revert accidental change to vendor/postgres.
ed0fcfa9b Fri Jul 16 14:30:27 2021 +0300 replace parse_duration crate because of unpatched known vulnerability
8a541147e Fri Jul 16 15:04:56 2021 +0300 run cargo generate-lockfile
eb0a56eb2 Fri Jul 16 18:43:07 2021 +0300 Replay non-relational WAL records on page server
3cded2066 Fri Jul 16 18:43:07 2021 +0300 Refactring after Heikki review
842419b91 Fri Jul 16 18:43:07 2021 +0300 Do not update relation metadata in get_page_at_lsn
dcabe694e Fri Jul 16 18:43:07 2021 +0300 Fix usage of put_page_image in save_xlog_dbase_create
56da87cad Fri Jul 16 18:43:07 2021 +0300 Merge with main branch
46e613f42 Fri Jul 16 18:43:07 2021 +0300 Fix typos
386403dcd Fri Jul 16 18:43:07 2021 +0300 Hold CLOG for prepared transactions
f6705b7a7 Fri Jul 16 18:43:07 2021 +0300 Fix TimestampTz type to i64 to be compatbile with Postgres
e74b06d99 Fri Jul 16 18:43:07 2021 +0300 Pass prev_record_ptr through zenith.signal file to compute node
9436c4161 Fri Jul 16 18:43:07 2021 +0300 Adding comment to prev_record_lsn update
a048e0c7c Fri Jul 16 18:43:07 2021 +0300 Revert assert cechk for advancing prev_record_lsn because in case of creation of branch on some older LSN we can not provide proper xl_prev value
d55095ab2 Fri Jul 16 18:43:07 2021 +0300 [refer #331] Move initialization of checkpoint object into import_timeline_from_postgres_datadir
bf45bef28 Mon Jul 19 14:52:41 2021 +0300 md5 auth for postgres_backend.rs
dab34c3dd Mon Jul 19 14:52:41 2021 +0300 distinguish between new and old users
6f747893b Mon Jul 19 14:52:41 2021 +0300 quick mgmp api
605b90c6c Mon Jul 19 14:52:41 2021 +0300 do an actual proxy pass
1b6d99db7 Mon Jul 19 14:52:41 2021 +0300 unfreeze client session upon callback
aa404b60f Mon Jul 19 14:52:41 2021 +0300 change mgmt json format; add cli flags
560f088f0 Mon Jul 19 14:52:41 2021 +0300 fix query_string parsing for mgmt callback
70926adab Mon Jul 19 14:52:41 2021 +0300 allow to specify redirect_uri in proxy
8ec234ba7 Mon Jul 19 14:52:41 2021 +0300 fix tokio features set for proxy standalone build
a11855733 Mon Jul 19 14:52:41 2021 +0300 review fixes
2b33894e7 Mon Jul 19 14:52:41 2021 +0300 few more review fixes
79d9314ba Mon Jul 19 14:52:41 2021 +0300 terminate socket explicitly
9838c71a4 Mon Jul 19 16:49:12 2021 +0300 Explicit compact (#341)
7c96c638a Tue Jul 20 10:32:59 2021 +0300 Fix particluar typos: `s/cofig/config/g`
325dd4127 Tue Jul 20 16:01:37 2021 +0300 Remove unused constructor function.
ad79ca05e Tue Jul 20 20:12:15 2021 +0300 suppress nullptr warnings on auto-generated bindgen unit tests
0723d49e0 Wed Jul 21 00:41:57 2021 +0300 Object push (#276)
c4b2bf7eb Wed Jul 21 17:22:22 2021 +0300 Use 'zenith_admin' as superuser name in `initdb`
a17b2a436 Wed Jul 21 17:22:22 2021 +0300 reflect postgres superuser changes in pageserver->compute connstring
791312824 Wed Jul 21 17:22:22 2021 +0300 set superuser name in python tests too
eb1618f2e Wed Jul 21 17:27:05 2021 +0300 TLA+ specification of proposer-acceptor consensus protocol.
9e3fe2b4d Wed Jul 21 17:27:05 2021 +0300 Truncate not matching part of log.
51b50f5cf Wed Jul 21 17:27:05 2021 +0300 Fix truncating the wal after VCL.
fe1718846 Wed Jul 21 17:27:05 2021 +0300 Alternative way to truncate behind-the-vcl part of log.
8e42af9b1 Wed Jul 21 18:55:41 2021 +0300 Remove unused 'identify_system' pageserver query
c91340473 Wed Jul 21 18:56:34 2021 +0300 Redirect log to pageserver.log during zenith init. Add new module logger.rs that contains shared code to init logging
6a3b9b1d4 Thu Jul 22 12:12:55 2021 +0300 Fix accidental busyloop in walkeeper's background thread
97329d490 Thu Jul 22 12:12:55 2021 +0300 Add a test for EOF in walkeeper's background thread
8b656bad5 Thu Jul 22 16:46:27 2021 +0300 Add a missing [cfg(test)]
d210ba5fd Thu Jul 22 20:33:34 2021 +0300 Update README.md
767590bbd Thu Jul 22 20:54:20 2021 +0300 support tenants
47824c5fc Fri Jul 23 12:21:21 2021 +0300 Remove page server interactive mode.
1e6267a35 Fri Jul 23 13:21:45 2021 +0300 Get rid of snapshot directory + related code cleanup and refactoring.
ec03848d2 Fri Jul 23 16:22:01 2021 +0300 Fix pageserver.log destination for zenith init. The problem was caused by merge conflict in 767590b
3f4815efa Fri Jul 23 12:38:37 2021 -0700 Correct `LeSer` doc: "Big Endian" -> "Little Endian" (#362)
14b679691 Sun Jul 25 17:46:47 2021 +0300 Send pgdata subdirs with basebackup. Fix for 1e6267a.
bd7d81192 Sun Jul 25 17:46:47 2021 +0300 Add libseccomp-dev as a dep to Dockerfile
acc0f4198 Sat Jul 31 18:13:21 2021 +0300 Don't try to launch duplicate WAL redo thread if tenant already exists.
f0030ae00 Tue Aug 3 13:59:51 2021 +0300 Handle SLRU ZERO records directly by storing an all-zeros page image.
9ff122835 Tue Aug 3 14:01:05 2021 +0300 Refactor ObjectTags, intruducing a new concept called "relish"
cb1b4a12a Tue Aug 3 21:42:24 2021 +0300 Add some prometheus metrics to pageserver
bcaa59c0b Wed Aug 4 00:05:19 2021 +0300 Test compute restart with AND without safekeepers
ed634ec32 Wed Aug 4 10:49:02 2021 +0300 Extract message processing function from PostgresBackend's event loop
56565c0f5 Wed Aug 4 14:15:07 2021 +0300 look up WAL in right directory
b77fade7b Wed Aug 4 14:15:07 2021 +0300 Look up wal directory properly in all find_end_of_wal callers.
04ae63a5c Wed Aug 4 14:15:07 2021 +0300 use proper postgres version
1dc2ae696 Wed Aug 4 14:21:01 2021 +0300 Point vendor/postgres to main.
cc3ac2b74 Wed Aug 4 18:03:43 2021 +0300 Allow safekeeper to stream till real end of wal.
02b9be488 Wed Aug 4 18:33:33 2021 +0300 Disable GC test.
754892402 Wed Aug 4 21:41:17 2021 +0300 Enable full feature set for hyper in zenith_utils
fa0409673 Wed Aug 4 23:51:02 2021 +0300 cargo fmt pass
ec07acfb1 Wed Aug 4 23:57:17 2021 +0300 fix typo in run_initdb()
e59e0ae2d Thu Aug 5 10:27:56 2021 +0300 Clarify the terms "WAL service", "safekeeper", "proposer"
3ca339417 Thu Aug 5 16:57:57 2021 +0300 [refer #395] Check WAL record CRC in waldecoder (#396)
a5d57ca10 Fri Aug 6 15:23:46 2021 +0300 list_nonrels() returns elements in arbitrary order. Remove incorrect comments that say otherwise.
cc877f198 Tue Aug 10 12:30:21 2021 +0300 Add unit test for find_end_of_wal().
5dd9a66f9 Tue Aug 10 14:26:28 2021 +0300 Move postgres backend messages to trace level
8c7983797 Tue Aug 10 14:26:32 2021 +0300 Remove unused SLRUTruncate ObjectValue
a36864279 Tue Aug 10 14:26:52 2021 +0300 cargo fmt
e475f82ff Wed Aug 11 05:49:24 2021 +0300 Rename get_rel_size() to get_relish_size(). Don't bail if relish is not found, just return None and let the caller to decide how to handle this
590ace104 Wed Aug 11 05:49:24 2021 +0300 Fixes for handling SLRU relishes:     - don't return ZERO_PAGE from get_page_at_lsn_nowait() for truncated SLRU segments;
e40681137 Wed Aug 11 05:49:24 2021 +0300 Fixes for handling SLRU relishes: replace get_tx_status() with self.get_tx_is_in_progress() to handle xacts in truncated SLRU segments correctly
949ac5440 Wed Aug 11 05:49:24 2021 +0300 Add test of clog (pg_xact) truncation
c99a211b0 Wed Aug 11 05:49:24 2021 +0300 Fix CLOG truncate handling in case of wraparound.
b607f0fd8 Wed Aug 11 08:56:37 2021 +0300 Align prev record CRC on 8-bytes boundary (#407)
0ee2e16b1 Wed Aug 11 09:14:05 2021 +0300 Walkeeper safe info (#408)
5f0fd093d Wed Aug 11 16:26:35 2021 +0300 Revert "Walkeeper safe info (#408)"
ce5333656 Wed Aug 11 20:05:54 2021 +0300 Introduce authentication v0.1.
70cb399d5 Wed Aug 11 20:17:33 2021 +0300 Add convenience function to create a RowDescriptor message for an int8 col.
20d5e757c Wed Aug 11 22:16:38 2021 +0300 Remove now-unused get_next_tag function.
4eebe22fb Thu Aug 12 14:42:21 2021 +0300 cargo fmt
1bfade8ad Thu Aug 12 14:42:21 2021 +0300 Issue #330. Use put_unlink for twophase relishes. Follow PostgreSQL logic: remove Twophase files when prepared transaction is committed/aborted.
6c3726913 Thu Aug 12 14:42:21 2021 +0300 Introduce check for physical relishes.
0a92b3149 Thu Aug 12 18:39:23 2021 +0300 If a pg_regress test fails in CI, save regression.diffs
97f9021c8 Thu Aug 12 20:46:14 2021 +0300 Fix JWT token encoding issue in test.
8517d9696 Thu Aug 12 23:46:01 2021 +0300 Move gc_iteration() function to Repository trait.
f8de71eab Fri Aug 13 14:02:26 2021 +0300 Update vendor/postgres to fix race condition leading to CRC errors.
6e22a8f70 Fri Aug 13 17:23:36 2021 +0300 Refactor WAL redo to not use a separate thread.
5eb1738e8 Fri Aug 13 11:25:16 2021 -0700 Rework walkeeper protocol to use libpq (#366)
2450f82de Mon Aug 16 10:06:48 2021 +0300 Introduce a new "layered" repository implementation.
0c4ab80ea Mon Aug 16 14:27:44 2021 +0300 try to be more intelligent in WalAcceptor.start, added a bunch of typing sugar to wal acceptor fixtures
047a05efb Mon Aug 16 15:48:59 2021 +0300 Minor formatting and comment fixes.
7ee8de372 Mon Aug 16 15:49:17 2021 +0300 Add metrics to WAL redo.
f37cb2130 Mon Aug 16 19:24:26 2021 +0300 Update Cargo.lock for addition of 'bincode'
921ec390b Mon Aug 16 19:41:07 2021 +0300 cargo fmt
cbeb67067 Tue Aug 17 18:12:31 2021 +0300 Issue #367. Change CLI so that we always create node from scratch at 'pg start'. This operation preserve previously existing config
91f72fabc Tue Aug 17 18:54:41 2021 +0300 Work with smaller segments.
48f4a7b88 Tue Aug 17 18:54:48 2021 +0300 Refactor get_page_at_lsn() logic to layered_repository.rs
45f641cab Tue Aug 17 18:54:51 2021 +0300 Handle last "open" layer specially in LayerMap.
e35a5aa55 Tue Aug 17 18:54:53 2021 +0300 WIP: track mem usage
a389c2ed7 Tue Aug 17 18:54:53 2021 +0300 WIP: Track oldest open layer
11ebcb531 Tue Aug 17 18:54:53 2021 +0300 Add Gauge for # of layers
8d2b61f4d Tue Aug 17 18:54:53 2021 +0300 Move code to handle snapshot filenames
882f54923 Tue Aug 17 18:54:53 2021 +0300 WIP: store base images separately
ddb7155bb Tue Aug 17 18:55:04 2021 +0300 WIP Store base images in separate ImageLayers
3319befc3 Tue Aug 17 19:20:27 2021 +0300 Revert a bunch of commits that I pushed by accident
4bce65ff9 Tue Aug 17 20:31:28 2021 +0300 bump rust version in ci to 1.52.1
9fed5c8fb Wed Aug 18 20:19:07 2021 +0300 Add test for page server restart.
20e6cd772 Thu Aug 19 12:15:09 2021 +0300 Update test_twophase - check that we correctly restore files at compute node start.
04a309f56 Thu Aug 19 15:12:35 2021 +0300 Build zenithdb/zenith:latest in CI (zenithdb/console#18)
1c3d51ed9 Thu Aug 19 15:12:35 2021 +0300 Add Docker images building doc and refactor the overall docs reference
82725725f Thu Aug 19 17:42:52 2021 +0300 update README to match required Rust version and new python package installation process
39bb6fb19 Thu Aug 19 08:46:18 2021 -0700 Marginally improve walkeeper error visibility (#440)
798160544 Mon Aug 23 10:21:10 2021 +0300 Update zenith readmes: - Move source tree overview into separate docs/sourcetree.md and update it. - Add glossary: docs/glossary.md - Add a draft of Architecture overview to main Readme.md
d989580c1 Mon Aug 23 13:00:05 2021 +0300 remove small code duplication involving InMemoryLayer::get_seg_size, and remove redundant Option around new snapshot layer in InMemoryLayer::freeze
35b60d509 Mon Aug 23 17:28:45 2021 +0300 Add support for code format checking using rustfmt in optional pre-commit hook and in ci pipeline. Found issues can be fixed automatically via make fmt.
8c62b11bd Mon Aug 23 17:28:45 2021 +0300 adjust for review
b29ca232d Mon Aug 23 17:28:45 2021 +0300 add ability to disable colors, use argparse for arguments
dcaa2126f Mon Aug 23 18:01:59 2021 +0300 fix code format after main rebase
ad8b5c384 Mon Aug 23 18:19:59 2021 +0300 use updated vendor/postgres
81dd4bc41 Tue Aug 24 15:59:25 2021 +0300 Fix decoding XLOG_HEAP_DELETE and XLOG_HEAP_UPDATE records.
41fa02f82 Tue Aug 24 16:32:37 2021 +0300 Replace transmute with serde
23b524951 Tue Aug 24 19:05:00 2021 +0300 translate pageserver api to http
b13572399 Tue Aug 24 19:05:00 2021 +0300 review adjustments
f2f02a8af Tue Aug 24 19:05:00 2021 +0300 apply transformation (Arc<Option> -> Option<Arc>) suggested by @funbringer
19fcea99d Wed Aug 25 11:20:47 2021 +0300 If too much memory is being used for in-memory layers, flush oldest one.
3edad463f Wed Aug 25 17:28:42 2021 +0300 Adjust docker container for console's CI pipeline
250ae643a Wed Aug 25 18:37:22 2021 +0300 Remove 'zenith push' feature.
5998744bc Wed Aug 25 18:37:22 2021 +0300 Remove rocksdb implementation.
404653016 Wed Aug 25 18:37:22 2021 +0300 Remove remnants of choosing between repository formats.
de9d5e0aa Wed Aug 25 18:51:15 2021 +0300 Remove unnecessary dependencies.
c4450907e Wed Aug 25 20:46:31 2021 +0300 Don't hide exact error of get_timeline.
beaa2cd0a Thu Aug 26 13:53:10 2021 +0300 Handle COPY error
d265b4cdd Thu Aug 26 10:24:33 2021 -0700 waldecoder - check for trailing bytes
40c79988a Fri Aug 27 02:35:16 2021 +0300 Move code to handle snapshot filenames
4902d1daa Fri Aug 27 02:35:16 2021 +0300 Store base images in separate ImageLayers
8d3450f4c Fri Aug 27 15:22:10 2021 +0300 Basic safekeeper refactoring and bug fixing.
6cbc08f1f Fri Aug 27 15:22:10 2021 +0300 bump pg version
7474cfac0 Fri Aug 27 15:22:10 2021 +0300 Rename VCL to epochStartLsn and restart_lsn to truncate_lsn.
787806285 Fri Aug 27 15:45:45 2021 +0300 Remove unused 'update_meta' argument.
7e7b31a62 Fri Aug 27 19:46:51 2021 +0300 Extract basebackup directly from the CopyOutReader
e1d8f97b9 Fri Aug 27 19:46:51 2021 +0300 Mention `pipenv run` as an option to run pytest
074bd3bb1 Fri Aug 27 21:00:45 2021 +0300 Add basic performance test framework.
263e03f4b Mon Aug 30 12:41:47 2021 +0300 Improve code & text formatting in proxy welcome
9dfee8a3b Mon Aug 30 12:58:15 2021 +0300 Add Gauge for # of layers
c5fc4e690 Mon Aug 30 14:29:21 2021 +0300 Fix instructions in README.md on how to start psql
a3f3d4601 Mon Aug 30 14:29:21 2021 +0300 Misc doc updates
b949127b0 Mon Aug 30 15:17:30 2021 +0300 Rename page_cache.rs to tenant_mgr.rs.
e29bfa09b Mon Aug 30 17:29:29 2021 +0300 Fix list_rels and list_nonrels in layeredRepository - return only visible objects
27442c3da Mon Aug 30 17:29:29 2021 +0300 Add test for DROP DATABASE command
78963ad10 Mon Aug 30 17:29:29 2021 +0300 Issue #411. Support drop database in pageserver. Use put_unlink for FileNodeMap relishes. Always store FileNodeMap as materialized page images (no wal records).
98f49671c Mon Aug 30 09:12:38 2021 -0700 delta_layer - read page versions from disk
561bf2c51 Mon Aug 30 09:18:49 2021 -0700 circleci - fix test summary
7c7e89e2e Mon Aug 30 09:40:13 2021 -0700 layered_repo - atomic last/prev record_lsn
5ac4a2704 Mon Aug 30 10:34:36 2021 -0700 image_layer - read images directly from disk
63d0a865f Mon Aug 30 20:35:08 2021 +0300 Update and move comment.
03a09b782 Mon Aug 30 23:51:47 2021 +0300 Replace old git urls with the current ones
c0ace1eff Tue Aug 31 14:10:50 2021 +0300 Bump vendor/postgres to use relsize cache.
625abf3c5 Tue Aug 31 13:09:16 2021 -0700 Bump vendor/postgres for walproposer cleanup
b45d5368b Wed Sep 1 09:42:18 2021 +0300 Don't create an image layer for dropped relations.
8a05d6dde Wed Sep 1 15:02:32 2021 +0300 Fix 'unrecognized filename in timeline' warning
e9d2181e1 Wed Sep 1 15:02:37 2021 +0300 Remove obsolete comment
989ab7e88 Wed Sep 1 16:11:44 2021 +0300 move several functions which replicate ones from postgresql to postgres_ffi crate
8b3a293bb Wed Sep 1 16:11:44 2021 +0300 Use postgres_ffi bindings instead of custom type definitions. Move several functions to postgres_ffi crate
aae39ecf5 Wed Sep 1 16:23:42 2021 +0300 [refer #506] Enforce that xl_prev<curr_lsn for created branch
91d605f78 Wed Sep 1 16:30:09 2021 +0300 Revert accidental commit: "[refer #506] Enforce that xl_prev<curr_lsn for created branch"
812160ba1 Wed Sep 1 17:02:14 2021 +0300 fix XLOG_MULTIXACT_ZERO_MEM_PAGE wal parsing
5ac3cb1c7 Wed Sep 1 10:29:19 2021 -0700 TLS for postgres_backend and proxy
d7bebd807 Wed Sep 1 12:20:16 2021 -0700 Add 'dump_layerfile' utility for debugging.
291c2c9a1 Thu Sep 2 11:33:00 2021 +0300 Test readme typo fix
212920e47 Thu Sep 2 11:33:00 2021 +0300 Collect and expose I/O disk write metrics
ddd2c83c6 Thu Sep 2 12:06:12 2021 +0300 Change test_restart_compute to expose safekeeper problems.
8c07a36fd Thu Sep 2 12:06:12 2021 +0300 Remove last_valid_lsn tracking in wal_receiver.
59c19d6e1 Thu Sep 2 12:06:12 2021 +0300 Rework basebackup.
3c5452da8 Thu Sep 2 12:57:39 2021 +0300 add tenant id tracking to safekeeper
81479b021 Thu Sep 2 14:22:26 2021 +0300 Rename 'InMemoryLayer::img_layer' field.
c3cbb56ff Thu Sep 2 14:22:29 2021 +0300 Refactor Layer::get_page_reconstruct_data function
66929ad6f Thu Sep 2 15:41:40 2021 +0300 Fix infinite loop with forced repository checkpoint.
0e4cbe016 Thu Sep 2 17:27:18 2021 +0300 Fix some typos
bc709561b Thu Sep 2 18:54:44 2021 +0300 fix clippy warnings
7507f4b30 Thu Sep 2 09:16:03 2021 -0700 zenith_utils - box BidiStream::Tls variant
1686715ad Thu Sep 2 22:01:46 2021 +0300 Partial fix for issue with extending relation with a gap.
c6678c5de Fri Sep 3 09:00:26 2021 +0300 Include # of bytes written in pgbench benchmark result
fabf5ec66 Fri Sep 3 11:00:38 2021 +0300 Don't use term 'snapshot' to describe layers
a7de53d4c Fri Sep 3 11:00:38 2021 +0300 Improve comments for Layer trait.
66dcaa4e0 Fri Sep 3 11:00:38 2021 +0300 Rename put_unlink() to drop_relish() in Timeline trait. Rename put_unlink() to drop_segment() in Layer trait.
45c09c1cd Fri Sep 3 11:00:38 2021 +0300 Add LayerMap.dump() funciton for debugging. Print timelineid in layer dumps
b227c63ed Fri Sep 3 14:58:59 2021 +0300 Set proper xl_prev in basebackup, when possible.
6d42ea47b Fri Sep 3 17:29:23 2021 +0300 Check rusage return code
2cf3a70be Fri Sep 3 19:48:26 2021 +0300 Add description of Zenith changes in Postgres core (#533)
ed4eed0a1 Mon Sep 6 13:06:20 2021 +0300 Make use of `postgres --sync-safekeepers` in tests and CLI.
d1f0b1eda Mon Sep 6 13:06:20 2021 +0300 Adapt safekeepers to --sync-safekeepers walproposer mode.
51d36b993 Mon Sep 6 13:06:20 2021 +0300 bump vendor/postgres
1e172230c Mon Sep 6 18:21:23 2021 +0300 Add test funciton to compare files in compute nodes to catch bugs in SLRU replay. Compare files in existing compute node's pgdata with fresh basebackup at the same lsn. We expect that content is identical, except tmp files Use it after some tests.
a3214e982 Mon Sep 6 18:21:23 2021 +0300 Transaction commit redo handler should set TRANSACTION_STATUS_COMMITTED status for subtransactions, not TRANSACTION_STATUS_SUB_COMMITTED
eb3fd7a8d Mon Sep 6 18:21:23 2021 +0300 print diff for mismatching files in check_restored_datadir_content()
511873aae Tue Sep 7 15:05:08 2021 +0300 Bump postgres version
f83108002 Tue Sep 7 15:06:43 2021 +0300 Revert "Bump postgres version"
94c50e3e9 Tue Sep 7 16:58:21 2021 +0300 Fix check_restored_datadir_content(). Call 'basebackup' command directly, instead of relying on CLI
6f0c06574 Tue Sep 7 16:58:21 2021 +0300 preserve filediff artifacts in CI
292bdaa6a Tue Sep 7 17:48:41 2021 +0300 Update documentation to note some Postgres specifics
9098f2159 Tue Sep 7 18:10:07 2021 +0300 Fix comparison routines of OpenSegEntry
6245702c7 Tue Sep 7 18:10:07 2021 +0300 Comment fixes
04ee1d597 Tue Sep 7 18:10:07 2021 +0300 Add test for managing old open segments in binary heap.
26782851a Tue Sep 7 18:10:07 2021 +0300 Rename OpenSegEntry to OpenLayerEntry
018a60698 Tue Sep 7 18:10:07 2021 +0300 Refactor code in LayerMap, for readability
7a03e32dd Tue Sep 7 18:10:07 2021 +0300 Use Rust shorthand range syntax
1b9e49eb6 Tue Sep 7 08:19:42 2021 -0700 pageserver - update `unload()` comment
b4ecae33e Tue Sep 7 18:25:15 2021 +0300 add incremental tracking of logical timeline size
4b73ada26 Tue Sep 7 20:50:27 2021 +0300 fix connection error appeared on zenith start
d7313bb85 Tue Sep 7 19:49:03 2021 -0700 Switch tokio-postgres dependency to git repo
5488ce883 Wed Sep 8 14:12:00 2021 +0300 Change CLI command 'pg stop' to avoid races in tests. Stop postgres immediately only when destroy option is used. Otherwise, use default shutdown mode (fast).
3d1725540 Wed Sep 8 14:12:00 2021 +0300 Add comment to 'pg stop' changes
4fae115dc Wed Sep 8 17:32:59 2021 +0300 propagate pageserver http error messages to zenith cli
30c034372 Thu Sep 9 15:15:50 2021 +0300 Use layer start_lsn instead of *entry_lsn as LSN to continue WAL record traversal at next layer (#573)
674807eee Thu Sep 9 16:05:32 2021 +0300 Add test for dropped reltaions. Fix list_rels() and list_nonrels() functions
b79754d06 Thu Sep 9 16:05:32 2021 +0300 list_rels() and list_nonrels() refactoring: move shared code to list_relishes() function.
507177b42 Thu Sep 9 18:48:46 2021 +0300 Refactor code to handle incoming page requests.
6a8785379 Fri Sep 10 09:56:11 2021 +0300 Add explicit 'wait_lsn' calls before get_page_at_lsn and such calls.
03dff207d Fri Sep 10 10:24:35 2021 +0300 Remove start_lsn arg from `create_empty_repository`.
ab33614ab Fri Sep 10 10:59:09 2021 +0300 Forbid adding WAL to the repository after advancing last record LSN.
3dea06b82 Fri Sep 10 12:43:11 2021 +0300 Update layered_repository/README.md
59e7ca585 Fri Sep 10 12:43:11 2021 +0300 Minor fixes
7c62a57e5 Fri Sep 10 13:00:39 2021 +0300 initialize tenant_mgr after daemonizing
0aec60938 Sat Sep 11 06:10:10 2021 +0300 Make flush_lsn reported by safekeepers point to record boundary.
6dc66eefb Sat Sep 11 06:10:10 2021 +0300 bump vendor/postgres
18b5165b2 Sun Sep 12 15:35:18 2021 +0300 Update README.md
6afd99c73 Mon Sep 13 12:31:04 2021 +0300 Fix misc typos in comments.
9043f4548 Mon Sep 13 15:57:41 2021 +0300 removes protobuf dependency (brought by prometheus default features)
a68c23448 Mon Sep 13 22:46:04 2021 +0300 Skip the bootstrap hole in safekeeper's find_end_of_wal.
6b7f3bc78 Tue Sep 14 16:56:04 2021 +0300 Add inter-repo CI job to CircleCI configuration
84008a256 Tue Sep 14 18:09:14 2021 +0300 factor out common logging initialisation routine
cff457277 Tue Sep 14 11:24:24 2021 -0700 Avoid race in `get_layer_for_write`
d150f3ce8 Tue Sep 14 11:44:48 2021 -0700 Detect writes on frozen InMemoryLayers
a2498f3e6 Tue Sep 14 11:59:14 2021 -0700 Improve walkeeper replication error messages & context (#585)
dc897fb86 Wed Sep 15 13:24:35 2021 +0300 remove pageserver remotes support since we do not have tests for that and feature itself is delayed (#136)
4ebe643d0 Wed Sep 15 14:02:15 2021 +0300 Support parallel test running for python tests
9563336d9 Wed Sep 15 14:02:15 2021 +0300 Bring back check for interferring processes, add more comments and descriptive errors
6a2e4bfdd Wed Sep 15 14:02:15 2021 +0300 use parallel test execution in ci
01ef2baef Wed Sep 15 14:02:15 2021 +0300 show more context for zenith cli run errors
3ab60ce76 Wed Sep 15 16:00:08 2021 +0300 Unify tokio deps and bump cargo resolver version
0ede93371 Wed Sep 15 18:59:59 2021 +0300 temporary disable parallel test runs as it seems to misbehave when there are several concurrent CI runs
b11b0bb08 Wed Sep 15 11:48:19 2021 -0700 bin_ser: reject trailing bytes by default (#587)
fea5954b1 Wed Sep 15 14:22:04 2021 -0700 Change filling gap println! to trace!
91ff09151 Wed Sep 15 16:04:49 2021 -0700 Remove disk IO from `InMemoryLayer::freeze`
0cbee4a41 Wed Sep 15 16:04:49 2021 -0700 Don't hold lock on LayerMap while writing to disk
a5bd306db Wed Sep 15 16:04:49 2021 -0700 Ensure InMemoryLayer predecessor updated correctly
25b7d424a Wed Sep 15 20:50:51 2021 -0700 Prevent frozen InMemoryLayer races
87bc18972 Thu Sep 16 11:41:29 2021 +0300 bump vendor/postgres
98d4f9cea Thu Sep 16 12:33:50 2021 +0300 Add checkpoint_distance config parameter. - Change hardcoded OLDEST_INMEM_DISTANCE value to pageserver config option checkpoint_distance. - Get rid of 'force' flag in checkpoint_internal(). Use checkpoint_distance=0 instead.
6984d33b4 Thu Sep 16 12:33:50 2021 +0300 Run GC and checkpointer separate threads. Add checkpoint_period configuration parameter
8de41f1d7 Thu Sep 16 12:33:50 2021 +0300 Change checkpoint_distance type to u64
7dda9f289 Thu Sep 16 15:09:16 2021 +0300 Fix clippy lints and enable clippy checking in CI
bbe4f3979 Thu Sep 16 09:04:35 2021 -0700 walkeeper: Add parsing check for hot standby tag (#597)
3743344e6 Thu Sep 16 10:38:21 2021 -0700 Add `get_timeline_for_tenant()` to `tenant_mgr` (#615)
7b3fb760f Fri Sep 17 14:16:23 2021 +0300 [test_runner] psql should be oblivious to user's preferences
1d5abf125 Fri Sep 17 15:30:22 2021 +0300 Initial version of the relish storage
1aa7218fd Fri Sep 17 16:16:05 2021 +0300 Show underlying pageserver error details
ad5f16f72 Fri Sep 17 16:38:14 2021 +0300 Improve the protocol between Postgres and page server.
540973eac Fri Sep 17 18:56:05 2021 +0300 Don't get confused on request of latest page version with very old LSN.
c2af6d98d Fri Sep 17 20:04:29 2021 +0300 Don't print 'pg_controldata' output after every startup in tests.
745627c8c Fri Sep 17 20:06:04 2021 +0300 Remove unused FE/BE ControlFile message.
ea4c3639e Mon Sep 20 07:57:51 2021 -0700 Include layer metadata in layer summary chapters
b7aac87ec Mon Sep 20 18:44:42 2021 +0300 fix port distribution so services do not use ephemeral ports
296586b7c Mon Sep 20 18:52:55 2021 +0300 bump vendor/postgres
5344ffc3d Mon Sep 20 21:43:09 2021 +0300 try to reenable parallel test runs in CI
49c8c0346 Tue Sep 21 13:25:46 2021 +0300 Add performance test for bulk INSERT
a91eeb1c6 Tue Sep 21 16:54:29 2021 +0300 Buffer the writes when writing a layer to disk.
16d3dc821 Tue Sep 21 23:08:22 2021 +0300 disable parallelization for benchmarks
8ebf2fe55 Wed Sep 22 11:59:20 2021 +0300 Add test for acceptor restarts under load (#591)
579b5ee94 Wed Sep 22 18:03:48 2021 +0300 exclude labels formatting for every operation in LOGICAL_TIMELINE_SIZE gauge metric
90ef66167 Wed Sep 22 11:24:43 2021 -0700 Fix rustc & clippy warnings for nightly (2021-09-19) (#629)
d7cff8fba Wed Sep 22 14:51:14 2021 -0700 Show more detailed query errors from postgres_backend (#651)
e554f9514 Thu Sep 23 12:21:47 2021 +0300 gc refactoring
c934e724a Thu Sep 23 12:21:47 2021 +0300 Enable test_list_rels_drop test
a4fc6da57 Thu Sep 23 12:21:47 2021 +0300 Fix gc_internal to treat dropped layers. Some dropped layers serve as tombstones for earlier layers and thus cannot be garbage collected. Add new fields to GcResult for layers that are preserved as tombstones
97c4cd443 Thu Sep 23 12:22:53 2021 +0300 bump vendor/postgres
86164c8b3 Thu Sep 23 13:19:45 2021 +0300 Add unit tests for drop_lsn. test_drop_extend and test_truncate_extend illustrate what happens if we dropped a segment and then created it again within the same layer.
7fb7f67bb Thu Sep 23 13:19:45 2021 +0300 Fix relish extention after it was dropped or truncated.
c81ee3bd5 Thu Sep 23 13:19:45 2021 +0300 Add some comments to the checkpoint process
7db3a9e7d Thu Sep 23 08:42:58 2021 -0700 walredo - don't use RefCell on stdin/stdout
d4eed61f5 Thu Sep 23 19:34:27 2021 +0300 Refactor code for parsing and creating postgresql.conf.
139936197 Thu Sep 23 14:55:38 2021 -0700 bump vendor/postgres: Catch walkeeper ErrorResponse (#650)
d4e037f1e Fri Sep 24 13:19:59 2021 +0300 Support for `--sync-safekeepers` in tests (#647)
2319e0ec8 Fri Sep 24 14:10:49 2021 +0300 Define a layer's start and end bounds more precisely.
ff5cbe269 Fri Sep 24 14:10:52 2021 +0300 Support overlapping and nested Layers in the layer map.
bd9f4794d Fri Sep 24 10:06:03 2021 -0700 Allow `LeSer`/`BeSer` impls missing either `Serialize` or `Deserialize` (#655)
0f770967b Fri Sep 24 10:18:36 2021 -0700 Revert "Allow `LeSer`/`BeSer` impls missing either `Serialize` or `Deserialize` (#655)
a72707b8c Fri Sep 24 10:58:01 2021 -0700 Redo #655 with fix: Allow `LeSer`/`BeSer` impls missing either `Serialize` or `Deserialize`
41dfc117e Fri Sep 24 21:12:38 2021 +0300 Buffer the writes to the WAL redo process pipe.
b71e3a40e Fri Sep 24 21:44:22 2021 +0300 Add more details to the log, when an error happens in GetPage request.
c846a824d Fri Sep 24 21:48:30 2021 +0300 Bump vendor/postgres, to use buffered I/O in WAL redo process.
70b08923e Sun Sep 26 22:33:58 2021 +0300 Disable new safekeepers tests as not stable enough.
f84eaf4f0 Mon Sep 27 11:56:43 2021 +0300 Leave only pkcs8 keys support for proxy.
3bac4d485 Mon Sep 27 11:56:43 2021 +0300 Fix EncryptionResponse message in pq_proto.rs
8331ce865 Mon Sep 27 11:56:43 2021 +0300 Interceipt and log error in mgmt interface.
aae41e866 Mon Sep 27 11:56:43 2021 +0300 Proxy pass for existing users.
ca9af3747 Mon Sep 27 14:15:55 2021 +0300 Do not write WAL at pageserver (#645)
22e15844a Mon Sep 27 18:59:30 2021 +0300 Fix clippy errors (#673)
2252d9faa Mon Sep 27 19:15:40 2021 +0300 Switch to RwLock in InMemoryLayer
08978458b Mon Sep 27 19:23:32 2021 +0300 Refactor write_to_disk, handling dropped segment as a special case.
014be8b23 Mon Sep 27 19:28:02 2021 +0300 Use Iterator, to avoid making one copy of page_versions BTreeMap
0f3cf8ac9 Tue Sep 28 18:26:20 2021 +0300 Cleanup Dockerfile.
7a370394a Tue Sep 28 19:15:41 2021 +0300 Wait till previous victim recovers in run_restarts_under_load.
d6fc74a41 Tue Sep 28 19:25:05 2021 +0300 Various fixes for test_sync_safekeepers (#668)
3065532f1 Tue Sep 28 20:57:51 2021 +0300 pageserver: fix mistype in listen-http arg help
ddf4b15eb Tue Sep 28 20:57:51 2021 +0300 pageserver: use const_format crate to generate default listen addrs
b0a723475 Tue Sep 28 20:57:51 2021 +0300 pageserver: fix stale default listen addrs
fb05e4cb0 Wed Sep 29 01:55:41 2021 +0300 Show better error messages on pageserver failures
6d993410c Wed Sep 29 14:40:16 2021 +0300 docs/README: fix link to walkeeper's README (#677)
3127a4a13 Wed Sep 29 19:58:30 2021 +0300 Safekeeper::Storage::write_wal: clarify behavior (#679)
adbae6228 Thu Sep 30 17:29:15 2021 +0300 Rename SharedState.commit_lsn to notified_commit_lsn.
86e14f2f1 Thu Sep 30 20:36:57 2021 +0300 Bump vendor/postgres
287ea2e5e Fri Oct 1 08:37:09 2021 +0300 Limit concurrent relish storage sync operations
cf8e27a55 Fri Oct 1 14:27:52 2021 +0300 Proxy: pass database name in console too
2c99e2461 Fri Oct 1 16:24:35 2021 +0300 Allow usage of the compute hostname in the proxy
e47479040 Fri Oct 1 17:57:41 2021 +0300 Print more details on errors to log
0a8aaa2c2 Fri Oct 1 11:41:39 2021 -0700 zenith_utils - add crashsafe_dir
69670b61c Fri Oct 1 11:41:39 2021 -0700 pageserver - use crashsafe_dir utility
62f83869f Fri Oct 1 11:41:39 2021 -0700 pageserver - fsync image/delta layers
538c2a2a3 Fri Oct 1 11:41:39 2021 -0700 pageserver - store timeline metadata durably
7095a5d55 Fri Oct 1 11:41:39 2021 -0700 pageserver - reject and backup future layer files
84f7dcd05 Fri Oct 1 15:45:42 2021 -0700 Fix clippy errors on nightly (2021-09-29) (#691)
7fab38c51 Fri Oct 1 15:47:45 2021 -0700 Use threadlocal for walreceiver check (#692)
ec673a5d6 Mon Oct 4 08:58:49 2021 +0300 bulk tenant create test added
fbd8ca2ff Mon Oct 4 08:58:49 2021 +0300 minor code beautification
ae2749028 Mon Oct 4 08:58:49 2021 +0300 wal_acceptors added to tenant creation tests
4256231eb Mon Oct 4 16:50:46 2021 +0300 Enable test_start_compute with safekeepers.
664b99b5a Mon Oct 4 08:36:35 2021 -0700 pageserver - use constant TIMELINE_ID for tests
d134a9856 Mon Oct 4 08:36:35 2021 -0700 pageserver - introduce RepoHarness for testing
5719f13cb Tue Oct 5 10:15:56 2021 +0300 Rework the relish thread model (#689)
9c936034b Tue Oct 5 00:28:14 2021 -0700 pageserver - fix newer clippy lints
7e190d72a Tue Oct 5 19:06:44 2021 +0300 Make `pageserver_` prefix for common metric names configurable (#681)
530d3eaf0 Tue Oct 5 19:10:50 2021 +0300 Add more details to pageserver and safekeeper docs (#680)
05fe39088 Tue Oct 5 19:19:25 2021 +0300 Readme updates based on a fresher Ubuntu installation experience (#627)
d806c3a47 Tue Oct 5 11:07:50 2021 -0700 pageserver - serialize PageVersion as it is
e3945d94f Wed Oct 6 10:58:15 2021 +0300 Store unlogged tables locally, and replace PD_WAL_LOGGED.
24580f249 Wed Oct 6 14:37:27 2021 +0200 Improve build system: (#703)
15f1bcc9c Wed Oct 6 15:59:28 2021 +0300 Remove obsolete code, now that we don't load WAL from local disk anymore.
a03e1b389 Wed Oct 6 23:42:00 2021 +0200 Docker build now also uses BUILD_TYPE=release. (#712)
53b4dc944 Thu Oct 7 10:36:26 2021 +0300 Don't create unused "wal" directory
fdb19fdb9 Thu Oct 7 11:24:27 2021 +0300 Remove unused function.
db4059cd6 Thu Oct 7 18:03:20 2021 +0300 Measure peak memory usage in perf test.
7fa04e2d1 Fri Oct 8 00:14:56 2021 +0300 zenith_metrics: exit process on config errors (#706)
c660926a0 Fri Oct 8 00:34:26 2021 +0300 Refactor duplicated code to get on-disk timeline size in tests.
60dae0b4a Fri Oct 8 00:34:29 2021 +0300 Add test case that demonstrates Write Amplification.
960c7d69a Fri Oct 8 00:54:13 2021 +0300 Remove 'predecessor' reference from in-memory and delta layers.
b3b8f18f6 Thu Oct 7 15:38:22 2021 -0700 tests - fix get_timeline_size signature
403d9779d Fri Oct 8 18:55:41 2021 +0300 safekeeper: add initial metrics and HTTP handler (#699, #541)
3b82e806f Fri Oct 8 14:11:07 2021 -0700 pageserver - use VecMap for in-memory PageVersions
c4bb6d78d Fri Oct 8 14:37:32 2021 -0700 pageserver - use VecMap for in memory segsizes
c35603066 Fri Oct 8 15:05:22 2021 -0700 pageserver - use VecMap for delta metadata & sizes
0baf4bc79 Sat Oct 9 08:45:46 2021 -0700 fix `cargo doc` complaints
3f0ebc6a4 Sat Oct 9 08:45:52 2021 -0700 pageserver - move early File::open call
bf58f7f64 Sat Oct 9 19:23:57 2021 +0300 Expose certain layered repository structs to reuse in relish storage (#688)
7216f2260 Mon Oct 11 08:59:06 2021 +0300 Use tracing crate to have more context in log messages.
b9119f11b Mon Oct 11 11:10:58 2021 +0300 Add perf test case for buffering GiST build.
d7c9dd06f Mon Oct 11 13:35:01 2021 +0300 Implement graceful shutdown at 'pageserver stop': - perform checkpoint for each tenant repository. - wait for the completion of all threads.
8c61c3e54 Mon Oct 11 16:31:44 2021 +0300 Minor safekeeper readme fix.
1cd790079 Mon Oct 11 17:03:51 2021 +0300 [Makefile] Make build type detection more precise
bb239b4f6 Mon Oct 11 17:08:31 2021 +0300 [Makefile] Set default build type to debug
934fb8592 Tue Oct 12 09:09:10 2021 +0300 Detect when a checkpoint is modified in a smarter way.
95a85312f Tue Oct 12 10:16:26 2021 +0300 Simplify code to build walredo messages.
f3445949d Tue Oct 12 16:51:28 2021 +0300 Wal acceptor: report socket bind errors better when daemonizing (#738)
6e5ca5dc5 Tue Oct 12 10:02:15 2021 -0700 pageserver - create TimelineWriter
160c4aff6 Tue Oct 12 10:02:15 2021 -0700 pageserver - use write guard for checkpointing
7c5b99683 Tue Oct 12 21:02:39 2021 +0300 Speed up builds by passing make jobserver to cargo
23f4c0a74 Tue Oct 12 22:03:06 2021 +0300 Rename `wal_acceptor` binary to `safekeeper` (#740), stage 1/2
64ca94772 Tue Oct 12 19:05:16 2021 +0000 Dockerfile: remove wal_acceptor alias for safekeeper
f65826354 Tue Oct 12 19:05:58 2021 +0000 Revert "Dockerfile: remove wal_acceptor alias for safekeeper"
1c29de81d Wed Oct 13 00:03:42 2021 -0700 pageserver - remove `lsn` from `WALRecord`
96f1175a8 Wed Oct 13 10:52:47 2021 +0300 Cleanup hardcoded oids.
6b6b3f68b Wed Oct 13 16:28:24 2021 +0300 Safekeeper metrics refactor (#747)
8a4f092e8 Wed Oct 13 16:59:00 2021 +0300 Skip syncing the temp initdb installation.
43957f440 Wed Oct 13 17:16:02 2021 +0300 [cross-repo-ci] Use solely commit hash to test PRs in CI
4b87acb1f Thu Oct 14 13:10:09 2021 +0300 Use logging in python tests (#674)
0e026371e Thu Oct 14 14:21:23 2021 +0300 Optimize WAL decoding slightly.
de744a44d Thu Oct 14 19:02:38 2021 +0300 Add /timeline http request to safekeeper returning its status.
100da024b Fri Oct 15 00:26:38 2021 +0300 expose pageserver http socket in docker
4ade0bb41 Fri Oct 15 11:34:15 2021 +0300 Refactor upload/download_relish function signatures.
2dde20a22 Fri Oct 15 09:10:08 2021 -0700 Bump MSRV to 1.55
ba557d126 Fri Oct 15 21:24:24 2021 +0300 React on sigint
b405eef32 Sun Oct 17 14:54:39 2021 +0300 Avoid writing the metadata file when it hasn't changed.
bdd039a9e Sun Oct 17 16:21:58 2021 +0300 S3 DELETE call returns 204, not 200.
e9b5224a8 Mon Oct 18 14:14:27 2021 +0300 Fix toml serde gotchas
a1bc0ada5 Mon Oct 18 14:56:30 2021 +0300 Dockerfile: remove wal_acceptor alias for safekeeper (#743)
0dc7a3fc1 Mon Oct 18 15:40:06 2021 +0300 Change tenant_mgr to use TenantState. It allows to avoid locking entire TENANTS list while one tenant is bootstrapping and prepares the code for remote storage integration.
e272a380b Tue Oct 19 09:48:04 2021 +0300 On new repo, start writing WAL only after the initial checkpoint record.
c2b468c95 Tue Oct 19 09:48:10 2021 +0300 Separate node name from the branch name in ComputeControlPlane
feae7f39c Tue Oct 19 09:48:12 2021 +0300 Support read-only nodes
732d13fe0 Tue Oct 19 17:13:42 2021 +0300 use cached-property package because python<3.8 doesnt have cached_property in functools
798df756d Tue Oct 19 17:13:42 2021 +0300 suppress FileNotFound exception instead of missing_ok=True because the latter is added in python 3.8 and we claim to support >3.6
eb706bc9f Tue Oct 19 20:13:47 2021 +0300 Force yapf (Python code formatter) in CI (#772)
e42c884c2 Wed Oct 20 01:55:49 2021 +0300 test_runner/README: add note on capturing logs (#778)
85116a837 Wed Oct 20 14:15:49 2021 +0300 [proxy] Prevent TLS stream from hanging
13f4e173c Wed Oct 20 14:42:53 2021 +0300 Wait for safekeepers to catch up in test_restarts_under_load (#776)
7f9d2a7d0 Thu Oct 21 11:04:22 2021 +0300 Change 'zenith tenant list' API to return tenant state added in 0dc7a3fc
ff563ff08 Thu Oct 21 13:51:54 2021 +0300 test_runner: fix mypy errors and force it on CI (#774)
c31093212 Thu Oct 21 18:15:50 2021 +0300 Implement backpressure for compute node to avoid WAL overflow
c058d0425 Thu Oct 21 18:26:43 2021 +0300 Rename WalAcceptor to Safekeeper in most places (#741)
86a28458c Thu Oct 21 20:01:29 2021 +0300 test_runner: use Python 3.7 in CI and improve its support (#775)
9070a4dc0 Fri Oct 22 01:40:43 2021 +0300 Turn off back pressure by default
8c42dcc04 Fri Oct 22 08:39:58 2021 +0300 Fix safekeeper -D option.
04fb0a034 Fri Oct 22 22:22:38 2021 +0300 Add core relish backup and restore functionality
e14f24034 Mon Oct 25 14:14:38 2021 +0300 Turn a few path-fixtures to global variables
57ce54152 Mon Oct 25 14:14:41 2021 +0300 Remove unnecessary 'pg_bin' object from 'postgres' fixture.
f337d73a6 Mon Oct 25 14:14:43 2021 +0300 Rearrange output dirs a bit
28af3e500 Mon Oct 25 14:14:45 2021 +0300 Remove some unnecessary fixture arguments
66ec13567 Mon Oct 25 14:14:47 2021 +0300 Refactor pytest fixtures
f291ab2b8 Mon Oct 25 18:36:30 2021 +0300 Do not panic on missing tenant
66eb08187 Mon Oct 25 21:16:58 2021 +0300 Improve comment on 'base_dir'
3bbc106c7 Mon Oct 25 21:16:58 2021 +0300 Prefer long CLI option name for clarity.
4726870e8 Mon Oct 25 21:16:58 2021 +0300 Remove obsolete comment.
a064ebb64 Mon Oct 25 21:24:11 2021 +0300 Cope with missing 'tenantid' in '.zenith/config' file.
1877bbc7c Tue Oct 26 15:43:19 2021 +0300 bump vendor/postgres to fix reconnection busy loop
f43f8401e Tue Oct 26 19:30:28 2021 +0300 Don't wait for wal-redo process for non-relational records replay
ecd577c93 Tue Oct 26 23:24:11 2021 +0300 Simplify tracing declarations
d88377f9f Tue Oct 26 23:24:11 2021 +0300 Remove log from zenith_utils
41d48719e Wed Oct 27 00:46:24 2021 +0300 In python tests, skip ports that are already in use.
de87aad99 Wed Oct 27 01:10:24 2021 +0300 Remove a few unused functions
710fe02d0 Wed Oct 27 01:10:24 2021 +0300 Return success on 'zenith stop' if the page server is already stopped.
af429fb40 Wed Oct 27 10:49:38 2021 +0300 Improve 'zenith' CLI utility for safekeepers and a config file.
1bc917324 Wed Oct 27 10:49:38 2021 +0300 Use -m immediate for 'immediate' shutdown
1fac4a3c9 Wed Oct 27 10:58:21 2021 +0300 Fix a few messages.
5bc09074e Wed Oct 27 13:30:34 2021 +0300 add a flag to avoid non incremental size calculation in pageserver http api
1c0e85f9a Wed Oct 27 13:30:34 2021 +0300 review cleanups
d42314262 Wed Oct 27 20:24:23 2021 +0300 Proxy: wait for kick on .pgpass connection (zenithdb/console#227)
28ab40c8b Wed Oct 27 20:50:26 2021 +0300 fix init_repo() call in register_relish_download()
ea5900f15 Wed Oct 27 20:50:26 2021 +0300 Refactoring of checkpointer and GC. Move them to a separate tenant_threads module to detangle thread management from LayeredRepository implementation.
7e552b645 Thu Oct 28 18:38:36 2021 +0300 Add disk write/sync metrics to Safekeeper (#745)
edba2e974 Thu Oct 28 18:55:14 2021 +0300 Use a proper extension for the readme file
e0d7ecf91 Fri Oct 29 19:01:01 2021 +0300 Refactor 'zenith' CLI subcommand handling
b53247079 Fri Oct 29 12:45:26 2021 -0700 Set SO_REUSEADDR for all TCP listeners
e6ef27637 Fri Oct 29 23:51:40 2021 +0300 Better API to handle timeline metadata properly
071e30cc5 Mon Nov 1 18:04:00 2021 +0300 Expose TENANT_THREADS_COUNT metric to observe number of currently active checkpointer and GC threads
83ed930bc Mon Nov 1 18:04:00 2021 +0300 WIP. Launch and shutdown tenant threads together with walreceiver. TODO: now walreceiver only disconnects if safekeeper was shut down. Implemnt proper walreceiver disconnection.
85f8bf97f Mon Nov 1 19:09:57 2021 +0300 Name walkeeper threads to make debugging more convenient
cdbbd15eb Mon Nov 1 12:20:24 2021 -0700 pageserver - add InMemoryLayer global map (#817)
8c6d2664c Tue Nov 2 15:43:16 2021 +0200 Support removing arbitrary open layers, not just the oldest one
fb524dd97 Tue Nov 2 15:49:39 2021 +0200 Put a global limit on memory used by in-memory layers.
0457fe81a Wed Nov 3 09:28:49 2021 -0700 pageserver - make `PageVersion` an enum
4ba783d0a Wed Nov 3 19:10:23 2021 +0200 Remove a couple of unused functions.
c6172dae4 Thu Nov 4 02:15:46 2021 +0300 implement performance tests against our staging environment tests are based on self-hosted runner which is physically close to our staging deployment in aws, currently tests consist of various configurations of pgbenchi runs.
7ed39655d Thu Nov 4 10:35:50 2021 +0200 Bump vendor/postgres
086a02ab9 Thu Nov 4 10:36:45 2021 +0200 Add performance test for simple seq scans.
3a0111c75 Thu Nov 4 10:39:00 2021 +0200 Refactor functions for constructing WAL redo messages.
b38e841f2 Thu Nov 4 10:39:04 2021 +0200 Use poll() in communication with WAL redo process.
956fc3dec Thu Nov 4 12:53:42 2021 +0200 Tidy up and make consistent the remote storate API
f36acf00d Thu Nov 4 12:53:42 2021 +0200 Reduce "relish" word usages in remote storage
987833e0b Thu Nov 4 14:22:29 2021 +0300 Propagate git SHA to zenith binaries
33007cc0b Thu Nov 4 14:50:33 2021 +0300 Safekeeper's `START_REPLICATION` handler: remove `stop_point`, do not handle `start_point == 0` (#777)
c75bc9b8b Thu Nov 4 16:33:31 2021 +0300 Change benchmark plugin layout so pytest loads it properly when running all tests (not necessary performance ones)
6d742719a Thu Nov 4 16:07:12 2021 +0200 Fix infinite loop in looking up predecessor layer
d19263aec Thu Nov 4 19:58:40 2021 +0300 Adjust timeouts for test_restarts_under_load (#830)
865870a8e Fri Nov 5 14:07:11 2021 +0300 Follow up staging benchmarking
067f2ac81 Mon Nov 8 13:27:23 2021 +0300 fix perf repo branch name
229dc7704 Mon Nov 8 17:32:13 2021 +0300 Bump vendor/postgres.
07dddfed2 Tue Nov 9 17:51:46 2021 +0300 Use more robust way to persist safekeeper control file.
587935ebe Tue Nov 9 22:18:59 2021 +0300 Add Safekeeper metrics tests (#746)
eaff0cd56 Tue Nov 9 22:23:29 2021 +0300 Check python for the whole repository and improve docs (#813)
ce15c62f3 Wed Nov 10 01:38:25 2021 +0300 Fix 'send WAL up to' debug logging.
5603259c5 Wed Nov 10 01:38:25 2021 +0300 In wal_proposer_recovery, don't wait outcoming WAL to be committed.
9aaa02bc9 Wed Nov 10 17:18:07 2021 +0300 Fix high CPU usage in walproposer (#860)
9300107cd Wed Nov 10 17:19:37 2021 +0200 Cache Book objects, use virtual files to avoid running out of fds.
1ce4976e3 Wed Nov 10 11:09:34 2021 -0800 pageserver - track size of VecMaps
e7ca8ef5a Thu Nov 11 13:53:39 2021 +0300 Use PG timelineid 1 everywhere.
99dbbe5f1 Thu Nov 11 18:51:34 2021 +0200 Allow downloading remote files partially
abb2ac524 Thu Nov 11 19:22:05 2021 +0200 Better context when erroring
d1e79c4af Thu Nov 11 20:12:59 2021 +0200 Fix locking issues in VirtualFile machinery.
0d6bf14ec Fri Nov 12 16:27:43 2021 +0300 Use vendor/postgres rebased on top of REL_14_1
de5e6a15a Fri Nov 12 16:27:43 2021 +0300 Set LD_LIBRARY_PATH in the check_restored_datadir_content() psql call
849ac791a Fri Nov 12 18:47:39 2021 +0200 Bandaid fix for "page not found" errors, when a table is loaded.
3d172d98a Fri Nov 12 19:59:31 2021 +0200 Improve layered repo README.
431d32756 Fri Nov 12 11:02:12 2021 -0800 Add a buffer cache, and use it to store materialized pages.
4ba521f53 Mon Nov 15 14:49:53 2021 +0200 Add performance test case for parallel COPY TO
298bc588f Mon Nov 15 09:01:45 2021 -0800 pageserver - don't try to GC InMemoryLayers
44111e3ba Mon Nov 15 20:03:16 2021 +0300 Prohibit branch creation at lsn that was already garbage collected.
f8702d462 Mon Nov 15 20:19:15 2021 +0200 Fix checking for whether segment exists on a frozen in-memory layer.
43ded1c54 Wed Nov 17 16:28:44 2021 +0300 [proxy] Minor cleanup
b55cf773a Wed Nov 17 16:28:44 2021 +0300 [proxy] Streamline control- and dataflow
0ccfc62e8 Wed Nov 17 16:28:44 2021 +0300 [proxy] Pass PostgreSQL version to client
b32da3b42 Thu Nov 18 22:53:40 2021 +0200 Use less pageserver-specific method in RemoteStorage trait
6ac76248c Fri Nov 19 00:00:19 2021 +0300 Save performance test results from perfirmance test suit runs.
70ab0d5b1 Fri Nov 19 00:10:40 2021 +0300 add missing script
6f7ebe6e0 Mon Nov 22 11:39:20 2021 +0300 preserve data in parent branch that might be referenced in child branch
737a557f0 Mon Nov 22 11:39:20 2021 +0300 add check to python tests that afteer gc number of rows is unchanged in all branches
0650e51f0 Mon Nov 22 11:39:20 2021 +0300 add test one more case for layer visibility
d47f61060 Thu Nov 25 13:31:52 2021 +0200 Fix pageserver CLI parameter names and document them
130184fee Thu Nov 25 15:27:16 2021 +0300 Prohibit branch creation and basebackup at out of scope lsns
93cc40584 Fri Nov 26 16:48:27 2021 +0300 Shutdown socket on CopyFail (#938)
5aa969a58 Fri Nov 26 17:25:17 2021 +0300 Replace in-memory layers and OOM-triggered eviction with temp files.
7cae26544 Mon Nov 29 11:26:54 2021 +0200 Fix dump_layerfile.
5ecf0664c Mon Nov 29 14:35:24 2021 +0200 Fix off-by-one error in check for future delta layers.
f72d4814b Tue Nov 30 12:57:26 2021 +0300 Extract page images from FPI WAL records (#949)
670205e17 Tue Nov 30 13:58:49 2021 +0200 Evict excessively failing sync tasks, improve processing for the rest of the tasks
f49ad33f1 Tue Nov 30 22:23:59 2021 +0200 Initialize 'loaded' correctly in DeltaLayer.
2669d140f Wed Dec 1 17:35:57 2021 +0300 use full commit sha for version info
cba4da3f4 Fri Dec 3 12:43:57 2021 +0300 Add term history to safekeepers.
d39608c36 Fri Dec 3 12:43:57 2021 +0300 Fix passing start_offset to find_end_of_wal_segment.
5bad2deff Fri Dec 3 07:42:10 2021 -0500 Don't hold 'timelines' lock over checkpoint.
c7f3b4e62 Mon Dec 6 12:49:42 2021 +0300 Clarify the meaning of StandbyReply LSNs: write_lsn - The last LSN received and processed by pageserver's walreceiver. flush_lsn - same as write_lsn. At pageserver it doesn't guarantees data persistence, but it's fine. We rely on safekeepers. apply_lsn - The LSN at which pageserver guaranteed persistence of all received data (disk_consistent_lsn).
b7685eb6b Mon Dec 6 12:49:42 2021 +0300 Enable backpressure
7cec13d1d Mon Dec 6 13:27:52 2021 +0300 Improve shutdown story for code coverage
5d3756030 Mon Dec 6 13:27:52 2021 +0300 Add bespoke glue script leveraging LLVM coverage tools
d87467595 Mon Dec 6 13:27:52 2021 +0300 Collect coverage in CI
b87ab17d0 Mon Dec 6 13:27:52 2021 +0300 Bump rust version to 1.56.1
0a8c67263 Mon Dec 6 13:52:28 2021 +0300 [CI] Fix benchmarks
bd34d7ecf Mon Dec 6 19:47:55 2021 +0300 Bump safekeeper control file version and allow reading the previous one.
557e3024c Mon Dec 6 21:28:49 2021 +0300 Forward pageserver connection string from compute to safekeeper
450fb9eaf Tue Dec 7 15:02:44 2021 +0300 Don't persist control file without sync (#966)
bb5aba42e Wed Dec 8 18:57:18 2021 +0300 bump vendor/postgres to use correct backpressure commit
609423617 Wed Dec 8 11:55:54 2021 -0800 Update README.md
37c85d5fd Thu Dec 9 06:57:46 2021 +0300 Switch safekeeper from log to tracing logging.
7dece8e4a Thu Dec 9 12:53:26 2021 +0300 skip temporary table files when comparing directories in regress tests
41dce68bd Thu Dec 9 13:31:49 2021 +0300 callmemaybe refactoring
93ff5f7ff Thu Dec 9 13:31:49 2021 +0300 Add default value for safekeeper --recall option. DEFAULT_RECALL_PERIOD is 1 second.
5293e183c Thu Dec 9 13:31:49 2021 +0300 callmemaybe. review code cleanup
8388e14bb Thu Dec 9 14:06:17 2021 +0300 [scripts/git-upload] Fix logic of --forbid-overwrite
f3f059c1f Thu Dec 9 17:46:48 2021 +0200 Fix a few cases where request beyond end of rel would error out.
6ecd442fb Fri Dec 10 14:24:33 2021 +0200 Remove a bunch of unnecessary dependencies.
9d369f158 Fri Dec 10 14:52:08 2021 +0200 Update rust-s3 to version 0.28.0
c77e30116 Fri Dec 10 15:14:13 2021 +0200 Split waldecoder.rs into two source files.
cb4a8396f Fri Dec 10 15:14:27 2021 +0200 Use rustls rather than native-tls in all dependencies.
e61732ca7 Fri Dec 10 17:23:35 2021 +0200 Compress checkpoint files before streaming into S3
673c29794 Fri Dec 10 17:23:35 2021 +0200 Download timelines on demand
72ef59c37 Mon Dec 13 13:44:08 2021 +0200 Fix small typos in comments, add a comment.
e0d41ac6a Mon Dec 13 16:57:16 2021 +0200 Move constants related to metadata file to metadata.rs.
8f0cafd50 Mon Dec 13 22:11:04 2021 +0300 Grab safekeeper.lock on the whole directory instead of per tli.
5cff7d1de Tue Dec 14 15:32:22 2021 +0200 Use proper download order
f8f88154d Tue Dec 14 20:24:03 2021 +0200 Split restore_local_repo.rs into two files, with more descriptive names.
7f78e80c5 Tue Dec 14 20:24:03 2021 +0200 Refactor WAL ingestion code.
66242f0d0 Wed Dec 15 16:08:31 2021 +0300 tag docker image by commit sha and add docker build for compute
86a409a17 Wed Dec 15 16:08:31 2021 +0300 cleanup circleci config after test
ca60561a0 Wed Dec 15 15:13:21 2021 +0200 Propagate disk consistent lsn in timeline sync statuses
d8a367dd3 Wed Dec 15 19:58:03 2021 +0200 Remove dead code, fix typos.
29143b018 Wed Dec 15 21:57:34 2021 +0300 Disable rustc incremental compilation to avoid ICEs
cbe155ff4 Thu Dec 16 17:05:20 2021 +0300 storage CI flow for staging environment (#1003)
5d5c2738a Thu Dec 16 22:54:01 2021 +0300 staging deployment flow fix (#1029)
75cbaafb9 Fri Dec 17 00:00:02 2021 +0200 Remove old ephemeral files on pageserver restart.
90e5b6f98 Mon Dec 20 12:34:28 2021 +0300 Don't try to reconnect failed walreceiver. If necessary, wal service will send new callmemaybe request
3b61f364f Mon Dec 20 12:34:28 2021 +0300 Stop WAL streaming threads, when compute node is shut down.
2d9d0658e Mon Dec 20 13:54:10 2021 +0300 adjust benchmarking script for go console
56312522f Tue Dec 21 13:24:23 2021 +0300 Make safekeeper namings more consistent with reality.
76777f581 Tue Dec 21 15:43:15 2021 +0300 Add utility for dumping/editing metadata file (#1031)
68aa9d271 Tue Dec 21 15:43:34 2021 +0300 Set utf8 encoding in initdb (#993)
f56db3da6 Tue Dec 21 16:53:08 2021 +0300 Bump vendor/postgres (#996)
bcf80eaa9 Tue Dec 21 17:50:06 2021 +0200 Fix multixacts members WAL redo.
927587cec Tue Dec 21 22:38:33 2021 +0200 Fix comments in tests
1cc181ca3 Tue Dec 21 23:08:01 2021 +0200 Fix WAL redo of commit records with subtransactions.
da62407fc Wed Dec 22 16:55:37 2021 +0200 Change the meaning of 'blknum' argument in Layer trait
fdd987c3a Thu Dec 23 00:33:16 2021 +0200 Refactor the way Image- and DeltaLayers are created
9854ded56 Thu Dec 23 15:53:28 2021 +0300 Feature/proxy deploy (#1046)
114a757d1 Thu Dec 23 18:58:28 2021 +0200 Use generic config parameters in pageserver cli
b807570f4 Thu Dec 23 14:25:44 2021 -0500 Use parking_lot::Mutex instead of std::Mutex in walreceiver (#1045)
42647f606 Fri Dec 24 03:41:45 2021 +0200 Use correct pageserver CLI parameters in docker entrypoint
980f5f844 Fri Dec 24 15:32:54 2021 +0300 Propagate remote_consistent_lsn to safekeepers.
a163650a9 Fri Dec 24 15:48:13 2021 +0300 Refactor Postgres command parsing in safekeeper.
b494ac1ea Mon Dec 27 18:38:54 2021 +0200 Remove redundant pageserver cli params
f0afd0866 Tue Dec 28 00:21:48 2021 +0200 Fix zenith init defaults
5ef2b1baf Tue Dec 28 17:50:48 2021 +0300 Add new test illustrating issue with sync-safekeepers. If safekeepers sync fast enough, callmemaybe thread may never make a call before receiving Unsubscribe request. This leads to the situation, when pageserver lacks data that exists on safekeepers.
eba897ffe Tue Dec 28 17:50:48 2021 +0300 send CallmeEvent::Unsubscribe request only when pageserver is caught up with safekeeper and it's time to stop streaming
f64074c60 Tue Dec 28 20:17:29 2021 +0300 Move compute_tools from console repo (zenithdb/console#383)
989371493 Tue Dec 28 22:40:22 2021 +0300 Add BeMessage::BackendKeyData variant
1e3ddd43b Tue Dec 28 22:40:22 2021 +0300 Add struct for key data
24eca8d58 Tue Dec 28 16:43:44 2021 -0500 Parse cancel message in pq_proto (#1060)
a379b4525 Tue Dec 28 14:26:42 2021 -0800 Update README.md
70778058d Wed Dec 29 12:58:27 2021 +0300 Add test for safekeeper setup without pageserver (#1000)
c910132d4 Wed Dec 29 14:42:29 2021 +0300 Fix wal receiver shutdown
8f0cd7fb9 Wed Dec 29 16:35:29 2021 +0300 [compute_tools] Switch cluster_id in spec to string (zenithdb/console#72)
1c47fbae8 Sat Jan 1 19:08:09 2022 +0300 Do not write image layers during enforced checkpoint (#1057)
25a515b96 Mon Jan 3 20:44:36 2022 +0300 Don't call immediately on resume in callmemaybe.
722667f18 Tue Jan 4 11:26:37 2022 +0200 Add test case for performance issue #941.
55a4cf64a Tue Jan 4 11:26:37 2022 +0200 Refactor WAL record handling.
24c8dab86 Tue Jan 4 20:40:57 2022 -0800 pageserver - parallelize checkpoint fsyncs
191d9d2b7 Tue Jan 4 20:40:57 2022 -0800 par_fsync - use VirtualFile
5a6405848 Wed Jan 5 14:27:51 2022 +0300 Bump vendor/postgres (#1086)
5b9391b51 Wed Jan 5 17:27:12 2022 -0500 Support "query cancel" in proxy (#1052)
2fd4c390c Mon Jan 10 14:41:15 2022 +0300 Do not hold timelines lock during GC (#1089)
233c4811d Tue Jan 11 10:13:27 2022 +0300 Fix default safekeeper http port.
384b2a91f Tue Jan 11 15:44:23 2022 +0200 Pass generic pageserver params through zenith cli
ce8d6ae95 Tue Jan 11 15:44:23 2022 +0200 Allow using remote storage in tests
23cf2fa98 Tue Jan 11 15:44:23 2022 +0200 Properly shutdown storage sync loop
65c851a45 Tue Jan 11 15:44:23 2022 +0200 Test pageserver's timeline http methods
a3cd8f0e6 Tue Jan 11 15:44:23 2022 +0200 Add the remote storage test
7c4a65323 Tue Jan 11 15:44:23 2022 +0200 Propagate Zenith CLI's RUST_LOG env var to subprocesses
8ab4c8a05 Tue Jan 11 15:44:23 2022 +0200 Code review fixes
4b3b19f44 Tue Jan 11 15:44:50 2022 +0200 Support prefixes when working with s3 buckets
7aba299db Wed Jan 12 14:38:04 2022 +0300 Use safekeeper in test_branch_behind (#1068) to avoid a subtle race condition.
f70a5cad6 Wed Jan 12 15:05:08 2022 +0300 Fix releasing of timelines lock (#1100)
ab4d27214 Wed Jan 12 19:47:24 2022 +0300 Add safekeeper --dump-control-file option.
772d853dc Thu Jan 13 11:21:11 2022 +0200 Fix race condition leading to panic in walkeeper.
bc6db2c10 Thu Jan 13 17:36:53 2022 +0300 Implement IO metrics in VirtualFile (#1112)
404aab937 Thu Jan 13 17:48:24 2022 +0300 Use mutex to prevent concurrent checkpoints (#1115)
19aaa91f6 Thu Jan 13 18:45:30 2022 +0200 Timeline IDs are not globally unique, fix some code that assumed that.
0a34a592d Thu Jan 13 20:28:37 2022 +0300 Bump vendor/postgres (#1120)
5e0f39cc9 Thu Jan 13 20:34:30 2022 -0500 Add proxy metrics (#1093)
adb0b3dad Fri Jan 14 10:10:17 2022 +0200 Include backtrace in error messages in the log.
d29836d0d Fri Jan 14 18:02:30 2022 +0200 Don't panic if spawning a thread to handle a connection fails.
bad1dd975 Fri Jan 14 18:02:34 2022 +0200 Don't panic if spawning a new WAL receiver thread fails.
dab30c27b Fri Jan 14 18:36:10 2022 +0200 Refactor thread management and shutdown
17b7caddc Fri Jan 14 20:51:02 2022 +0200 Update vendor/postgres: silence excessive logging from walproposer.
8af1b4307 Fri Jan 14 19:12:43 2022 -0500 proxy: Add new metrics (#1132)
06c28174c Tue Jan 18 18:47:31 2022 +0300 Integrate compute_tools into zenith workspace and improve logging (zenithdb/console#487)
9d6ae0666 Tue Jan 18 19:23:53 2022 +0300 monitoring turn on for proxy (#1146)
7fb62fc84 Tue Jan 18 23:01:04 2022 +0200 Fix macos compilation
d3542c34f Wed Jan 19 16:33:48 2022 +0300 Refactoring: use anyhow::Context's methods where possible
caa62eff2 Thu Jan 20 14:50:27 2022 +0300 Fix description of proxy --auth-endpoint option.
38c6f6ce1 Thu Jan 20 18:42:47 2022 +0200 Allow specifying custom endpoint in s3
45124856b Thu Jan 20 18:42:47 2022 +0200 Better S3 remote storage logging
026eb64a8 Thu Jan 20 18:42:47 2022 +0200 Use python lib to mock s3
924d8d489 Thu Jan 20 18:42:47 2022 +0200 Allow enabling S3 mock in all existing tests with an env var
127df9663 Fri Jan 21 17:31:19 2022 +0300 [proxy] Make `NUM_BYTES_PROXIED_COUNTER` more precise
65290b2e9 Fri Jan 21 17:34:15 2022 +0300 Ensure every submodule compiles on its own
e20976487 Mon Jan 24 10:42:40 2022 +0300 Do not delete layers beyand cutoff LSN (#1128)
5f5a11525 Mon Jan 24 11:33:47 2022 +0300 Switch our python package management solution to poetry.
7bc1274a0 Mon Jan 24 12:19:18 2022 +0300 Fix comparison with disk_consistent_lsn in  newer_image_layer_exists (#1167)
81e94d189 Mon Jan 24 12:52:30 2022 +0300 Add LSN and Backpressure descriptions to glossary.md
37c440c5d Mon Jan 24 17:20:15 2022 +0300 Introduce first version of tenant migraiton between pageservers
39591ef62 Mon Jan 24 17:20:15 2022 +0300 reduce flakiness
458bc0c83 Mon Jan 24 17:20:15 2022 +0300 walkeeper: use named type as a key in callmemaybe subscriptions hashmap
703716228 Mon Jan 24 18:49:05 2022 +0300 Use `&str` instead of `String` in `BeMessage::ErrorResponse`
be6d1cc36 Tue Jan 25 00:58:37 2022 +0300 Use zimg as builders (#1165)
e6f2d7051 Tue Jan 25 18:48:49 2022 +0300 use 2021 rust edition
f3c73f579 Wed Jan 26 13:01:12 2022 +0300 cache python deps in circle ci
63dd7bce7 Wed Jan 26 19:54:09 2022 +0300 bandaid to avoid concurrent timeline downloading until proper refactoring/fix
5abe2129c Thu Jan 27 11:20:45 2022 +0300 Extend replication protocol with ZentihFeedback message to pass current_timeline_size to compute node
c44695f34 Thu Jan 27 11:20:45 2022 +0300 bump vendor/postgres
79f0e44a2 Thu Jan 27 14:41:16 2022 +0300 Gc cutoff rwlock (#1139)
86045ac36 Thu Jan 27 17:22:07 2022 +0300 Prefix per-cluster directory with ztenant_id in safekeeper.
49d1d1ddf Thu Jan 27 17:23:14 2022 +0300 Don't call adjust_for_wal_acceptors after pg create (#1178)
cedde559b Thu Jan 27 17:26:55 2022 +0300 Add test for replacement of the failed safekeeper (#1179)
f58a22d07 Thu Jan 27 18:21:00 2022 +0300 Freeze layers at the same end LSN (#1182)
08135910a Thu Jan 27 18:21:51 2022 +0300 Fix checkpoint.nextXid update (#1166)
5df21e105 Fri Jan 28 12:31:15 2022 +0300 remove Timeline::start_lsn in favor of ancestor_lsn
602ccb7d5 Fri Jan 28 12:31:15 2022 +0300 distinguish failures for pre-initdb lsn and pre-ancestor lsn branching in test_branch_behind
c045ae7a9 Fri Jan 28 16:29:55 2022 +0300 Fix random range for keys in test_gc_aggressive.py (#1199)
33251a9d8 Fri Jan 28 18:35:46 2022 +0300 Disable failing remote storage tests for now
c2927353a Fri Jan 28 19:40:37 2022 +0300 Enable async deserialization of FeMessage
8ac8be520 Fri Jan 28 19:56:28 2022 +0300 [scripts/coverage] Implement `merge` command
9350dfb21 Fri Jan 28 19:56:28 2022 +0300 [CI] Merge *.profraw files prior to uploading workspace
ec78babad Fri Jan 28 20:40:50 2022 +0300 Use `mold` instead of default linker
d69b0539b Tue Feb 1 13:31:05 2022 +0300 proxy chart staging values update for labels (#1202)
729ac38ea Thu Feb 3 02:34:10 2022 +0300 Centralize suspending/resuming timeline activity on safekeepers.
32c785965 Sat Feb 5 01:27:31 2022 +0300 bump vendor/postgres
2d93b129a Sat Feb 5 17:59:31 2022 +0200 Avoid eprintln() in pageserver and walkeeper.
3ed156a5b Sat Feb 5 15:48:08 2022 -0500 Add a CLI tool to manipulate remote storage blob files
642797b69 Sun Feb 6 02:16:36 2022 +0300 Implement cluster size quota for zenith compute node. Use GUC zenith.max_cluster_size to set the limit.
cb1d84d98 Sun Feb 6 02:16:36 2022 +0300 Make test_timeline_size_quota more deterministic
b67cddb30 Sat Feb 5 22:02:59 2022 -0500 Implement EphemeralFile flush in a least dangerous way
2866a9e82 Mon Feb 7 20:05:16 2022 +0300 Fix safekeeper LSN metrics (#1216)
e1d770939 Wed Feb 9 08:50:45 2022 -0500 Bump vendor/postgres to fix recent CI failure.
5268bbc84 Wed Feb 9 15:52:21 2022 +0200 Bump vendor/postgres for fixes to cluster size limit.
a504cc87a Wed Feb 9 16:13:46 2022 +0200 Bump vendor/postgres for "Make getpage requests interruptible"
1e8ca497e Thu Feb 10 09:23:53 2022 +0300 Fix safekeeper loopback addr (#1247)
fa8a6c0e9 Thu Feb 10 08:34:30 2022 +0200 Reduce logging of walkeeper normal operations.
f1e7db9d0 Thu Feb 10 11:19:10 2022 +0300 Bump vendor/postgres rebased to 14.2
c45ee13b4 Thu Feb 10 11:29:38 2022 +0200 Bump vendor/postgres, to fix memory leak.
ccf3c8cc3 Thu Feb 10 13:12:19 2022 +0300 store performance test results in our staging cluster to be able to visualize them in grafana
a25fa29bc Thu Feb 10 13:12:19 2022 +0300 modify git-upload for generate_and_push_perf_report.sh needs
b08e340f6 Thu Feb 10 14:18:34 2022 +0300 point perf results back from testing to master
76b74349c Thu Feb 10 08:33:22 2022 -0500 Bump pageserver dependencies
c5b5905ed Thu Feb 10 08:33:22 2022 -0500 Remove parking_lot dependency from workspace
6eef40160 Thu Feb 10 08:33:22 2022 -0500 Move routerify behind zenith_utils
7c1c7702d Thu Feb 10 08:33:22 2022 -0500 Code review fixes
d7af96598 Thu Feb 10 08:33:22 2022 -0500 Do not leak decoding_key in JwtAuth's Debug representation
3cfcdb92e Thu Feb 10 08:33:22 2022 -0500 Fix tokio features in zenith utils to enable its standalone compilation
b51f23cdf Thu Feb 10 17:49:54 2022 +0300 pass perf test cluster connstr to circle ci jobs
ea13838be Thu Feb 10 15:33:36 2022 -0500 Add pgbench baseline test (#1204)
d951dd897 Thu Feb 10 18:36:02 2022 -0500 Fix cli start (#1260)
36481f337 Mon Feb 14 15:57:38 2022 +0300 bump vendor/postgres to init pgxactoff in walproposer
d4d26f619 Mon Feb 14 21:00:11 2022 +0300 bump vendor/postgres to fix compilation warning
a4829712f Tue Feb 15 03:47:06 2022 +0300 merge directories in git-upload instead of removing existing files for perf test result uploads
47f6a1f9a Tue Feb 15 06:51:16 2022 +0300 Add -Werror to CI builds.
328e3b418 Tue Feb 15 06:51:16 2022 +0300 bump vendor/postgres to fix compiler warnings
9632c352a Tue Feb 15 14:26:16 2022 +0200 Avoid having multiple records for the same page and LSN.
0a557b2fa Tue Feb 15 17:01:22 2022 +0200 Add cli v4 loopback listener ports test
5563ff123 Tue Feb 15 17:45:23 2022 +0200 Reuse tenant-timeline id struct from utils
afb3342e4 Tue Feb 15 13:44:22 2022 -0500 Add vanilla pg baseline tests (#1275)
335abfcc2 Wed Feb 16 10:59:51 2022 -0500 Add slow seqscan perf test (#1283)
4bf4bacf0 Wed Feb 16 13:19:12 2022 -0800 Add cli start/stop test
9cce43043 Thu Feb 17 11:26:28 2022 +0300 remove several obsolete management api commands from pageserver's libpq api
a47dade62 Thu Feb 17 11:54:27 2022 +0300 [proxy] Migrate to async
a26d56528 Thu Feb 17 11:54:27 2022 +0300 [proxy] Replace private static map with a public `CancelMap`
9512e21b9 Thu Feb 17 13:22:14 2022 +0300 fix python formatting
e5bf520b1 Thu Feb 17 13:41:19 2022 +0200 Use types in zenith cli invocations in Python tests
ce533835e Thu Feb 17 13:41:19 2022 +0200 Use uuid.UUID types for tenants and timelines more
ad262a46a Thu Feb 17 13:41:49 2022 +0200 Remove redundant pytest_plugins assignment
4c64b10ae Thu Feb 17 13:41:49 2022 +0200 Revert removal of ignore hint
1b3137945 Thu Feb 17 13:42:09 2022 +0200 Log postgres errors with ERROR level
009f6d4ae Fri Feb 18 08:26:37 2022 -0800 Fix safekeeper metric tags
d2b896381 Fri Feb 18 08:26:37 2022 -0800 Add safekeeper tenant tags in lsn/wal metrics
207286f2b Fri Feb 18 20:22:21 2022 +0200 Actualize branching parts of openapi spec.
fdc15de8b Fri Feb 18 15:46:29 2022 -0500 Add perf test: test_random_writes (#1292)
abb422d5d Mon Feb 21 13:45:22 2022 +0300 Fix SafekeeperMetrics parsing in python tests
92787159f Mon Feb 21 16:43:28 2022 +0300 Add client auth method option
c8f47cd38 Mon Feb 21 16:43:28 2022 +0300 Fix param name
cca886682 Mon Feb 21 16:43:28 2022 +0300 Undo cplane change
65a0b2736 Mon Feb 21 16:43:28 2022 +0300 Add static router
ca81a550e Mon Feb 21 16:43:28 2022 +0300 Fmt
dba1d36a4 Mon Feb 21 17:20:53 2022 +0300 Refactor WAL utils in safekeeper (#1290)
993b544ad Tue Feb 22 13:56:21 2022 +0300 Change default parameters for back pressure
1a4682a04 Tue Feb 22 13:56:21 2022 +0300 Add 'walreceiver-after-ingest' failpoint. Use sleep at this point to imitate slow walreceiver.
74a0942a7 Tue Feb 22 13:56:21 2022 +0300 Fix zenith feedback processing at compute node. Add test for backpressure
b815f5fb9 Tue Feb 22 12:01:12 2022 -0800 Add no_sync check in storage
468366a28 Wed Feb 23 11:33:17 2022 +0200 Fix wrong 'lsn' stored in test page image
58ee5d005 Wed Feb 23 19:59:35 2022 +0300 Add --pageserver-config-override to ZenithEnvBuilder to tune checkpointer and GC in tests. Usage example: zenith_env_builder.pageserver_config_override = "checkpoint_period = '100 s'; checkpoint_distance = 1073741824"
87edbd38c Wed Feb 23 19:59:35 2022 +0300 Add 'wait_lsn_timeout' and 'wal_redo_timeout' pageserver config options instead of hardcoded defaults
058123f7e Wed Feb 23 20:33:47 2022 +0300 Bump postgres to fix zenith_test_utils linkage on macOS.
7fae89464 Wed Feb 23 20:32:06 2022 +0200 Move a few unit tests specific to layered file format.
e4670a5f1 Wed Feb 23 21:04:39 2022 +0200 Remove the PageVersions abstraction.
5120ba4b5 Thu Feb 24 10:37:12 2022 +0200 Refactor the interface for using cached page image.
c1b3836df Thu Feb 24 12:52:12 2022 +0300 Bump vendor/postgres
917c64081 Thu Feb 24 14:24:36 2022 +0300 Fix mypy for the new Python
137d616e7 Thu Feb 24 11:20:07 2022 -0500 [proxy] Add pytest fixture (#1311)
c8a1192b5 Fri Feb 25 18:52:21 2022 +0300 Optimize WAL storage in safekeeper (#1318)
850dfd02d Sat Feb 26 23:33:16 2022 +0300 Release deployment (#1331)
26a68612d Sun Feb 27 01:36:40 2022 +0300 safekeeper to cosnole call fix (#1333)
a0f9a0d35 Sun Feb 27 01:52:33 2022 +0300 safekeeper to cosnole call fix (#1333) (#1334)
949f8b463 Wed Mar 2 21:35:34 2022 +0200 Fix 1.59 rustc clippy warnings
1d90b1b20 Fri Mar 4 01:10:42 2022 +0300 add node id to pageserver (#1310)
9424bfae2 Fri Mar 4 10:58:40 2022 +0200 Use a separate newtype for ZId that (de)serialize as hex strings
66eb2a1dd Fri Mar 4 13:46:44 2022 +0200 Replace zenith/build build image with zimg/* ones
f86cf9343 Sun Mar 6 08:06:38 2022 +0300 Refactor timeline creation on safekeepers, allowing storing peer ids.
8e37d345a Tue Mar 8 08:07:00 2022 +0300 Adjust safekeeper detailed logging to batch fsyncing.
cffac59a4 Tue Mar 8 23:19:49 2022 +0300 Docker improvement (#1345)
934bbcba0 Wed Mar 9 10:13:46 2022 +0300 revert docker build to debian:buster based rust (#1347)
15b19a0a5 Wed Mar 9 22:47:06 2022 +0300 [proxy] Test connstr options (#1344)
5b34afe89 Thu Mar 10 17:36:09 2022 +0400 Bump vendor/postgres to use local relation cache for smgr_exists
87f306c51 Thu Mar 10 17:36:09 2022 +0400 Tune backpressure in python tests to make them more stable
2883a2576 Thu Mar 10 17:36:09 2022 +0400 Bump vendor/postgres to use local relation cache for smgr_exists
10f811e88 Thu Mar 10 19:38:58 2022 +0200 Use `timeline` instead of `branch` in pageserver's API
0c91091c6 Thu Mar 10 19:38:58 2022 +0200 Avoid point in time concept on pageserver level
f49990ed4 Thu Mar 10 19:38:58 2022 +0200 Allow creating timelines by branching off ancestors
4d0f7fd1e Thu Mar 10 19:38:58 2022 +0200 Update Zenith CLI config between runs
c7569dce4 Thu Mar 10 19:38:58 2022 +0200 Allow passing initial timeline id into zenith CLI commands
7b5482bac Thu Mar 10 19:38:58 2022 +0200 Properly store the branch name mappings
a5e10c4f6 Thu Mar 10 19:38:58 2022 +0200 Tidy up pageserver's endpoints
dd74c66ef Thu Mar 10 19:38:58 2022 +0200 Do not create timeline along with tenant
fe6fccfda Thu Mar 10 19:38:58 2022 +0200 Allow already existing repo when creating a tenant
c51d545fd Thu Mar 10 19:38:58 2022 +0200 Serialize Lsn as strings in http api
093ad8ab5 Thu Mar 10 19:38:58 2022 +0200 Send 409 HTTP responses on timeline and tenant creation for existing entity
f67d010d1 Thu Mar 10 14:42:28 2022 -0800 Add ps smgr/storage metrics tenant tags
27dadba52 Thu Mar 10 14:42:28 2022 -0800 Fix retain references to layer histograms
b2ad8342d Thu Mar 10 14:42:28 2022 -0800 Add zid stringify bench test
a8a7dc9ca Thu Mar 10 14:42:28 2022 -0800 Fix zid encoding
5d7bd8643 Thu Mar 10 14:42:28 2022 -0800 Fix page reconstruct time histo
d93fc371f Fri Mar 11 18:49:36 2022 +0200 Import all existing RFCs documents from the separate 'rfcs' repository.
d5a96d3d5 Mon Mar 14 18:54:59 2022 +0300 Fix finding end of WAL on safekeepers after f86cf93435133ee11.
9c1a9a1d9 Mon Mar 14 21:06:25 2022 +0300 Update Cargo.lock for new dependencies (#1354)
705f51db2 Wed Mar 16 21:20:04 2022 +0300 [proxy] Propagate some errors to user (#1329)
15a2a2bf0 Wed Mar 16 23:00:01 2022 +0300 release 2202-03-16 (#1373)
1fddb0556 Thu Mar 17 00:01:17 2022 +0300 deploy playbook fix - interaction with console (#1374)
ab124c161 Thu Mar 17 00:05:51 2022 +0300 Merge branch 'release' into main
a7544eead Thu Mar 17 16:46:58 2022 +0300 Remove the last non-borrowed string from `BeMessage` (#1376)
7738254f8 Fri Mar 18 18:14:57 2022 +0300 refactor timeline memory state management
b19870cd8 Fri Mar 18 18:14:57 2022 +0300 guard against partial uploads to local storage
3b069f5ae Fri Mar 18 21:27:48 2022 +0200 Fix name of directory used in unit test.
063f9ba81 Mon Mar 21 12:46:07 2022 +0200 Use serde_with to (de)serialize ZId and Lsn to hex
37ebbb598 Mon Mar 21 12:46:33 2022 +0200 Add a macOs build
77ed2a0fa Mon Mar 21 12:46:33 2022 +0200 Run GitHub testing workflow on every push
bd6bef468 Mon Mar 21 13:42:21 2022 +0200 Provide single list timelines HTTP API handle
e13bdd77f Tue Mar 22 15:01:26 2022 +0400 add safekepeers gossip annd storage messaging rfcs
a4d0d78e9 Wed Mar 23 13:39:55 2022 +0300 s3 settings for pageserver (#1388)
15434ba7e Wed Mar 23 14:12:59 2022 +0200 Show cachepot build stats
123fcd5d0 Wed Mar 23 15:45:29 2022 +0200 Revert accidental bump of vendor/postgres submodule
e80ae4306 Wed Mar 23 18:20:43 2022 +0400 change log level from info to debug for timeline gc messages
0be7ed0cb Wed Mar 23 18:20:43 2022 +0400 decrease log message severity for timeline checkpoint internals
8a86276a6 Wed Mar 23 18:38:15 2022 +0400 add more context to error
8b8d78a3a Wed Mar 23 22:05:43 2022 +0400 use main branch of our bookfile crate
8437fc056 Wed Mar 23 23:35:36 2022 +0400 some follow ups after s3 integration was enabled on staging
c71887051 Thu Mar 24 09:46:07 2022 +0200 Tiny refactoring of page_cache::init function.
d3a9cb44a Thu Mar 24 12:47:22 2022 +0400 tweak timeouts for tenant relocation test
b9a1a75b0 Thu Mar 24 12:47:22 2022 +0400 clean up unused imports in python tests
825d36317 Thu Mar 24 12:20:06 2022 +0200 Remove some unnecessary Ord etc. trait implementations.
a201d33ed Thu Mar 24 21:11:02 2022 +0200 Properly print cachepot stats
edc7bebcb Fri Mar 25 11:58:54 2022 +0200 Remove obvious panic sources
f6b1d76c3 Fri Mar 25 11:58:54 2022 +0200 Replace assert! with ensure! for anyhow::Result functions
6244fd9e7 Fri Mar 25 11:58:54 2022 +0200 Better error messages on zenith cli subcommand invocations
28bc8e3f5 Fri Mar 25 11:58:54 2022 +0200 Log pageserver threads better and shut down on errors in them
b39d1b171 Fri Mar 25 11:58:54 2022 +0200 Exit only on important thread failures
e3fa00972 Fri Mar 25 15:34:38 2022 +0200 Use RwLocks in image and delta layers for more concurrency.
b8cba059a Sat Mar 26 00:19:25 2022 +0400 temporary disable s3 integration on staging until LSM storge rewrite lands
5e04dad36 Fri Mar 25 23:42:13 2022 +0200 Add more variants of the sequential scan performance tests.
18dfc769d Sat Mar 26 08:38:45 2022 +0200 Use cachepot to cache more rustc builds
d56a0ee19 Sat Mar 26 08:38:45 2022 +0200 Avoid recompiling tests for release profile
55de0b88f Mon Mar 28 12:36:01 2022 +0300 Hide remote timeline index access details
07342f751 Mon Mar 28 05:41:15 2022 -0500 Major storage format rewrite.
75002adc1 Mon Mar 28 20:34:06 2022 +0400 Make shared_buffers large in test_pageserver_catchup.
780b46ad2 Mon Mar 28 20:37:33 2022 +0400 Bump vendor/postgres to fix commit_lsn going backwards.
a88320249 Mon Mar 28 12:04:40 2022 -0500 Enable S3 for pageserver on staging
8a901de52 Mon Mar 28 21:52:12 2022 +0400 Refactor control file update at safekeeper.
d88f8b4a7 Mon Mar 28 13:30:40 2022 -0500 Fix storage deploy condition in ansible playbook
9a4f0930c Mon Mar 28 14:14:17 2022 -0500 Turn off S3 for pageserver on staging
1aa57fc26 Mon Mar 28 13:24:13 2022 -0700 Fix tone down compact log chatter
0e4488792 Tue Mar 29 00:36:06 2022 +0300 Show more S3 logs and less verbove WAL logs
be6a6958e Mon Mar 28 18:19:20 2022 -0700 CI: rebuild postgres when Makefile changes (#1429)
fd78110c2 Tue Mar 29 09:57:00 2022 +0300 Add default statement_timeout for tests (#1423)
eee0f51e0 Tue Mar 29 10:42:04 2022 +0300 use cargo-hakari to manage workspace_hack crate
9594362f7 Tue Mar 29 10:42:30 2022 +0300 change python cache version to 2 (fixes python cache in circle CI)
ec3bc7416 Tue Mar 29 18:16:49 2022 +0400 Add safekeeper information exchange through etcd.
ce0243bc1 Tue Mar 29 18:54:24 2022 +0300 Add metric for last_record_lsn (#1430)
277e41f4b Tue Mar 29 19:21:31 2022 +0300 Show s3 spans in logs and improve the log messages
5c5629910 Tue Mar 29 22:13:06 2022 -0700 Add a test case for reading historic page versions (#1314)
860923420 Wed Mar 30 10:13:38 2022 +0300 decrease the log level to debug because it is too noisy
649f324fe Wed Mar 30 17:58:51 2022 +0300 make logging in basebackup more consistent
1aa8fe43c Thu Mar 31 15:47:59 2022 +0300 Fix race condition in image layer (#1440)
a40b7cd51 Thu Mar 31 17:00:09 2022 +0300 Fix timeouts in test_restarts_under_load (#1436)
8745b022a Thu Mar 31 17:26:24 2022 +0300 Extend LayerMap dump() function to print also open_layers and frozen_layers. Add verbose option to chose if we need to print all layer's keys or not.
f5da65238 Thu Mar 31 20:44:57 2022 +0300 [proxy] Enable keepalives for all tcp connections (#1448)
af712798e Sat Apr 2 00:36:54 2022 +0300 Fix pageserver readme formatting
43c16c514 Sun Apr 3 19:30:36 2022 +0300 Don't log ZIds in the timeline load span
9e5423c86 Sun Apr 3 19:30:36 2022 +0300 Assert in a more informative way
4c9447589 Sun Apr 3 19:30:36 2022 +0300 Place an info span into gc loop step
1f0b406b6 Mon Apr 4 10:43:27 2022 +0300 Perform repartitioning in compaction thread
92031d376 Mon Apr 4 10:43:27 2022 +0300 Fix unit tests
232fe1429 Mon Apr 4 10:43:27 2022 +0300 Refactor partitioning
bef9b837f Mon Apr 4 10:43:27 2022 +0300 Replace rwlock with mutex in repartition
572b3f48c Mon Apr 4 10:43:27 2022 +0300 Add compaction_target_size parameter
fcf613b6e Mon Apr 4 10:43:27 2022 +0300 Fix unit tests build
a5a478c32 Mon Apr 4 16:32:30 2022 +0300 Bump vendor/postgres to store WAL on disk only (#1342)
089ba6abf Mon Apr 4 20:12:25 2022 +0300 Clean up some comments that still referred to 'segments'
222b72335 Mon Apr 4 20:12:28 2022 +0300 Handle read errors when dumping a delta layer file.
2f784144f Mon Apr 4 20:12:31 2022 +0300 Avoid deadlock when locking two buffers.
d0c246ac3 Tue Apr 5 20:01:57 2022 +0300 Update pageserver OpenAPI spec with missing attach/detach methods (#1463)
6fe443e23 Wed Apr 6 18:32:10 2022 -0400 Improve random_writes test (#1469)
6bc78a0e7 Thu Apr 7 01:44:26 2022 +0300 Log more info in test_many_timelines asserts (#1473)
d5258cdc4 Wed Apr 6 20:05:24 2022 -0400 [proxy] Don't print passwords (#1298)
81ba23094 Thu Apr 7 20:38:26 2022 +0300 Fix scripts to deploy sk4 on staging (#1476)
5d9851f5d Thu Apr 7 20:58:54 2022 +0300 Refactor the I/O functions.
c4b57e4b8 Thu Apr 7 20:58:55 2022 +0300 Move BlobRef
214567bf8 Thu Apr 7 20:58:55 2022 +0300 Use B-tree for the index in image and delta layers.
8e2a6661e Mon Apr 11 20:36:26 2022 +0300 Make wal_storage initialization eager (#1489)
db63fa64a Mon Apr 11 21:34:04 2022 +0300 Use rusoto lib for S3 relish_storage impl
0e9ee772a Mon Apr 11 21:34:04 2022 +0300 Use rusoto in safekeeper
4f172e761 Mon Apr 11 21:34:04 2022 +0300 Replicate S3 blob metadata in the remote storage
dc7e3ff05 Mon Apr 11 21:34:04 2022 +0300 Fix rustc 1.60 clippy warnings
07a955370 Mon Apr 11 22:30:08 2022 +0300 Add test for restore from WAL (#1366)
0fbe657b2 Wed Apr 13 00:02:06 2022 +0300 Fix remote e2e tests after repository rename (#1434)
4af87f3d6 Wed Apr 13 03:00:32 2022 +0300 [proxy] Add SCRAM auth mechanism implementation (#1050)
9b7a8e67a Wed Apr 13 10:05:19 2022 +0300 fix deadlock in upload_timeline_checkpoint
20414c4b1 Wed Apr 13 10:05:19 2022 +0300 defuse possible deadlock in download_timeline too
87020f812 Wed Apr 13 10:59:29 2022 +0300 Fix CI staging deploy (#1499)
58d5136a6 Wed Apr 13 17:16:25 2022 +0300 compute_tools: check writability handler (#941)
1fd08107c Wed Apr 13 07:42:58 2022 -0700 Add ps compaction_threshold config
49da76237 Wed Apr 13 19:50:31 2022 +0300 remove noisy debug log message
1d36c5a39 Wed Apr 13 20:10:39 2022 +0300 reenable s3 on staging pagservers by default
a0781f229 Wed Apr 13 22:47:13 2022 -0700 Add ps compact command
cdf04b6a9 Thu Apr 14 09:31:35 2022 +0300 Fix control file updates in safekeeper (#1452)
570db6f16 Thu Apr 14 11:30:01 2022 +0300 Update README for Zenith -> Neon renaming.
19954dfd8 Thu Apr 14 13:31:37 2022 +0300 Refactor proxy options test to not rely on the 'schema' argument.
a009fe912 Thu Apr 14 13:31:40 2022 +0300 Refactor connection option handling in python tests
4a8c66345 Thu Apr 14 13:31:42 2022 +0300 Refactor pgbench tests.
9e4de6bed Thu Apr 14 13:34:01 2022 +0300 Use RwLock instad of Mutex for layer map lock.
d5ae9db99 Thu Apr 14 10:09:03 2022 -0400 Add s3 cost estimate to tests (#1478)
93e0ac2b7 Thu Apr 14 17:38:26 2022 +0300 Remove a couple of unused dependencies.
2cb39a162 Thu Apr 14 20:41:21 2022 +0300 add missing files, update workspace hack
e97f94cc3 Thu Apr 14 23:01:06 2022 +0300 Bump rustc version
c9d897f9b Fri Apr 15 12:06:25 2022 +0300 [proxy] Update rustls (#1510)
ab20f2c49 Fri Apr 15 18:36:11 2022 +0300 Use the same version of `rust-postgres` everywhere. (#1516)
9946cd112 Fri Apr 15 20:44:56 2022 +0400 Bump vendor/postgres to add safekeeper connection timeout.
712697995 Fri Apr 15 20:08:22 2022 +0300 Remove custom neon Docker build image
3ab090b43 Fri Apr 15 23:12:35 2022 +0300 Fix compute tools build
4bc338bab Sat Apr 16 10:03:26 2022 +0300 Revert libc upgrade
ed5f9acca Sat Apr 16 13:38:48 2022 +0300 Revert "Revert libc upgrade" (#1527)
787f0d33f Sat Apr 16 23:36:42 2022 +0300 Use another cachepot bucket for rust Docker build caches
3136a0754 Sun Apr 17 00:50:28 2022 +0300 Use mold in Docker images
9b7dcc2ba Sun Apr 17 16:35:40 2022 +0300 Use proper cachepot bucket
0ca2bd929 Mon Apr 18 00:00:36 2022 +0300 Remove log crate from pageserver
5b2977453 Mon Apr 18 13:11:34 2022 +0400 Small refactoring after ec3bc741653d.
81879f813 Mon Apr 18 12:32:04 2022 +0300 Restore missing cachepot env vars
81417788c Mon Apr 18 12:52:31 2022 +0300 walkeeper -> safekeeper
52e0816fa Mon Apr 18 12:52:31 2022 +0300 wal_acceptor -> safekeeper
c15aa0471 Mon Apr 18 18:11:31 2022 +0300 Move Cluster size limit RFC from rfcs repo
389bd1fae Mon Apr 18 22:19:01 2022 +0300 Support for SCRAM-SHA-256 in compute tools
a1e34772e Tue Apr 19 00:20:08 2022 +0300 Improve compute error logging
ef72eb84c Tue Apr 19 09:46:47 2022 -0400 Remove zenfixture (#1534)
44bfc529f Tue Apr 19 23:13:52 2022 +0300 Require specifying the upload size in remote storage
3e6087a12 Tue Apr 19 23:13:52 2022 +0300 Remove S3 archiving
91fb21225 Wed Apr 20 02:57:03 2022 +0300 Show more logs during S3 sync
170badd62 Wed Apr 20 11:18:40 2022 +0300 Capture the postgres log in all tests that start a vanilla Postgres.
5e95338ee Wed Apr 20 11:18:40 2022 +0300 Improve logging in test_wal_restore.py
ac52f4f2d Wed Apr 20 13:24:38 2022 +0300 Set superuser when initializing database for wal recovery (#1544)
e660e12f7 Wed Apr 20 14:07:55 2022 +0300 Update rustls-split and rustls versions.
9eaa21317 Wed Apr 20 14:27:49 2022 +0300 Update jsonwebtoken crate.
86bf4301b Wed Apr 20 14:36:54 2022 +0300 Remove unnecessary dependency on 'webpki'
cbdfd8c71 Wed Apr 20 14:42:05 2022 +0300 Update 'routerify' dependency in proxy.
e113c6fa8 Wed Apr 20 16:23:16 2022 +0300 Print a warning if unlinking an ephemeral file fails.
e41ad3be0 Wed Apr 20 17:07:07 2022 +0300 add more context to writeback error
334a1d6b5 Wed Apr 20 21:25:59 2022 +0300 Fix materialized page caching with delta layers.
9d3779c12 Wed Apr 20 21:26:03 2022 +0300 Add a counter for materialized page cache hits.
629688fd6 Thu Apr 21 13:30:33 2022 +0300 Drop redundant resolver setting for 2021 edition
81cad6277 Thu Apr 21 13:30:33 2022 +0300 Move and library crates into a dedicated directory and rename them
abcd7a4b1 Thu Apr 21 16:00:15 2022 +0400 Insert less data in test_wal_restore.
263d60f12 Thu Apr 21 16:37:32 2022 +0300 Add prometheus metric for time spent waiting for WAL to arrive
dafdf9b95 Thu Apr 21 16:37:36 2022 +0300 Handle EINTR
a4700c9bb Thu Apr 21 20:32:48 2022 +0300 Use pprof to get flamegraph of get_page and get_relsize requests.
5f83c9290 Fri Apr 22 11:24:29 2022 +0300 Make it possible to specify per-tenant configuration parameters Add tenant config API and 'zenith tenant config' CLI command. Add 'show' query to pageserver protocol for tenantspecific config parameters
d3f356e7a Fri Apr 22 17:31:58 2022 +0300 Update `rust-postgres` project-wide (#1525)
867aede71 Fri Apr 22 10:45:47 2022 -0400 Add idle compute restart time test (#1514)
1fb3d0818 Fri Apr 22 21:31:27 2022 +0300 Use a 1-byte length header for short blobs.
56f6269a8 Mon Apr 25 11:34:51 2022 +0300 rename docker images to neondatabase docker account (#1570)
8f6a16127 Mon Apr 25 14:54:39 2022 +0300 Show better layer load errors
78a6cb247 Mon Apr 25 15:35:44 2022 +0300 allow the users to create extensions: GRANT CREATE ON DATABASE
d060a97c5 Mon Apr 25 16:23:34 2022 +0300 Simplify clippy runs
fec050ce9 Mon Apr 25 16:23:34 2022 +0300 Fix macos clippy issues
eabf6f89e Tue Apr 26 10:15:19 2022 +0300 Use item.get for tenant config toml parsing
778744d35 Tue Apr 26 13:49:37 2022 +0300 Limit concurrent S3 and IAM interactions
3fd234da0 Tue Apr 26 18:13:50 2022 +0400 Enable etcd for safekeepers in deploy.
8b9d523f3 Tue Apr 26 23:02:23 2022 +0400 Remove old WAL on safekeepers.
b2e35fffa Wed Apr 27 00:05:13 2022 -0700 Fix ancestor layer traversal (#1484)
6391862d8 Wed Apr 27 00:05:13 2022 -0700 Add branch traversal test
aeb4f81c3 Wed Apr 27 00:05:13 2022 -0700 Add branch traversal unit test
091cefaa9 Wed Apr 27 00:05:13 2022 -0700 Fix add compaction for key partitioning
66694e736 Wed Apr 27 00:05:13 2022 -0700 Fix add ps tenant config
695b5f9d8 Wed Apr 27 14:34:33 2022 +0300 Remove obsolete failpoint in proxy
29539b056 Wed Apr 27 19:09:28 2022 +0300 Set wal_keep_size to zero (#1507)
5c5c3c64f Thu Apr 28 11:49:19 2022 +0300 Fix tenant config parsing. Add a test
4a46b01ca Fri Apr 29 09:19:18 2022 +0300 Properly populate local timeline map
6cca57f95 Fri Apr 29 09:19:18 2022 +0300 Properly remove from the local timeline map
2911eb084 Fri Apr 29 09:19:18 2022 +0300 Remove timeline files on detach
76388abeb Fri Apr 29 14:23:42 2022 +0300 Rename READMEs with .md extension, and fix links to them.
05f8e6a05 Fri Apr 29 15:53:56 2022 +0300 Use fsync+rename for atomic downloads from remote storage
67b4e3809 Fri Apr 29 15:53:56 2022 +0300 remporarily disable test_backpressure_received_lsn_lag
aa933d396 Fri Apr 29 20:05:14 2022 +0300 proxy settings update for new domain (#1597)
7e1db8c8a Fri Apr 29 21:40:57 2022 +0300 Show which virtual file got the deserialization errors
038ea4c12 Sat Apr 30 22:04:08 2022 +0300 proxy notice message update (#1600)
f3f12db2c Sun May 1 13:13:17 2022 -0700 Add gc churn threshold knob (#1594)
3128e8c75 Sun May 1 13:13:25 2022 -0700 Fix tenant conf test
992874c91 Sun May 1 13:52:08 2022 -0700 Fix update ps settings doc
2477d2f9e Mon May 2 17:55:13 2022 +0300 Deploy standalone SRAM proxy on staging
8f479a712 Mon May 2 17:55:13 2022 +0300 minor fixes in proxy deployment
68ba6a58a Mon May 2 17:55:13 2022 +0300 authEndpoint fix
4b1bd32e4 Mon May 2 18:32:18 2022 +0300 Drop `Debug` impl for `ScramKey` and `ServerSecret`
9df8915b0 Mon May 2 18:32:18 2022 +0300 [proxy] `sasl::Mechanism` may return `Output` during exchange
af0195b60 Mon May 2 18:32:18 2022 +0300 [proxy] Introduce `cloud::Api` for communication with Neon Cloud
0323bb587 Mon May 2 18:32:18 2022 +0300 [proxy] Refactor cplane API and add new console SCRAM auth API
9a396e1fe Mon May 2 18:32:18 2022 +0300 Support SNI-based routing in proxy
ad25736f3 Mon May 2 19:04:45 2022 +0300 Exit pageserver process with correct error code
5cb501c2b Mon May 2 20:04:48 2022 +0300 Make remote storage test less flacky
801b749e1 Mon May 2 21:46:32 2022 +0300 Set correct authEndpoint for the new proxy
87a6c4d05 Mon May 2 23:39:06 2022 +0300 RFC on connection routing and authentication.
baa59512b Tue May 3 08:07:14 2022 +0300 Traverse frozen layer in get_reconstruct_data in reverse order (#1601)
62449d606 Tue May 3 09:25:12 2022 +0300 Bump vendor/postgres (#1573)
9ede38b6c Tue May 3 09:28:57 2022 +0300 Support finding LSN from a commit timestamp.
ff7e9a86c Tue May 3 12:44:42 2022 +0300 turn panic into an error with more details
e7cba0b60 Tue May 3 15:34:23 2022 +0300 use thiserror instead of anyhow in disk_btree
2f9b17b9e Tue May 3 17:13:09 2022 +0300 Add simple test of pageserver recovery after crash. To cause a crash, use failpoints in checkpointer
2f83f793b Tue May 3 18:31:23 2022 +0300 print more details when thread fails
5642d0b2b Wed May 4 00:42:57 2022 +0300 Change shutdown_process_on_error thread spawn settings.
9dfa145c7 Wed May 4 00:47:52 2022 +0300 tone down tenant not found error
51a0f2683 Wed May 4 01:35:30 2022 +0300 fix scram-proxy addresses
748c5a577 Wed May 4 10:54:44 2022 +0300 Bump vendor/postgres. (#1616)
b9fd8a36a Wed May 4 14:32:03 2022 +0400 Remember timeline_start_lsn and local_start_lsn on safekeeper.
e58c83870 Wed May 4 14:32:03 2022 +0400 Bump vendor/postgres to to send timeline_start_lsn.
b68e3b03e Wed May 4 17:11:22 2022 +0400 Fix control file update for b9fd8a36ad3b
e2cf77441 Wed May 4 18:14:45 2022 +0300 Implement pg_database_size(). In this implementation dbsize equals sum of all relation sizes, excluding shared ones.
b8880bfaa Wed May 4 18:14:45 2022 +0300 Bump vendor/postgres
c4bc604e5 Wed May 4 12:12:26 2022 -0400 Fix pg list table alignment #1633
02e508369 Wed May 4 12:45:01 2022 -0400 Add hot page test (#1479)
bc569dde5 Wed May 4 17:41:05 2022 -0400 Remove some unwraps from waldecoder (#1539)
c46fe9001 Thu May 5 10:41:43 2022 +0400 Fix division by zero in WAL removal.
0f3ec8317 Thu May 5 12:54:42 2022 +0300 avoid detach with alive branches
ad5eaa602 Thu May 5 10:53:10 2022 -0400 Use node's LSN for read-only nodes (#1642)
52a7e3155 Thu May 5 18:26:39 2022 +0300 Add local path to the Layer trait and historic layers
2ef0e5c6e Thu May 5 18:26:39 2022 +0300 Do not require metadata in every upload sync task
4024bfe73 Thu May 5 22:21:07 2022 +0300 get_binaries script fix (#1638)
954859f6c Thu May 5 22:35:15 2022 +0300 add readme for performance tests with the current state of things
1ad5658d9 Thu May 5 22:35:15 2022 +0300 Fix typos
30a759817 Thu May 5 22:35:15 2022 +0300 Some copy-editing.
11a44eda0 Thu May 5 23:48:16 2022 +0300 Add TLS support in scram-proxy (#1643)
ef40e404c Thu May 5 19:06:53 2022 -0400 Rename zenith crate to neon_local (#1625)
dd6dca907 Fri May 6 20:07:26 2022 +0400 Bump vendor/postgres to shut down on wrong basebackup.
d4e155aaa Fri May 6 22:32:57 2022 +0300 Librarify common etcd timeline logic
de37f982d Sat May 7 00:30:36 2022 +0300 Share the remote storage as a crate
10e4da399 Sat May 7 01:33:33 2022 +0300 Rework timeline batching
64a602b8f Sat May 7 01:33:33 2022 +0300 Delete timeline layers
0a7735a65 Sat May 7 01:33:33 2022 +0300 Rework remote storage sync queue, general refactoring
cf59b5151 Mon May 9 11:11:46 2022 -0400 Update README (Running local installation section) (#1649)
87dfa9973 Tue May 10 09:55:14 2022 -0400 Update layered_repository REAMDE (#1659)
6cb14b420 Tue May 10 22:41:02 2022 +0400 Optionally remove WAL on safekeepers without s3 offloading.
d710dff97 Tue May 10 23:47:40 2022 +0300 Remove unnecessary Serialize/Deserialize traits from VecMap.
e6e883eb1 Wed May 11 15:23:17 2022 +0300 Do not set LSN for new FPI page (#1657)
5bd879f64 Wed May 11 15:50:36 2022 +0300 Proxy: update protocol after cluster->project rename
b338b5dff Wed May 11 22:16:13 2022 +0400 Make callmemaybe less agressive until we fix it/migrate to bigger machines.
20361395b Wed May 11 21:36:53 2022 +0300 Add zenith-us-stage-sk-5 to circleci inventory (#1665)
c86409103 Wed May 11 16:13:26 2022 -0700 Fix err msg typo
2bde77fce Thu May 12 07:56:02 2022 +0300 Do not apply records with LSN smaller than LSN of cached image in del… (#1672)
5da4f3a4d Thu May 12 10:31:04 2022 +0300 Refactor DeltaLayer::dump() function
b426775aa Thu May 12 12:26:24 2022 +0300 Use compute-tools from the new neondatabase Docker Hub repo
b10ae195b Thu May 12 15:05:49 2022 +0300 Set vendor/postgres back to the main branch
4538f1e1b Thu May 12 18:47:31 2022 +0300 Correctly operate etcd safekeeper timeline data
ec8861b8c Thu May 12 19:53:07 2022 +0300 Fix pageserver metrics names (#1682)
5812e26b9 Thu May 12 16:33:09 2022 -0400 Create an initial timeline on CLI tenant creation (#1689)
ae2075172 Thu May 12 17:27:08 2022 -0400 update `ZenithCli::create_tenant` return signature (#1692)
85884a159 Fri May 13 01:26:38 2022 +0300 Disable tenant relocation python test
0030da57a Fri May 13 11:27:00 2022 +0300 compute-tools: grant rw priveleges to the all created users
51c0f9ab2 Fri May 13 16:34:32 2022 +0300 Force git version to be up to date via decl macro
b68330879 Fri May 13 16:34:32 2022 +0300 Return GIT_VERSION back to storage binaries
22d997049 Fri May 13 15:43:52 2022 +0200 libs/utils/http/request: add ensure_no_body
07b85e7cf Fri May 13 15:43:52 2022 +0200 Safekeeper refactor: move callmemaybe_tx from SafekeeperPostgresBackend to Timeline
bf899a57d Fri May 13 15:43:52 2022 +0200 Safekeeper: add timeline/tenant force delete HTTP endpoings (closes #895)
aa7c601ec Fri May 13 18:32:14 2022 +0300 Fix pitr_interval check in GC: Use timestamp->LSN mapping instead of file modification time. Fix 'latest_gc_cutoff_lsn' - set it to the minimum of pitr_cutoff and gc_cutoff. Add new test: test_pitr_gc
a2561f0a7 Fri May 13 18:32:14 2022 +0300 Use tenant's pitr_interval instead of hardroded 0 in the  command. Adjust python tests that use the
768c846ee Fri May 13 17:36:18 2022 +0200 Fix test_delete_force from #1653 conflicting with #1692
cded72a58 Fri May 13 20:41:54 2022 +0300 remove sk-2 from staging inventory list (#1699)
081d5dac5 Fri May 13 21:41:00 2022 +0300 Bump vendor/postgres.
a10cac980 Sun May 15 00:25:38 2022 +0300 Continue with pageserver startup, if loading some tenants fail.
51ea9c305 Mon May 16 09:58:58 2022 +0300 Don't swallow panics when the pageserver is build with failpoints.
33cac863d Mon May 16 12:07:35 2022 +0300 Test simple.conf and handle broker_endpoints better
c700032dd Mon May 16 14:40:49 2022 +0300 Run the regression tests in CI also for PRs opened from forked repos.
c41549f63 Mon May 16 10:42:08 2022 -0400 Update readme build for osx (#1709)
e4a70faa0 Mon May 16 11:05:43 2022 -0400 Add more information to timeline-related APIs (#1673)
85b5c0e98 Mon May 16 21:10:57 2022 +0300 List profiling as a feature with 'pageserver --enabled-features'
bea84150b Tue May 17 00:16:42 2022 +0300 Fix the markdown rendering on 004-durability.md RFC
9a0fed088 Tue May 17 01:17:44 2022 +0300 Enable at least 1 safekeeper in every test
a884f4cf6 Tue May 17 01:17:44 2022 +0300 Add etcd to neon_local
f2881bbd8 Tue May 17 01:17:44 2022 +0300 Start and stop single etcd and mock s3 servers globally in python tests
9ccbb8d33 Tue May 17 10:31:13 2022 +0300 Make "neon_local stop" less verbose.
070c25552 Tue May 17 18:03:01 2022 +0300 Neon stress deploy (#1720)
f03779bf1 Tue May 17 18:14:10 2022 +0300 Fix wait_for_last_record_lsn() and wait_for_upload() python functions.
55ea3f262 Tue May 17 18:14:57 2022 +0300 Fix race condition leading to panic in remote storage sync thread.
134eeeb09 Tue May 17 19:29:01 2022 +0300 Add more common storage metrics (#1722)
b9f84f4a8 Tue May 17 23:04:04 2022 +0300 trun on storage deployment to neon-stress enviroment (#1729)
772c2fb4f Wed May 18 13:03:29 2022 +0400 Report startup metrics and failure reason from compute_ctl (#1581)
98da0aa15 Wed May 18 15:17:04 2022 +0300 Add _total suffix to metrics name (#1741)
432907ff5 Wed May 18 23:02:17 2022 +0300 Safekeeper: avoid holding mutex when deleting a tenant (#1746)
4a36d8924 Thu May 19 00:51:48 2022 +0300 Avoid spawning a layer-flush thread when there's no work to do.
5914aab78 Thu May 19 00:54:14 2022 +0300 add comments, use expect instead of unwrap
bd2979d02 Thu May 19 00:09:13 2022 +0200 CirleCI/check-codestyle-python: print versions
7dd27ecd2 Thu May 19 00:09:13 2022 +0200 Bump minimal supported Python version to 3.9
fab104d5f Thu May 19 00:09:13 2022 +0200 docs/sourcetree: add note about exact Python version used and how to choose it
c1b365fdf Thu May 19 10:11:12 2022 +0300 Use temp filename while writing ImageLayer file
3da4b3165 Thu May 19 10:11:12 2022 +0300 Fsync layer files before rename
4c30ae8ba Thu May 19 10:11:12 2022 +0300 Add random string as a part of tempfile name
cbd00d7ed Thu May 19 10:11:12 2022 +0300 Remove temp layer files during timeline initialization on pageserver start
0da404670 Thu May 19 10:19:38 2022 +0300 Include traversal path in error message.
ee3bcf108 Thu May 19 10:19:38 2022 +0300 Fix compact_level0 for delta layers with overlap or gaps
baf7a81dc Thu May 19 14:01:03 2022 +0300 git-upload: pass committer to 'git rebase' (fix #1749) (#1750)
ffbb9dd15 Thu May 19 14:04:14 2022 +0300 Add a 5 minute timeout to python tests.
a4aef5d8d Thu May 19 12:25:31 2022 -0400 Compile psql with openssl (#1725)
65cf1a322 Fri May 20 12:02:51 2022 -0400 Added paths to openssl includes and libraries for OSX because make complained that it couldn't find them. (#1761)
d97617ed3 Fri May 20 23:12:30 2022 +0300 updated proxy and proxy scram deployment for prod and stress environments (#1758)
3c6890bf1 Sat May 21 05:25:17 2022 +0200 postgres_ffi: add complex WAL tests for find_end_of_wal
12b7c793b Sat May 21 05:25:17 2022 +0200 postgres_ffi: find_end_of_wal_segment: remove redundant CRC operations
c9efdec8d Sat May 21 05:25:17 2022 +0200 postgres_ffi: find_end_of_wal_segment: improve name of wal_crc variable
c4b77084a Sat May 21 05:25:17 2022 +0200 utils: add const_assert! macro
a124e4486 Sat May 21 05:25:17 2022 +0200 postgres_ffi: find_end_of_wal_segment: add lots of trace
967eb38e8 Sat May 21 05:25:17 2022 +0200 postgres_ffi: find_end_of_wal_segment: fix contrecord skipping
73187bfef Sat May 21 05:25:17 2022 +0200 postgres_ffi: find_end_of_wal_segment: clarify code around xl_crc retrieval
ef7cdb13e Sat May 21 12:21:45 2022 +0200 Remove unused dependencies from poetry.lock via `poetry lock --no-update`
89e5659f3 Mon May 23 01:03:03 2022 +0200 Replace COPYRIGHT file from the root with NOTICE file
fbedd535c Mon May 23 13:16:00 2022 +0300 Replace a bunch of zenith references with neon.
3ff5caf78 Mon May 23 13:11:59 2022 -0400 Add to readme install protobuf etcd (#1777)
2aceb6a30 Mon May 23 20:58:27 2022 +0300 Fix garbage collection to not remove image layers that are still needed.
8346aa3a2 Tue May 24 04:55:38 2022 -0400 Potential fix to #1626. Fixed typo is Makefile. (#1781)
541ec2587 Tue May 24 19:09:31 2022 +0300 Properly shutdown test mock S3 server
d32b491a5 Wed May 25 10:31:10 2022 +0300 Add zenith-us-stage-sk-6 to deploy (#1728)
2b265fd6d Wed May 25 14:48:11 2022 +0400 Disable restart_after_crash in neon_local.
703f691df Wed May 25 14:30:50 2022 +0300 production inventory update (#1779)
6f1f33ef4 Wed May 25 14:33:06 2022 +0300 Improve error messages on seccomp loading errors.
9ab52e218 Wed May 25 15:41:18 2022 +0300 helm repository name fix for production proxy deploy (#1790)
24d2313d0 Wed May 25 16:57:45 2022 +0300 Set --quota-backend-bytes when launching etcd in tests.
7997fc293 Wed May 25 18:14:44 2022 +0300 Fix error handling with 'basebackup' command.
c584d90bb Wed May 25 20:11:26 2022 +0300 initial commit, renamed znodeid to nodeid.
887b0e14d Thu May 26 01:03:48 2022 +0300 Run basic checks on PRs and pushes to main only
06f5e017a Thu May 26 01:03:48 2022 +0300 Move rustfmt check to GH Action
5a5737278 Thu May 26 01:24:52 2022 +0300 add simple metrics for remote storage operations
38f2d165b Thu May 26 13:21:29 2022 +0300 allow TLS 1.2 in proxy to be compatible with older client libraries
b0d114ee3 Thu May 26 15:42:18 2022 +0300 Initialize last_freeze_at with disk consistent LSN to avoid creation of small L0  delta layer on startup
72a7220dc Thu May 26 18:37:40 2022 +0300 Tidy up some log messages
7d565aa4b Thu May 26 12:21:15 2022 -0400 Reduce the logging level when PG client disconnected to `INFO` (#1713)
1d71949c5 Thu May 26 14:59:03 2022 -0400 Change proxy welcome message (#1808)
0e1bd57c5 Fri May 27 06:19:23 2022 +0400 Add WAL offloading to s3 on safekeepers.
54b75248f Fri May 27 14:02:52 2022 +0400 s3 WAL offloading staging review.
75f71a638 Fri May 27 11:43:06 2022 -0400 Handle broken timelines on startup (#1809)
cb8bf1beb Fri May 27 20:23:30 2022 +0400 Prevent commit_lsn <= flush_lsn violation after a42eba3cd7.
757746b57 Fri May 27 13:33:53 2022 -0400 Fix `test_pageserver_http_get_wal_receiver_success` flaky test. (#1786)
5d813f973 Fri May 27 21:50:43 2022 +0300 [proxy] Refactoring
b3ec6e066 Fri May 27 21:50:43 2022 +0300 [proxy] Propagate SASL/SCRAM auth errors to the user
500e8772f Fri May 27 17:48:11 2022 -0400 Add quick-start guide in readme (#1816)
f1c51a126 Sat May 28 14:02:05 2022 +0300 Fix typos
4b4d3073b Sat May 28 14:56:23 2022 +0300 Fix misc typos
e3b320daa Sat May 28 21:22:19 2022 +0300 Remove obsolete Dockerfile.alpine
3accde613 Mon May 30 11:11:01 2022 +0300 Rename contrib/zenith to contrib/neon. Rename custom GUCs: - zenith.page_server_connstring -> neon.pageserver_connstring - zenith.zenith_tenant -> neon.tenantid - zenith.zenith_timeline -> neon.timelineid - zenith.max_cluster_size -> neon.max_cluster_size
751f1191b Mon May 30 11:11:01 2022 +0300 Rename 'wal_acceptors' GUC to 'safekeepers'
6a867bce6 Mon May 30 11:11:01 2022 +0300 Rename 'zenith_admin' role to 'cloud_admin'
67d6ff410 Mon May 30 11:11:01 2022 +0300 Rename custom GUCs: - zenith.zenith_tenant -> neon.tenant_id - zenith.zenith_timeline -> neon.timeline_id
915e5c911 Mon May 30 11:11:01 2022 +0300 Rename 'zenith_admin' to 'cloud_admin' on compute node start
e014cb602 Mon May 30 12:24:44 2022 +0300 rename zenith.zenith_tenant to neon.tenant_id in test
36281e3b4 Mon May 30 13:57:17 2022 +0400 Extend test_wal_backup with compute restart.
c3e0b6c83 Tue May 31 11:10:50 2022 +0300 Implement timeline-based metrics in safekeeper (#1823)
595a6bc1e Tue May 31 14:47:06 2022 +0300 Bump vendor/postgres to fix basebackup LSN comparison. (#1835)
54e163ac0 Tue May 31 17:22:47 2022 +0300 Improve Readability in Docs
c97cd684e Tue May 31 11:20:51 2022 -0400 Use `HOMEBREW_PREFIX` instead of hard-coded path (#1833)
ca10cc12c Tue May 31 14:14:09 2022 -0400 Close file descriptors for redo process (#1834)
b1b67cc5a Tue May 31 22:42:11 2022 +0300 improve test normal work to start several computes
ff233cf4c Tue May 31 23:12:30 2022 +0300 Use :local compute-tools tag to build compute-node image
af6143ea1 Tue May 31 23:12:30 2022 +0300 Install missing openssl packages in the Github Actions workflow
e5a2b0372 Wed Jun 1 15:40:45 2022 +0300 remove sk1 from inventory (#1845)
6623c5b9d Wed Jun 1 15:59:53 2022 +0300 add installation instructions for Fedora Linux
e5cb72757 Wed Jun 1 16:07:04 2022 +0300 Replace callmemaybe with etcd subscriptions on safekeeper timeline info
1188c9a95 Wed Jun 1 19:29:17 2022 +0300 remove extra span as this code is already covered by create timeline span
de7eda2dc Thu Jun 2 00:48:10 2022 +0300 Fix url path printing
c71faae2c Thu Jun 2 15:05:12 2022 +0200 Docs readability cont
b155fe0e2 Thu Jun 2 17:41:34 2022 +0300 avoid perf test result context for pg regress
aba5e5f8b Thu Jun 2 17:45:53 2022 +0200 GitHub Actions: pin Rust version to 1.58 like on CircleCI
90e2c9ee1 Thu Jun 2 16:21:28 2022 -0400 Rename zenith to neon in python tests (#1871)
b0c4ec059 Fri Jun 3 00:23:13 2022 +0300 Log storage sync and etcd events a bit better
a91e0c299 Fri Jun 3 00:23:13 2022 +0300 Reproduce etcd parsing bug in Python tests
793380428 Fri Jun 3 00:23:13 2022 +0300 Fix and test regex parsing
1d16ee92d Fri Jun 3 00:23:13 2022 +0300 Fix the Lsn difference reconnection
5b0659977 Fri Jun 3 00:23:13 2022 +0300 Simplify etcd key regex parsing
c5007d391 Fri Jun 3 00:23:13 2022 +0300 Remove unused module
9c846a93e Fri Jun 3 14:24:27 2022 +0300 chore(doc)
9e108102b Fri Jun 3 16:12:14 2022 +0400 Silence etcd safekeeper info key parse errors.
70a53c4b0 Fri Jun 3 16:12:14 2022 +0400 Get backup test_safekeeper_normal_work, but skip by default.
262319387 Fri Jun 3 17:30:36 2022 +0300 Remove pageserver_connstr from WAL stream logic
5a723d44c Fri Jun 3 20:32:53 2022 +0400 Parametrize test_normal_work.
e442f5357 Fri Jun 3 19:36:09 2022 +0300 unify two identical failpoints in flush_frozen_layer
92de8423a Sun Jun 5 09:18:11 2022 -0400 Remove dead code (#1886)
fecad1ca3 Mon Jun 6 08:14:41 2022 -0400 Resolving issue #1745. Added cluster option for SNI data (#1813)
6cfebc096 Mon Jun 6 12:32:10 2022 -0400 Add read/write throughput performance tests (#1883)
7dc6beacb Tue Jun 7 12:59:35 2022 +0300 make it possible to associate thread with a tenant after thread start
0b93253b3 Tue Jun 7 15:17:57 2022 +0400 Fix leaked keepalive task in s3 offloading leader election.
6e26588d1 Tue Jun 7 22:11:54 2022 +0300 Allow to customize shutdown condition in PostgresBackend
8a53472e4 Wed Jun 8 11:21:05 2022 +0300 Force etcd broker keys to not to intersect
32e64afd5 Wed Jun 8 11:25:37 2022 +0300 Use better parallel build instructions in readme.md (#1908)
a01999bc4 Wed Jun 8 13:36:49 2022 +0300 Replace most common remote logs with metrics (#1909)
e22d9cee3 Wed Jun 8 09:15:12 2022 -0400 fix `ZeroDivisionError` in `scripts/generate_perf_report_page` (#1906)
a51b2dac9 Thu Jun 9 18:30:16 2022 +0400 Don't s3 offload from newly joined safekeeper not having required WAL.
f7b878611 Thu Jun 9 17:14:46 2022 +0200 Implement JWT authentication in Safekeeper HTTP API (#1753)
1f1d85220 Thu Jun 9 17:14:46 2022 +0200 ZenithEnvBuilder: rename pageserver_auth_enabled --> auth_enabled
a001052cd Thu Jun 9 17:14:46 2022 +0200 test_runner: SafekeeperHttpClient: support auth
0ac0fba77 Thu Jun 9 17:14:46 2022 +0200 test_runner: test Safekeeper HTTP API Auth
e2a5a3159 Thu Jun 9 17:14:46 2022 +0200 Safekeeper HTTP router: add comment about /v1/timeline
a4d826139 Thu Jun 9 19:16:43 2022 +0400 Save Postgres log in test_find_end_of_wal_* tests.
e1336f451 Thu Jun 9 18:19:18 2022 +0200 renamed .zenith data-dir to .neon.
d8a37452c Sat Jun 11 00:44:05 2022 +0300 Rename ZenithFeedback (#1912)
d11c9f9fc Wed Jun 15 20:21:58 2022 +0300 Use random ports for the proxy and local pg in tests Fixes #1931 Author: Dmitry Ivanov
36ee182d2 Thu Jun 16 14:07:11 2022 +0300 Implement page servise 'fullbackup' endpoint  (#1923)
699f46cd8 Fri Jun 17 15:33:39 2022 +0300 Download WAL from S3 if it's not available in safekeeper dir (#1932)
f862373ac Fri Jun 17 20:43:54 2022 +0300 Fix WAL timeout in test_s3_wal_replay (#1953)
83c7e6ce5 Mon Jun 20 15:28:43 2022 +0300 Bump vendor/postgres.
ec0064c44 Mon Jun 20 10:05:10 2022 -0400 Small README.md changes (#1957)
37465dafe Mon Jun 20 11:40:55 2022 -0400 Add wal backpressure tests (#1919)
6c4d6a218 Tue Jun 21 02:02:24 2022 +0300 Remove timeline_start_lsn check temporary. (#1964)
1ca28e6f3 Tue Jun 21 11:04:10 2022 -0400 Import basebackup into pageserver (#1925)
6222a0012 Wed Jun 22 11:40:59 2022 +0300 Migrate from CircleCI to Github Actions: python codestyle, build and tests (#1647)
d059e588a Wed Jun 22 09:34:24 2022 -0400 Added invariant check for project name. (#1921)
7c49abe7d Thu Jun 23 09:11:27 2022 +0300 Rework etcd timeline updates and their handling
3c2b03cd8 Thu Jun 23 12:28:12 2022 +0300 Update timeline size on dropdb. Add the test (#1973)
6d7dc384a Thu Jun 23 14:52:32 2022 +0300 Add zenith-us-stage-ps-3 to deploy
93e050afe Thu Jun 23 15:38:05 2022 +0300 Don't require project name for link auth
84b9fcbbd Thu Jun 23 11:51:56 2022 -0400 Increase a few test timeouts (#1977)
3cc531d09 Thu Jun 23 21:36:53 2022 +0200 Fix CREATE EXTENSION for non-db-owner users (#1408)
392cd8b1f Fri Jun 24 05:57:33 2022 -0400 Refactored extracting project_name in console.rs. (#1982)
55192384c Fri Jun 24 13:59:37 2022 +0300 Fix zero timeline_start_lsn (#1981)
26bca6ddb Sun Jun 26 21:54:07 2022 +0300 Add `openssl` to OSX dependencies (#1994)
eb8926083 Mon Jun 27 13:12:58 2022 +0300 Use the updated base build Docker image (#1972)
137291dc2 Mon Jun 27 16:30:21 2022 +0300 Push to etcd from safekeeper many timelines concurrently.
8a714f1eb Mon Jun 27 19:15:56 2022 +0300 Add coverage to GH actions and rework part of them (#1987)
dd61f3558 Mon Jun 27 20:41:09 2022 +0300 Fix coverage upload credentials retrieval (#2001)
4a05413a4 Mon Jun 27 22:40:20 2022 +0300 More code coverage fixes in GH Actions (#2002)
cef90d922 Wed Jun 29 17:56:02 2022 +0300 Disable cachepot for GH Actions builds (#2007)
5ee19b075 Wed Jun 29 17:59:19 2022 +0300 Fix bloated coverage uploads (#2005)
1d0706cf2 Thu Jun 30 00:40:12 2022 +0300 Fix walreceiver connection selection mechanism
00fc69660 Thu Jun 30 14:32:15 2022 +0300 replace extra urlencode dependency with already present url library
f09c09438 Fri Jul 1 11:10:49 2022 +0300 Fix gc after import
cadaca010 Fri Jul 1 16:58:34 2022 +0300 Make ansible to work with storage nodes through teleport from local box.
97fed3821 Fri Jul 1 19:20:59 2022 +0400 Fix cadaca010c for older ssh clients.
6100a02d0 Fri Jul 1 19:21:28 2022 +0400 Prefix WAL files in s3 with environment name.
65704708f Fri Jul 1 18:56:51 2022 +0300 remove unused imports, make more use of pathlib.Path
7898e7299 Mon Jul 4 22:35:00 2022 +0300 Remove duplicated checks from LocalEnv
6abdb1272 Mon Jul 4 23:46:37 2022 +0300 Fix 1.62 Clippy errors
d29c545b5 Tue Jul 5 02:06:40 2022 -0400 Gc/compaction thread pool, take 2 (#1933)
844832ffe Tue Jul 5 10:55:03 2022 +0300 Bump vendor/postgres
05f6a1394 Tue Jul 5 12:22:58 2022 +0100 Add tests for different Postgres client libraries (#2008)
bb69e0920 Tue Jul 5 14:45:31 2022 +0300 Do not overwrite an existing image layer.
32560e75d Tue Jul 5 08:27:57 2022 -0400 Enable relocation test (#1974)
cfdf79ace Tue Jul 5 16:44:18 2022 +0300 harden create_empty_timeline
68adfe0fc Tue Jul 5 21:29:03 2022 +0400 inventory file fix for neon-stress env
50821c0a3 Tue Jul 5 21:45:15 2022 +0300 Return download stream directly from the remote storage API
07df7c2ed Wed Jul 6 13:15:15 2022 +0100 github/actions: fix storing perf data for main (#2038)
8fabdc670 Wed Jul 6 18:07:29 2022 +0400 Add tests with concurrent computes.
242af7565 Wed Jul 6 13:45:02 2022 -0400 Fix signal file parsing (#2042)
4a96259bd Wed Jul 6 13:45:26 2022 -0400 Add export/import test (#2036)
1faf49da0 Wed Jul 6 19:24:06 2022 +0100 github/actions: set PERF_TEST_RESULT_CONNSTR from secrets (#2040)
0e3456351 Wed Jul 6 22:36:38 2022 +0300 Shrink thread pools used for WAL receivers and background tasks.
cb5df3c62 Thu Jul 7 10:47:03 2022 +0100 github/actions: set missing VIP_VAP_ACCESS_TOKEN (#2045)
747d009bb Thu Jul 7 11:56:58 2022 +0200 Fix panic while waiting for Postgres readiness in the compute_ctl (#2021)
e6ea04916 Thu Jul 7 16:05:13 2022 +0300 If an error happens during import of base backup or WAL, log it.
ae116ff0a Thu Jul 7 18:09:57 2022 +0300 update timeout for proxy deploy (#2047)
4c54e4b37 Thu Jul 7 21:20:04 2022 +0300 switch to per-tenant attach/detach
e1e24336b Thu Jul 7 21:20:04 2022 +0300 review adjustments, bring back timeline_detach and rename it to timeline_delete
d9d4ef12c Thu Jul 7 21:20:04 2022 +0300 review cleanup
168214e0b Thu Jul 7 21:20:04 2022 +0300 use tenant status endpoint to check whether timelines were downloaded or not
9f2b40645 Thu Jul 7 21:20:04 2022 +0300 review cleanup, point timeline/detach to timeline/delete
520ffb341 Thu Jul 7 21:20:04 2022 +0300 fix pageserver openapi spec
1a5af6d7a Thu Jul 7 21:20:04 2022 +0300 extend detach/delete tests
ec0faf3ac Thu Jul 7 21:20:04 2022 +0300 retry timeline delete
00c26ff3a Thu Jul 7 19:53:23 2022 +0100 Bring periodic perf tests on GitHub back (#2037)
c08fa9d56 Fri Jul 8 13:56:37 2022 +0200 postgres_ffi/wal_generate: support generating WAL for an already running Postgres server
bcdee3d3b Fri Jul 8 13:56:37 2022 +0200 test_runner: add test_crafted_wal_end.py
52f445094 Fri Jul 8 14:51:44 2022 +0200 Update vendor/postgres to 14.4 (#2049)
85bda437d Fri Jul 8 15:37:26 2022 +0200 postgres_ffi/wal_generate: add last_wal_record_xlog_switch and use it in tests
80b7a3b51 Fri Jul 8 15:37:26 2022 +0200 Test what happens when XLOG_SWITCH ends on page boundary, fix #1991
1f5918b36 Fri Jul 8 10:29:29 2022 -0400 Delay calculating the starting LSN when doing timeline branching (#2053)
60e5dc10e Fri Jul 8 18:30:56 2022 +0200 postgres_ffi/wal_generate: use 'craft' instead of 'generate'
0b5b2e8e0 Fri Jul 8 18:30:56 2022 +0200 postgres_ffi/wal_craft: extract trait Crafter
f540f115a Fri Jul 8 18:30:56 2022 +0200 postgres_ffi/wal_craft: simplify API
39d86ed29 Sat Jul 9 00:42:45 2022 +0300 debug branch failure
21da9199f Mon Jul 11 17:03:58 2022 +0300 take Value by reference to avoid calling .clone
95452e605 Mon Jul 11 17:03:58 2022 +0300 Optimize importing a physical backup
5cf597044 Mon Jul 11 10:31:14 2022 -0400 Allow prev_lsn hint for fullbackup (#2052)
5cf94a584 Tue Jul 12 15:01:44 2022 -0400 Add test for cascade/flat branching (#1569)
7f048abf3 Tue Jul 12 15:04:40 2022 -0400 Add `close_fds` for `initdb` command and add close fd test (#2060)
7c041d993 Tue Jul 12 15:53:22 2022 -0400 Add a test for gc dropping active layers (#707) (#1484)
61cc56282 Wed Jul 13 09:18:11 2022 +0100 Make POSTGRES_INSTALL_DIR configurable for build (#2067)
2b21d7b5b Wed Jul 13 12:51:20 2022 +0300 Migrate from CircleCI to Github Actions: docker build and deploy (#1986)
07acd6ddd Wed Jul 13 14:12:11 2022 +0100 Fix clippy warnings in postgres_ffi/build.rs (#2081)
f8a64512d Wed Jul 13 15:38:22 2022 +0200 [compute_tools] Set public schema owner to db owner (#2058)
968c20ca5 Wed Jul 13 21:22:44 2022 +0300 Add zenith-1-ps-3 to prod inventory (#2084)
9a7427c20 Thu Jul 14 10:28:15 2022 +0300 Fill build-args for Docker builds via GH Actions context
12bac9c12 Thu Jul 14 11:27:16 2022 +0200 Wait for compute image before deploy in GitHub Action
1b6a80a38 Thu Jul 14 16:23:39 2022 +0300 Fix flaky test_concurrent_computes
c004a6d62 Thu Jul 14 17:20:00 2022 +0300 Do not cancel in-progress checks on the `main` branch
79f5685d0 Thu Jul 14 20:46:35 2022 +0300 Enable basic optimizations even in 'dev' builds.
a342957ae Thu Jul 14 22:13:51 2022 +0300 Use ok_or_else() instead of ok_or(), to silence clippy warnings.
0886aced8 Thu Jul 14 22:13:51 2022 +0300 Update dependencies.
c68336a24 Thu Jul 14 23:08:57 2022 +0300 Strip debug symbols from test binaries, to make the artifact smaller.
fe65d1df7 Fri Jul 15 12:30:09 2022 +0300 reduce concurrent tasks in `test_branching_with_pgbench.py`
a490f64a6 Fri Jul 15 12:33:13 2022 +0300 Don't include Postgres binaries in neon.tgz
eaa550afc Fri Jul 15 13:18:48 2022 +0300 Reduce size of cargo deps cache, by excluding ~/.cargo/registry/src.
c69052287 Fri Jul 15 12:25:07 2022 +0200 [compute_tools] Change owner of the schema public only once (#2058)
a68d5a017 Fri Jul 15 13:18:55 2022 +0200 Run workflow on release branch (#2085)
95c40334b Fri Jul 15 15:39:49 2022 +0100 github/workflows: post periodic benchmark failures to slack (#2105)
19ea486cd Fri Jul 15 19:06:50 2022 +0300 postgres_ffi/xlog_utils: refactor find_end_of_wal test
94003e1eb Fri Jul 15 19:06:50 2022 +0300 postgres_ffi: test restoring from intermediate LSNs by wal_craft
373bc59eb Sat Jul 16 16:05:12 2022 +0100 Bump pywin32 from 227 to 301 (#2102)
c4b2347e2 Sun Jul 17 12:49:18 2022 +0300 Use less restricrtive lock guard during storage sync
912a08317 Mon Jul 18 12:27:04 2022 +0300 do not ignore errors during downloading of tenant index parts
7987889cb Mon Jul 18 12:27:04 2022 +0300 keep successfully downloaded index parts
eeff56aeb Mon Jul 18 15:13:10 2022 +0300 Make get_dir_size robust to concurrent deletions.
a69fdb0e8 Mon Jul 18 15:15:51 2022 +0300 Fix commit_lsn monotonicity violation.
0b14fdb07 Mon Jul 18 17:39:12 2022 +0300 Reorganize, expand, improve internal documentation
f384e20d7 Tue Jul 19 07:50:55 2022 +0300 Minor cleanup in layer_repository.rs.
0b8049c28 Tue Jul 19 09:53:12 2022 +0300 Update core_changes.md, describing Postgres changes.
bf5333544 Tue Jul 19 10:57:24 2022 +0300 Fix missing quotes in GitHub Actions (#2116)
df7f64482 Tue Jul 19 16:36:59 2022 +0300 Move things around in github yml file, for clarity.
3dce39419 Tue Jul 19 16:36:59 2022 +0300 Use the same cargo options for every cargo call.
5ff7a7dd8 Tue Jul 19 16:33:33 2022 +0100 github/workflows: run periodic benchmarks earlier (#2121)
444679139 Tue Jul 19 17:40:58 2022 +0100 github/workflows: pause stress env deployment (#2122)
71753dd94 Tue Jul 19 21:31:22 2022 +0300 Remove github CI 'build_postgres' job, merging it with 'build_neon'
98dd2e4f5 Tue Jul 19 21:31:34 2022 +0300 Use zstd and multiple threads to compress artifact tarball.
160e52ec7 Tue Jul 19 14:56:25 2022 -0400 Optimize branch creation (#2101)
abff15dd7 Wed Jul 20 15:59:46 2022 +0300 Fix test to be more robust with slow pageserver.
b4c74c0ec Wed Jul 20 16:31:25 2022 +0300 Clean up unnecessary dependencies.
f4233fde3 Wed Jul 20 16:55:41 2022 +0300 Silence "Module already imported" warning in python tests
cc680dd81 Wed Jul 20 17:09:36 2022 +0300 Explicitly enable cachepot in Docker builds only
b445cf766 Wed Jul 20 22:13:05 2022 +0300 Refactor test_unavailability (#2134)
572ae7438 Thu Jul 21 07:45:11 2022 +0300 More precisely control size of inmem layer (#1927)
ed102f44d Thu Jul 21 12:08:26 2022 -0400 Reduce memory allocations for page server (#2010)
e308265e4 Fri Jul 22 11:43:38 2022 +0300 register tenants task thread pool threads in thread_mgr
9dcb9ca3d Fri Jul 22 11:00:05 2022 +0100 test/performance: ensure we don't have tables that we're creating (#2135)
39c59b8df Fri Jul 22 12:44:20 2022 +0100 Fix flaky test_branch_creation_before_gc test (#2142)
5f4ccae5c Mon Jul 25 17:23:10 2022 +0300 [proxy] Add the `password hack` authentication flow (#2095)
45680f9a2 Mon Jul 25 18:30:30 2022 +0300 Drop CircleCI runs (#2082)
28243d68e Tue Jul 26 09:11:10 2022 +0300 Yet another apporach of copying logical timeline size during branch creation (#2139)
172314155 Tue Jul 26 11:37:16 2022 +0300 Compact only once on psql checkpoint call
d301b8364 Tue Jul 26 11:47:04 2022 +0300 Move LayeredTimeline and related code to separate source file.
5a4394a8d Tue Jul 26 22:21:05 2022 +0300 Do not hold timelines lock while calling update_gc_info to avoid recusrive mutex lock and so deadlock (#2163)
d6f12cff8 Wed Jul 27 10:26:21 2022 +0300 Make DatadirTimeline a trait, implemented by LayeredTimeline.
fd46e52e0 Wed Jul 27 12:28:05 2022 +0300 Switch staging storage to dedicated etcd (#2164)
f6f29f58c Wed Jul 27 16:41:25 2022 +0300 Switch production storage to dedicated etcd (#2169)
6a664629f Wed Jul 27 12:36:46 2022 -0400 Add timeline physical size tracking (#2126)
01f1f1c1b Wed Jul 27 21:29:22 2022 +0300 Add OpenAPI spec for safekeeper HTTP API (neondatabase/cloud#1264, #2061)
58b04438f Wed Jul 27 22:16:40 2022 +0300 Tweak backoff numbers to avoid no wal connection threshold trigger
aeb3f0ea0 Thu Jul 28 14:38:37 2022 +0300 Refactor test_race_conditions (#2162)
09ddd34b2 Thu Jul 28 15:44:02 2022 +0300 Fix checkpoints race condition in safekeeper tests (#2175)
14a027cce Thu Jul 28 17:05:30 2022 +0100 Makefile: get openssl prefix dynamically (#2179)
6ace34717 Thu Jul 28 18:37:21 2022 +0100 github/workflows: unpause stress env deployment (#2180)
417d9e9db Thu Jul 28 13:59:20 2022 -0400 Add current physical size to tenant status endpoint (#2173)
d903dd61b Fri Jul 29 09:09:22 2022 +0300 Rename 'wal_producer_connstr' to 'wal_source_connstr'.
02afa2762 Fri Jul 29 15:02:15 2022 +0300 Move Tenant- and TimelineInfo structs to models.rs.
a0f76253f Fri Jul 29 16:30:39 2022 +0300 Bump Postgres version.
d865892a0 Fri Jul 29 16:41:55 2022 +0300 Print full error with stacktrace, if compute node startup fails.
9733b24f4 Fri Jul 29 19:03:57 2022 +0300 Fix README.md: Fixed several typos and changed a bit documentation for OSX
2af5a96f0 Fri Jul 29 19:04:40 2022 +0300 Back off when reenqueueing delete tasks
d0494c391 Fri Jul 29 20:51:37 2022 +0300 Remove wal_receiver mgmt API endpoint
539007c17 Mon Aug 1 12:54:39 2022 +0100 github/workflows: make bash more strict (#2197)
e73b95a09 Mon Aug 1 18:13:01 2022 +0300 docs: linked poetry related step in tests section
092a9b74d Mon Aug 1 18:28:49 2022 +0300 use only s3 in boto3-stubs and update mypy
0ebb6bc4b Mon Aug 1 18:28:49 2022 +0300 Temporary pin Werkzeug version because moto hangs with newer one. See https://github.com/spulec/moto/issues/5341
1edf3eb2c Mon Aug 1 18:28:49 2022 +0300 increase timeout so mac os job can finish the build with all cache misses
8ba41b8c1 Mon Aug 1 19:08:09 2022 +0100 Bump pywin32 from 227 to 301 (#2202)
177d5b1f2 Tue Aug 2 11:16:26 2022 +0300 Bump postgres to get uuid extension
71f39bac3 Tue Aug 2 13:57:26 2022 +0100 github/workflows: upload artifacts to S3 (#2071)
b4f2c5b51 Wed Aug 3 01:36:14 2022 +0300 run benchmarks conditionally, on main or if run_benchmarks label is set
5f71aa09d Thu Aug 4 11:14:05 2022 +0300 support running tests against real s3 implementation without mocking
bc2cb5382 Thu Aug 4 11:14:05 2022 +0300 run real s3 tests in CI
52ce1c9d5 Thu Aug 4 12:57:15 2022 +0300 Speed up test shutdown, by polling more frequently.
e54941b81 Thu Aug 4 16:32:19 2022 +0300 treat pytest warnings as errors
f7d8db7e3 Thu Aug 4 16:32:19 2022 +0300 silence https://github.com/neondatabase/neon/issues/2211
1bbc8090f Thu Aug 4 16:38:29 2022 +0300 [issue #1591] Add `neon_local pageserver status` handler
0a958b0ea Thu Aug 4 17:56:19 2022 +0300 Check find_end_of_wal errors instead of unwrap
4cb1074fe Fri Aug 5 13:44:57 2022 +0100 github/workflows: Fix git dubious ownership (#2223)
5133db44e Fri Aug 5 16:28:59 2022 +0300 Move relation size cache from WalIngest to DatadirTimeline (#2094)
84d1bc06a Fri Aug 5 19:34:04 2022 +0200 refactor: replace lazy-static with once-cell (#2195)
8c8431ebc Sat Aug 6 11:45:47 2022 +0200 Add more buckets to pageserver latency metrics (#2225)
0d14d4a1a Mon Aug 8 12:15:16 2022 +0300 ignore record property warning to fix benchmarks
4da4c7f76 Mon Aug 8 12:15:16 2022 +0300 increase statement timeout
9430abae0 Mon Aug 8 12:15:16 2022 +0300 use event so it fires only if workload thread successfully finished
beaa991f8 Mon Aug 8 12:15:16 2022 +0300 remove debug log
7cd68a0c2 Mon Aug 8 12:15:16 2022 +0300 increase timeout to pass test with real s3
cdfa9fe70 Mon Aug 8 12:15:16 2022 +0300 avoid duplicate parameter, increase timeout
743370de9 Mon Aug 8 17:52:28 2022 +0200 Major migration script (#2073)
3a9bff81d Mon Aug 8 19:04:46 2022 +0300 Fix etcd typos
32fd709b3 Tue Aug 9 10:19:18 2022 +0700 Fix links to safekeeper protocol docs. (#2188)
0290893bc Tue Aug 9 14:18:25 2022 +0300 Update CONTRIBUTING.md
227d47d2f Tue Aug 9 14:18:25 2022 +0300 Update CONTRIBUTING.md
1fc761983 Tue Aug 9 18:59:00 2022 +0300 support node id and remote storage params in docker_entrypoint.sh
4227cfc96 Tue Aug 9 22:45:33 2022 +0300 Safe truncate (#2218)
7a36d06cc Thu Aug 11 08:34:57 2022 +0300 Fix exponential backoff values
4b9e02be4 Thu Aug 11 19:25:08 2022 +0300 Update back `vendor/postgres` back; it was changed accidentally. (#2251)
e593cbaab Thu Aug 11 22:54:09 2022 +0300 Add pageserver checkpoint_timeout option.
995a2de21 Thu Aug 11 23:21:06 2022 +0300 Share exponential backoff code and fix logic for delete task failure (#2252)
dc52436a8 Fri Aug 12 09:24:20 2022 +0700 Fix bug when import large (>1GB) relations (#2172)
7da47d8a0 Fri Aug 12 14:28:50 2022 +0700 Fix timeline physical size flaky tests (#2244)
142e247e8 Fri Aug 12 11:40:46 2022 +0300 postgres_ffi/waldecoder: validate more header fields
07bb7a2af Fri Aug 12 11:40:46 2022 +0300 postgres_ffi/waldecoder: remove unused startlsn
a7bf60631 Fri Aug 12 11:40:46 2022 +0300 postgres_ffi/waldecoder: introduce explicit `enum State`
6d99b4f1d Fri Aug 12 19:13:42 2022 +0700 disable `test_import_from_pageserver_multisegment` (#2258)
7f9726927 Fri Aug 12 16:01:22 2022 +0300 get_binaries uses DOCKER_TAG taken from docker image build step (#2260)
ad08c273d Fri Aug 12 17:38:43 2022 +0300 [proxy] Rework wire format of the password hack and some errors (#2236)
da5f8486c Fri Aug 12 17:03:09 2022 +0100  test_runner/pg_clients: collect docker logs (#2259)
a5154dce3 Fri Aug 12 20:35:26 2022 +0300 get_binaries script fix (#2263)
f38f45b01 Sat Aug 13 10:58:14 2022 +0300 Better storage sync logs (#2268)
431393e36 Sun Aug 14 14:47:14 2022 +0300 Find end of WAL on safekeepers using WalStreamDecoder.
116ecdf87 Mon Aug 15 13:31:26 2022 +0300 Improve walreceiver logic (#2253)
63a72d99b Mon Aug 15 18:02:27 2022 +0300 increase timeout in wait_for_upload to avoid spurious failures when testing with real s3
7b12deead Mon Aug 15 18:24:24 2022 +0300 Bump vendor/postgres to include XLP_FIRST_IS_CONTRECORD fix. (#2274)
4cddb0f1a Mon Aug 15 18:54:31 2022 +0100 Set up a workflow to run pgbench against captest (#2077)
18f251384 Tue Aug 16 11:10:38 2022 +0300 Check for entire range during sasl validation (#2281)
b8f0f37de Tue Aug 16 11:15:35 2022 +0200 Gen2 GH runner (#2128)
83f7b8ed2 Tue Aug 16 13:41:51 2022 +0200 Add missing step output, revert one deploy step (#2285)
4cde0e7a3 Tue Aug 16 13:59:41 2022 +0200 Error for fatal not git repo (#2286)
1d4114183 Tue Aug 16 15:41:31 2022 +0200 Use main, not branch for ref check (#2288)
9218426e4 Tue Aug 16 17:24:58 2022 +0200 Fix docker zombie process issue (#2289)
648e8bbef Tue Aug 16 18:49:22 2022 +0300 Fix 1.63 clippy lints (#2282)
b21f7382c Tue Aug 16 18:49:32 2022 +0300 split out timeline metrics, track layer map loading and size calculation
d5ec84b87 Tue Aug 16 18:49:32 2022 +0300 reset rust cache for clippy run to avoid an ICE
e94a5ce36 Tue Aug 16 19:37:36 2022 +0300 Rename pg_control_ffi.h to bindgen_deps.h, for clarity.
3414feae0 Wed Aug 17 08:17:09 2022 -0400 Make local mypy behave like CI mypy (#2291)
e9a3499e8 Wed Aug 17 08:17:35 2022 -0400 Fix flaky pageserver restarts in tests (#2261)
3b819ee15 Wed Aug 17 17:51:53 2022 +0300 Remove extra type aliases (#2280)
262cdf834 Wed Aug 17 18:02:03 2022 +0200 Update cachepot endpoint (#2290)
dc102197d Wed Aug 17 17:16:26 2022 +0100 workflows/benchmarking: increase timeout (#2294)
67e091c90 Wed Aug 17 23:24:47 2022 +0300 Rework `init` in pageserver CLI  (#2272)
92bdf0475 Thu Aug 18 09:41:24 2022 +0200 Fix: Always build images (#2296)
9bc12f744 Thu Aug 18 13:25:00 2022 +0300 Move auto-generated 'bindings' to a separate inner module.
1a07ddae5 Thu Aug 18 13:25:00 2022 +0300 fix cargo test
976576ae5 Thu Aug 18 13:38:23 2022 +0300 Fix walreceiver and safekeeper bugs (#2295)
77a2bdf3d Thu Aug 18 15:05:40 2022 +0300 on safekeeper registration pass availability zone param (#2292)
2db675a2f Thu Aug 18 15:18:59 2022 +0200 Re-enable test dependency for deploy (#2300)
f99ccb504 Thu Aug 18 17:12:28 2022 +0200 Extract WalProposer into the neon extension (#2217)
a185821d6 Thu Aug 18 22:37:20 2022 +0300 Explicitly error on cache issues during I/O (#2303)
37d90dc3b Thu Aug 18 21:51:33 2022 +0200 Fix dependencies issue between compute-tools and compute node docker images (#2304)
6b9cef02a Fri Aug 19 12:41:00 2022 +0300 Use better defaults for pageserver Docker image
12e87f0df Fri Aug 19 12:07:46 2022 +0200 Update workflow to fix dependency issue (#2309)
804361233 Fri Aug 19 16:40:37 2022 +0300 Remove Timeline trait, rename LayeredTimeline struct into Timeline
c19b4a65f Fri Aug 19 16:40:37 2022 +0300 Remove Repository trait, rename LayeredRepository struct into Repository
c634cb1d3 Fri Aug 19 16:40:37 2022 +0300 Remove TimelineWriter trait, rename LayeredTimelineWriter struct into TimelineWriter
187a76040 Fri Aug 19 16:40:37 2022 +0300 Reset codestyle cargo cache
aaa60c92c Fri Aug 19 16:44:16 2022 +0300 Use u64/i64 for logical size, comment on why to use signed i64.
8ac5a285a Fri Aug 19 20:02:36 2022 +0200 Update vendor/postgres to one that is rebased onto REL_14_5 (#2312)
daba4c740 Fri Aug 19 21:57:00 2022 +0300 Add a section in glossary to explain what "logical size" means. (#2306)
84cd40b41 Fri Aug 19 22:21:15 2022 +0300 rustfmt fixes.
d48177d0d Fri Aug 19 22:21:33 2022 +0300 Expose timeline logical size as a prometheus metric.
5522fbab2 Sat Aug 20 01:21:18 2022 +0300 Move all unit tests related to Repository/Timeline to layered_repository.rs
631cbf5b1 Mon Aug 22 11:51:37 2022 +0300 Use single map to manage timeline data
32be8739b Mon Aug 22 11:51:37 2022 +0300 Move walreceiver timeline registration into layered_repository
777930898 Mon Aug 22 11:51:37 2022 +0300 Ensure timeline logical size is initialized once
277f2d6d3 Mon Aug 22 11:21:50 2022 +0100 Report test results to Allure (#2229)
6b2e1d906 Mon Aug 22 14:57:09 2022 +0100 test_runner: replace yapf with black and isort
4c2bb4377 Mon Aug 22 14:57:09 2022 +0100 Reformat all python files by black & isort
ae3227509 Mon Aug 22 14:57:09 2022 +0100 test_runner: revive flake8
39a3bcac3 Mon Aug 22 14:57:09 2022 +0100 test_runner: fix flake8 warnings
6dc56a9be Mon Aug 22 16:29:42 2022 +0200 Add GitHub templates for epics, bugs and release PRs (neondatabase/cloud#2079)
832e60c2b Mon Aug 22 16:38:31 2022 +0100 Add .git-blame-ignore-revs file (#2318)
9dd19ec39 Mon Aug 22 20:59:32 2022 +0300 Remove interferring proc check
b98fa5d6b Mon Aug 22 20:02:45 2022 -0400 Added a new test for making sure the proxy displays a session_id when using link auth. (#2039)
d110d2c2f Tue Aug 23 12:14:06 2022 +0300 Reorder permission checks in HTTP API call handlers.
1a666a01d Tue Aug 23 12:58:54 2022 +0300 Improve comments a little.
63b9dfb2f Tue Aug 23 12:58:54 2022 +0300 Remove unnecessary 'pub' from test module, and remove dead constant.
5f0c95182 Tue Aug 23 12:58:54 2022 +0300 Minor cleanup, to pass by reference where possible.
401329050 Tue Aug 23 12:58:54 2022 +0300 Fix module doc comment.
8e1d6dd84 Tue Aug 23 18:00:02 2022 +0300 Minor cleanup in pq_proto (#2322)
0c8ee6bd1 Thu Aug 25 09:46:52 2022 +0200 Add postgis & plv8 extensions (#2298)
344db0b4a Thu Aug 25 11:17:09 2022 +0200 Re-add temporary symlink (#2331)
f67d109e6 Thu Aug 25 14:35:01 2022 +0200 Copy binaries to /usr/local (#2335)
c952f022b Thu Aug 25 15:03:22 2022 +0200 waldecoder: fix comment
bc588f3a5 Thu Aug 25 17:17:32 2022 +0300 Update WAL redo histograms (#2323)
04a018a5b Thu Aug 25 18:48:09 2022 +0200 Extract neon and neon_test_utils from postgres repo (#2325)
a5ca6a9d2 Fri Aug 26 13:59:04 2022 +0200 Move legacy version of compute-node Dockerfile from postgres repo (#2339)
a56ae15ed Fri Aug 26 17:29:01 2022 +0300 Lock cargo dependencies during CI builds
6d30e21a3 Fri Aug 26 20:42:32 2022 +0300 Fix proxy tests (#2343)
c0a867d86 Fri Aug 26 19:58:08 2022 +0200 Include neon extensions in the main neon images (#2341)
ec2053417 Sat Aug 27 17:54:56 2022 +0300 Fix minor typos and leftover comments.
88a339ed7 Sat Aug 27 18:14:30 2022 +0300 Update a few crates
34b5d7aa9 Sat Aug 27 18:14:33 2022 +0300 Remove unused dependency
f8188e679 Sat Aug 27 18:14:35 2022 +0300 Downgrade a few panics into plain errors.
5f189cd38 Sat Aug 27 18:14:38 2022 +0300 Remove some unnecessary derives.
7a840ec60 Sat Aug 27 18:14:40 2022 +0300 Move save_metadata function.
bfa1d9161 Mon Aug 29 11:23:37 2022 +0300 Introduce RCU, and use it to protect latest_gc_cutoff_lsn.
1324dd89e Mon Aug 29 13:44:56 2022 +0200 Mark PostGIS and PLV8 as trusted extensions (#2355)
ee8b5f967 Mon Aug 29 17:59:04 2022 +0300 Add fork_at_current_lsn function which creates branch at current LSN (#2344)
07b4ace52 Mon Aug 29 22:01:53 2022 +0300 Use more restrictive .dockerignore
60408db10 Tue Aug 30 11:32:36 2022 +0300 Fix logging scopes in safekeeper.
96a50e99c Tue Aug 30 17:36:21 2022 +0300 Forward various connection params to compute nodes. (#2336)
3aca717f3 Tue Aug 30 18:25:38 2022 +0300 Reorganize python tests.
f09bd6bc8 Tue Aug 30 18:44:06 2022 +0300 Fix size checks in the "local" remote storage implementation.
a4803233b Tue Aug 30 22:19:52 2022 +0300 Remove `RemoteObjectName` and many remote storage generics in pageserver (#2360)
5745dbdd3 Wed Aug 31 14:36:24 2022 +0200 Remove deprecated notification channel (#2330)
d7c9cfe7b Wed Aug 31 16:15:26 2022 +0100 Create Allure report for perf tests (#2326)
13beeb59c Thu Sep 1 12:53:17 2022 +0200 Update extensions included in compute-node
46c8a9397 Thu Sep 1 15:06:52 2022 +0300 Fix PERF_TEST_RESULT_CONNSTR for benchmark init (#2375)
15c5f3e6c Thu Sep 1 20:04:08 2022 +0300 Fix misc typos in comments and variable names.
40813adba Thu Sep 1 21:51:48 2022 +0300 Pevent creation of empty layers with duplicates (#2327)
f0a0d7bb7 Fri Sep 2 00:34:37 2022 +0300 Split RcuWriteGuard::store() into two stages: store and wait.
47bd307cb Fri Sep 2 10:16:47 2022 +0300 Add python types to represent LSNs, tenant IDs and timeline IDs. (#2351)
8a7333438 Fri Sep 2 11:58:28 2022 +0300 Extract common remote storage operations into GenericRemoteStorage (#2373)
f78a542cb Fri Sep 2 14:31:28 2022 +0300 Calculate timeline initial logical size in the background
2db20e558 Fri Sep 2 14:31:28 2022 +0300 Remove [Un]Loaded timeline code (#2359)
827c3013b Fri Sep 2 14:57:09 2022 +0300 Adjust benchmark code to Ids
8b28adb6a Fri Sep 2 14:57:09 2022 +0300 Merge file name and extension for index part files
73f926c39 Fri Sep 2 15:08:18 2022 +0300 Return safekeeper remote storage logging during downloads
a463749f5 Fri Sep 2 14:34:40 2022 +0200 Slim down compute-node images (#2346)
a4e79db34 Fri Sep 2 16:34:33 2022 +0300 Move `neon_local` to `control_plane`.
71c965b0e Sat Sep 3 08:48:28 2022 +0300 Move backpressure throttling implementation to neon extension and function for monitoring throttling time (#2380)
eef747540 Sat Sep 3 17:06:19 2022 +0300 Add tests for measuring effect of lsn caching (#2384)
2b6c49b2e Sat Sep 3 23:54:00 2022 +0300 Fix negative usize parsing
846d71b94 Sun Sep 4 22:25:32 2022 +0300 Add test for last written lsn cache (#1949)
7a3e8bb7f Mon Sep 5 11:02:13 2022 +0300 Make tracing span names consistent for mgmt API handlers.
aeb1cf9c3 Mon Sep 5 11:09:32 2022 +0300 Fix misc typos and grammar in comments.
ad057124b Mon Sep 5 13:12:02 2022 +0300 Update relation size cache only when latest LSN is requested (#2310)
772078eb5 Mon Sep 5 15:13:29 2022 +0300 Reword proxy SNI error message
ee0071e90 Mon Sep 5 14:30:37 2022 +0100 Fix nightly benchmark reports (#2392)
05e263d0d Mon Sep 5 18:30:54 2022 +0300 Prepare pg 15 support (build system and submodules) (#2337)
f081419e6 Tue Sep 6 11:30:20 2022 +0300 Cleanup tenant specific metrics once a tenant is detached. (#2328)
cf157ad8e Tue Sep 6 13:00:40 2022 +0300 Add test that repeatedly kills and restarts the pageserver.
f441fe57d Tue Sep 6 17:38:17 2022 +0300 Register prometheus counters correctly.
65b592d4b Tue Sep 6 18:54:04 2022 +0300 Remove deprecated management API for timeline detach.
2794cd83c Wed Sep 7 12:40:48 2022 +0300 Prepare pg 15 support (generate bindings for pg15) (#2396)
dc2150a90 Wed Sep 7 12:11:03 2022 +0000 Add built files to gitignore (#2404)
83dca73f8 Wed Sep 7 14:16:48 2022 +0100 Store Allure tests statistics in database (#2367)
9e3136ea3 Wed Sep 7 21:40:08 2022 +0100 scripts/ingest_regress_test_result.py: fix json data insertion (#2408)
1351beae1 Thu Sep 8 10:57:30 2022 +0000 Fix race condition in ginHeapTupleFastInsert (#2412)
171385ac1 Thu Sep 8 16:02:11 2022 +0100 Pass COPT and PG_CFLAGS  to Extension's CFLAGS (#2405)
35b4816f0 Thu Sep 8 19:59:42 2022 +0300 Turn GenericRemoteStorage into just a newtype around 'Arc<dyn RemoteStorage>'
0b76b82e0 Thu Sep 8 19:59:42 2022 +0300 review clean up
d3f83eda5 Fri Sep 9 16:07:43 2022 +0300 Use regular agent for triggering e2e tests
c9e7c2f01 Fri Sep 9 16:36:45 2022 +0300 Ensure all temporary and empty directories and files are cleansed on pageserver startup
31ec3b790 Fri Sep 9 22:32:00 2022 +0300 Use the toolchain file to define current rustc version used
923f64254 Fri Sep 9 22:32:00 2022 +0300 Collect cargo build timings
648e86e9d Fri Sep 9 22:32:00 2022 +0300 Use Debian images with libc 2.31 to build legacy compute tools
18dafbb9b Fri Sep 9 22:32:00 2022 +0300 Remove deceiving rust version from the CI files
a48f9f377 Sat Sep 10 01:23:19 2022 +0300 Fix typo in issue template
698d6d0ba Mon Sep 12 13:44:54 2022 +0300 Use stable coverage API with rustc 1.60
40c845e57 Mon Sep 12 14:21:00 2022 +0300 Switch to async for all concurrency in the pageserver.
2a837d7de Mon Sep 12 21:04:33 2022 +0000 Create tenants in temporary directory first (#2426)
4f7557fb5 Tue Sep 13 09:45:45 2022 +0100 github/workflows: Create projects using API (#2403)
f44afbaf6 Tue Sep 13 12:26:20 2022 +0300 Changes of neon extension to support local prefetch (#2369)
1a8c8b04d Tue Sep 13 15:39:39 2022 +0300 Merge Repository and Tenant entities, rework tenant background jobs
59d04ab66 Tue Sep 13 17:24:11 2022 +0000 test_runner: redact passwords from log messages (#2434)
db0c49148 Tue Sep 13 21:21:45 2022 +0300 clean up metrics in handle_pagerequests
d4d57ea2d Tue Sep 13 20:26:26 2022 +0200 github/workflows: fix project creation via API (#2437)
1d53173e6 Tue Sep 13 21:53:59 2022 +0300 update openapi spec (tenant state has changed)
32b7259d5 Tue Sep 13 22:37:20 2022 +0300 Timeline data management RFC (#2152)
35761ac6b Tue Sep 13 21:55:18 2022 +0000 docs/sourcetree: add info about IDE config (#2332)
ba8698bbc Wed Sep 14 01:41:27 2022 +0300 update neon_local output in readme
260ec20a0 Wed Sep 14 08:14:05 2022 +0300 Refotmat pgxn code, add typedefs.list that was used
b8eb908a3 Wed Sep 14 08:14:05 2022 +0300 Rename old project name references
6db6e7ddd Wed Sep 14 08:14:05 2022 +0300 Use backward-compatible safekeeper code
c3096532f Wed Sep 14 09:23:51 2022 +0300 Fix vendor/postgres-v15 to point to correct v15 branch.
d87c9e62d Wed Sep 14 10:53:34 2022 +0000 Nightly Benchmarks: perform tests on both pre-created and fresh projects (#2443)
f86ea0932 Wed Sep 14 15:18:18 2022 +0300 Avoid recompiling postgres_ffi every time you run "make".
87bf7be53 Wed Sep 14 21:27:47 2022 +0300 [proxy] Drop support for legacy cloud API (#2448)
757e2147c Thu Sep 15 15:21:22 2022 +0300 Follow-up for neondatabase/neon#2448 (#2452)
a8d973252 Thu Sep 15 14:07:00 2022 +0100 Bump axum-core from 0.2.7 to 0.2.8
1062e57fe Thu Sep 15 16:33:42 2022 +0300 Don't run codestyle checks separately for Postgres v14 and v15.
9d9d8e951 Thu Sep 15 17:16:07 2022 +0000 docs/sourcetree: update CLion set up instructions (#2454)
e968b5e50 Thu Sep 15 21:43:51 2022 +0300 tests: do not set num_safekeepers = 1, it's the default (#2457)
96e867642 Thu Sep 15 18:20:23 2022 -0400 Validate tenant create options (#2450)
031e57a97 Fri Sep 16 09:26:29 2022 +0300 Disable failpoints by default
db5ec0dae Thu Sep 15 23:50:46 2022 -0700 Cleanup/simplify logical size calculation (#2459)
74312e268 Fri Sep 16 11:17:41 2022 +0300 Tidy up storege artifact build flags
72b33997c Fri Sep 16 09:09:54 2022 +0000 Nightly Benchmarks: trigger tests earlier (#2463)
4db15d3c7 Fri Sep 16 18:14:05 2022 +0300 change prefix_in_bucket in pageserver config
44fd4e3c9 Fri Sep 16 18:14:05 2022 +0300 add more logs
9c35a0945 Fri Sep 16 08:37:44 2022 -0700 Improve build errors when `postgres_ffi` fails (#2460)
65a5010e2 Fri Sep 16 15:44:02 2022 +0000 Use custom `install` command in Makefile to speed up incremental builds (#2458)
b46c8b4ae Fri Sep 16 18:58:41 2022 +0300 Add an alias to build test images simply
c9c3c77c3 Fri Sep 16 20:51:35 2022 +0300 Fix Docker image builds (follow-up for #2458) (#2469)
846d12657 Mon Sep 19 12:56:08 2022 +0300 Set last written lsn for created relation (#2398)
90ed12630 Mon Sep 19 12:57:44 2022 +0200 Add zenith-us-stage-ps-4 and undo changes in prefix_in_bucket in pageserver config (#2473)
d11cb4b2f Mon Sep 19 15:12:05 2022 +0300 Bump vendor/postgres-v15 to the latest state of REL_15_STABLE_neon branch
4b5e7f2f8 Mon Sep 19 17:03:20 2022 +0300 Temporarily disable storage deployments
fcb4a61a1 Mon Sep 19 20:08:38 2022 +0300 Adjust spans around gc and compaction
6985f6cd6 Mon Sep 19 20:56:11 2022 +0300 Add a new benchmark data series for prefetching.
bb3c66d86 Mon Sep 19 22:28:51 2022 +0000 github/workflows: Make publishing perf reports more configurable (#2440)
e4f775436 Tue Sep 20 09:46:15 2022 +0300 Don't override other options than statement_timeout in test conn string.
566e81629 Tue Sep 20 07:42:39 2022 +0000 Refactor safekeeper timelines handling (#2329)
7863c4a70 Tue Sep 20 11:39:10 2022 +0300 Regenerate Hakari files, add a CI check for that
a5019bf77 Tue Sep 20 13:48:50 2022 +0300 Use a simpler way to set extra options for benchmark test.
4b25b9652 Tue Sep 20 11:06:31 2022 -0700 Rename more zid-like idents (#2480)
4a3b3ff11 Tue Sep 20 11:28:12 2022 -0700 Move testing pageserver libpq cmds to HTTP api (#2429)
6fc719db1 Tue Sep 20 23:43:52 2022 +0300 Merge timelines.rs with tenant.rs
310c50730 Tue Sep 20 23:43:52 2022 +0300 Merge path retrieval methods in config.rs
6b8dcad1b Tue Sep 20 23:43:52 2022 +0300 Unify timeline creation steps
8d7024a8c Tue Sep 20 23:43:52 2022 +0300 Move path manipulation function to utils
6f949e155 Tue Sep 20 17:02:10 2022 -0700 Improve pageserver/safekeepeer HTTP API errors (#2461)
71c92e0db Wed Sep 21 10:13:11 2022 +0000 Use prebuilt image with Hakari for CI style checks (#2488)
b82e2e3f1 Wed Sep 21 17:14:29 2022 +0300 Bump postgres submodules and update docs/core_changes.md.
19fa410ff Wed Sep 21 15:17:55 2022 +0100 NeonCompare: switch to new pageserver HTTP API
7eebb45ea Wed Sep 21 19:13:30 2022 +0300 Reduce metrics footprint in safekeeper (#2491)
e9a103c09 Wed Sep 21 21:42:47 2022 +0300 [proxy] Pass extra parameters to the console (#2467)
f3073a4db Thu Sep 22 08:35:06 2022 +0300 R-Tree layer map (#2317)
e764c1e60 Thu Sep 22 11:41:04 2022 +0300 remove self argument from several spans
86bf49198 Thu Sep 22 14:15:13 2022 +0300 Support pg 15
9dfede814 Thu Sep 22 14:15:13 2022 +0300 Handle backwards-compatibility of TimelineMetadata. This commit bumps TimelineMetadata format version and makes it independent from STORAGE_FORMAT_VERSION.
03c606f7c Thu Sep 22 14:15:13 2022 +0300 Pass pg_version parameter to timeline import command. Add pg_version field to LocalTimelineInfo. Use pg_version in the export_import_between_pageservers script
a4397d43e Thu Sep 22 14:15:13 2022 +0300 Rename waldecoder -> waldecoder_handler.rs. Add comments
a69e060f0 Thu Sep 22 14:15:13 2022 +0300 fix clippy warning
d45de3d58 Thu Sep 22 14:15:13 2022 +0300 update build scripts to match pg_distrib_dir versioning schema
5dddeb8d8 Thu Sep 22 14:15:13 2022 +0300 Use non-versioned pg_distrib dir
1255ef806 Thu Sep 22 14:15:13 2022 +0300 pass version to wal_craft.rs
0fde59aa4 Thu Sep 22 14:15:13 2022 +0300 use pg_version in python tests
8d890b3cb Thu Sep 22 14:15:13 2022 +0300 fix clippy warnings
862902f9e Thu Sep 22 14:15:13 2022 +0300 Update readme and openapi spec
ed6b75e30 Thu Sep 22 14:15:13 2022 +0300 show pg_version in create_timeline info span
3618c242b Thu Sep 22 14:15:13 2022 +0300 use version specific find_end_of_wal function
d8d3cd49f Thu Sep 22 14:15:13 2022 +0300 Update libs/postgres_ffi/wal_craft/src/bin/wal_craft.rs
eba419fda Thu Sep 22 14:15:13 2022 +0300 Clean up the pg_version choice code
d098542dd Thu Sep 22 14:15:13 2022 +0300 Make test_timeline_size_metrics more stable: Compare size with Vanilla postgres size instead of hardcoded value
1fa7d6aeb Thu Sep 22 14:15:13 2022 +0300 Use DEFAULT_PG_VERSION env in CI pytest
64f64d563 Thu Sep 22 14:15:13 2022 +0300 Fix after rebase: bump vendor/postgres-v14 to match main
2d012f0d3 Thu Sep 22 14:15:13 2022 +0300 Fix rebase conflicts in pageserver code
5e151192f Thu Sep 22 14:15:13 2022 +0300 Fix rebase conflicts in safekeeper code
262fa3be0 Thu Sep 22 17:07:08 2022 +0300 pageserver pg proto: add missing auth checks (#2494)
7138db927 Thu Sep 22 18:12:41 2022 +0300 Fix paths to postgres binaries in the deploy script
8b42c184e Thu Sep 22 18:12:41 2022 +0300 Update LD_LIBRARY_PATH in deploy scripts
7c1695e87 Thu Sep 22 18:12:41 2022 +0300 fix psql path in export_import_between_pageservers script
eb9200abc Thu Sep 22 18:12:41 2022 +0300 Use version-specific path in pytest CI script
c81ede864 Thu Sep 22 21:17:36 2022 +0300 Hotfix for safekeeper timelines with unknown pg_version. Assume DEFAULT_PG_VERSION = 14
43560506c Fri Sep 23 00:27:24 2022 +0300 remove duplicate walreceiver connection span
b0377f750 Fri Sep 23 11:25:26 2022 +0300 Add staging-test region to normal staging rollouts (#2500)
52819898e Fri Sep 23 11:25:29 2022 +0200 Extend image push step with production ECR (#2465)
eb0c6bcf1 Fri Sep 23 14:12:39 2022 +0300 reenable storage deployments
3e65209a0 Fri Sep 23 12:50:36 2022 +0100 Nightly Benchmarks: use Postgres binaries from artifacts (#2501)
bc3ba23e0 Fri Sep 23 14:35:36 2022 +0200 Fix extreme metrics bloat in storage sync (#2506)
ebab89ebd Fri Sep 23 12:51:33 2022 +0000 test_runner: pass password to pgbench via PGPASSWORD (#2468)
1dffba9de Fri Sep 23 18:30:44 2022 +0300 Write more tests for the proxy... (#1918)
5ccd54c69 Fri Sep 23 19:06:57 2022 +0300 Add support for h3-pg and re-enable plv8
805bb198c Fri Sep 23 11:49:28 2022 -0700 Miscellaneous small fixups (#2503)
093264a69 Fri Sep 23 22:23:43 2022 +0300 Fix deploy bin and lib paths for postgres
116568620 Fri Sep 23 22:23:43 2022 +0300 fix deploy lib paths for postgres
367cc0129 Mon Sep 26 10:08:01 2022 +0300 Fix deploy paths
df45c0d0e Mon Sep 26 12:22:46 2022 +0300 Disable plv8 again
d15116f2c Mon Sep 26 19:57:03 2022 +0300 Update pg_version for old timelines
fb68d0144 Mon Sep 26 20:57:02 2022 +0000 Preserve task result in TaskHandle by keeping join handle around (#2521)
2233ca2a3 Tue Sep 27 11:47:59 2022 +0300 seqwait.rs unit tests don't check return value
fc7087b16 Tue Sep 27 11:57:59 2022 +0300 Add metric for loaded safekeeper timelines (#2509)
dabb6d267 Tue Sep 27 10:36:17 2022 +0000 Fix log level for sk startup logs (#2526)
7b2f9dc90 Mon Oct 3 13:33:55 2022 +0300 Reuse existing tenants during attach (#2540)
4f2ac51bd Mon Oct 3 16:36:03 2022 +0300 Bump rustc to 1.61
31123d1fa Mon Oct 3 17:44:17 2022 +0300 Silence clippies, minor doc fix (#2543)
537b2c1ae Tue Oct 4 12:09:13 2022 +0300 Remove unnecessary check for open PostgreSQL TCP port.
9b9bbad46 Tue Oct 4 13:00:15 2022 +0300 Use 'notify' crate to wait for PostgreSQL startup.
5cf53786f Tue Oct 4 14:53:01 2022 +0300 Improve pytest ergonomics
231dfbaed Tue Oct 4 18:13:51 2022 +0300 Do not remove empty timelines/ directory for tenants
d823e84ed Tue Oct 4 18:13:51 2022 +0300 Allow attaching tenants with zero timelines
580584c8f Tue Oct 4 11:14:45 2022 -0700 Remove control_plane deps on pageserver/safekeeper (#2513)
b99bed510 Wed Oct 5 16:14:09 2022 +0300 Move proxies to neon-proxy namespace (#2555)
f25dd75be Thu Oct 6 01:07:02 2022 +0300 Fix deadlock in safekeeper metrics (#2566)
ff8c48177 Thu Oct 6 09:01:56 2022 +0300 Normalize last_record LSN in wal receiver (#2529)
c5a428a61 Thu Oct 6 10:50:08 2022 +0300 Update Dockerfile.compute-node-v15 to match v14 version. Fix build script to promote the image for v15 to neon dockerhub
4a216c5f7 Thu Oct 6 10:50:08 2022 +0300 Use PostGIS 3.3.1 that is compatible with pg 15
ed85d97f1 Thu Oct 6 10:50:08 2022 +0300 bump vendor/postgres-v15. Rebase it to Stamp 15rc2
254cb7dc4 Thu Oct 6 10:50:08 2022 +0300 Update CI script to push compute-node-v15 to dockerhub
e8b195acb Thu Oct 6 11:13:40 2022 +0300 fix: apply notify workaround on m1 mac docker (#2564)
47bae68a2 Thu Oct 6 12:42:50 2022 +0300 Make get_lsn_by_timestamp available in mgmt API (#2536) (#2560)
687ba8136 Thu Oct 6 13:53:52 2022 +0000 Display sync safekeepers output in compute_ctl (#2571)
9e1eb69d5 Fri Oct 7 13:55:19 2022 +0300 Increase default compaction_period setting to 20 s.
8e51c27e1 Fri Oct 7 10:58:31 2022 +0000 Restore artifact versions (#2578)
e516c376d Fri Oct 7 14:34:57 2022 +0300 [proxy] Improve logging (#2554)
725be60bb Fri Oct 7 21:22:17 2022 +0400 Storage messaging rfc 2.
a22165d41 Sat Oct 8 10:07:33 2022 +0300 Add tests for comparing root and child branch performance.
9f79e7ede Sat Oct 8 12:42:17 2022 +0000 Merge pageserver helper binaries and provide it for deployment (#2590)
01d2c52c8 Sun Oct 9 08:21:11 2022 +0300 Tidy up feature reporting
3be3bb773 Sun Oct 9 08:21:11 2022 +0300 Be more verbose with initdb for pageserver timeline creation
3e35f10ad Sun Oct 9 08:21:11 2022 +0300 Add a script to reformat the project
13f0e7a5b Sun Oct 9 08:21:11 2022 +0300 Deploy pageserver_binutils to the envs
34bea270f Mon Oct 10 09:12:50 2022 +0000 Fix POSTGRES_DISTRIB_DIR for benchmarks on ec2 runner (#2594)
241e54975 Mon Oct 10 22:07:19 2022 +0000 Switch neon-stress etcd to dedicatd instance (#2602)
e52029309 Tue Oct 11 09:54:32 2022 +0300 Add build info metric to pageserver, safekeeper and proxy (#2596)
db26bc49c Tue Oct 11 17:47:41 2022 +0300 Remove obsolete FIXME comment.
47366522a Tue Oct 11 17:47:41 2022 +0300 Make the return type of 'list_timelines' simpler.
676c63c32 Tue Oct 11 17:47:41 2022 +0300 Improve comments.
e5e40a31f Tue Oct 11 17:47:41 2022 +0300 Clean up terms "delete timeline" and "detach tenant".
6d0dacc4c Wed Oct 12 11:46:21 2022 +0400 Recreate timeline on pageserver in s3_wal_replay test.
93775f6ca Wed Oct 12 10:22:24 2022 +0100 GitHub Actions: replace deprecated set-output with GITHUB_OUTPUT (#2608)
771e61425 Wed Oct 12 08:38:28 2022 -0300 Update release-pr.md (#2600)
6ace79345 Wed Oct 12 21:00:44 2022 +0300 [proxy] Add more context to console requests logging (#2583)
09dda35da Wed Oct 12 22:28:39 2022 +0300 Return broken tenants due to non existing timelines dir (#2552) (#2575)
ebf54b0de Thu Oct 13 10:00:29 2022 +0100 Nightly Benchmarks: Add 50 GB projects (#2612)
14c623b25 Thu Oct 13 15:17:00 2022 +0300 Make it possible to build with old cargo version.
9fe4548e1 Thu Oct 13 21:43:10 2022 +0400 Reimplement explicit timeline creation on safekeepers.
a13b48694 Fri Oct 14 18:12:50 2022 +0300 Bump vendor/postgres-v15. Rebase to 15.0
ee64a6b80 Fri Oct 14 18:12:50 2022 +0300 Fix CI: push versioned compute images to production ECR
500239176 Fri Oct 14 18:37:14 2022 +0300 Make TimelineInfo.local field mandatory.
538876650 Fri Oct 14 18:37:14 2022 +0300 Merge 'local' and 'remote' parts of TimelineInfo into one struct.
9c24de254 Fri Oct 14 18:37:58 2022 +0300 Add description and license fields to OpenAPI spec.
f03b7c345 Sat Oct 15 01:55:31 2022 +0300 Bump regular dependencies (#2618)
5d6553d41 Sun Oct 16 11:37:10 2022 +0000 Fix pageserver configuration generation bug (#2584)
c70935457 Mon Oct 17 12:21:04 2022 +0300 Add layer sizes to index_part.json (#2582)
c4ee62d42 Mon Oct 17 12:58:40 2022 +0300 Bump clap and other minor dependencies (#2623)
0ec5ddea0 Mon Oct 17 22:42:51 2022 +0300 GRANT CREATE ON SCHEMA public TO web_access
129f7c82b Tue Oct 18 11:21:48 2022 +0300 remove redundant expect_tenant_to_download_timeline
80746b1c7 Tue Oct 18 15:00:10 2022 +0300 Add micro-benchmark for layer map search function
2418e7264 Tue Oct 18 15:00:10 2022 +0300 Speed up layer_map::search, by remembering the "envelope" for each layer.
59bc7e67e Tue Oct 18 15:00:10 2022 +0300 Use an optimized version of amplify_num.
546e9bdbe Tue Oct 18 15:52:15 2022 +0300 Deploy storage into new account and migrate to management API v2 (#2619)
0cd2d91b9 Tue Oct 18 14:44:19 2022 +0000 Fix deploy-new job by installing sivel.toiletwater (#2641)
41550ec8b Tue Oct 18 18:25:30 2022 +0300 Remove unnecessary indirections of libpqwalproposer functions
7ca72578f Tue Oct 18 18:34:27 2022 +0300 Enable plv8 again
989d78aac Tue Oct 18 18:46:07 2022 +0300 Buffer the TCP incoming stream on libpq connections.
8fbe43776 Tue Oct 18 11:53:28 2022 -0400 Improve pageserver IO metrics (#2629)
c67cf3404 Wed Oct 19 11:16:36 2022 +0300 Update GH Action version (#2646)
91411c415 Wed Oct 19 12:32:03 2022 +0300 Persists latest_gc_cutoff_lsn before performing GC (#2558)
6b49b370f Wed Oct 19 13:55:30 2022 +0300 Fix build after applying PR #2558
7576b18b1 Wed Oct 19 18:37:52 2022 +0300 [compute_tools] fix GRANT CREATE ON SCHEMA public - run the grant query in each database
4d1e48f3b Wed Oct 19 19:20:06 2022 +0200 [compute_ctl] Use postgres::config to properly escape database names (#2652)
b237feeda Wed Oct 19 22:47:11 2022 +0200 Add more redo metrics: (#2645)
bc5ec4305 Wed Oct 19 23:50:21 2022 +0300 Fix flaky physical-size tests in test_timeline_size.py.
7734929a8 Wed Oct 19 22:59:22 2022 +0000 Remove stale todos (#2630)
9211923be Thu Oct 20 10:46:57 2022 +0300 Pageserver Python tests should not fail if the server is built with no testing feature (#2636)
50297bef9 Thu Oct 20 12:49:54 2022 +0300 RFC about Tenant / Timeline guard objects (#2660)
84c5f681b Thu Oct 20 13:44:03 2022 +0300 Fix test feature detection (#2659)
306a47c4f Thu Oct 20 14:19:17 2022 +0300 Use uninit mark files during timeline init for atomic creation (#2489)
f5ab9f761 Thu Oct 20 17:14:32 2022 +0400 Remove flaky checks in test_delete_force (#2567)
eb1bdcc6c Thu Oct 20 17:27:01 2022 +0300 If an FSM or VM page cannot be reconstructed, fill it with zeros.
7404777ef Thu Oct 20 20:06:05 2022 +0300 Pin pages with speculative insert tuples to prevent their reconstruction because spec_token is not wal logged (#2657)
30984c163 Thu Oct 20 23:01:01 2022 +0300 Fix race between pushing image to ECR and copying to dockerhub (#2662)
cca1ace65 Fri Oct 21 00:40:12 2022 +0300 make launch_wal_receiver infallible
fc4ea3553 Fri Oct 21 02:39:55 2022 +0300 test_gc_cutoff.py fixes (#2655)
a347d2b6a Fri Oct 21 12:47:06 2022 +0300 #2616 handle 'Unsupported pg_version' error properly
52e75fead Fri Oct 21 12:47:06 2022 +0300 Use anyhow::Result explicitly
39e4bdb99 Fri Oct 21 10:58:43 2022 +0000 Actualize tenant and timeline API modifiers (#2661)
2709878b8 Fri Oct 21 14:21:22 2022 +0300 Deploy scram proxies into new account (#2643)
7480a0338 Fri Oct 21 15:33:27 2022 +0300 Determine safekeeper for offloading WAL without etcd election API.
6ff2c61ae Fri Oct 21 13:44:08 2022 +0000 Refactor safekeeper s3 config and change it for new account (#2672)
5928cb33c Fri Oct 21 15:51:48 2022 +0000 Introduce timeline state (#2651)
71ef7b666 Fri Oct 21 20:02:31 2022 +0300 Remove cached_property package (#2673)
321aeac3d Fri Oct 21 17:30:20 2022 +0000 Json logging capability (#2624)
7b6431cbd Sat Oct 22 14:59:18 2022 +0300 Disable wal_log_hints by default (#2598)
9f4960504 Sat Oct 22 18:25:12 2022 +0300 Fix division by zero panic in determine_offloader.
2f399f08b Tue Oct 25 09:55:24 2022 +0300 Hotfix to disable grant create on public schema
39897105b Tue Oct 25 09:55:24 2022 +0300 Check postgres version and ensure that public schema exists before running GRANT query on it
df18b041c Tue Oct 25 14:29:11 2022 +0300 Use apt version pinning instead of repo priorities
834ffe1ba Tue Oct 25 16:41:50 2022 +0200 Add data format backward compatibility tests (#2626)
9fb2287f8 Tue Oct 25 11:25:22 2022 -0400 Add draw_timeline binary (#2688)
a3cb8c11e Tue Oct 25 23:51:23 2022 +0000 Do not release to new staging proxies on release (#2685)
259a5f356 Wed Oct 26 13:59:25 2022 +0300 Add a docker-compose example file (#1943) (#2666)
0c54eb65f Wed Oct 26 17:32:31 2022 -0400 Move pagestream api to libs/pageserver_api (#2698)
1f08ba579 Thu Oct 27 09:44:16 2022 +0300 Avoid debian-testing packages in compute Dockerfiles
b42bf9265 Thu Oct 27 10:47:08 2022 +0300 Enable etcd compaction in neon_local.
6dbf202e0 Thu Oct 27 16:00:40 2022 +0200 Update crane copy target (#2704)
78e412b84 Thu Oct 27 14:02:55 2022 +0000 The fix of #2650. (#2686)
0cbae6e8f Thu Oct 27 15:54:49 2022 +0000 test_backward_compatibility: friendlier error message (#2707)
128dc8d40 Thu Oct 27 19:26:10 2022 +0300 Nightly Benchmarks: fix workflow (#2708)
d3c8749da Fri Oct 28 10:39:22 2022 +0300 Build compute postgres with openssl support
e86a9105a Fri Oct 28 10:17:27 2022 +0000 Deploy storage to new prod regions (#2709)
59a3ca4ec Fri Oct 28 16:25:28 2022 +0300 Deploy proxy to new prod regions (#2713)
1eb9bd052 Fri Oct 28 16:45:11 2022 +0300 Bump vendor/postgres-v15 to fix XLP_FIRST_IS_CONTRECORD issue.
7481fb082 Fri Oct 28 14:12:49 2022 +0000 Fix bugs in #2713 (#2716)
596d622a8 Fri Oct 28 22:12:31 2022 +0400 Fix test_prepare_snapshot.
22cc8760b Mon Oct 31 01:11:50 2022 +0100 Move walredo process code under pgxn in the main 'neon' repository.
c64a121aa Tue Nov 1 15:08:23 2022 +0200 do not nest wal_connection_manager span inside parent one
0df346714 Tue Nov 1 18:17:36 2022 +0300 Refactoring: replace `utils::connstring` with `Url`-based APIs
32d14403b Tue Nov 1 18:07:08 2022 +0200 remove wrong is_active filter for timelines in compaction/gc
6df4d5c91 Wed Nov 2 01:21:33 2022 +0200 Bump rustc to 1.62.1 (#2728)
d42700280 Wed Nov 2 02:26:37 2022 +0200 Remove daemonize from storage components (#2677)
67401cbdb Wed Nov 2 17:15:49 2022 +0200 pageserver s3 coordination
ccdc3188e Wed Nov 2 17:15:49 2022 +0200 update according to discussion and comments
e56d11c8e Wed Nov 2 17:15:49 2022 +0200 fix style if possible (cannot really split long lines in mermaid)
0a0595b98 Wed Nov 2 15:22:38 2022 +0000 test_backward_compatibility: assign random port to compute (#2738)
590f894db Wed Nov 2 16:22:58 2022 +0100 tenant_status: remove unnecessary spawn_blocking
a86a38c96 Wed Nov 2 16:22:58 2022 +0100 README: fix instructions on how to run tests
b15499251 Wed Nov 2 16:22:58 2022 +0100 timeline_list_handler: avoid spawn_blocking
a0a74868a Wed Nov 2 12:30:09 2022 -0400 Fix clippy (#2742)
511214299 Wed Nov 2 18:37:48 2022 +0000 fix: use different port for temporary postgres (#2743)
d7eeb73f6 Wed Nov 2 23:44:07 2022 -0400 Impl serialize for pagestream FeMessage (#2741)
63221e4b4 Thu Nov 3 16:20:55 2022 +0400 Fix sk->ps walsender shutdown on sk side on caughtup.
cf68963b1 Thu Nov 3 12:39:19 2022 +0000 Add initial tenant sizing model and a http route to query it (#2714)
71d268c7c Thu Nov 3 14:24:15 2022 +0000 Write message serialization test (#2746)
c38f38dab Thu Nov 3 22:56:04 2022 +0300 Move pq_proto to its own crate
07b3ba5ce Fri Nov 4 20:30:13 2022 +0200 Bump postgres submodules, for some cosmetic cleanups.
bc40a5595 Fri Nov 4 21:29:51 2022 +0000 test_runner: update cryptography (#2753)
7b7f84f1b Sun Nov 6 13:42:18 2022 +0200 Refactor layer flushing task
15d970f73 Sun Nov 6 13:42:18 2022 +0200 decrease diff by moving check_checkpoint_distance back
99e745a76 Sun Nov 6 13:42:18 2022 +0200 review adjustments
548d472b1 Mon Nov 7 12:03:57 2022 +0200 fix: logical size query at before initdb_lsn (#2755)
d5b6471fa Mon Nov 7 18:13:24 2022 +0200 Update prefetch mechanism: (#2687)
c1a76eb0e Mon Nov 7 18:39:51 2022 +0000 test_runner: replace global variables with fixtures (#2754)
c3a470a29 Tue Nov 8 14:03:13 2022 +0100 walredo process management: handle every error on the kill() and drop path
40164bd58 Tue Nov 8 20:15:54 2022 +0400 Use latestMsgReceivedAt in walproposer
1cf257bc4 Tue Nov 8 20:15:54 2022 +0400 feedback
e999f66b0 Tue Nov 8 19:45:14 2022 +0200 Use a cached WaitEventSet instead of WaitLatchOrSocket.
b55466045 Wed Nov 9 11:43:10 2022 +0100 Introduce codeowners
4a10e1b06 Thu Nov 10 08:50:42 2022 +0200 Pass pushed storage Docker tag to e2e jobs
c4f9f1dc6 Thu Nov 10 09:06:34 2022 +0000 Add data format forward compatibility tests  (#2766)
f720dd735 Thu Nov 10 12:47:27 2022 +0100 Stricter mypy linters for `test_runner/fixtures/*`
8654e95fa Thu Nov 10 12:50:50 2022 +0100 walredo: fix zombie processes ([postgres] <defunct>)
175779c0e Thu Nov 10 12:51:47 2022 +0000 GitHub Actions: fix non-parallel benchmarks on CI (#2787)
c6072d38c Thu Nov 10 15:49:00 2022 +0000 Remove debug logs in should_walsender_stop (#2791)
d5b7832c2 Thu Nov 10 16:15:04 2022 +0000 Fix test_wal_backpressure tests (#2792)
842121815 Thu Nov 10 17:41:36 2022 +0100 Change the branch name for V14 as it does for V15
7edc098c4 Thu Nov 10 16:05:57 2022 -0500 Add perf test instructions (#2777)
7fd88fab5 Thu Nov 10 16:43:04 2022 -0500 Trace read requests (#2762)
03695261f Fri Nov 11 19:42:26 2022 +0200 Test storage Docker images (#2767)
4131a6efa Sat Nov 12 18:51:51 2022 +0200 Remove unused Dockerfile.compute-node.legacy.
dbe5b5249 Sat Nov 12 18:52:25 2022 +0200 Avoid some vector-growing overhead.
f30ef0043 Sat Nov 12 20:48:10 2022 +0200 Stop building the legacy "compute-node" docker image.
c11cbf0f5 Sun Nov 13 21:03:54 2022 +0200 fix test_compare_child_and_root_pgbench_perf to do a fair comparison
f87017c04 Mon Nov 14 12:44:41 2022 +0000 Omit dependencies' debug info (#2803)
03190a216 Tue Nov 15 10:27:59 2022 +0000 GitHub Actions: Do not create Allure report for cancelled jobs (#2813)
01778e37c Tue Nov 15 15:12:38 2022 +0100 Address issues in the pagestore prefetch mechanism: (#2790)
223834a42 Tue Nov 15 18:47:28 2022 +0200 Fix confusion between Postgres and pageserver connection string in test.
e44e4a699 Tue Nov 15 18:47:28 2022 +0200 Downgrade log message, if client terminates COPY during basebackup import
d0105cea1 Tue Nov 15 18:47:28 2022 +0200 Avoid errors when removing a timeline that's still active
46d30bf05 Tue Nov 15 18:47:28 2022 +0200 Check for errors in pageserver log after each test.
1e21ca1af Tue Nov 15 22:39:44 2022 +0200 Trim whitespaces off Lsn strings when parsing (#2827)
638af96c5 Tue Nov 15 22:32:12 2022 +0000 postgres-v15: fix expected results for regress tests (#2822)
ac3ccac56 Wed Nov 16 11:25:24 2022 +0400 Add zenith-1-ps-4 and zenith-1-ps-5 (#2815)
4787a744c Wed Nov 16 10:38:03 2022 +0200 Add documentation page about error handling and logging. (#2681)
1d105727c Wed Nov 16 11:13:56 2022 +0200 perf: simple walredo bench (#2816)
c4b417ecd Wed Nov 16 11:28:37 2022 +0200 Introduce aws-sdk-rust as rusoto S3 replacement (#2802)
53267969d Wed Nov 16 11:28:57 2022 +0100 Preparation for ARM runners (#2751)
3f93c6c6f Wed Nov 16 13:16:00 2022 +0200 Improve checks for broken tenants in test_broken_timeline.py
d013a2b22 Wed Nov 16 13:24:02 2022 +0200 Make test_gc_cutoff test more robust.
aca221ac8 Wed Nov 16 16:54:55 2022 +0400 Switch old staging to new etcd (#2834)
9ae4da4f3 Wed Nov 16 15:50:49 2022 +0200 Silence test failure caused by race condition between GC and detach.
5184685ce Wed Nov 16 15:10:36 2022 +0000 Revert "Introduce aws-sdk-rust as rusoto S3 replacement (#2802)" (#2837)
2b728bc69 Wed Nov 16 15:14:36 2022 +0000 test_forward_compatibility: fix path to pg_distrib_dir (#2826)
150bddb92 Wed Nov 16 19:51:37 2022 +0200 Clean up process start/stop handling
0a87d7129 Wed Nov 16 17:57:48 2022 +0000 test_runner: make proxy mgmt port mandatory (#2839)
24d3ed095 Thu Nov 17 12:42:56 2022 +0200 Ignore another ERROR that's expected in test.
4a60051b0 Thu Nov 17 14:31:34 2022 +0000 Add codeowners section for /vendor/ (#2849)
60ac22719 Thu Nov 17 14:48:21 2022 +0000 Use modern flex and bison in macOS compilations (#2847)
fd99e0fbc Fri Nov 18 09:10:32 2022 +0200 Build pg_prewrm extension (#2794)
dcb79ef08 Fri Nov 18 10:18:15 2022 +0200 Silence yet another test failure from race condition between GC and delete.
328ec1ce2 Fri Nov 18 11:44:00 2022 +0200 Print a more full error message, with stack trace, on GC failure.
b9152f1ef Fri Nov 18 15:04:58 2022 +0200 Correctly terminate prefetch in case of pageserver restart (#2850)
2655bdbb2 Fri Nov 18 09:05:13 2022 -0500 Add remote seqscans test (#2840)
d783889a1 Fri Nov 18 17:15:34 2022 +0100 timeline: explicit tracking of flush loop state: NotStarted, Running, Exited
f564dff0e Fri Nov 18 17:15:34 2022 +0100 make test_tenant_detach_smoke fail reproducibly
e28eda793 Fri Nov 18 22:30:41 2022 +0000 sourcetree/docs: mention hakari generate (#2864)
a50a7e8ac Sat Nov 19 01:19:09 2022 +0200 Try to silence test_gc_cutoff flakiness.
3f3932762 Sat Nov 19 14:11:04 2022 +0200 Silence a few compiler warnings
ed40a045c Sat Nov 19 14:12:21 2022 +0200 Add more logging to track down test_gc_cutoff failure.
684329d4d Sat Nov 19 19:28:56 2022 +0200 Another attempt at silencing test_gc_cutoff failures.
cb9b26776 Sat Nov 19 23:39:42 2022 +0000 Fix test_seqscans on remote cluster (#2869)
6c97fc941 Mon Nov 21 16:24:19 2022 +0100 Enable passing FAILPOINTS at startup.
6b2bc7f77 Mon Nov 21 15:25:09 2022 +0000 Nightly Benchmarks: Add RDS Postgres (#2859)
c6f095a82 Mon Nov 21 17:21:47 2022 -0500 Fix remote seqscan test (#2878)
a5b898a31 Tue Nov 22 02:28:41 2022 +0200 Fix the order of checks in LSN (#2882)
a63ebb644 Tue Nov 22 10:46:21 2022 +0200 Update vendor postgres to 14.6 and 15.1
74ec36a1b Tue Nov 22 10:55:02 2022 +0100 Add pageserver-1.us-east-2.aws.neon.build (#2881)
f50d0ec0c Tue Nov 22 11:30:34 2022 +0100 test_runner: ignore 'sender is dropped while join handle is still alive' warnings
86e483f87 Tue Nov 22 17:11:27 2022 +0200 Fix tenant size modeling code to include WAL at end of branch
9470bc9fe Tue Nov 22 18:50:57 2022 +0300 [proxy] Implement per-tenant traffic metrics
4bf3087ae Tue Nov 22 21:10:49 2022 +0100 [pageserver] list `latest_gc_cutoff_lsn` in the OpenAPI spec (#2894)
e9f4ca597 Wed Nov 23 00:40:17 2022 +0200 Remove references to obsolete files in .gitignore
37625c443 Wed Nov 23 00:40:17 2022 +0200 Remove obsolete design doc.
1af087449 Wed Nov 23 08:41:22 2022 +0200 Reduce max_replication_write_lag to 10Mb (#1793)
85f0975c5 Wed Nov 23 10:54:39 2022 +0100 Setup eu-west-1 as region for PR testing (#2757)
de8f24583 Wed Nov 23 16:58:31 2022 +0200 Remove obsolete 'zenith_ctl' alias from compute images
21ec28d9b Wed Nov 23 17:51:35 2022 +0200 Add bulk update test (#2902)
a6e4a3c3e Wed Nov 23 18:46:07 2022 +0200 Implement corrent truncation of FSM/VM forks on arbitrary position (#2609)
aee3eb6d1 Wed Nov 23 18:11:44 2022 +0100 Deploy link proxy to us-east-2 (#2905)
2d42f8438 Wed Nov 23 22:05:59 2022 +0400 Add storage_broker binary.
05db6458d Wed Nov 23 23:03:29 2022 +0300 [proxy] Fix project (endpoint) -related error messages
99d9c23df Thu Nov 24 12:26:15 2022 +0200 Gather path-related consts and functions to one place.
5bca7713c Thu Nov 24 12:26:15 2022 +0200 Improve comments on TenantStates
46ea2a8e9 Thu Nov 24 14:02:23 2022 +0300 Continue #2724: replace `Url`-based `PgConnectionConfig` with a hand-crafted struct
b6989e892 Thu Nov 24 14:02:23 2022 +0300 pageserver: make `wal_source_connstring: String` a 'wal_source_connconf: PgConnectionConfig`
9c886ac0a Thu Nov 24 12:41:38 2022 +0100 Use per-cluster DNS name for link proxy (#2911)
47734fdb0 Thu Nov 24 18:43:34 2022 +0300 [proxy] Move some tests to a dedicated module
0b0cb77da Thu Nov 24 20:07:41 2022 +0400 Fix deploy after 2d42f843892d2.
e6db4b63e Thu Nov 24 17:19:01 2022 +0100 [safekeeper] Serialize LSN in the `term_history` according to the spec (#2896)
a40678309 Fri Nov 25 04:17:42 2022 +0300 neon_fixtures: refactor AuthKeys to support more scopes
2ce5d8137 Fri Nov 25 04:17:42 2022 +0300 Separate permission checks for Pageserver and Safekeeper
10d554fcb Fri Nov 25 04:17:42 2022 +0300 walproposer: refactor safekeeper::conninfo initialization
1ca76776d Fri Nov 25 04:17:42 2022 +0300 pageserver: require management permissions on HTTP /status
ae53dc332 Fri Nov 25 04:17:42 2022 +0300 Add authentication between Safekeeper and Pageserver/Compute
aeeb78234 Fri Nov 25 15:59:15 2022 +0000 Make test runner compatible with Python 3.11 (#2915)
1a316a264 Fri Nov 25 16:05:45 2022 +0000 Disable statement timeout for performance tests (#2891)
15db56642 Fri Nov 25 20:14:06 2022 +0200 Allow setting gc/compaction_period to 0, to disable automatic GC/compaction
9fdd228de Fri Nov 25 18:18:08 2022 +0000 GitHub Actions: Add branch related actions (#2877)
480175852 Fri Nov 25 18:41:26 2022 +0000 Nightly Benchmarks: add OLAP-style benchmark (clickbench) (#2855)
0205a4426 Mon Nov 28 11:04:25 2022 +0200 Remove obsolete TODO and settings in test
67469339f Mon Nov 28 11:05:20 2022 +0200 When new timeline is created, don't wait for compaction. (#2931)
3ba92d238 Mon Nov 28 12:08:04 2022 +0000 Nightly Benchmarks: Fix default db name and clickbench-compare trigger (#2938)
0c1195c30 Mon Nov 28 15:34:07 2022 +0100 Fix #2937 (#2940)
0a4e5f8aa Mon Nov 28 17:21:35 2022 +0100 Setup legacy scram proxy in us-east-2 (#2943)
52166799b Mon Nov 28 20:27:43 2022 +0400 Put .proto compilation result to $OUT_DIR/
f27714023 Tue Nov 29 10:29:25 2022 +0200 Small fixes (#2949)
fb633b16a Tue Nov 29 11:38:24 2022 +0000 neon-project-create: change default region for staging (#2951)
1f1324ebe Tue Nov 29 14:10:45 2022 +0200 Require tenant to be active when calculating tenant size.
fbd5f6593 Tue Nov 29 14:10:45 2022 +0200 Misc cosmetic fixes in comments, messages.
baa8d5a16 Tue Nov 29 14:32:01 2022 +0200 Test that physical size is the same before and after re-attaching tenant.
9a6c0be82 Tue Nov 29 18:55:20 2022 +0100 storage_sync2
33834c01e Wed Nov 30 01:10:16 2022 +0200 Rename Paused states to Stopping.
136b029d7 Wed Nov 30 09:19:59 2022 +0000 neon-project-create: fix project creation (#2954)
ebb51f16e Wed Nov 30 17:47:32 2022 +0200 Re-introduce aws-sdk-rust as rusoto S3 replacement (#2841)
b9544adcb Wed Nov 30 13:48:07 2022 -0500 Add layer map search benchmark (#2957)
edfebad3a Thu Dec 1 12:08:56 2022 +0200 Add test that importing an empty file fails.
d9ab42013 Thu Dec 1 12:16:15 2022 +0200 Resend prefetch request in case of pageserver restart (#2974)
faf1d20e6 Thu Dec 1 16:38:52 2022 +0200 Don't remove PID file in neon_local, and wait after "pageserver init". (#2983)
fe280f70a Thu Dec 1 13:29:21 2022 -0500 Add synthetic layer map bench (#2979)
c21104465 Thu Dec 1 22:27:18 2022 +0200 Fix copying relation in walloged create database in PG15 (#2986)
d90b52b40 Fri Dec 2 11:47:50 2022 +0100 Update README
145e7e4b9 Fri Dec 2 13:35:01 2022 +0100 Prefetch cleanup: (#2876)
788823ebe Fri Dec 2 17:59:26 2022 +0000 Fix named_arguments_used_positionally warnings (#2987)
ed27c9802 Sat Dec 3 13:11:02 2022 +0000 Nightly Benchmarks: use new prefetch settings (#3000)
4f443c339 Sat Dec 3 15:30:55 2022 +0000 Tone down retry error logs (#2999)
ab073696d Mon Dec 5 10:56:01 2022 +0000 test_bulk_update: use new prefetch settings (#3007)
79fdd3d51 Mon Dec 5 13:56:04 2022 +0200 Fix #2907: Change missing_layers property to optional in the IndexPart struct (#3005)
38af45355 Mon Dec 5 22:48:45 2022 +0200 Use async RwLock around tenants (#3009)
7a9cb75e0 Mon Dec 5 22:52:42 2022 +0200 Replace dynamic dispatch with static dispatch
b38473d36 Mon Dec 5 22:52:42 2022 +0200 Remove RelativePath conversions
c0480facc Mon Dec 5 22:52:42 2022 +0200 Rename RelativePath to RemotePath
61825dfb5 Tue Dec 6 15:45:58 2022 +0100 Update chrono to 0.4.23; use only clock feature from it
046ba67d6 Tue Dec 6 11:27:46 2022 -0400 Update README.md (#3015)
d6bfe955c Tue Dec 6 15:30:02 2022 +0000 Add commands to unload and load the tenant in memory (#2977)
98ff0396f Tue Dec 6 18:44:07 2022 +0300 tone down error log for successful process termination
4530544bb Tue Dec 6 18:17:48 2022 +0100 draw_timeline_dirs: accept paths as input
8f2b3cbde Tue Dec 6 18:57:54 2022 +0000 Sentry integration for storage. (#2926)
634d0eab6 Tue Dec 6 21:09:54 2022 +0200 pass availability zone to console during pageserver registration (#2991)
09393279c Tue Dec 6 23:52:16 2022 +0200 Fix tenant config parsing
6a57d5bbf Tue Dec 6 23:52:16 2022 +0200 Make the request tracing test more useful
b447eb4d1 Wed Dec 7 12:56:42 2022 +0200 Add postgres-v15 to source tree documentation (#3023)
b51361950 Wed Dec 7 13:13:54 2022 +0200 Remove obsolete 'awaits_download' field.
c74dca95f Wed Dec 7 14:24:07 2022 +0200 Helm values for old staging and one region in new staging (#2922)
a46a81b5c Wed Dec 7 15:03:39 2022 +0200 Fix updating "trace_read_requests" with /v1/tenant/config mgmt API.
6dfd7cb1d Wed Dec 7 17:15:51 2022 +0200 Neon storage broker helm value fixes (#3025)
ac0c167a8 Wed Dec 7 18:24:12 2022 +0100 improve pidfile handling
b50e0793c Wed Dec 7 23:11:02 2022 +0200 Rework remote_storage interface (#2993)
e1ef62f08 Thu Dec 8 09:12:38 2022 +0200 Print more information about context of failed walredo requests (#3003)
0d04cd0b9 Thu Dec 8 09:49:43 2022 +0100 Run compaction on the buffer holding received buffers when useful (#3028)
f5a735ac3 Thu Dec 8 12:24:24 2022 +0100 Add proxy and broker to us-west-2 (#3027)
2baf6c09a Thu Dec 8 15:54:59 2022 +0300 Some more allowed pageserver errors.
4de421724 Thu Dec 8 14:50:59 2022 +0000 Bump certifi from 2022.9.24 to 2022.12.7 (#3033)
5c701f9a7 Thu Dec 8 15:13:40 2022 +0000 merge-allure-report: create report even if benchmarks is skipped (#3029)
a19c48776 Thu Dec 8 15:32:49 2022 +0000 Nightly Benchmarks: add TPC-H benchmark (#2978)
9747e90f3 Thu Dec 8 22:28:25 2022 +0000 Nightly Benchmarks: Move from captest to staging (#2838)
475238547 Fri Dec 9 11:02:23 2022 +0200 Update PostgreSQL to latest vendored releases (#3037)
3122f3282 Fri Dec 9 12:07:50 2022 +0300 Ignore backup files (ones with .n.old suffix) in download_missing
6c8b2af1f Fri Dec 9 11:12:42 2022 +0200 Change storage brokers to internal subdomain (#3039)
28667ce72 Fri Dec 9 12:35:36 2022 +0300 Make safekeeper exit code 0.
3321eea67 Fri Dec 9 14:26:05 2022 +0100 Fix for #3043 (#3048)
8684b1b58 Fri Dec 9 14:37:53 2022 +0000 Reduce the storage-broker deployment timeout to 5 minutes. 15 minutes is (#3047)
4d6137e0e Fri Dec 9 20:43:54 2022 +0300 Try to fix docker image tag in broker deploy.
861dc8e64 Fri Dec 9 22:14:32 2022 +0200 Remove redundant once_cell usages
b8a5664fb Sat Dec 10 00:35:05 2022 +0200 test: kill spawned postgres (#3054)
700a36ee6 Sat Dec 10 10:18:55 2022 +0200 Wait for certain tenant status in the remote storage test (#3055)
0f445827f Sat Dec 10 23:35:05 2022 +0000 test_seqscans: increase table size for remote test (#3057)
249d77c72 Mon Dec 12 13:00:37 2022 +0300 Deploy broker with L4 LB on old envs.
32662ff1c Mon Dec 12 13:30:16 2022 +0300 Replace etcd with storage_broker.
a1fd0ba23 Mon Dec 12 13:30:16 2022 +0300 set tag to make proper e2e tests run
26f4ff949 Mon Dec 12 13:30:16 2022 +0300 Add sentry to storage_broker.
0aa2f5c9a Mon Dec 12 12:58:55 2022 +0200 Regroup CI testing (#3049)
f013d5323 Mon Dec 12 16:25:23 2022 +0300 Switch to clap derive API in safekeeper.
d1edc8aa0 Mon Dec 12 16:55:40 2022 +0100 Deprecate old runner for deploy job (#3070)
22ae67af8 Tue Dec 13 01:27:59 2022 +0200 refactor: use new type LayerFileName when referring to layer file names in PathBuf/RemotePath (#3026)
e2ae4c09a Tue Dec 13 09:53:22 2022 +0300 Put e2e tag back.
544777e86 Tue Dec 13 10:57:26 2022 +0300 Fix storage_broker deploy typo.
d6325aa79 Tue Dec 13 13:06:30 2022 +0300 Disable body size limit in ingress broker deploy.
7a16cde73 Tue Dec 13 12:06:20 2022 +0000 Remove useless pub trait method (#3076)
e5d523c86 Tue Dec 13 14:11:40 2022 +0100 Add new us-west-2 region (#3071)
607c0facf Tue Dec 13 16:16:31 2022 +0300 [proxy] Propagate more console API errors to the user
02c1c351d Tue Dec 13 15:42:59 2022 +0200 Create initial timeline without remote storage (#3077)
4603a4cbb Tue Dec 13 14:52:04 2022 +0100 Bypass SENTRY_ENVIRONMENT variable in order to filter panics in sentry by environment.
feb07ed51 Tue Dec 13 14:01:29 2022 +0000 deploy (old): replace actions/setup-python@v4 with ansible image (#3081)
0c915dcb1 Tue Dec 13 15:53:08 2022 +0100 Timeline::download_missing: fix handling of mismatched layer size
0bc488b72 Tue Dec 13 16:26:28 2022 +0100 Add sentry environment for pageserver and safekeepers in new region (us-west-2)
b39d6126b Tue Dec 13 21:57:39 2022 +0300 Force ansible to use local ansible.cfg (#3089)
826214ae5 Tue Dec 13 21:06:18 2022 +0100 Force ansible-galaxy to also use local ansible.cfg (#3091)
228f9e432 Tue Dec 13 23:59:49 2022 +0100 Use default folder for ansible collections (#3092)
c819b699b Tue Dec 13 23:02:45 2022 +0000 Nightly Benchmark: run neon-captest-reuse from staging (#3086)
827ee10b5 Wed Dec 14 01:51:42 2022 +0100 Disable neon-stress deploy (#3093)
f8ab5ef3b Wed Dec 14 12:58:12 2022 +0100 Update broker endpoint for prod-us-west-2. (#3095)
ada5b7158 Wed Dec 14 14:09:16 2022 +0200 Fix Issue #3014  (#3059)
d3787f9b4 Wed Dec 14 13:04:04 2022 +0000 neon-project-create/delete: print project id to stdout (#3073)
4d201619e Wed Dec 14 13:09:08 2022 +0000 Remove large database files after every test suite (#3090)
62f6e969e Wed Dec 14 16:41:26 2022 +0100 Fix helm value for proxy
df09d0375 Wed Dec 14 19:00:19 2022 +0300 ignore metadata_backup files in index_part
8fcba150d Wed Dec 14 18:05:05 2022 +0000 test_seqscans: temporarily disable remote test (#3101)
4132ae9df Wed Dec 14 19:25:29 2022 +0100 always remove RemoteTimelineClient's metrics when dropping it
c04c20152 Wed Dec 14 21:28:14 2022 +0100 Push proxy metrics to Victoria Metrics (#3106)
bf3ac2be2 Thu Dec 15 09:48:35 2022 +0100 add remote_physical_size metric
10cd64cf8 Thu Dec 15 10:26:17 2022 +0100 make TaskHandle::next_task_event cancellation-safe
397b60fea Thu Dec 15 11:50:39 2022 +0100 common abstraction for waiting for SK commit_lsn to reach PS
807b11094 Thu Dec 15 17:06:17 2022 +0000 Update Makefile configuration: (#3011)
b58f7710f Thu Dec 15 18:19:43 2022 +0100 seqwait: different error messages per variant
70ce01d84 Thu Dec 15 22:42:30 2022 +0100 Deploy broker with L4 LB in new env. (#3125)
6dec85b19 Fri Dec 16 11:05:55 2022 +0200 Redefine the timeline_gc API to not perform a forced compaction
c26239021 Fri Dec 16 11:05:55 2022 +0200 Don't upload index file when GC doesn't remove anything.
e14bbb889 Fri Dec 16 11:55:12 2022 +0200 Enable broker client keepalives. (#3127)
b688a538e Fri Dec 16 13:40:01 2022 +0200 fix(remote_storage): use cached credentials (#3128)
8d39fcdf7 Fri Dec 16 13:23:36 2022 +0000 pgbench-compare: don't run neon-captest-new (#3130)
c86c0c08e Fri Dec 16 17:19:47 2022 +0200 task_mgr: use CancellationToken instead of shutdown_rx (#3124)
64775a0a7 Fri Dec 16 17:45:38 2022 +0000 test_runner/performance: fix flush for NeonCompare (#3135)
83baf4948 Fri Dec 16 21:37:50 2022 +0300 [proxy] Forward compute connection params to client
3514e6e89 Fri Dec 16 21:14:57 2022 +0100 Use neon_nblocks instead of get_cached_relsize (#3132)
61194ab2f Sat Dec 17 00:26:10 2022 +0300 Update rust-postgres everywhere
12e6f443d Sun Dec 18 00:02:04 2022 +0000 test_perf_pgbench: switch to server-side data generation (#3058)
e23d5da51 Mon Dec 19 14:03:22 2022 +0200 Tidy up and add comments to the pageserver startup code.
c785a516a Mon Dec 19 14:37:40 2022 +0100 remove TimelineInfo.{Remote,Local} along with their types
ee2b5dc9a Mon Dec 19 16:14:58 2022 +0100 [1/4] initial logical size calculation: if it fails, retry on next call
40a3d5088 Mon Dec 19 16:14:58 2022 +0100 [2/4] add test to show that tenant detach makes us leak running size calculation task
38ebd6e7a Mon Dec 19 16:14:58 2022 +0100 [3/4] make initial size estimation task sensitive to task_mgr shutdown requests
7db018e14 Mon Dec 19 16:14:58 2022 +0100 [4/4] the fix: do not leak spawn_blocking() tasks from logical size calculation code
49a211c98 Mon Dec 19 21:43:36 2022 +0200 Add neon_local test
9ddd1d752 Mon Dec 19 21:43:36 2022 +0200 Stop all storage nodes on startup failure
3735aece5 Mon Dec 19 21:43:36 2022 +0200 Safekeeper: Always use workdir as a full path
39f58038d Mon Dec 19 23:58:24 2022 +0200 Don't upload index file in compaction, if there was nothing to do. (#3149)
f9f57e211 Tue Dec 20 01:55:59 2022 +0200 Use local brokers
56d8c25dc Tue Dec 20 01:57:36 2022 +0200 Revert "Use local brokers"
6ac9ecb07 Tue Dec 20 12:52:26 2022 +0200 Remove a few unnecessary checkpoint calls from unit tests.
7b0d28bbd Tue Dec 20 12:52:26 2022 +0200 Update outdated comment on Tenant::gc_iteration.
cd7fdf258 Tue Dec 20 12:03:42 2022 +0100 Remove neon-stress configs (#3121)
2c11f1fa9 Tue Dec 20 11:06:21 2022 +0000 Use separate broker per Python test (#3158)
eefb1d46f Tue Dec 20 13:45:47 2022 +0200 Replace Timeline::checkpoint with Timeline::freeze_and_flush
4cda9919b Tue Dec 20 14:27:24 2022 +0200 Use Self to emphasize this is a constructor
8e2edfcf3 Tue Dec 20 14:27:24 2022 +0200 Retry remote downloads.
0c71dc627 Tue Dec 20 15:54:02 2022 +0200 Tidy up walreceiver logs (#3147)
9a049aa84 Tue Dec 20 20:50:55 2022 +0200 Move code from tenant_mgr::delete_timeline to Tenant::delete_timeline.
43fd89eaa Tue Dec 20 20:50:55 2022 +0200 Improve comments, formatting around layer_removal_cs lock.
4235f97c6 Tue Dec 20 22:59:52 2022 +0200 Implement consumption metrics collection.
5d4774491 Wed Dec 21 00:52:07 2022 +0200 Exclude macOs fork files from tar processing (#3165)
486a98562 Wed Dec 21 09:38:42 2022 +0000 mypy: enable check_untyped_defs (#3142)
a3f011172 Wed Dec 21 12:14:55 2022 +0100 LayerMap::search is actually infallible
f637f6e77 Wed Dec 21 15:37:29 2022 +0100 stop exposing non-incremental sizes in API spec
91e893711 Wed Dec 21 19:16:39 2022 +0100 no-op: add Timeline::myself member
f5b424b96 Wed Dec 21 19:16:39 2022 +0100 no-op: type aliases for Layer::iter and Layer::key_iter return types
e94b45143 Wed Dec 21 19:16:39 2022 +0100 no-op: storage_layer::Iter::{iter, key_iter}: make them fallible
749a2f00d Wed Dec 21 19:16:39 2022 +0100 no-op: distinguished error types for Timeline::get_reconstruct_data
246098732 Wed Dec 21 19:16:39 2022 +0100 no-op: pgdatadir_mapping: qualified use of anyhow::Result
1da03141a Wed Dec 21 19:16:39 2022 +0100 refactor: make Layer::local_path return Option<PathBuf> instead of PathBuf
31543c4ac Wed Dec 21 19:16:39 2022 +0100 refactor: make update_gc_info and transitive callers async
7ff591ffb Wed Dec 21 19:16:39 2022 +0100 On-Demand Download
f5f1197e1 Thu Dec 22 11:25:56 2022 +0100 Build vm-compute-node images (#3174)
fca25edae Thu Dec 22 14:27:48 2022 +0200 Fix 1.66 Clippy warnings (#3178)
707d1c1c9 Thu Dec 22 13:34:16 2022 +0100 Fix vm-compute-image upload to dockerhub (#3181)
201fedd65 Thu Dec 22 12:40:39 2022 +0000 tpch-compare: use rust image instead of rustlegacy (#3182)
5a762744c Thu Dec 22 16:01:49 2022 +0200 Collect core dump backtraces in compute_ctl.
9b7121590 Thu Dec 22 15:05:43 2022 +0100 Simplify some functions in compute_tools and fix typo errors in func name
63eb87bde Thu Dec 22 16:24:09 2022 +0200 Set default metric_collection_interval to 10 min, which is more reasonable for real usage
8544c5932 Thu Dec 22 16:28:11 2022 +0200 Fix flaky test_metrics_collection.py Only check that all metrics are present on the first request, because pageserver doesn't send unchanged metrics.
5a496d82b Thu Dec 22 15:37:17 2022 +0100 Do not deploy storage and proxies to old staging (#3180)
72ab10473 Thu Dec 22 15:21:53 2022 +0000 Move zenith-1-sk-3 to zenith-1-sk-4 (#3164)
7bc17b373 Thu Dec 22 16:28:36 2022 +0100 Fix calculate-deploy-targets (#3189)
c01f92c08 Thu Dec 22 20:09:45 2022 +0100 Fully remove old staging deploy (#3191)
0bafb2a6c Fri Dec 23 15:39:59 2022 +0200 Do more on-demand downloads where needed (#3194)
b77c33ee0 Fri Dec 23 15:40:37 2022 +0200 Move tenant-related modules below `tenant` module (#3190)
1468c65ff Fri Dec 23 18:04:45 2022 +0200 Enable billing metric_collection_endpoint on staging
1137b58b4 Mon Dec 26 18:21:41 2022 +0200 Fix LayerMap::search to not return delta layer preceeding image layer (#3197)
5826e19b5 Tue Dec 27 10:25:19 2022 +0100 update the grafana links in the PR release template (#3156)
140c0edac Tue Dec 27 14:42:51 2022 +0200 Yet another port of local file system cache (#2622)
1ad6e186b Tue Dec 27 20:19:12 2022 +0300 Refuse ProposerElected if it is going to truncate correct WAL.
fee8bf3a1 Tue Dec 27 20:19:12 2022 +0300 Remove global_commit_lsn.
f6bf7b200 Tue Dec 27 20:19:12 2022 +0300 Add tenant_id to safekeeper spans.
0c7b02ebc Wed Dec 28 09:20:01 2022 +0200 Move tenant related files to tenant directory (#3214)
172c7e5f9 Wed Dec 28 15:12:06 2022 +0200 Split upload queue code from storage_sync.rs (#3216)
42c6ddef8 Thu Dec 29 03:33:43 2022 +0300 Rename ZENITH_AUTH_TOKEN to NEON_AUTH_TOKEN
bd7a9e627 Thu Dec 29 13:01:17 2022 +0300 switch to debug from info to produce less noise
f731e9b3d Thu Dec 29 12:11:04 2022 +0200 Fix serialization of billing metrics (#3215)
0e7c03370 Thu Dec 29 12:20:28 2022 +0200 Lazy calculation of traversal_id which is needed only for error repoting (#3221)
c0290467f Thu Dec 29 12:33:30 2022 +0200 Fix #2907 Remove missing_layers from IndexPart (#3217)
894ac3073 Thu Dec 29 14:25:47 2022 +0200 Rename billing_metrics to consumption_metrics. Use more appropriate term, because not all of these metrics are used for billing.
434fcac35 Thu Dec 29 13:59:40 2022 +0100 Remove unused HTTP endpoints from compute_ctl
fefe19a28 Thu Dec 29 16:23:25 2022 +0200 Avoid calling find_lsn_for_timestamp call while holding lock.
890ff3803 Thu Dec 29 16:23:25 2022 +0200 Allow update_gc_info to download files on-demand.
8ff7bc5df Thu Dec 29 19:13:54 2022 +0200 Add timleline_logical_size metric. Send this metric only when it is fully calculated.
7c7d225d9 Thu Dec 29 20:29:42 2022 +0300 add pageserver to new region see https://github.com/neondatabase/aws/pull/116
c700c7db2 Thu Dec 29 22:25:52 2022 +0300 [proxy] Add more labels to the pricing metrics
cb6194498 Sat Dec 31 02:27:08 2022 +0300 Safekeeper: refactor auth validation
9f94d098a Sat Dec 31 02:27:08 2022 +0300 Remove unused AuthType::MD5
3468db8a2 Mon Jan 2 08:47:28 2023 +0100 Bump setuptools from 65.5.0 to 65.5.1 (#3212)
81afd7011 Mon Jan 2 11:14:35 2023 +0200 Use rustls for everything.
41b8e6730 Mon Jan 2 15:29:33 2023 +0300 Fix 81afd7011 by enabling reqwest feature for sentry.
56a4466d0 Mon Jan 2 14:34:06 2023 +0200 Run Python tests in 8 threads (#3206)
6fd64cd5f Mon Jan 2 15:37:05 2023 +0300 Allow failure to report metrics in test_metric_collection.
a9cca7a0f Mon Jan 2 16:51:05 2023 +0200 Use proper error code for BeMessage error responses (#3240)
182dc785d Mon Jan 2 18:05:23 2023 +0200 Set PITR  default to 7 days (#3245)
4c4d3dc87 Mon Jan 2 22:14:05 2023 +0400 Add new pageserver to us-east-2 staging (#3248)
5bc9f8eae Tue Jan 3 11:05:23 2023 +0100 README: Fedora needs protobuf-devel
0a0e55c3d Tue Jan 3 12:39:11 2023 +0200 Replace 'tar' crate with 'tokio-tar' (#3202)
8b692e131 Tue Jan 3 14:44:42 2023 +0200 Enable on-demand download in WalIngest. (#3233)
0b428f7c4 Tue Jan 3 15:11:50 2023 +0100 Enable licenses check for 3rd-parties
e9583db73 Tue Jan 3 20:11:32 2023 +0200 Remove code and test to generate flamegraph on GetPage requests. (#3257)
10dae79c6 Tue Jan 3 20:42:04 2023 +0000 Tone down safekeeper and pageserver walreceiver errors (#3227)
efad64bc7 Wed Jan 4 10:45:11 2023 +0000 Expect compute shutdown test log error (#3262)
8932d14d5 Wed Jan 4 17:31:51 2023 +0200 Revert "Run Python tests in 8 threads (#3206)" (#3264)
f436fb2df Wed Jan 4 17:26:42 2023 +0100 Fix panics at compute_ctl:monitor
8c6e60732 Wed Jan 4 23:03:16 2023 +0200 Refactor send_tarball() (#3259)
6a9d1030a Thu Jan 5 11:08:50 2023 +0100 use RemoteTimelineClient for downloading index part during tenant_attach
d7f1e3011 Thu Jan 5 11:50:17 2023 +0100 remote_timeline_client: more metrics & metrics-related cleanups
8712e1899 Thu Jan 5 17:48:27 2023 +0200 Move initial timeline creation into pytest (#3270)
c187de110 Thu Jan 5 18:51:47 2023 +0200 Copy error message before it's freed.
8b710b975 Thu Jan 5 18:51:47 2023 +0200 Fix segfault if pageserver connection is lost during backend startup.
b6237474d Fri Jan 6 12:26:14 2023 +0200 Fix README and basic startup example (#3275)
df42213db Fri Jan 6 17:07:46 2023 +0200 Fix missing COMMIT in handle_role_deletions.
debd134b1 Fri Jan 6 18:34:18 2023 +0300 Implement wss support in proxy (#3247)
af9425394 Fri Jan 6 17:50:44 2023 +0200 Print time taken by CREATE/ALTER DATABASE at compute start.
3526323bc Fri Jan 6 19:42:25 2023 +0200 prepare Timeline::get_reconstruct_data for becoming async  (#3271)
23d5e2bda Sat Jan 7 00:46:42 2023 +0200 Fix common pg port in the CLI basics test (#3283)
7920b39a2 Mon Jan 9 10:24:50 2023 +0200 Adding transition reason to the log when a tenant is moved to Broken state  (#3289)
93c77b038 Mon Jan 9 15:40:14 2023 +0400 Use GHA environment for per-region deploy approvals on staging (#3293)
3a22e1335 Mon Jan 9 12:15:53 2023 +0000 Adding a PR template (#3288)
a457256fe Mon Jan 9 14:25:12 2023 +0200 Fix log message matching (#3291)
d4d0aa6ed Mon Jan 9 13:53:59 2023 +0100 gc_iteration_internal: better log message & debug log level if nothing to do
14df37c10 Mon Jan 9 20:18:16 2023 +0400 Use GHA environments for gradual prod rollout (#3295)
8c07ef413 Mon Jan 9 18:56:50 2023 +0200 Minor cleanup of test_ondemand_download_timetravel test.
8eebd5f03 Mon Jan 9 19:08:22 2023 +0100 run on-demand compaction in a task_mgr task
0807522a6 Mon Jan 9 19:56:12 2023 +0000 Enable wss proxy in all regions (#3292)
80d4afab0 Tue Jan 10 09:02:00 2023 +0100 Update tokio version (RUSTSEC-2023-0001)
95bf19b85 Tue Jan 10 10:05:27 2023 +0000 Add --atomic to all helm upgrade operations (#3299)
c1731bc4f Thu Jan 12 11:53:10 2023 +0200 Push on-demand download into Timeline::get() function itself.
a0ee306c7 Thu Jan 12 12:41:53 2023 +0100 Enable safe contrib extensions
f49e923d8 Thu Jan 12 15:33:07 2023 +0300 Keep deleted timelines in memory of safekeeper (#3300)
29a246527 Thu Jan 12 15:16:52 2023 +0100 Update rust version in toolchain
d7c41cbbe Thu Jan 12 17:37:15 2023 +0200 Replace tokio::watch with CancellationToken.
1983c4d4a Thu Jan 12 18:12:40 2023 +0200 Explain prefetch (#3002)
0cceb14e4 Thu Jan 12 19:05:13 2023 +0200 Add a FIXME on ugly error message parsing.
57a6e931e Thu Jan 12 19:05:13 2023 +0200 Comment, formatting and other cosmetic cleanup.
bb406b21a Thu Jan 12 19:23:59 2023 +0100 Fix issue in compaction code (#3246)
fe8cef342 Thu Jan 12 21:27:34 2023 +0200 Use ready! rustc 1.64 macro (#3315)
dec875fee Thu Jan 12 21:51:49 2023 +0100 Disable postgis_sfcgal
c28bfd4c6 Thu Jan 12 23:03:21 2023 +0000 Nightly Benchmarks: add user provided example (#3308)
9ce5ada89 Fri Jan 13 10:23:35 2023 +0200 Do not report position in SMGR message (#3307)
ba0190e3e Fri Jan 13 11:51:28 2023 +0200 Handle errors in tenant_size_model code
0675859bb Fri Jan 13 11:51:28 2023 +0200 Add background worker that periodically spawns synthetic size calculation. Add new pageserver config param calculate_synthetic_size_interval
148e020fb Fri Jan 13 11:51:28 2023 +0200  Fix logical size calculation:     sort updates in topological order so that the parent timeline always preceeds its children.     fixes #3179
26f39c03f Fri Jan 13 11:51:28 2023 +0200 review code cleanup:
5e3e0fbf6 Fri Jan 13 11:51:28 2023 +0200 remove unneeded Cargo.lock changes
c6d383e23 Fri Jan 13 11:51:28 2023 +0200 code cleanup
99808558d Fri Jan 13 12:05:54 2023 +0000 Avoid duplicate timeline insert (#3326)
16baa91b2 Fri Jan 13 13:24:34 2023 +0100 Add more information about `cargo deny`
bce4233d3 Fri Jan 13 18:13:34 2023 +0200 Rework Cargo.toml dependencies (#3322)
84ffdc8b4 Mon Jan 16 19:03:38 2023 +0400 Don't keep FDs open on cancelled timelines in safekeepers.
5c6a7a17c Mon Jan 16 07:05:29 2023 -0800 Add VM informant to vm-compute-node (#3324)
2cbe84b78 Mon Jan 16 15:17:28 2023 +0000 Proxy metrics (#3290)
5f1bd0e8a Mon Jan 16 17:24:13 2023 +0200 Add documentation for consumption metrics
3c571ecde Mon Jan 16 17:24:13 2023 +0200 Update docs/consumption_metrics.md
6ac5656be Mon Jan 16 17:04:51 2023 +0100 Enable earthdistance extension
a8a9bee60 Mon Jan 16 18:24:45 2023 +0200 walredo: simple tests and bench updates (#3045)
424fd0bd6 Mon Jan 16 12:32:00 2023 -0400 Update auth.rs (#3349)
431e464c1 Mon Jan 16 19:15:59 2023 +0200 Consumption metering RFC
4c6b50747 Mon Jan 16 17:22:17 2023 +0000 Update Postgres clients we test (#3359)
58c8c1076 Mon Jan 16 19:29:06 2023 +0100 download_all_remote_layers API: require client to specify max_concurrent_downloads
e067cd294 Mon Jan 16 21:15:42 2023 +0200 Enable metric collection for proxy on staging
48dd9565a Tue Jan 17 09:42:22 2023 +0100 TaskHandle: tone down `sender is dropped while join handle is still alive`
f8e887830 Tue Jan 17 10:38:33 2023 +0100 build: Use `curl -f` on vm-informant download (#3363)
1ebd145c2 Tue Jan 17 13:30:42 2023 +0200 Actualize the comment (#3362)
63e3b815a Tue Jan 17 13:43:50 2023 +0200 Enable metric_collection_endpoint for pageserver on prod in all regions
7624963e1 Tue Jan 17 13:43:50 2023 +0200 Enable metric_collection_endpoint for proxy on prod in all regions
9d3992ef4 Tue Jan 17 15:50:19 2023 +0200 Increase metric_collection_interval for proxy on prod to not owerwhelm the service
c6b56d296 Tue Jan 17 22:07:38 2023 +0200 Add more io::Error context when fail to operate on a path (#3254)
3b58c61b3 Wed Jan 18 11:25:47 2023 +0200 If an error happens while checking for core dumps, don't panic.
506086a3e Wed Jan 18 16:35:43 2023 +0200 Fix metric_collection_endpoint for prod. It was incorrectly set to staging url
e59d32ac5 Wed Jan 18 16:34:49 2023 +0100 Change SENTRY_ENVIRONMENT from "development" to "staging"
826e89b9c Wed Jan 18 17:43:27 2023 +0200 Use actual temporary dir for pageserver unit tests
90f66aa51 Wed Jan 18 17:43:27 2023 +0200 Enable logs in unit tests
e5cc2f92c Wed Jan 18 19:42:47 2023 +0200 Switch to 'tracing' for logging, restructure code to make use of spans.
a9bd05760 Thu Jan 19 10:29:15 2023 -0500 Improve layer map docstrings (#3382)
8ba169993 Thu Jan 19 20:16:56 2023 +0100 Revert "Use actual temporary dir for pageserver unit tests"
20b1e26e7 Fri Jan 20 15:37:24 2023 +0100 [compute_ctl] Make role deletion spec processing idempotent (#3380)
58fb6fe86 Fri Jan 20 19:55:19 2023 +0200 fix: dont stop pageserver if we fail to calculate synthetic size
36f048d6b Fri Jan 20 20:21:36 2023 +0200 Fix tenant size orphans (#3377)
a3d7ad2d5 Fri Jan 20 16:10:12 2023 -0500 Implement layer map using immutable BST (#2998)
5c865f46b Mon Jan 23 10:51:09 2023 +0200 Fix slru_segment_key_range function: segno was assigned to incorrect Key field (#3354)
a44e5eda1 Mon Jan 23 14:08:48 2023 +0100 Adding pageserver3 to staging (#3403)
7704caa3a Mon Jan 23 17:12:51 2023 +0200 More tenant size fixes (#3410)
6b6570b58 Mon Jan 23 17:22:49 2023 +0100 remove TimelineState::Suspended, introduce TimelineState::Loading
a4be54d21 Mon Jan 23 17:46:22 2023 +0100 [compute_ctl] Stop updating roles on each compute start (#3391)
fd18692df Tue Jan 24 09:58:08 2023 +0200 Output coloured pageserver logs for tty stdout
55c184fcd Tue Jan 24 12:22:33 2023 +0100 fix some anyhow::Context::context calls that should use with_context(format!(...))
f74080cba Tue Jan 24 13:57:13 2023 +0200 feat(http): support ?inputs_only=true for tenant_size (#3419)
98d0a0d24 Tue Jan 24 14:53:39 2023 +0200 fix(http): omit needless string allocs (#3421)
f7ec33970 Tue Jan 24 15:23:48 2023 +0100 add doc comment that outlines which tokio tasks walreceiver creates
7a333cfb1 Tue Jan 24 15:56:02 2023 +0100 be noisy about unexpected Timeline state transitions
0b673c12d Tue Jan 24 15:56:02 2023 +0100 timeline: don't transition Active=>Active during pageserver startup
0c16ad859 Tue Jan 24 17:23:33 2023 +0200 Tone down broker subscription errors
1c3636d84 Tue Jan 24 18:03:33 2023 +0200 Tone down walreceiver connection timeout errors (#3425)
aabca55d7 Tue Jan 24 17:18:16 2023 +0100 Migrate update version to management APIv2 (#3430)
9fbef1159 Wed Jan 25 10:36:30 2023 +0000 Tone down http error printing (#3434)
3d5faa029 Wed Jan 25 12:39:53 2023 +0200 Unify common image args in compute-node Dockerfiles (#3437)
ea6f41324 Wed Jan 25 10:50:33 2023 +0000 Tone down postgres client io errors (#3435)
bc4f594ed Wed Jan 25 12:07:38 2023 +0100 Fix Sentry Version
5223b62a1 Wed Jan 25 12:08:45 2023 +0100 Compile unit extension
572332ab5 Wed Jan 25 13:40:08 2023 +0200 Tone down page_service timeouts (#3426)
dee71404a Wed Jan 25 14:39:55 2023 +0100 Use TLS for staging link proxy (#3443)
01b4b0c2f Wed Jan 25 14:53:30 2023 +0100 Introduce RequestContext
8963d830f Wed Jan 25 16:55:25 2023 +0300 add script to download all remote layers (#3294)
00f1f54b7 Wed Jan 25 15:10:45 2023 +0100 Leave one Dockerfile
0c7276ae1 Wed Jan 25 16:23:30 2023 +0200 Expect timeline being stopped during the detach smoke test (#3442)
4b8dbea5c Wed Jan 25 17:15:56 2023 +0100 Add production link proxy to new account (#3444)
e3efb0d85 Wed Jan 25 17:29:06 2023 +0000 Fix bug while creating unit extension (#3447)
0a0958940 Wed Jan 25 15:18:41 2023 -0500 Increase gc period to 1h (#3432)
cd5732d9d Thu Jan 26 10:46:06 2023 +0100 Gen3 runners (#3220)
dc64962ff Thu Jan 26 11:24:48 2023 +0100 tenant::mgr: explicit tracking of initializing & shutting-down states
4bcbb7793 Thu Jan 26 11:30:53 2023 +0100 Revert docker hub job (#3453)
006ee5f94 Thu Jan 26 15:20:03 2023 +0200 Configure 'compute_ctl' to use OpenTelemetry exporter.
3e94fd5af Thu Jan 26 15:20:03 2023 +0200 Inherit OpenTelemetry context for compute startup from cloud console.
0c0e15b81 Thu Jan 26 15:20:03 2023 +0200 compute_ctl: Extract tracing context from incoming HTTP requests.
b858d70f1 Thu Jan 26 14:26:23 2023 +0100 Update promote job (#3455)
2ecd0e1f0 Thu Jan 26 16:18:57 2023 +0100 Decommission link proxy from old account (#3454)
bf63f129a Fri Jan 27 02:12:07 2023 +0200 Make 'branch_timeline' function more clear.
fb721cdfa Fri Jan 27 11:05:05 2023 +0100 Setup legacy scram proxy in the new account (#3461)
238898131 Fri Jan 27 11:20:51 2023 +0100 Add cleanup tasks for ansible and helm (#3465)
99399c112 Fri Jan 27 12:23:17 2023 +0100 move walreceiver module under timeline
8342e9ea6 Fri Jan 27 13:28:26 2023 +0100 Update helm job (#3467)
0ec84e2f1 Fri Jan 27 15:34:59 2023 +0200 Allow creating config for attached tenant (#3446)
c5ca7d0c6 Fri Jan 27 18:36:24 2023 +0200 Implement asynchronous pipe for communication with walredo process (#3368)
4718c67c1 Fri Jan 27 18:05:49 2023 +0100 Update deploy steps (#3470)
4d291d0e9 Fri Jan 27 19:27:23 2023 +0100 Prevent assume error (#3476)
67d418e91 Sun Jan 29 12:40:50 2023 +0200 Set the last_record_gauge to the value which was persisted metadata (#3460)
ddb9c2fe9 Sun Jan 29 14:04:06 2023 +0200 Add metrics for tenants state  (#3448)
5ee77c0b1 Mon Jan 30 12:10:51 2023 +0200 Fix holding tracing span guard over query execution.
5fc233964 Mon Jan 30 12:44:48 2023 +0100 Create release PR
7bb13569b Mon Jan 30 14:00:44 2023 +0100 Switch more jobs to small runner (#3483)
c61bc25ef Mon Jan 30 16:08:23 2023 +0200 Clean up NeedsDownload error (#3464)
20b38acff Mon Jan 30 17:10:29 2023 +0200 Replace per timeline `pageserver_storage_operations_seconds` with a global one (#3409)
ec0e64157 Mon Jan 30 16:15:22 2023 +0100 Create Release PR: review fixes
82cbcb36a Mon Jan 30 20:10:54 2023 +0100 Extract neon deploy jobs into separate workflows (#3424)
5e08b35f5 Mon Jan 30 22:08:00 2023 +0100 Fix new deploy workflow (#3492)
0806a46c0 Tue Jan 31 13:36:25 2023 +0100 Fix production deploy (#3498)
a7d8bfa63 Tue Jan 31 14:36:04 2023 +0100 Fix create release PR
895f929bc Tue Jan 31 15:50:52 2023 +0200 Add layer_map_analyzer tool (#3451)
a058bc6de Tue Jan 31 17:30:45 2023 +0200 Bump aiohttp from 3.7.0 to 3.7.4 (#3445)
847fc566f Tue Jan 31 17:40:24 2023 +0100 Use the same runners/container for old prod deployments as for new prod
2309dd564 Wed Feb 1 10:45:41 2023 +0100 Install postgis_sfcgal
9bb6a6c77 Wed Feb 1 14:07:23 2023 +0200 pysync: override PYTHON_KEYRING_BACKEND (#3480)
590695e84 Wed Feb 1 14:11:12 2023 +0100 improve query param parsing
f1aece1ba Wed Feb 1 15:29:01 2023 +0200 add RequestContext plumbing for layer access stats
ea0278cf2 Wed Feb 1 17:11:41 2023 +0300 [proxy] Implement compute node info cache (#3331)
f3dadfb3d Wed Feb 1 16:01:27 2023 +0100 Confirm that there is an emergency before manual execution of prod deploy workflow (#3507)
567b71c1d Wed Feb 1 18:11:00 2023 +0000 Require poetry 1.3; regenerate poetry.lock (#3508)
bf1c36a30 Thu Feb 2 11:02:47 2023 +0200 Moving the template file location  (#3523)
f474495ba Thu Feb 2 11:18:42 2023 +0200 Publish builds stats that are easy to browse (#3514)
2759f1a22 Thu Feb 2 12:14:44 2023 +0200 Evict layers on demand (#3486)
d25307dce Thu Feb 2 13:33:38 2023 +0100 Compile postgres with ICU support
f6a10f469 Thu Feb 2 14:52:17 2023 +0200 Use regular layer names instead of a special test ones (#3524)
ada933eb4 Thu Feb 2 15:33:40 2023 -0500 Pageserver read trace utils (#2795)
96e78394f Thu Feb 2 22:56:15 2023 +0200 [proxy] Fix project (aka endpoint) init in the password hack handler (#3529)
f71b1b174 Fri Feb 3 08:01:26 2023 +0200 Check correctness of file_cache_size_limit (#3530)
83048a4ad Fri Feb 3 12:37:34 2023 +0200 Handle errors during metric collection. (#3521)
a0372158a Fri Feb 3 12:23:27 2023 +0100 Add build_info metric to storage broker (#3525)
f2d89761c Fri Feb 3 15:33:46 2023 +0200 feat: LayerMap::replace (#3513)
be81db21b Fri Feb 3 17:54:12 2023 +0200 Revert accidental change (#3538)
87cd2bae7 Fri Feb 3 18:12:17 2023 +0100 introduce LaunchTimestamp to identify process restarts
ec3a3aed3 Sat Feb 4 01:32:29 2023 +0200 Dump current tenant config (#3534)
121d53506 Sat Feb 4 15:56:11 2023 +0100 Add a test for the PostgresNIO Swift client library.
c9821f13e Mon Feb 6 09:25:15 2023 +0200 Expose the tenant calculated synthetic size as a Prometheus metric (#3541)
678fe0684 Mon Feb 6 14:21:51 2023 +0200 std::fmt::Debug for Layer implementations (#3536)
959f5c6f4 Mon Feb 6 15:51:20 2023 +0100 Do not deploy legacy scram proxy (*.cloud.neon.tech) to the old account (#3546)
877a2d70e Mon Feb 6 17:53:10 2023 +0200 Periodically send cached consumption metrics (#3520)
58fa4f0eb Mon Feb 6 17:01:38 2023 +0100 maintain access stats for historic layers
fcb905f51 Tue Feb 7 11:08:55 2023 +0200 Use LayerMap::replace in eviction (#3544)
1254dc7ee Tue Feb 7 15:21:15 2023 +0100 Fix production deploy: run as root to access docker (#3555)
c5c14368e Tue Feb 7 15:27:31 2023 +0100 Fix deploy-prod.yml syntax (#3556)
a6dffb6ef Wed Feb 8 12:25:25 2023 +0000 fix: stop using Arc::ptr_eq with dyn Trait (#3558)
7ed93fff0 Wed Feb 8 14:40:47 2023 +0100 refactor: allow for eviction of layers in a batch
1b9e5e84a Wed Feb 8 16:48:29 2023 +0100 Add new storage hosts for placement group test (#3561)
371493ae3 Wed Feb 8 16:08:01 2023 +0000 Bump cryptography from 38.0.3 to 39.0.1 (#3565)
2040db98e Thu Feb 9 11:20:10 2023 +0200 Add docs for synthetic size calculation (#3328)
f07d6433b Thu Feb 9 13:02:07 2023 +0200 fix: one leftover Arc::ptr_eq (#3573)
7ed9eb4a5 Thu Feb 9 13:28:20 2023 +0200 Add script for safekeeper tenants cleanup (#3452)
446a39e96 Thu Feb 9 12:35:45 2023 +0100 make LayerAccesStatFullDetails Copy
1fdf01e3b Thu Feb 9 13:55:37 2023 +0200 fix: readable Debug for Layers (#3575)
175a577ad Thu Feb 9 13:33:55 2023 +0100 automatic layer eviction
a4256b325 Thu Feb 9 13:39:04 2023 +0100 allow on-demand downloads in walreceiver connection handler
9657459d8 Fri Feb 10 12:45:38 2023 +0300 [proxy] Fix possible unsoundness in the websocket machinery (#3569)
4175cfbda Fri Feb 10 13:03:12 2023 +0100 Create folder for file_cache
948f047f0 Fri Feb 10 13:37:52 2023 +0100 Compile pgvector extension
f4359b688 Fri Feb 10 14:20:55 2023 +0100 Backport `cargo fmt` diff from `release` branch into `main`
694150ce4 Fri Feb 10 18:49:32 2023 +0300 [proxy] Respect the magic `RUST_LOG` env variable
f383b4d54 Fri Feb 10 21:40:28 2023 +0300 Enable TCP_NODELAY for wss connections
eaff14da5 Mon Feb 13 17:09:43 2023 +0300 [proxy] Restore INFO as the default tracing level
e6618f1cc Tue Feb 14 13:17:34 2023 +0200 Update current logical size gauge (#3592)
eb21d9969 Tue Feb 14 12:56:03 2023 +0100 Add pageserver-3.us-west-2.aws.neon.tech (#3603)
86681b92a Tue Feb 14 13:33:27 2023 +0100 Enable plls and plcoffee extensions
3569c1bac Tue Feb 14 17:54:01 2023 +0300 [proxy] Fix: don't cache user & dbname in node info cache
a5ce2b533 Wed Feb 15 16:02:02 2023 +0200 Add debug messages around timeline.get_current_logical_size
a839860c2 Wed Feb 15 16:02:02 2023 +0200 Add debug messages around sending cached metrics
a974602f9 Wed Feb 15 15:11:06 2023 +0100 fix the logical size term definition (#3609)
1d9d7c02d Wed Feb 15 22:05:03 2023 +0300 [proxy] Don't forward empty `options` to compute nodes
7b182e260 Thu Feb 16 10:33:04 2023 +0200 Update settings.md with latest PITR and gc period values (#3618)
ddbdcdddd Thu Feb 16 10:53:46 2023 +0200 Tenant size calculation: refactor, rewrite, and add SVG (#2817)
7991bd3b6 Thu Feb 16 10:56:42 2023 +0200 Fix periodic metric sending: don't reset timer on every iteration (#3617)
5082d84f5 Thu Feb 16 10:54:22 2023 +0100 Compile pgjwt extension
f0b41e775 Thu Feb 16 14:25:35 2023 +0200 Propose less verbose way to build neon (#3624)
0cf7fd0fb Thu Feb 16 15:36:13 2023 +0200 Compaction with on-demand download (#3598)
d9ba3c5f5 Thu Feb 16 17:46:15 2023 +0200 Revert "Add debug messages around timeline.get_current_logical_size"
6139e8e42 Thu Feb 16 17:46:15 2023 +0200 Revert "Add debug messages around sending cached metrics"
0d3aefb27 Thu Feb 16 17:58:53 2023 +0200 Only use active timelines in synthetic_size calculation
d9c518b2c Thu Feb 16 22:10:56 2023 +0300 Refactor use_cleartext_password_flow.
edffe0dd9 Thu Feb 16 22:10:56 2023 +0300 Extract password hack & cleartext hack
a4d5c8085 Thu Feb 16 22:10:56 2023 +0300 Move hacks to a dedicated module.
a1b062123 Thu Feb 16 20:28:53 2023 +0000 Do not deploy storage to old account (#3630)
526f8b76a Fri Feb 17 08:29:52 2023 +0000 Bump werkzeug from 2.1.2 to 2.2.3 (#3631)
501702b27 Fri Feb 17 13:34:26 2023 +0200 fix: flaky test_compaction_downloads_on_demand_with_image_creation (#3629)
ae3eff1ad Fri Feb 17 13:56:00 2023 +0200 Tracing panic hook (#3475)
8e6b27bf7 Fri Feb 17 14:15:29 2023 +0200 fix: avoid busy loop on replacement failure (#3613)
6f9af0aa8 Fri Feb 17 15:32:14 2023 +0300 [proxy] Enable OpenTelemetry tracing.
956b6f17c Fri Feb 17 15:32:14 2023 +0300 [proxy] Handle some unix signals.
d90cd36bc Fri Feb 17 15:32:14 2023 +0300 [proxy] Improve tracing spans here and there.
b242b0ad6 Fri Feb 17 15:56:56 2023 +0200 Fix flaky tests (#3616)
40799d8ae Fri Feb 17 17:57:45 2023 +0200 Add debug messages to catch abnormal consumption metric values
53128d56d Fri Feb 17 17:57:45 2023 +0200 Fix make clean: Use correct paths in neon-pg-ext-clean
8d28a24b2 Fri Feb 17 18:32:01 2023 +0200 staging: enable automatic layer eviction at 20m threshold + period (#3636)
564fa1124 Fri Feb 17 18:18:23 2023 +0000 Update Postgres extensions (#3615)
2153d2e00 Fri Feb 17 14:14:41 2023 -0800 Run compute_ctl in a cgroup in VMs (#3577)
af210c8b4 Mon Feb 20 13:23:13 2023 +0200 Allow running do_gc in non testing env (#3639)
8f557477c Mon Feb 20 17:51:27 2023 +0300 Add new safekeeper to ap-southeast-1 prod (#3645)
d5d690c04 Mon Feb 20 16:05:21 2023 +0100 Use fqdn for staging console management API (#3642)
e363911c8 Mon Feb 20 17:18:13 2023 +0200 timeline: propagate span to download_remote_layer (#3644)
ee1eda992 Mon Feb 20 18:01:59 2023 +0100 eviction: remove EvictionStats::not_considered_due_to_clock_skew
485b26967 Mon Feb 20 18:01:59 2023 +0100 eviction: tone down logs to debug!() level if there were no evictions
e3d75879c Mon Feb 20 18:11:06 2023 +0100 Use fqdn to access console management API on production (#3651)
bc7d3c647 Mon Feb 20 22:51:54 2023 +0300 docs: add dependency requirements for arch based systems (#3588)
d7d3f451f Tue Feb 21 10:03:55 2023 +0200 Use tracing panic hook in all binaries (#3634)
5c5b03ce0 Tue Feb 21 10:34:45 2023 +0100 Compile xml2 extension
7de373210 Tue Feb 21 13:02:19 2023 +0200 Warn when background tasks exceed their configured period (#3654)
b220ba6cd Tue Feb 21 12:42:11 2023 +0100 add random init delay for background tasks (#3655)
c0de7f5cd Tue Feb 21 17:31:23 2023 +0100 Build `pg_jsonschema` and `pg_graphql` extensions (#3535)
fe462de85 Tue Feb 21 19:31:53 2023 +0200 fix: log download failed error (#3661)
5d001b1e5 Tue Feb 21 20:20:13 2023 +0200 chore: ignore all compaction inactive tenant errors (#3665)
225add041 Tue Feb 21 21:09:31 2023 +0200 calculate_logical_size: no longer use spawn_blocking (#3664)
b8b8c19fb Tue Feb 21 21:14:08 2023 +0200 fix: hold permit until GetObject eof (#3663)
2caece207 Tue Feb 21 23:11:52 2023 +0300 Add -v to ansible invocations (#3670)
95018672f Wed Feb 22 11:55:41 2023 +0200 Remove safekeeper-1.ap-southeast-1.aws.neon.tech (#3671)
965b4f4ae Wed Feb 22 16:50:07 2023 +0200 Change the staging neon-proxy-scram update strategy to RollingUpdate (#3678)
412e0aa98 Wed Feb 22 18:28:01 2023 +0200 Skip largest N holes during compaction (#3597)
b0311cfde Wed Feb 22 20:15:37 2023 +0200 Change the production neon-proxy-scram update strategy to RollingUpdate (#3683)
a8d736088 Wed Feb 22 20:14:30 2023 +0100 Compile `hypopg` extension
f3ad63591 Wed Feb 22 20:16:11 2023 +0100 Compile `pgrouting` extension
eb403da81 Wed Feb 22 22:19:05 2023 +0300 Use debug level for successful GET http requests (#3681)
093570af2 Wed Feb 22 21:00:25 2023 +0100 Compile `pg_hashids` extension
0692fffbf Thu Feb 23 01:34:59 2023 +0400 Bump vendor/postgres to include hotfix for unlogged tables with indexes.
5ebf7e561 Thu Feb 23 10:43:46 2023 +0100 Fix `pg_jsonschema` and `pg_graphql`
20a4d817c Thu Feb 23 16:10:22 2023 +0200 Update vendored PostgreSQL versions to 14.7 and 15.2 (#3581)
ec4ecdd54 Thu Feb 23 16:49:37 2023 +0100 Enable postgres SPI extensions
c79dd8d45 Thu Feb 23 13:19:39 2023 -0500 compute_ctl: support for fetching spec from control plane (#3610)
9f906ff23 Thu Feb 23 19:56:21 2023 +0100 Add pageserver-2.us-east-2.aws.neon.tech (#3701)
f51b48fa4 Fri Feb 24 23:30:02 2023 +0400 Fix UNLOGGED tables.
000eb1b06 Mon Feb 27 12:44:08 2023 +0000 Bump tempfile from 3.3.0 to 3.4.0 (#3709)
1360361f6 Tue Feb 28 21:11:00 2023 -0800 Fix missing VM cgconfig.conf (#3718)
d19c5248c Wed Mar 1 18:09:08 2023 +0200 Add UUID header to mgmt API (#3708)
8dae87999 Wed Mar 1 23:58:43 2023 -0800 Disable VM cgroup shenanigans (#3730)
a60f687ce Thu Mar 2 12:28:20 2023 +0100 Compile `rum` extension
5e514b846 Fri Mar 3 10:14:38 2023 +0100 Compile pgTAP extension
b23742e09 Fri Mar 3 14:01:05 2023 +0300 Create `/v1/debug_dump` safekeepers endpoint (#3710)
764d27f69 Fri Mar 3 12:10:24 2023 +0100 fix checkpoint_timeout serialization in TenantConf
68141a924 Fri Mar 3 12:10:24 2023 +0100 eviction: remove needless if-let around resident size decrement
1b9b9d60d Fri Mar 3 12:10:24 2023 +0100 eviction: add comment explaining resident size decrement on error
38022ff11 Fri Mar 3 12:10:24 2023 +0100 gc: only decrement resident size if GC'd layer is resident
1b780fa75 Fri Mar 3 12:10:24 2023 +0100 timeline_checkpoint_handler: add span with tenant and timeline id
d1a0a907f Fri Mar 3 14:53:27 2023 +0100 tests: use `parse_metrics` everywhere (#3737)
66a515951 Fri Mar 3 16:11:54 2023 +0100 fix: compaction: no index upload scheduled if no on-demand downloads
9cada8b59 Fri Mar 3 18:47:57 2023 +0100 fix benchmarks, broken by PR #3737
96f65fad6 Mon Mar 6 10:10:58 2023 +0200 Handle crash of walredo process and retry applying wal records (#3739)
7b9057ad0 Mon Mar 6 18:52:59 2023 +0200 Add timeout to download copy (#3675)
ca85646df Tue Mar 7 10:16:54 2023 +0400 Max peer_horizon_lsn before adopting it.
0acf9ace9 Tue Mar 7 16:34:20 2023 +0400 Return 404 if timeline is not found in safekeeper HTTP API.
b05e94e4f Tue Mar 7 12:44:04 2023 +0000 fix: allow ERROR log to appear per allowed failure (#3696)
069b5b0a0 Tue Mar 7 15:01:14 2023 +0200 Make `postgres --wal-redo` more embeddable.
1b16de0d0 Tue Mar 7 17:42:53 2023 +0100 Compile `prefix` extension
02b8e0e5a Tue Mar 7 09:08:46 2023 -0800 Add OpenAPI spec for do_gc (#3756)
fb1581d0b Wed Mar 8 11:39:30 2023 +0200 Fix setting "image_creation_threshold" setting in tenant config. (#3762)
177f98679 Wed Mar 8 12:03:09 2023 +0100 Compile `hll` extension
37bc6d9be Wed Mar 8 23:20:24 2023 +0100 Compile `plpgsql_check` extension
ccf92df4d Thu Mar 9 00:53:13 2023 +0200 Remove deprecated support to handle ZENITH_AUTH_TOKEN.
03a2ce9d1 Thu Mar 9 09:24:01 2023 +0200 Add tracing spans with request_id into pageserver management API handlers (#3755)
8459e0265 Thu Mar 9 14:30:12 2023 +0200 Add performance test for compaction and image layer creation
e43c413a3 Thu Mar 9 14:21:10 2023 +0100 [compute_tools] Add /insights endpoint to compute_ctl (#3704)
3f11a647c Thu Mar 9 20:45:56 2023 +0300 Rename write_message to write_message_noflush in postgres_backend_async.rs
7627d8534 Thu Mar 9 20:45:56 2023 +0300 Move async postgres_backend to its own crate.
0d8ced853 Thu Mar 9 20:45:56 2023 +0300 Remove sync postgres_backend, tidy up its split usage.
b80fe41af Thu Mar 9 20:45:56 2023 +0300 Refactor postgres protocol parsing.
a34e78d08 Thu Mar 9 22:15:46 2023 +0200 Retry attempt to connect to pageserver in order to make pageserver restart transparent for clients (#3700)
d1a0f2f0e Fri Mar 10 00:03:17 2023 +0300 Fix example why manual-range-contains is disabled.
965837df5 Fri Mar 10 10:50:03 2023 +0300 Log connection ids in safekeeper instead of thread ids.
290884ea3 Fri Mar 10 10:50:03 2023 +0300 Fix too many arguments in read_network clippy complain.
3c4f5af1b Fri Mar 10 11:11:39 2023 +0100 Try depot.dev for image building (#3768)
42ec79fb0 Fri Mar 10 14:59:21 2023 +0200 Make expected test output nicer to read.
856d01ff6 Fri Mar 10 14:59:21 2023 +0200 Add newline at end of postgresql.conf
d1537a49f Fri Mar 10 14:59:21 2023 +0200 Fix escaping in postgresql.conf that we generate at compute startup
b7fddfa70 Fri Mar 10 15:00:48 2023 +0200 Add branch_id field to proxy_io_bytes_per_client metric. Since we allow switching endpoints between different branches, it is important to use composite key. Otherwise, we may try to calculate delta between metric values for two different branches.
2ceef91da Fri Mar 10 14:59:26 2023 +0100 Compile `pg_tiktoken` extension
bebf76c46 Fri Mar 10 16:09:32 2023 +0200 Accept RS384 and RS512 JWT tokens.
b00530df2 Fri Mar 10 16:09:32 2023 +0200 Add section in internal docs on the JWT payload.
34d3385b2 Fri Mar 10 16:09:32 2023 +0200 Add unit tests for JWT encoding and decoding.
252b3685a Fri Mar 10 17:40:45 2023 +0200 Use `unsafe-postgres` feature to build pgx extension
1401021b2 Fri Mar 10 19:00:20 2023 +0200 Be able to get number of CPUs (#3774)
ce8fbbd91 Fri Mar 10 17:44:12 2023 +0000 Fix allowed error again (#3790)
869934224 Mon Mar 13 09:26:49 2023 +0200 Ondemand rx bytes and layer count (#3777)
d9a132983 Mon Mar 13 12:18:10 2023 +0300 Make postgres_backend use generic IO type (#3789)
e0ee138a8 Mon Mar 13 12:14:37 2023 +0200 Add a test for tokio-postgres client to the driver test suite.
07dcf679d Mon Mar 13 14:00:01 2023 +0200 set content type explicitly (#3799)
f0573f599 Mon Mar 13 14:07:35 2023 +0200 Remove block cursor cache (#3740)
daeaa767c Mon Mar 13 13:40:15 2023 +0100 Add `neondatabase/release` team as a default reviewers for storage releases
582620274 Mon Mar 13 07:16:39 2023 -0700 Enable file cache handling by vm-informant (#3794)
d7ab69f30 Mon Mar 13 17:50:10 2023 +0200 add test for getting branchpoints from an inactive timeline
50476a7cc Mon Mar 13 17:50:10 2023 +0200 test: update to match current interfaces
15ed6af5f Tue Mar 14 01:32:37 2023 +0300 Add descriptions to proxy's python tests.
2e4bf7cee Tue Mar 14 01:45:57 2023 +0300 [proxy] Immediately log all compute node connection errors.
319402fc7 Tue Mar 14 10:25:48 2023 +0000 postgres_ffi: restore POSTGRES_INSTALL_DIR support (#3811)
d6bb8caad Tue Mar 14 13:18:26 2023 +0200 refactor: correct return value for not found L0's on LayerMap::replace (#3805)
68ae020b3 Tue Mar 14 13:23:46 2023 +0000 Use RollingUpdate strategy also for legacy proxy (#3814)
3d869cbcd Tue Mar 14 13:25:44 2023 +0000 Replace flake8 and isort with ruff (#3810)
15b692ccc Tue Mar 14 15:27:52 2023 +0200 test: more strict finding of WARN, ERROR lines (#3798)
c23c8946a Tue Mar 14 15:29:02 2023 +0200 chore: clippies introduced with rust 1.68 (#3781)
539627354 Tue Mar 14 16:15:07 2023 +0200 Avoid holes between generated image layers (#3771)
4a92799f2 Tue Mar 14 19:45:33 2023 +0200 Fix check for trailing garbage in basebackup import.
2672fd09d Tue Mar 14 20:10:34 2023 +0200 Make test independent of the order of config lines.
a7ab53c80 Wed Mar 15 14:32:41 2023 +0300 Forward framed read buf contents to compute before proxy pass.
10a5d36af Wed Mar 15 13:52:29 2023 +0200 Separate mgmt and libpq authentication configs in pageserver. (#3773)
cd17802b1 Wed Mar 15 16:18:38 2023 +0300 Add pg_clients test for serverless driver (#3827)
f1d960d2c Wed Mar 15 16:58:28 2023 +0100 Add new pageserver to eu-central-1 (#3829)
768c8d997 Thu Mar 16 11:03:21 2023 +0200 test: allow gc to get unlucky (#3826)
b067378d0 Thu Mar 16 17:24:01 2023 +0300 Measure cross-AZ traffic in safekeepers (#3806)
b917270c6 Thu Mar 16 16:25:35 2023 +0100 remove unused TenantConfig::update function
f6e2e0042 Thu Mar 16 17:09:45 2023 -0700 Fix + re-enable VM cgroup creation + running (#3820)
93f3f4ab5 Sun Mar 19 10:44:42 2023 +0200 Return NotFound in mgmt API requests when tenant is not present in the pageserver (#3818)
3c15874c4 Mon Mar 20 10:43:53 2023 +0100 allow specifying eviction_policy in TenantCreateRequest
0c1228c37 Mon Mar 20 11:57:27 2023 +0200 feat: store initial timeline in env fixture (#3839)
1ddb9249a Mon Mar 20 15:49:16 2023 +0200 Reduce the # of histogram buckets in metrics. (#3850)
1da963b2f Mon Mar 20 16:28:01 2023 +0200 Remove some unused code in control plane.
77107607f Mon Mar 20 16:28:01 2023 +0200 Allow JWT key generation to fail if authentication is not enabled.
fea4b5f55 Mon Mar 20 16:28:01 2023 +0200 Switch to EdDSA algorithm for the storage JWT authentication tokens.
881356c41 Mon Mar 20 16:11:36 2023 +0100 add metrics to detect eviction-induced thrashing (#3837)
699f20081 Tue Mar 21 01:22:02 2023 +0400 Send error context chain to the client when Copy stream errors.
5a786fab4 Tue Mar 21 00:15:04 2023 +0200 Remove duplicated global variables in neon extension.
299db9d02 Tue Mar 21 00:15:04 2023 +0200 Simplify and clean up the $NEON_AUTH_TOKEN stuff in compute
809acb5fa Tue Mar 21 19:32:36 2023 +0200 Move neon-image-depot to a larger runner (#3860)
4158e24e6 Tue Mar 21 20:03:27 2023 +0200 rfc: delete pageserver data from s3 (#3792)
6fdd9c10d Tue Mar 21 20:12:09 2023 +0200 Read storage auth token from spec file.
dd22c8710 Tue Mar 21 23:33:28 2023 +0200 Remove older layer metadata format support code (#3854)
0f7de8478 Wed Mar 22 07:17:00 2023 +0000 Allow calling detach on ignored tenant (#3834)
14a40c9ca Wed Mar 22 08:10:53 2023 +0000 Fix minor things for the docker-compose file (#3862)
6033dfdf4 Wed Mar 22 16:26:27 2023 +0200 Re-access layers before threshold eviction (#3867)
8bd565e09 Wed Mar 22 17:42:31 2023 +0200 Ensure branches with no layers have their remote storage counterpart created eventually (#3857)
f5ca89729 Thu Mar 23 12:00:52 2023 +0200 fix: less logging at shutdown (#3866)
870ba43a1 Fri Mar 24 19:25:39 2023 +0200 return proper http codes in timeline delete endpoint (#3876)
4071ff8c7 Sat Mar 25 12:33:39 2023 +0000 Bump openssl from 0.10.45 to 0.10.48 in /test_runner/pg_clients/rust/tokio-postgres (#3879)
4d8c76548 Mon Mar 27 12:04:48 2023 +0300 remove redundant dyn (#3878)
8d7832999 Mon Mar 27 12:24:35 2023 +0300 Remove some dead code.
e3cbcc2ea Mon Mar 27 14:10:18 2023 +0400 Revert "Add `neondatabase/release` team as a default reviewers for storage"
ff51e96fb Mon Mar 27 12:45:10 2023 +0200 fix synthetic size for (last_record_lsn - gc_horizon) < initdb_lsn (#3874)
fe1562457 Mon Mar 27 14:33:40 2023 +0300 eviction_task: only refresh layer accesses once per p.threshold (#3877)
f14895b48 Mon Mar 27 19:20:23 2023 +0200 eviction: avoid post-restart download by synthetic_size (#3871)
6efea4344 Mon Mar 27 21:01:46 2023 +0300 Use precondition failed code in delete_timeline when tenant is missing (#3884)
82a477704 Tue Mar 28 08:27:50 2023 +0300 Add local free space monitor (#3832)
c30b9e6eb Tue Mar 28 12:06:06 2023 +0400 Show full path to pg_ctl invokation when it fails.
278d0f117 Tue Mar 28 14:28:56 2023 +0400 Rename neon_local sk logs s/safekeeper 1.log/safekeeper-1.log.
35ecb139d Tue Mar 28 14:43:34 2023 +0400 Use stavfs instead inof statfs to fix MacOS build
9798737ec Tue Mar 28 14:43:34 2023 +0400 Update pgxn/neon/file_cache.c
7456e5b71 Tue Mar 28 17:04:02 2023 +0300 Add script to collect state from safekeepers (#3835)
5a123b56e Tue Mar 28 17:57:22 2023 +0300 Remove obsolete hack to rename neon-specific GUCs.
b52389f22 Tue Mar 28 22:29:42 2023 +0400 Cleanly exit on any shutdown signal in storage_broker.
018c8b0e2 Wed Mar 29 00:08:30 2023 +0300 Use proper tokens and delimeters when listing S3
1300dc923 Wed Mar 29 00:08:30 2023 +0300 Replace Python IT test with the Rust one
6c84cbbb5 Wed Mar 29 00:08:30 2023 +0300 Run new Rust IT test in CI
9d714a841 Wed Mar 29 00:08:30 2023 +0300 Split $CARGO_FLAGS and $CARGO_FEATURES to make e2e tests work
f1b174dc6 Wed Mar 29 12:50:04 2023 +0400 Update rust version to 1.68.2
ac9c7e8c4 Wed Mar 29 14:14:56 2023 +0300 Replace pin! from tokio to the std one (#3903)
b26c837ed Wed Mar 29 19:18:44 2023 +0400 Fixed pageserver openapi spec properties reference (#3904)
1c1bb904e Thu Mar 30 16:24:47 2023 +0300 Rename zenith_* labels to neon_* (#3911)
fa54a57ca Thu Mar 30 18:38:45 2023 +0200 random_init_delay: remove the minimum of 10 seconds (#3914)
41d364a8f Thu Mar 30 22:02:39 2023 +0300 Add more detailed logging to compute_ctl's shutdown (#3915)
bf46237fc Thu Mar 30 22:07:19 2023 +0300 Fix prefetch for parallel bitmap scan (#3875)
a64dd3ecb Fri Mar 31 14:47:57 2023 +0300 disk-usage-based layer eviction (#3809)
271f6a6e9 Fri Mar 31 16:15:06 2023 +0400 Always sync-safekeepers in neon_local on compute start.
d0711d089 Fri Mar 31 16:05:15 2023 +0300 build: fix git perms for deploy job (#3921)
22f9ea5fe Fri Mar 31 16:11:34 2023 +0300 Remind people to clean up merge commit message in PR template (#3920)
d2aa31f0c Fri Mar 31 19:25:53 2023 +0300 fix pageserver_evictions_with_low_residence_duration metric (#3925)
75ffe34b1 Fri Mar 31 21:45:59 2023 +0300 check-macos-build: fix cache key (#3926)
814abd9f8 Sun Apr 2 11:32:27 2023 +0300 Switch to safekeeper in the same AZ (#3883)
d733bc54b Mon Apr 3 01:52:41 2023 +0400 Rename ReplicationFeedback and its fields.
cf5cfe6d7 Mon Apr 3 13:26:45 2023 +0300 fix: metric used for alerting threshold on staging (#3932)
a415670bc Mon Apr 3 14:15:41 2023 +0300 feat: log evictions (#3930)
45bf76eb0 Mon Apr 3 14:57:36 2023 +0200 enable layer eviction by default in prod (#3933)
f85a61cea Mon Apr 3 18:49:30 2023 +0300 [proxy] Fix regression in logging
846532112 Mon Apr 3 23:44:38 2023 +0300 Remove unused S3 list operation (#3936)
105b8bb9d Tue Apr 4 12:21:54 2023 +0100 test_runner: automatically rerun flaky tests (#3880)
1d23b5d1d Tue Apr 4 12:22:47 2023 +0100 Comment PR with test results (#3907)
957acb51b Tue Apr 4 19:06:10 2023 +0300 GitHub Autocomment: Fix the link to the latest commit (#3952)
c3ca48c62 Wed Apr 5 20:06:48 2023 +0300 Support extra domain names for proxy.
d8df5237f Wed Apr 5 21:29:21 2023 +0300 Aligne extra certificate name with default cert-manager names
9310949b4 Wed Apr 5 22:08:06 2023 +0300 GitHub Autocomment: Retry on server errors (#3958)
b17c24fa3 Thu Apr 6 12:47:21 2023 +0300 fix: settle down to configured percent (#3947)
9db70f623 Thu Apr 6 14:02:56 2023 +0400 Added disk_size and instance_type to payload (#3918)
2ce973c72 Thu Apr 6 13:26:40 2023 +0200 Allow installation of `pg_stat_statements`
887cee64e Thu Apr 6 13:52:41 2023 +0100 test_runner: add links to grafana for remote tests (#3961)
102746bc8 Thu Apr 6 18:57:48 2023 +0300 Apply clippy rule exclusion locally instead of a global approach (#3974)
4d64edf8a Thu Apr 6 19:18:24 2023 +0300 Nightly Benchmarks: Add free tier sized compute (#3969)
ba4a96fdb Thu Apr 6 20:57:06 2023 +0300 Eagerly update wal_backup_lsn after each segment offload (#3976)
b45c92e53 Thu Apr 6 21:21:39 2023 +0300 tests: exclude compatibility tests by default (#3975)
e42982fb1 Thu Apr 6 21:21:58 2023 +0200 [compute_ctl] Empty computes and /configure API (#3963)
6d01d835a Thu Apr 6 23:14:07 2023 +0300 [proxy] Report error if proxy_io_bytes_per_client metric has decreased
b1c2a6384 Fri Apr 7 01:24:27 2023 +0300 Set non-wildcard common names in link auth proxy
bfeb428d1 Fri Apr 7 13:47:28 2023 +0300 tests: make neon_fixtures a bit thinner by splitting out some pageserver related helpers (#3977)
bfee41270 Fri Apr 7 14:26:21 2023 +0300 Trigger tests for index scan implementation (#3968)
979fa8b1b Fri Apr 7 15:26:22 2023 +0200 Compile timescaledb
31f2cdeb1 Fri Apr 7 15:26:22 2023 +0200 Update Dockerfile.compute-node
0bf70e113 Fri Apr 7 19:18:19 2023 +0300 Add extra cnames to staging proxy
dec58092e Fri Apr 7 21:39:49 2023 +0300 Replace Box<dyn> with impl in RemoteStorage upload (#3984)
818e341af Sun Apr 9 12:52:49 2023 +0100 Nightly Benchmarks: replace neon-captest-prefetch with -new/-reuse (#3970)
f0b2e076d Sun Apr 9 21:52:28 2023 +0300 Move compute_ctl structs used in HTTP API and spec file to separate crate.
98df7db09 Mon Apr 10 23:54:16 2023 +0300 Support aarch64 in walredo seccomp code
83549a8d4 Tue Apr 11 00:08:01 2023 +0300 Revert "Support aarch64 in walredo seccomp code"
22c890b71 Tue Apr 11 01:55:25 2023 +0300 Add more cnames to proxies
7ad5a5e84 Tue Apr 11 11:45:43 2023 +0400 Enable timeout on reading from socket in safekeeper WAL service.
c79d5a947 Tue Apr 11 10:58:04 2023 +0100 Nightly Benchmarks: run third-party benchmarks once a week (#3987)
de99ee2c0 Tue Apr 11 14:54:09 2023 +0300 Add more proxy cnames
40a68e907 Tue Apr 11 15:05:35 2023 +0200 [compute_ctl] Add timeout for `tracing_utils::shutdown_tracing()` (#3982)
3c9f42a2e Tue Apr 11 19:28:18 2023 +0000 Support aarch64 in walredo seccomp code (#3996)
6064a2696 Wed Apr 12 01:55:40 2023 +0300 Refactor 'spec' in ComputeState.
ef68321b3 Wed Apr 12 12:11:22 2023 +0300 Use Lsn, TenantId, TimelineId types in compute_ctl.
8ace7a751 Wed Apr 12 12:11:22 2023 +0300 Remove unused 'timestamp' field from ComputeSpec struct.
06ce83c91 Wed Apr 12 12:11:22 2023 +0300 Tolerate missing 'operation_uuid' field in spec file.
d8939d416 Wed Apr 12 12:39:02 2023 +0300 Move walreceiver start and stop behind a struct (#3973)
a64044a7a Wed Apr 12 15:32:38 2023 +0300 Update most of the dependencies to their latest versions (#3991)
8d295780c Wed Apr 12 16:40:02 2023 +0300 Add support for ip4r extension
218062ceb Wed Apr 12 15:22:18 2023 +0100 GitHub Workflows: use ref_name instead of ref
c94b8998b Wed Apr 12 15:22:18 2023 +0100 GitHub Workflows: print error messages to stderr
13e53e5dc Wed Apr 12 15:22:18 2023 +0100 GitHub Workflows: use '!cancelled' instead of 'success or failure'
f7995b3c7 Wed Apr 12 14:51:59 2023 +0000 Revert "Update most of the dependencies to their latest versions (#3991)" (#4013)
5d0ecadf7 Wed Apr 12 18:16:49 2023 +0300 Add support for non-SNI case in multi-cert proxy
732acc54c Thu Apr 13 10:19:34 2023 +0300 Add check for duplicates of generated image layers (#3869)
15d1f8555 Thu Apr 13 12:11:43 2023 +0300 Add reason to TenantState::Broken (#3954)
c237a2f5f Thu Apr 13 12:59:46 2023 +0300 Compile `pg_hint_plan extension`
356439aa3 Thu Apr 13 13:13:24 2023 +0300 Add note about `manual_release_instructions` label (#4015)
53f438a8a Thu Apr 13 14:34:29 2023 +0300 Rename "Postgres nodes" in control_plane to endpoints.
89b5589b1 Thu Apr 13 16:57:31 2023 +0300 Tenant size should never be zero. Simplify test.
36c20946b Thu Apr 13 15:25:09 2023 +0100 Verify extensions checksums (#4014)
db8dd6f38 Thu Apr 13 18:07:29 2023 +0200 [compute_ctl] Implement live reconfiguration (#3980)
fd31fafee Thu Apr 13 19:31:30 2023 +0300 Make proxy shutdown when all connections are closed (#3764)
b6c7c3290 Thu Apr 13 20:03:24 2023 +0100 Bump h2 from 0.3.15 to 0.3.17 (#4020)
8895f28da Fri Apr 14 13:25:45 2023 +0300 make evictions_low_residence_duration_metric_threshold per-tenant (#3949)
0c82ff3d9 Fri Apr 14 11:46:47 2023 +0100 test_runner: add Timeline Inspector to Grafana links (#4021)
589cf1ed2 Fri Apr 14 13:05:07 2023 +0200 [compute_ctl] Do not create availability checker data on each start (#4019)
017d3a390 Fri Apr 14 15:02:26 2023 +0300 Compile postgres with lz4 and zstd support
75ea8106e Fri Apr 14 15:02:26 2023 +0300 Add `procps` into compute containers
5ffa20dd8 Fri Apr 14 15:08:07 2023 +0300 [proxy] adjust proxy sleep timeout
ebea29841 Fri Apr 14 18:28:54 2023 +0300  Update most of the dependencies to their latest versions (#4026)
c2496c7ef Sun Apr 16 16:33:37 2023 +0300 Added black_box in layer_map benches (fix #3396)
73f34eaa5 Mon Apr 17 11:24:57 2023 +0300 Send AppendResponse keepalive once per second (#4036)
d8dd60dc8 Mon Apr 17 11:59:38 2023 +0100 Add helm values for us-east-1
0c083564c Mon Apr 17 15:25:27 2023 +0300 Add us-east-1 hosts file and update regions (#4042)
e2a5177e8 Tue Apr 18 16:04:10 2023 +0300 Bump h2 from 0.3.17 to 0.3.18 (#4045)
f1b7dc406 Tue Apr 18 14:08:12 2023 +0100 Update pageserver instances in us-east-1
0bfbae2d7 Tue Apr 18 18:41:09 2023 +0300 Add storage broker deployment to us-east-1 (#4048)
02b28ae0b Tue Apr 18 18:54:32 2023 +0300 fix vm-informant dbname: "neondb" -> "postgres" (#4046)
7ba5c286b Fri Apr 21 11:10:48 2023 +0200 [compute_ctl] Improve 'empty' compute startup sequence (#4034)
afbbc6103 Mon Apr 24 16:19:25 2023 +0300 Adding synthetic size to pageserver swagger (#4049)
e83684b86 Tue Apr 25 14:10:18 2023 +0200 add libmetric metric for each logged log message (#4055)
4911d7ce6 Tue Apr 25 15:22:23 2023 +0300 feat: warn when requests get cancelled (#4064)
fa20e3757 Tue Apr 25 14:22:48 2023 +0200 add gauge for in-flight layer uploads (#3951)
cb9473928 Tue Apr 25 13:22:16 2023 +0000 feat: add rough timings for basebackup (#4062)
dbbe032c3 Tue Apr 25 15:33:30 2023 +0200 neon_local: fix `tenant create -c eviction_policy:...` (#4004)
78bbbccad Tue Apr 25 16:46:52 2023 +0200 Deploy proxies for preview enviroments (#4052)
7f80230fd Tue Apr 25 17:07:04 2023 +0200 fix: stop dead_code rustc lint (#4070)
bfd45dd67 Tue Apr 25 18:41:09 2023 +0300 test_tenant_config: allow ERROR from eviction task (#4074)
05ac0e249 Tue Apr 25 17:54:10 2023 +0100 Login to ECR and Docker Hub at once (#4067)
8945fbdb3 Tue Apr 25 20:45:36 2023 +0300 Enable OpenTelemetry tracing in proxy in staging. (#4065)
2d6fd7217 Tue Apr 25 23:58:59 2023 +0100 GitHub Workflows: Fix crane for several registries (#4076)
9d0cf08d5 Wed Apr 26 10:29:44 2023 +0300 Fix new storage-broker deploy for eu-central-1 (#4079)
f19b70b37 Wed Apr 26 09:36:26 2023 +0200 Configure extra domain for us-east-1 (#4078)
850f6b1cb Wed Apr 26 11:49:29 2023 +0300 refactor: drop pageserver_ondisk_layers (#4071)
4625da316 Wed Apr 26 09:07:45 2023 +0000 build: remove busted sk-1.us-east-2 from staging hosts (#4082)
381c8fca4 Wed Apr 26 12:39:17 2023 +0300 feat: log how long tenant activation takes (#4080)
31a3910fd Wed Apr 26 13:46:33 2023 +0400 Remove wait_for_sk_commit_lsn_to_reach_remote_storage.
11df2ee5d Wed Apr 26 14:40:36 2023 +0300 Add safekeeper-3.us-east-2.aws.neon.build (#4085)
6861259be Wed Apr 26 15:18:26 2023 +0200 add global metric for unexpected on-demand downloads (#4069)
92214578a Wed Apr 26 17:47:54 2023 +0300 Fix proxy_io_bytes_per_client metric: use branch_id identifier properly. (#4084)
0112a602e Thu Apr 27 09:50:52 2023 +0400 Add timeout on proxy -> compute connection establishment.
9ea7b5dd3 Thu Apr 27 11:54:48 2023 +0200 clean up logging around on-demand downloads (#4030)
5b911e1f9 Thu Apr 27 15:01:27 2023 +0300 build: run clippy for powerset of features (#4077)
e6ec2400f Thu Apr 27 15:26:44 2023 +0200 Enable hot standby PostgreSQL replicas.
3be81dd36 Thu Apr 27 17:07:25 2023 +0300 fix `clippy --release` failure introduced in #4030 (#4095)
f5b4697c9 Thu Apr 27 19:08:22 2023 +0400 Log session_id when proxy per client task errors out.
d1e86d65d Thu Apr 27 18:45:22 2023 +0300 Run rustfmt to fix whitespace.
fdf5e4db5 Thu Apr 27 18:51:57 2023 +0300 refactor: Cleanup page service (#4097)
c4e1cafb6 Thu Apr 27 17:08:00 2023 +0100 scripts/flaky_tests.py: handle connection error (#4096)
fe0b61629 Thu Apr 27 17:55:35 2023 +0000 feat(page_service): read timeouts (#4093)
b2a3981ea Fri Apr 28 06:22:13 2023 +0400 Move tracking of walsenders out of Timeline.
fdacfaabf Fri Apr 28 06:22:13 2023 +0400 Move PageserverFeedback to utils.
b03143dfc Fri Apr 28 13:55:07 2023 +0300 Use serde_as DisplayFromStr everywhere (#4103)
42798e6ad Fri Apr 28 16:17:23 2023 +0400 Increase connection_timeout to PG in find end of WAL test.
23aca8194 Fri Apr 28 17:15:43 2023 +0300 Add SNI-based proxy router
556fb1642 Fri Apr 28 17:15:43 2023 +0300 fixed the way hostname is parsed
81c75586a Fri Apr 28 17:15:43 2023 +0300 Take port from SNI, formatting, make clippy happy
b15204fa8 Fri Apr 28 17:15:43 2023 +0300 Fix --help, and required args
3813c703c Fri Apr 28 17:15:43 2023 +0300 Add an option for destination port.
53e5d18da Fri Apr 28 17:15:43 2023 +0300 Start passthrough earlier
e947cc119 Fri Apr 28 17:15:43 2023 +0300 Add a small test case for pg_sni_router
645e4f6ab Fri Apr 28 17:15:43 2023 +0300 use TLS in link proxy
040f73690 Fri Apr 28 17:15:43 2023 +0300 remove changes in main proxy that are now not needed
9486d76b2 Fri Apr 28 17:15:43 2023 +0300 Add tests for link auth to compute connection
4ac6a9f08 Fri Apr 28 17:15:43 2023 +0300 add backward compatibility to proxy
0364f77b9 Fri Apr 28 17:15:43 2023 +0300 fix python styling
5bb971d64 Fri Apr 28 17:15:43 2023 +0300 fix more python tests
b1329db49 Fri Apr 28 17:15:43 2023 +0300 fix sigterm handling
94d612195 Fri Apr 28 17:15:43 2023 +0300 bump rust-postgres version, after merging PR in rust-postgres
ec53c5ca2 Fri Apr 28 17:20:18 2023 +0300 revert: "Add check for duplicates of generated image layers" (#4104)
8543485e9 Fri Apr 28 14:20:46 2023 +0000 Pull clone timeline from peer safekeepers (#4089)
2617e7000 Sat Apr 29 11:42:52 2023 +0200 Add 4 new Pageservers for retool launch (#4115)
95244912c Sat Apr 29 13:31:04 2023 +0300 Override sharded-slab to increase MAX_THREADS (#4122)
21eb944b5 Sat Apr 29 15:25:57 2023 +0300 Staging: Add safekeeper nodes [3-8] to eu-west-1 (#4123)
6f472df0d Sun Apr 30 14:34:55 2023 +0300 fix: restore not logging ignored io errors as errors (#4120)
d53f81b44 Sun Apr 30 22:39:34 2023 +0300 Add one more pageserver to staging
138bc028e Mon May 1 11:54:09 2023 +0300 fix: quick and dirty panic avoidance on drop path (#4128)
7e368f3ed Mon May 1 12:14:31 2023 +0200 build pg-sni-router binary (#4129)
e3ae2661e Mon May 1 14:22:59 2023 +0300 Add 2 new sets of safekeepers to us-west2 (#4130)
093fafd6b Mon May 1 17:18:45 2023 +0200 Deploy pg-sni-router (#4132)
4d55d6180 Tue May 2 20:36:11 2023 +0300 Store basic endpoint info in endpoint.json file. (#4058)
47521693e Tue May 2 22:28:21 2023 +0300 Fix file_cache build warnings (#4118)
474f69c1c Wed May 3 10:56:49 2023 +0300 fix: omit cancellation logging when panicking (#4125)
faebe3177 Wed May 3 11:11:55 2023 +0300 wal_craft: cleanup to keep editable (#4121)
ecc0cf8cd Wed May 3 12:03:13 2023 +0300 Treat EPIPE as an expected error. (#4141)
39ca7c7c0 Wed May 3 10:40:35 2023 +0100 Bump flask from 2.1.3 to 2.2.5 (#4138)
db81242f4 Wed May 3 16:14:16 2023 +0300 add debug to pg-sni-router install (#4143)
586e6e55f Wed May 3 16:25:19 2023 +0300 Print WalReceiver context on WAL waiting timeout (#4090)
3ceef7b17 Wed May 3 17:07:41 2023 +0300 Add more safekeeper and walreceiver metrics (#4142)
b114ef26c Wed May 3 15:38:49 2023 +0100 GitHub Autocomment: add a note if no tests were run (#4109)
ce1bbc9fa Thu May 4 00:07:45 2023 +0300 Always send the latest commit_lsn in send_wal (#4150)
f9839a0dd Thu May 4 09:23:49 2023 +0200 import_basebackup_from_tar: don't load local layers twice (#4111)
b5d64a1e3 Thu May 4 14:41:15 2023 +0300 Rename field, to match field name in XLogData struct and in rust-postgres (#4149)
7dd9553bb Thu May 4 16:16:48 2023 +0200 eviction: regression test + distinguish layer write from map insert (#4005)
b627fa71e Thu May 4 17:41:42 2023 +0300 Make read-only replicas explicit in compute spec (#4136)
88f39c11d Thu May 4 18:10:40 2023 +0300 refactor: the code that builds TenantConfOpt from mgmt API requests (#4152)
291b4f0d4 Thu May 4 18:22:04 2023 +0100 Update client libs for test_runner/pg_clients to their latest versions (#4092)
653e633c5 Fri May 5 02:57:47 2023 +0300 test_runner: add --pg-version pytest argument (#4037)
dd4fd89dc Fri May 5 11:45:37 2023 +0200 [compute_ctl] Do not initialize `last_active` on start (#4137)
411c71b48 Fri May 5 19:32:41 2023 +0300 document current tenant attach API semantics (#4151)
9860d59aa Mon May 8 15:51:54 2023 +0400 Public docker image repository by default
0f8b2d8f0 Mon May 8 15:56:08 2023 +0200 Compile kq_imcx extension (#3568)
51ff9f935 Mon May 8 18:03:50 2023 +0300 pg-sni-router nlb is internal (#4164)
e85cbddd2 Mon May 8 17:12:42 2023 +0200 Update neondatabase banner in README.md (#4176)
0d3d022eb Mon May 8 17:30:16 2023 +0200 Remove deploy workflows (#4157)
4bd7b1daf Mon May 8 21:25:47 2023 +0100 Bump vendor/postgres: Fix entering hot standby mode for Neon postgres v15
d62315327 Tue May 9 12:20:35 2023 +0300 Allow parallel backup in safekeepers (#4177)
66b06e416 Tue May 9 17:08:02 2023 +0300 Pass tracing context in env variables instead of the spec file. (#4174)
3ec52088d Tue May 9 18:16:22 2023 +0200 eviction_task: tracing::instrument the imitate-access calls (#4180)
eb3a8be93 Wed May 10 10:27:12 2023 +0200 keep track of timeline deletion status in IndexPart to prevent timeline resurrection (#3919)
1d490b231 Wed May 10 16:59:03 2023 +0100 Make benchmark_fixture less noisy
7fc778d25 Wed May 10 16:59:03 2023 +0100 GitHub Autocomment: fix flaky test notifications
59510f644 Wed May 10 16:59:03 2023 +0100 scripts/flaky_tests.py: use retriesStatusChange from Allure
ecced13d9 Thu May 11 16:14:42 2023 +0300 try: higher page_service timeouts to isolate an issue (#4206)
80522a1b9 Thu May 11 16:53:46 2023 +0300 replace has_in_progress_downloads with new attachment_status field (#4168)
1d266a636 Thu May 11 17:09:29 2023 +0300 logical size calculation metrics: differentiate regular vs imitated (#4197)
1988cc552 Thu May 11 17:53:42 2023 +0300 Fix `failpoint_sleep_millis_async` without `use std::time::Duration` (#4195)
845e29656 Thu May 11 18:02:19 2023 +0300 eviction: add global histogram for iteration durations (#4212)
ecfe4757d Thu May 11 23:31:42 2023 +0100 fix bogus at character context in log messages
586923429 Fri May 12 15:36:30 2023 +0200 logical size calculation: spawn with in_current_span (#4196)
bb06d281e Fri May 12 15:28:51 2023 +0100 Run regressions tests on both Postgres 14 and 15 (#4192)
a2a9c598b Fri May 12 19:00:06 2023 +0300 add counter metric that increases whenever a background loop overruns its period (#4223)
edcf4d61a Fri May 12 17:57:33 2023 +0000 distinguish imitated from real size::gather_input calls in metrics (#4224)
2855c7399 Sat May 13 10:44:11 2023 +0300 Fix race condition after attaching tenant with branches. (#4170)
9cd6f2cee Mon May 15 10:08:44 2023 +0300 Remove duplicated logic in creating TenantConfOpt (#4230)
4a76f2b8d Mon May 15 14:16:43 2023 +0300 upload new timeline index part json before 201 or on retry (#4204)
a5615bd8e Mon May 15 13:04:03 2023 +0100 Fix Allure reports for different benchmark jobs (#4229)
6415dc791 Mon May 15 13:38:18 2023 -0500 Fix use-after-free issue in libpagestore (#4239)
e7514cc15 Mon May 15 15:36:53 2023 -0500 Wrap naked PQerrorMessage calls in libpagestore with pchomp (#4242)
4f64be4a9 Mon May 15 23:45:04 2023 +0200 Add endpoint to connection string
0322e2720 Tue May 16 12:46:28 2023 +0100 Nightly Benchmarks: add neonvm to pgbench-compare (#4225)
fdc1c12fb Tue May 16 08:13:54 2023 -0400 Simplify github PR template (#4241)
a0b34e8c4 Tue May 16 15:15:29 2023 +0300 add create tenant metric to storage operations (#4231)
a65e0774a Tue May 16 14:06:47 2023 +0100 Increase shared memory size for regression test run (#4232)
4a67f60a3 Tue May 16 09:09:50 2023 -0400 bump aws dep version (#4237)
efe9e131a Tue May 16 15:23:50 2023 +0200 Update vendored PostgreSQL to latest patch releases (#4208)
b7db62411 Tue May 16 16:54:29 2023 +0300 Make storage time operations an enum instead of an array (#4238)
511b0945c Tue May 16 10:38:39 2023 -0400 Replace usages of wait_for_active_timeline (#4243)
131343ed4 Tue May 16 17:18:56 2023 +0100 Fix regress-tests job for Postgres 15 on release branch (#4253)
4431779e3 Tue May 16 12:53:17 2023 -0400 refactor: attach: use create_tenant_files + schedule_local_tenant_processing (#4235)
1bceceac5 Wed May 17 11:03:46 2023 +0200 add helper to debug_assert that current span has a TenantId (#4248)
ef41b63db Wed May 17 12:25:01 2023 +0300 docs: add links to the doc for better read experience (#4258)
30fe31060 Wed May 17 11:30:07 2023 +0100 Code Coverage: upload reports to S3 (#4256)
89307822b Wed May 17 12:31:17 2023 +0200 mgmt api: share a single tenant config model struct in Rust and OpenAPI (#4252)
7b9e8be6e Wed May 17 11:38:41 2023 +0100 GitHub Autocomment: add a command to run all failed tests (#4200)
0c4dc55a3 Wed May 17 13:35:56 2023 +0100 Disable recovery_prefetch for Neon hot standby. Prefetching of blocks referenced in WAL doesn't make sense for us, because Neon hot standby anyway ignores pages that are not in the shared_buffers.
9767432cf Wed May 17 16:48:00 2023 +0300 add `cargo neon` shortcut for neon_local (#4240)
918cd2545 Wed May 17 16:19:02 2023 +0200 ondemand_download_large_rel: solve flakyness (#3697)
72346e102 Wed May 17 17:29:54 2023 +0300 Document that our code is mostly not async cancellation-safe.
fc886dc8c Wed May 17 17:43:50 2023 +0200 Compile pg_cron extension
8ebae74c6 Thu May 18 14:36:45 2023 +0100 Fix handling of XLOG_XACT_COMMIT/ABORT: Previously we didn't handle XACT_XINFO_HAS_INVALS and XACT_XINFO_HAS_DROPPED_STAT correctly, which led to getting incorrect value of twophase_xid for records with XACT_XINFO_HAS_TWOPHASE. This caused 'twophase file for xid {} does not exist' errors in test_isolation
1b2ece371 Thu May 18 19:56:09 2023 +0100 Re-enable compatibility tests on Postgres 15 (#4274)
5abc4514b Thu May 18 22:38:33 2023 +0100 Un-xfail fixed tests on Postgres 15 (#4275)
b391c9444 Thu May 18 21:16:09 2023 -0400 tenant create / update-config: reject unknown fields (#4267)
7529ee2ec Fri May 19 14:35:33 2023 +0300 rfc: the state of pageserver tenant relocation (#3868)
3837fca7a Fri May 19 15:34:22 2023 +0100 compute-node-image: fix postgis download (#4280)
638845437 Mon May 22 11:59:54 2023 +0300 test: allow benign warning in relation to startup ordering (#4262)
d6cf34767 Tue May 23 15:48:43 2023 +0300 Add an option to set "latest gc cutoff lsn" in pageserver binutils (#4290)
4d41b2d37 Tue May 23 16:29:59 2023 +0300 fix: `max_lsn_wal_lag` broken in tenant conf (#4279)
d75b4e0f1 Tue May 23 14:54:51 2023 +0100 Bump requests from 2.28.1 to 2.31.0 (#4305)
dad351935 Tue May 23 20:01:40 2023 +0300 Add SQL-over-HTTP endpoint to Proxy
00f7fc324 Tue May 23 15:16:12 2023 -0400 tenant_map_insert: don't expose the vacant entry to the closure (#4316)
7f1973f8a Tue May 23 15:20:20 2023 -0700 bump vm-builder, use Neon-specific version (#4155)
417f37b2e Wed May 24 08:01:41 2023 +0300 Pass set of wanted image layers from GC to compaction (#3673)
c200ebc09 Wed May 24 09:11:23 2023 +0400 proxy: log endpoint name everywhere.
f3769d45a Wed May 24 08:15:39 2023 +0300 chore: upgrade tokio to 1.28.1 (#4294)
2a3f54002 Wed May 24 12:47:01 2023 +0100 test_runner: update dependencies (#4328)
35bb10757 Wed May 24 10:11:24 2023 -0400 scripts/ingest_perf_test_result.py: increase connection timeout (#4329)
df52587be Wed May 24 17:46:30 2023 +0300 attach-time tenant config (#4255)
afc48e2cd Wed May 24 16:54:11 2023 +0200 refactor responsibility for tenant/timeline activation (#4317)
712619700 Wed May 24 19:36:07 2023 +0300 pagectl: refactor ctl and support dump kv in delta (#4268)
f276f2163 Thu May 25 00:00:21 2023 +0300 ci: use eu-central-1 bucket (#4315)
e11ba24ec Thu May 25 10:49:09 2023 +0200 tenant loops: operate on the Arc<Tenant> directly (#4298)
6052ecee0 Thu May 25 12:36:57 2023 +0300 Add connector extension to send Role/Database updates to console (#3891)
37ecebe45 Thu May 25 11:37:12 2023 +0200 mgr::get_tenant: distinguished error type (#4300)
83ba02b43 Thu May 25 11:38:04 2023 +0200 tenant_status: don't InternalServerError if tenant not found (#4337)
e5617021a Thu May 25 16:47:42 2023 +0300 refactor: eliminate global storage_broker client state (#4318)
ab2757f64 Thu May 25 10:21:15 2023 -0400 bump dependencies version (#4336)
08e7d2407 Thu May 25 15:55:46 2023 +0100 Storage: use Postgres 15 as default (#2809)
85e76090e Thu May 25 16:22:58 2023 +0000 test: fix ancestor is stopping flakyness (#4234)
ae805b985 Thu May 25 09:33:18 2023 -0700 Bump vm-builder v0.7.3-alpha3 -> v0.8.0 (#4339)
057cceb55 Thu May 25 20:26:43 2023 +0200 refactor: make timeline activation infallible (#4319)
2b25f0dfa Fri May 26 00:05:11 2023 +0300 Fix flakiness of test_metric_collection (#4346)
024109fbe Fri May 26 13:35:50 2023 +0300 Allow for higher s3 concurrency (#4292)
a560b2882 Fri May 26 16:19:36 2023 +0300 Make new tenant/timeline IDs mandatory in create APIs. (#4304)
339a3e314 Fri May 26 14:49:42 2023 +0100 GitHub Autocomment: comment commits for branches (#4335)
be177f82d Fri May 26 18:37:17 2023 +0300 Revert "Allow for higher s3 concurrency (#4292)" (#4356)
4e359db4c Fri May 26 17:15:47 2023 -0400 pgserver: spawn_blocking in compaction (#4265)
200a520e6 Sat May 27 11:47:22 2023 +0300 Minor refactoring in RequestSpan
2cdf07f12 Sat May 27 11:47:22 2023 +0300 Refactor RequestSpan into a function.
2d6a022bb Sat May 27 15:55:43 2023 +0300 Don't allow two timeline_delete operations to run concurrently. (#4313)
ccf653c1f Sun May 28 10:22:45 2023 -0700 re-enable file cache integration for VM compute node (#4338)
f4f300732 Mon May 29 17:52:41 2023 +0300 refactor TenantState transitions (#4321)
cb8349574 Mon May 29 21:48:38 2023 +0300 try: startup speedup (#4366)
db1435536 Tue May 30 10:40:37 2023 +0300 revert: static global init logical size limiter (#4368)
daa79b150 Tue May 30 14:05:41 2023 +0100 Code Coverage: store lcov report (#4358)
210be6b6a Tue May 30 16:08:02 2023 +0300 Replace broker duration logs with metrics (#4370)
f4db85de4 Tue May 30 16:25:07 2023 +0300 Continued startup speedup (#4372)
b190c3e6c Tue May 30 20:11:44 2023 +0300 reduce flakiness by allowing Compaction failed, retrying in X queue is in state Stopped. (#4379)
b6447462d Wed May 31 12:23:00 2023 -0400 Fix layer map correctness bug (#4342)
952d6e43a Wed May 31 21:37:20 2023 +0300 Add pageserver parameter forced_image_creation_limit which can be used… (#4353)
330083638 Thu Jun 1 05:04:46 2023 +0300 Fix stale and misleading comment in LayerMap (#4297)
36fee50f4 Thu Jun 1 20:12:07 2023 +0300 compute_ctl: enable tracing panic hook (#4375)
82484e824 Thu Jun 1 21:46:04 2023 +0300 pgserver: add more metrics for better observability (#4323)
66cdba990 Thu Jun 1 22:06:28 2023 +0300 refactor: use PersistentLayerDesc for persistent layers (#4398)
ef80a902c Fri Jun 2 14:59:10 2023 +0300 pg_sni_router: add session_id to more messages (#4403)
9787227c3 Fri Jun 2 08:28:13 2023 -0400 Shield HTTP request handlers from async cancellations. (#4314)
a55c66384 Fri Jun 2 21:03:12 2023 +0300 chore: comment marker fixes (#4406)
4ba950a35 Fri Jun 2 18:07:45 2023 -0400 Add libcurl as dependency to readme (#4405)
04542826b Sun Jun 4 11:41:38 2023 +0300 Add HNSW extension (#4227)
8caef2c0c Mon Jun 5 09:37:53 2023 +0300 fix: delay `eviction_task` as well (#4397)
b9871158b Mon Jun 5 12:52:13 2023 +0300 Compile PGX ULID extension (#4413)
8142edda0 Mon Jun 5 15:43:52 2023 +0300 test: Less flaky gc (#4416)
77598f5d0 Mon Jun 5 17:35:23 2023 +0300 Better walreceiver logging (#4402)
e0bd81ce1 Mon Jun 5 18:12:58 2023 +0300 test: fix flaky warning on attach (#4415)
8e1b5e122 Mon Jun 5 20:10:19 2023 +0300 Remove  -ftree-vectorizer-verbose=0 option notrecognized by MaxOS/X c… (#4412)
ac11e7c32 Mon Jun 5 22:04:15 2023 -0800 Remove arch-specific stuff from HNSW extension (#4423)
18a9d47f8 Tue Jun 6 13:51:39 2023 +0300 test: restore NotConnected being allowed globally (#4426)
0cef7e977 Tue Jun 6 15:30:55 2023 +0300 refactor: just one way to shutdown a tenant (#4407)
df3bae2ce Tue Jun 6 14:59:36 2023 +0100 Use `compute_ctl` to manage Postgres in tests.  (#3886)
dc6a38287 Wed Jun 7 12:39:20 2023 +0400 Increase timeouts on compute -> sk connections.
c058e1cec Wed Jun 7 12:39:20 2023 +0400 Quick exit in truncate_wal if nothing to do.
6b3c020cd Wed Jun 7 12:39:20 2023 +0400 Don't warn on system id = 0 in walproposer greeting.
88f0cfc57 Wed Jun 7 11:41:53 2023 +0200 Fix `pgx_ulid` extension (#4431)
5761190e0 Wed Jun 7 14:29:23 2023 +0300 feat: three phased startup order (#4399)
37bf2cac4 Wed Jun 7 17:23:37 2023 +0400 Persist safekeeper control file once in a while.
1c200bd15 Wed Jun 7 17:51:13 2023 +0300 fix: break dev dependencies between wal_craft and pg_ffi (#4424)
1a1019990 Wed Jun 7 18:25:30 2023 +0300 map TenantState::Broken to TenantAttachmentStatus::Failed (#4371)
2e687bca5 Wed Jun 7 18:28:18 2023 +0300 refactor: use LayerDesc in layer map (part 1) (#4408)
8560a98d6 Thu Jun 8 13:25:30 2023 +0300 fix openapi spec to pass swagger editor validation (#4445)
d53f9ab3e Thu Jun 8 15:01:22 2023 +0300 delete timelines from s3 (#4384)
d73639646 Thu Jun 8 16:00:18 2023 +0300 Add more output options to proxy json endpoint
c82d19d8d Thu Jun 8 16:00:18 2023 +0300 Fix NULLs handling in proxy json endpoint
6bac77081 Thu Jun 8 18:11:33 2023 -0400 Add cold start test (#4436)
cdce04d72 Thu Jun 8 19:34:25 2023 -0400 pgserver: add local manifest for atomic operation (#4422)
add51e137 Fri Jun 9 13:23:12 2023 +0300 Add delete_objects to storage api (#4449)
a21b55fe0 Fri Jun 9 17:38:53 2023 +0300 Use connect_timeout for broker::connect (#4452)
fbf0367e2 Sun Jun 11 19:14:30 2023 +0100 build(deps): bump cryptography from 39.0.1 to 41.0.0 (#4409)
227271cca Sun Jun 11 22:53:08 2023 +0400 Switch safekeepers to async.
7e17979d7 Sun Jun 11 22:53:08 2023 +0400 feat: http request logging on safekeepers.
e9072ee17 Mon Jun 12 11:13:33 2023 +0200 Compile rdkit (#4442)
6a65c4a4f Mon Jun 12 09:28:34 2023 +0000  create_test_timeline: always put@initdb_lsn the minimum required keys (#4451)
86dd8c96d Mon Jun 12 11:04:49 2023 +0100 add infrastructure to expect use of initdb_lsn flush optimization
aad918fb5 Mon Jun 12 11:04:49 2023 +0100 create_test_timeline: tests for put@initdb_lsn optimization code
f450369b2 Mon Jun 12 11:56:49 2023 +0100 timeline_init_and_sync: don't hold Tenant::timelines while load_layer_map
8d106708d Mon Jun 12 11:56:49 2023 +0100 Clean up timeline initialization code.
e4f05ce0a Mon Jun 12 11:56:49 2023 +0100 Enable sanity check that disk_consistent_lsn is valid on created timeline.
b0286e3c4 Mon Jun 12 13:42:28 2023 +0000 Always truncate WAL after restart (#4464)
2011cc05c Mon Jun 12 17:45:56 2023 +0100 make Delta{Value,Key}Iter Send (#4472)
939593d0d Mon Jun 12 17:45:56 2023 +0100 refactor check_checkpoint_distance to prepare for async Timeline::layers (#4476)
4936ab684 Mon Jun 12 13:57:02 2023 -0400 compute_ctl: add flag to avoid config step (#4457)
143fa0da4 Tue Jun 13 06:26:03 2023 +0400 Remove timeout on test_close_on_connections_exit
754ceaefa Tue Jun 13 10:15:25 2023 +0200 make TimelineWriter `Send` by using `tokio::sync Mutex` internally (#4477)
1299df87d Tue Jun 13 13:34:56 2023 +0200 [compute_ctl] Fix logging if catalog updates are skipped (#4480)
fdf7a67ed Tue Jun 13 13:49:40 2023 +0200 init_empty_layer_map: use `try_write` (#4485)
3693d1f43 Tue Jun 13 18:38:41 2023 +0200 turn Timeline::layers into tokio::sync::RwLock (#4441)
4385e0c29 Tue Jun 13 22:31:18 2023 +0300 Return more RowDescription fields via proxy json endpoint
a0b399041 Tue Jun 13 22:33:42 2023 +0100 Retry data ingestion scripts on connection errors (#4382)
3164ad705 Tue Jun 13 21:48:09 2023 -0400 compute_ctl: Spec parser forward compatibility test (#4494)
ebee8247b Wed Jun 14 15:38:01 2023 +0300 Move s3 delete_objects to use chunks of 1000 OIDs (#4463)
9484b96d7 Wed Jun 14 15:07:30 2023 +0100 GitHub Autocomment: do not fail the job (#4478)
ee9a5bae4 Wed Jun 14 19:07:42 2023 +0300 Filter only active timelines for compaction (#4487)
a7a0c3cd2 Wed Jun 14 19:24:46 2023 +0300 Invalidate proxy cache in http-over-sql (#4500)
cd3faa8c0 Wed Jun 14 19:04:22 2023 +0200 test_basic_eviction: avoid some sources of flakiness (#4504)
94f315d49 Wed Jun 14 19:03:09 2023 +0100 Remove neon-image-depot job (#4506)
2252c5c28 Wed Jun 14 17:12:34 2023 -0400 metrics: convert some metrics to pageserver-level (#4490)
e60b70b47 Thu Jun 15 15:01:06 2023 +0300 Fix data ingestion scripts (#4515)
76413a0fb Thu Jun 15 15:26:59 2023 +0300 Revert reconnect_timeout to improve performance (#4512)
472cc17b7 Thu Jun 15 17:30:12 2023 +0300 propagate lock guard to background deletion task (#4495)
14d495ae1 Fri Jun 16 14:23:55 2023 +0300 create_delta_layer: improve misleading TODO comment (#4488)
190c3ba61 Fri Jun 16 14:17:37 2023 +0100 Add tags for releases (#4524)
78082d0b9 Fri Jun 16 16:54:41 2023 +0200 create_delta_layer: avoid needless `stat` (#4489)
1b947fc8a Fri Jun 16 18:08:11 2023 +0100 test_runner: workaround rerunfailures and timeout incompatibility (#4469)
3b06a5bc5 Mon Jun 19 15:59:38 2023 +0400 Raise pageserver walreceiver timeouts.
557abc18f Mon Jun 19 16:08:20 2023 +0400 Fix test_s3_wal_replay assertion flakiness.
036fda392 Mon Jun 19 17:25:57 2023 +0300 log timings for compact_level0_phase1 (#4527)
2023e22ed Mon Jun 19 13:14:20 2023 -0400 Add `RelationError` error type to pageserver rather than string parsing error messages (#4508)
90e1f629e Tue Jun 20 11:38:59 2023 -0400 Add test for `skip_pg_catalog_updates` (#4530)
b4c5beff9 Tue Jun 20 15:36:28 2023 -0400 `list_files` function in `remote_storage` (#4522)
75d583c04 Wed Jun 21 14:25:58 2023 +0300 Tenant::load: fix uninit timeline marker processing (#4458)
870740c94 Wed Jun 21 15:50:52 2023 +0300 cargo update -p openssl (#4542)
e4da76f02 Wed Jun 21 18:00:14 2023 +0300 update_gc_info: fix typo in timeline_id tracing field (#4546)
d3aa8a48e Wed Jun 21 16:20:35 2023 +0100 Update client libs for test_runner/pg_clients to their latest versions (#4547)
2f618f46b Thu Jun 22 17:06:16 2023 +0300 Use BUILD_TAG in compute_ctl binary. (#4541)
a010b2108 Fri Jun 23 10:18:06 2023 +0300 pgserver: better template config file (#4554)
d96d51a3b Fri Jun 23 13:09:04 2023 +0200 Update rust to 1.70.0 (#4550)
6c3605fc2 Fri Jun 23 12:47:37 2023 +0100 Nightly Benchmarks: Increase timeout for pgbench-compare job (#4551)
c07b6ffbd Fri Jun 23 12:52:17 2023 +0100 Fix git tag name for release (#4545)
76718472b Fri Jun 23 16:42:12 2023 +0200 add pageserver-global histogram for basebackup latency (#4559)
a3f0dd2d3 Fri Jun 23 15:56:49 2023 +0100 Compile `pg_uuidv7` (#4558)
15456625c Fri Jun 23 15:40:36 2023 -0400 don't use MGMT_REQUEST_RUNTIME for consumption metrics synthetic size worker (#4560)
a500bb06f Fri Jun 23 16:40:50 2023 -0400 use preinitialize_metrics to initialize page cache metrics (#4557)
b1477b444 Sat Jun 24 01:38:27 2023 +0300 Create neon_superuser role, grant it to roles created from control plane (#4425)
c215389f1 Sat Jun 24 10:34:15 2023 +0300 quote_ident identifiers when creating neon_superuser (#4562)
44a441080 Mon Jun 26 11:42:17 2023 +0200 bring back spawn_blocking for `compact_level0_phase1` (#4537)
1faf69a69 Mon Jun 26 11:43:11 2023 +0200 run `Layer::get_value_reconstruct_data` in `spawn_blocking` (#4498)
00d1cfa50 Mon Jun 26 14:10:27 2023 -0400 bump VM_BUILDER_VERSION to 0.11.0 (#4566)
a7f3f5f35 Tue Jun 27 10:57:28 2023 +0300 Revert "run `Layer::get_value_reconstruct_data` in `spawn_blocking`#4498" (#4569)
148f0f9b2 Tue Jun 27 10:55:03 2023 +0100 Compile `pg_roaringbitmap` extension (#4564)
681c6910c Tue Jun 27 13:56:32 2023 +0300 Straighten the spec for timeline delete  (#4538)
d748615c1 Tue Jun 27 15:01:32 2023 +0300 RemoteTimelineClient::delete_all() to use s3::delete_objects (#4461)
250a27fb8 Tue Jun 27 16:23:22 2023 +0100 Upload Postgres Extensions to S3 (#4505)
ef2b9ffbc Tue Jun 27 12:05:27 2023 -0400 Basebackup forward compatibility (#4572)
7fe0a4bf1 Tue Jun 27 20:05:10 2023 +0300 Fix promote-images job (#4577)
195d4932c Wed Jun 28 09:04:13 2023 +0300 Set LwLSN after WAL records when redo is performed or skipped (#4579)
02ef246db Wed Jun 28 06:18:45 2023 +0000 refactor: to pattern of await after timeout (#4432)
ec9b58583 Wed Jun 28 12:35:52 2023 +0300 Add Activating as a possible state for attaching a tenant in test_tenant_relocation validation (#4581)
c19681bc1 Wed Jun 28 11:39:07 2023 -0400 neon_local: support force init (#4363)
44e7d5132 Thu Jun 29 15:53:16 2023 +0300 fix: hide token from logs (#4584)
b2a5e91a8 Thu Jun 29 16:33:26 2023 +0300 Upload custom extensions to S3 (#4585)
ca0e0781c Thu Jun 29 16:56:17 2023 +0300 use const instead of magic number for repartition threshold (#4286)
032b60301 Thu Jun 29 10:55:02 2023 -0400 Fix: Wrong Enum Variant (#4589)
7e20b49da Thu Jun 29 15:06:07 2023 -0400 refactor: use LayerDesc in LayerMap (part 2) (#4437)
b99020049 Fri Jun 30 15:01:06 2023 +0300 tests: use shortcut everywhere to get timeline path (#4586)
f558f88a0 Fri Jun 30 14:53:21 2023 +0200 refactor: distinguished error type for timeline creation failure (#4597)
3e55d9dec Fri Jun 30 16:29:10 2023 +0300 Bump vendor/postgres Point to REL_14_STABLE_neon and REL_15_STABLE_neon. This change updates PostgreSQL versions to 14.8 and 15.3
fbd37740c Fri Jun 30 21:55:56 2023 +0300 Make file_cache logging less verbose (#4601)
9de1a6fb1 Fri Jun 30 16:29:47 2023 -0400 cold starts: Run sync_safekeepers on compute_ctl shutdown (#4588)
c9f05d418 Fri Jun 30 23:49:06 2023 +0300 Bump vm-builder v0.11.0 -> v0.11.1 (#4605)
ff1a1aea8 Fri Jun 30 14:17:44 2023 -0700 Make control plane connector send encrypted password (#4607)
4957bb2d4 Mon Jul 3 11:53:57 2023 +0100 fix(proxy): stray span enter globbers up logs (#4612)
86604b3b7 Mon Jul 3 07:37:30 2023 -0400 Delete Unnecessary files in Extension Bucket (#4606)
26828560a Mon Jul 3 15:20:49 2023 +0300  Add timeouts and retries to consumption metrics reporting client (#4563)
24eaa3b7c Mon Jul 3 15:21:10 2023 +0300 timeline creation: reflect failures due to ancestor LSN issues in status code (#4600)
78a7f6890 Mon Jul 3 13:51:40 2023 +0100 Make pg_version and build_type regular parameters (#4311)
cff7ae0b0 Mon Jul 3 16:37:02 2023 +0300 fix: no more ansi colored logs (#4613)
10110bee6 Mon Jul 3 18:10:44 2023 +0300 fix setup instructions (#4615)
9c8c55e81 Mon Jul 3 19:34:07 2023 +0200 Add _cached and _bytes to pageserver_tenant_synthetic_size metric name (#4616)
ab2ea8cfa Tue Jul 4 14:54:59 2023 +0100 use pbkdf2 crate (#4626)
10aba174c Tue Jul 4 17:40:51 2023 +0300 metrics: Remove comments regarding upgradeable rwlocks (#4622)
cbf9a4088 Tue Jul 4 20:34:22 2023 +0300 Set a shorter timeout for the initial connection attempti in proxy.
c7143dbde Tue Jul 4 19:07:36 2023 -0400 compute_ctl: Fix misleading metric (#4608)
3f9defbfb Wed Jul 5 10:38:32 2023 +0200 page cache: add access & hit rate metrics (#4628)
f1db87ac3 Wed Jul 5 11:40:38 2023 +0300 Check if there is enough memory for HNSW index (#4602)
dbf88cf2d Wed Jul 5 12:00:03 2023 +0300 Minimalistic pool for http endpoint compute connections (under opt-in flag)
c92b7543b Wed Jul 5 13:39:51 2023 +0300 Update `pgvector` to 0.4.4 (#4632)
7d7cd8375 Wed Jul 5 14:04:05 2023 +0200 callers of task_mgr::spawn: some top-level async blocks were missing tenant/timeline id (#4283)
1c516906e Wed Jul 5 14:27:50 2023 +0200 Impl Display for LayerFileName and require it for Layer (#4630)
505aa242a Wed Jul 5 15:36:42 2023 +0300 page cache: add size metrics (#4629)
6fb7edf49 Wed Jul 5 18:40:25 2023 +0100 Compile `pg_embedding` extension (#4634)
434eaadbe Thu Jul 6 11:58:41 2023 +0300 Move uninitialized timeline from tenant.rs to timeline/uninit.rs
e418fc6dc Thu Jul 6 11:58:41 2023 +0300 move some tracing related assertions to separate module for tenant and timeline
b26351086 Thu Jul 6 11:58:41 2023 +0300 move some logical size bits to separate logical_size.rs
91435006b Thu Jul 6 10:11:24 2023 +0100 Fix docker-compose file and document (#4621)
269e20aea Thu Jul 6 12:32:34 2023 +0300 fix: filter out zero synthetic sizes (#4639)
1741edf93 Thu Jul 6 12:47:43 2023 +0300 Pageserver reconnect v2 (#4519)
d340cf372 Thu Jul 6 18:21:45 2023 +0300 dump more info in layer map (#4567)
634be4f4e Thu Jul 6 19:56:28 2023 +0400 Fix async write in safekeepers.
20137d958 Thu Jul 6 19:49:14 2023 +0300 Polish tracing helpers (#4651)
4f280c295 Fri Jul 7 16:53:14 2023 +0200 Small pageserver cleanups (#4657)
ac758e4f5 Fri Jul 7 19:50:50 2023 +0300 allow repeated IO errors from compute node (#4624)
1f151d03d Fri Jul 7 18:21:15 2023 +0100 Dockerfile.compute-node: support arm64 (#4660)
76b1cdc17 Mon Jul 10 10:23:37 2023 +0200 Order tenant_id argument before timeline_id, use references (#4671)
49efcc377 Mon Jul 10 12:49:22 2023 +0300 walredo: add tenant_id to span of NoLeakChild::drop (#4640)
5177c1e4b Mon Jul 10 09:22:06 2023 -0400 pagectl: separate xy margin for draw timeline (#4669)
65ff256bb Mon Jul 10 15:23:40 2023 +0200 page_service: add peer_addr span field, and set tenant_id / timeline_id fields earlier (#4638)
08bfe1c82 Mon Jul 10 19:40:37 2023 +0300 remove `LayerDescriptor` and use `LayerObject` for tests (#4637)
33c2d94ba Mon Jul 10 20:01:01 2023 +0100 Fix git-env version for PRs (#4641)
618d36ee6 Mon Jul 10 15:34:26 2023 -0400 compute_ctl: log a structured event on successful start (#4679)
5e2f29491 Tue Jul 11 12:45:25 2023 +0200 Update vm-builder v0.11.1 -> v0.12.1 (#4680)
92aee7e07 Tue Jul 11 13:11:23 2023 -0400 cold starts: basebackup compression (#4482)
a1d6b1a4a Wed Jul 12 11:38:36 2023 +0100 proxy wake_compute loop (#4675)
1355bd0ac Wed Jul 12 15:52:14 2023 +0200 layer deletion: Improve a comment and fix TOCTOU (#4673)
87dd37a2f Wed Jul 12 16:58:40 2023 +0300 pageserver: Align tenant, timeline id names in spans (#4687)
ed845b644 Wed Jul 12 15:12:37 2023 +0100 Prevent unintentional Postgres submodule update (#4692)
664d32eb7 Wed Jul 12 18:10:49 2023 +0200 Don't propagate but log file not found error in layer uploading (#4694)
3a1be9b24 Wed Jul 12 17:48:20 2023 +0100 Broadcast before exiting sync safekeepers (#4700)
444d6e337 Wed Jul 12 19:58:55 2023 +0200 add rfcs/022-user-mgmt.md (#3838)
0626e0bfd Thu Jul 13 11:03:37 2023 +0100 proxy: refactor some error handling and shutdowns (#4684)
db4d094af Thu Jul 13 11:47:27 2023 +0100 proxy: add more error cases to retry connect (#4707)
ed938885f Thu Jul 13 13:18:35 2023 +0200 [compute_ctl] Fix deletion of template databases (#4661)
c76b74c50 Thu Jul 13 17:35:27 2023 +0300 semantic layer map operations (#4618)
cc82cd1b0 Fri Jul 14 17:45:25 2023 +0300 spanchecks: Support testing without tracing (#4682)
9a69b6cb9 Fri Jul 14 18:59:16 2023 +0300 Demote deletion warning, list files (#4688)
1309571f5 Fri Jul 14 19:11:01 2023 +0300 proxy: switch to structopt for clap parsing (#4714)
e767ced8d Fri Jul 14 18:34:01 2023 +0200 Update rust to 1.71.0 (#4718)
982fce1e7 Sat Jul 15 05:11:25 2023 +0300 Fix rustdoc warnings and test cargo doc in CI (#4711)
edccef451 Sat Jul 15 11:58:15 2023 +0100 Make CI more friendly for external contributors (#4663)
53470ad12 Sat Jul 15 14:36:13 2023 +0300 Bump cryptography from 41.0.0 to 41.0.2 (#4724)
2eae0a1fe Sat Jul 15 15:38:15 2023 -0700 Update vm-builder v0.12.1 -> v0.13.1 (#4728)
48936d44f Sun Jul 16 13:40:59 2023 +0300 Update postgres version (#4727)
35e73759f Mon Jul 17 12:49:58 2023 +0200 Reword comment and add comment on race condition (#4725)
966213f42 Mon Jul 17 13:46:13 2023 +0200 basebackup query metric: use same buckets as control plane (#4732)
1aad8918e Mon Jul 17 09:21:42 2023 -0400 Document recommended ccls setup (#4723)
1066bca5e Mon Jul 17 17:26:29 2023 +0300 compaction: allow duplicated layers and skip in replacement (#4696)
7c85c7ea9 Mon Jul 17 15:53:01 2023 +0100 proxy: merge connect compute (#4713)
be271e3ed Mon Jul 17 17:18:33 2023 +0100 Use upstream version of tokio-tar (#4722)
149dd36b6 Mon Jul 17 14:47:08 2023 -0400 Update pg: add startup logs (#4736)
196943c78 Mon Jul 17 20:01:25 2023 +0100 CORS preflight OPTIONS support for /sql (http fetch) endpoint (#4706)
e074ccf17 Mon Jul 17 20:05:26 2023 +0100 reduce proxy timeouts (#4708)
4580f5085 Mon Jul 17 20:09:45 2023 +0100 test_runner: run benchmarks in parallel (#4683)
2e8a3afab Mon Jul 17 22:20:23 2023 +0100 proxy: merge handle_client (#4740)
762a8a7bb Tue Jul 18 12:56:40 2023 +0300 python: more linting (#4734)
b4d36f572 Tue Jul 18 13:50:44 2023 +0100 Use sharded-slab from crates (#4729)
1e7db5458 Wed Jul 19 06:03:51 2023 +0400 Add one more WAL service port allowing only tenant scoped auth tokens.
921bb8690 Wed Jul 19 06:03:51 2023 +0400 Use safekeeper tenant only port in all tests and actually test it.
d4a5fd525 Wed Jul 19 15:44:14 2023 +0100 Disable extension uploading to S3 (#4751)
f09e82270 Wed Jul 19 19:08:25 2023 +0100 Update comment for hnsw extension (#4755)
e1061879a Wed Jul 19 23:46:16 2023 -0400 Improve startup python test (#4757)
9e871318a Thu Jul 20 13:14:13 2023 +0300 Wait detaches or ignores on pageserver shutdown (#4678)
27c73c874 Thu Jul 20 12:32:57 2023 +0100 Bump pg_embedding extension (#4758)
d98cb3997 Thu Jul 20 16:19:38 2023 +0200 pageserver: use tokio::time::timeout where possible (#4756)
8d27a9c54 Thu Jul 20 17:45:10 2023 +0300 Less verbose eviction failures (#4737)
89746a48c Thu Jul 20 19:55:40 2023 +0300 chore: fix copypaste caused flakyness (#4763)
3fc3666df Thu Jul 20 13:39:19 2023 -0400 make flush frozen layer an atomic operation (#4720)
8d0f4a785 Thu Jul 20 22:33:50 2023 +0300 Bump aiohttp from 3.7.4 to 3.8.5 (#4762)
1685593f3 Fri Jul 21 10:15:44 2023 -0400 stable merge and sort in compaction (#4573)
25d2f4b66 Fri Jul 21 15:10:55 2023 +0000 metrics: chunked responses (#4768)
457e3a3eb Fri Jul 21 21:20:53 2023 +0300 Mx offset bug (#4775)
7feb0d1a8 Fri Jul 21 15:17:16 2023 -0400 `unwrap` instead of passing `anyhow::Error` on failure to spawn a thread (#4779)
e5b7ddfee Mon Jul 24 14:01:54 2023 +0200 Preparatory pageserver async conversions (#4773)
407a20cea Mon Jul 24 20:41:42 2023 +0300 add proxy unit tests for retry connections (#4721)
294b8a8fd Tue Jul 25 00:43:27 2023 +0300 Convert per timeline metrics to global (#4769)
a25504dea Tue Jul 25 10:19:04 2023 +0300 Limit concurrent compactions (#4777)
77a68326c Tue Jul 25 11:15:54 2023 +0300 Thin out TenantState metric, keep set of broken tenants (#4796)
f9214771b Tue Jul 25 12:31:24 2023 +0300 fix: count broken tenant more correct (#4800)
f2e2b8a7f Tue Jul 25 14:39:29 2023 +0300 fix some typos (#4662)
062159ac1 Tue Jul 25 13:03:55 2023 +0100 support non-interactive transactions in sql-over-http (#4654)
6d023484e Tue Jul 25 16:25:27 2023 +0300 Use mark file to allow for deletion operations to continue through restarts (#4552)
bcc2aee70 Tue Jul 25 15:08:24 2023 +0000 proxy: add tests for batch http sql (#4793)
2ebd2ce2b Tue Jul 25 18:57:42 2023 +0300 proxy: record connection type (#4802)
520046f5b Tue Jul 25 19:44:18 2023 -0400 cold starts: Add sync-safekeepers fast path (#4804)
700d92952 Wed Jul 26 14:05:18 2023 +0300 Init Timeline in Stopping state in create_timeline_struct when Cause::Delete (#4780)
916a5871a Wed Jul 26 08:10:49 2023 -0400 compute_ctl: Parse sk connstring (#4809)
5f8fd640b Wed Jul 26 15:24:03 2023 +0300 Upload Test Remote Extensions (#4792)
86a61b318 Wed Jul 26 16:32:56 2023 +0300 Bump certifi from 2022.12.7 to 2023.7.22 (#4815)
b98419ee5 Wed Jul 26 15:19:18 2023 +0100 Fix allure report overwriting for different Postgres versions (#4806)
35370f967 Wed Jul 26 15:03:51 2023 +0000 proxy: add some connection init logs (#4812)
5705413d9 Wed Jul 26 17:20:09 2023 +0200 Use OnceLock instead of manually implementing it (#4805)
231d7a761 Wed Jul 26 16:34:46 2023 +0100 proxy: retry compute wake in auth (#4817)
874c31976 Wed Jul 26 18:39:32 2023 +0300 dedup cleanup fs traces (#4778)
48ce95533 Wed Jul 26 20:20:12 2023 +0300 test: allow normal warnings in test_threshold_based_eviction (#4801)
b9a7a661d Wed Jul 26 15:55:55 2023 -0400 add list of public extensions and lookup table for libraries (#4807)
395bd9174 Thu Jul 27 10:22:44 2023 +0300 test: allow future image layer warning (#4818)
3e425c40c Thu Jul 27 15:40:53 2023 +0300 fix(compute_ctl): remove stray variable in error message (#4823)
cafbe8237 Thu Jul 27 15:52:36 2023 +0300 Move tenant/delete.rs to tenant/timeline/delete.rs (#4825)
67d2fa6de Thu Jul 27 19:13:58 2023 +0300 test: fix `test_neon_cli_basics` flakyness without making it better for future (#4827)
3681fc39f Fri Jul 28 10:03:18 2023 -0400 modify `relative_path_to_s3_object` logic for `prefix=None` (#4795)
9fdd3a4a1 Fri Jul 28 16:00:55 2023 +0100 test_runner: add amcheck to test_compatibility (#4772)
737463484 Fri Jul 28 16:15:31 2023 +0100 test_runner: clean up test_compatibility (#4770)
2fbdf2609 Fri Jul 28 14:32:01 2023 -0400 test: raise timeout to avoid flakyness (#4832)
4338eed8c Fri Jul 28 22:06:03 2023 +0300 Make it possible to grant self perfmissions to self created roles (#4821)
a8f3540f3 Fri Jul 28 19:10:55 2023 -0400 proxy: add unit test for wake_compute (#4819)
89ee8f202 Mon Jul 31 07:43:12 2023 +0000 fix: demote warnings, fix flakyness (#4837)
e5183f85d Mon Jul 31 12:52:29 2023 +0200 Make DiskBtreeReader::dump async (#4838)
f0ad60369 Mon Jul 31 12:51:18 2023 +0100 pageserver: add unit test for deleted_at in IndexPart (#4844)
eb7860312 Mon Jul 31 09:30:24 2023 -0400 proxy: div by zero (#4845)
705ae2dce Mon Jul 31 14:40:52 2023 +0100 Fix error message for listen_pg_addr_tenant_only binding (#4787)
e1424647a Mon Jul 31 20:23:18 2023 +0300 Update pg_embedding to 0.3.1 version (#4811)
39e458f04 Mon Jul 31 20:49:46 2023 +0300 test_compatibility: fix pg_tenant_only_port port collision (#4850)
ddbe17045 Mon Jul 31 14:13:32 2023 -0400 Prewarm compute nodes (#4828)
326189d95 Mon Jul 31 22:10:19 2023 +0300 consumption_metrics: send timeline_written_size_delta (#4822)
7b6c84945 Tue Aug 1 02:59:11 2023 +0300 support isolation level + read only for http batch sql (#4830)
a98a80abc Tue Aug 1 10:04:45 2023 +0300 Deffine NEON_SMGR to make it possible for extensions to use Neon SMG API (#4840)
69528b7c3 Tue Aug 1 13:38:35 2023 +0200 Prepare k-merge in compaction for async I/O (#4836)
7c076edee Tue Aug 1 13:17:49 2023 +0100 pageserver: tweak period of imitate_layer_accesses (#4859)
78fa2b13e Tue Aug 1 15:30:36 2023 +0300 test: written_size_bytes_delta (#4857)
3a00a5deb Tue Aug 1 18:14:16 2023 +0300 refactor: tidy consumption metrics (#4860)
c3fe335ea Tue Aug 1 18:28:18 2023 +0300 wait for tenant to be active before polling for timeline absence (#4856)
04776ade6 Tue Aug 1 19:18:25 2023 +0300 fix(consumption): rename _size_ => _data_ (#4866)
d005c77ea Wed Aug 2 12:38:12 2023 +0300 Tar Remote Extensions (#4715)
381f41e68 Wed Aug 2 14:10:36 2023 +0300 Bump cryptography from 41.0.2 to 41.0.3 (#4870)
ca4d71a95 Wed Aug 2 18:18:33 2023 +0300 Upgrade pg_embedding to 0.3.5 (#4873)
e0b05ecaf Wed Aug 2 20:34:21 2023 +0300 build: ca-certificates need to be present (#4880)
4ad0c8f96 Wed Aug 2 14:19:06 2023 -0400 compute_ctl: Prewarm before starting http server (#4867)
df49a9b7a Wed Aug 2 19:31:09 2023 +0100 pagekeeper: suppress error logs in shutdown/detach (#4876)
416c14b35 Thu Aug 3 15:30:41 2023 +0200 Compaction: sort on slices directly instead of kmerge (#4839)
cd33089a6 Thu Aug 3 16:44:48 2023 +0300 test_runner: set AWS credentials for endpoints (#4887)
1497a4229 Thu Aug 3 17:20:24 2023 +0300 tests: split neon_fixtures.py (#4871)
e71d8095b Thu Aug 3 15:23:23 2023 +0100 README: make it a bit clearer how to get regression tests running (#4885)
a241c8b2a Thu Aug 3 17:36:46 2023 +0200 Make DiskBtreeReader::{visit, get} async  (#4863)
5263b39e2 Thu Aug 3 20:34:05 2023 +0300 fix: shutdown logging again (#4886)
682dfb3a3 Thu Aug 3 14:26:14 2023 -0400 bump vm-builder to v0.15.0-alpha1 (#4895)
6a906c68c Fri Aug 4 12:35:45 2023 +0300 Make {DeltaLayer,ImageLayer}::{load,load_inner} async (#4883)
606caa0c5 Fri Aug 4 12:37:18 2023 +0300 proxy: update logs and span data to be consistent and have more info (#4878)
e3e739ee7 Fri Aug 4 17:56:31 2023 +0100 pageserver: remove no-op attempt to report fail/failpoint feature (#4879)
ea3e1b51e Fri Aug 4 21:01:29 2023 +0300 Remote storage metrics (#4892)
ba9df27e7 Fri Aug 4 21:03:17 2023 +0300 fix: silence not found error when removing ephmeral (#4900)
95ec42f2b Sun Aug 6 20:37:09 2023 +0200 Change log levels on various operations (#4914)
64a4fb35c Mon Aug 7 08:24:50 2023 +0100 pagectl: skip `metadata` file in `pagectl draw-timeline` (#4872)
9559ef6f3 Mon Aug 7 18:14:15 2023 +0300 Sort by (key, lsn), not just key (#4918)
33cb1e9c0 Tue Aug 8 09:16:21 2023 +0100 tests: enable higher concurrency and adjust tests with outlier runtime (#4904)
4892a5c5b Tue Aug 8 12:35:24 2023 +0300 pageserver: avoid logging the "ERROR" part of DbErrors that are successes (#4902)
6d17d6c77 Tue Aug 8 12:37:22 2023 +0300 Use WebIdentityTokenCredentialsProvider to access remote extensions  (#4921)
4dc644612 Tue Aug 8 12:41:37 2023 +0300 pageserver: expose prometheus metrics for startup time (#4893)
039017cb4 Tue Aug 8 14:26:38 2023 +0300 Add new flag for advertising pg address (#4898)
0fa85aa08 Tue Aug 8 17:19:24 2023 +0300 proxy: delay auth on retry (#4929)
459253879 Tue Aug 8 20:21:39 2023 +0300 Revert "bump vm-builder to v0.15.0-alpha1 (#4895)" (#4931)
b9f84b960 Tue Aug 8 20:09:38 2023 +0100 Improve test results format (#4549)
6661f4fd4 Tue Aug 8 15:22:10 2023 -0500 bump vm-builder version to v0.15.0-alpha1 (#4934)
1037a8ddd Tue Aug 8 23:41:09 2023 +0200 Explain why VirtualFile stores tenant_id and timeline_id as strings (#4930)
cbd04f514 Wed Aug 9 14:35:56 2023 +0300 remove_remote_layer: uninteresting refactorings (#4936)
4ce7aa9ff Wed Aug 9 15:37:51 2023 +0300 Fix extensions download error handling (#4941)
5993b2bed Wed Aug 9 16:27:53 2023 +0100 test_runner: remove excessive timeouts (#4659)
da128a509 Wed Aug 9 19:13:11 2023 +0300 fix pkglibdir path for remote extensions
c8aed107c Wed Aug 9 19:18:44 2023 +0300 refactor: make {Delta,Image}LayerInners usable without {Delta,Image}Layer (#4937)
94ad9204b Wed Aug 9 13:20:30 2023 -0400 Measure compute-pageserver latency (#4901)
e157b16c2 Wed Aug 9 18:56:09 2023 +0000 if control file already exists ignore the remote version of the extension (#4945)
db48f7e40 Thu Aug 10 11:05:27 2023 +0000 test: mark test_download_extensions.py skipped for now (#4948)
fa1f87b26 Thu Aug 10 13:43:13 2023 +0200 Make the implementation of DiskBtreeReader::visit non-recursive (#4884)
119b86480 Thu Aug 10 15:24:43 2023 +0300 test: make pg_regress less flaky, hopefully (#4903)
71f9d9e5a Thu Aug 10 15:55:41 2023 +0300 test: allow slow shutdown warning (#4953)
17aea78aa Thu Aug 10 16:51:16 2023 +0300 delete already present files from library index (#4955)
c58b22bac Thu Aug 10 18:53:16 2023 +0300 Delete tenant's data from s3  (#4855)
538373019 Thu Aug 10 17:21:52 2023 +0100 Increase max sql-over-http response size from 1MB to 10MB (#4961)
25c66dc63 Thu Aug 10 17:49:24 2023 +0100 proxy: http logging to 11 (#4950)
3a71cf38c Thu Aug 10 21:04:45 2023 +0200 Grant BypassRLS to new neon_superuser roles (#4935)
73d7a9bc6 Thu Aug 10 23:38:22 2023 +0300 proxy: propagate ws span (#4966)
d39fd6677 Fri Aug 11 10:18:13 2023 +0300 tests: remove redundant wait_while (#4952)
3a6b99f03 Fri Aug 11 18:18:07 2023 +0300 proxy: improve http logs (#4976)
9ffccb55f Fri Aug 11 18:01:02 2023 +0200 InMemoryLayer: move end_lsn out of the lock (#4963)
cc2d00fea Fri Aug 11 14:26:53 2023 -0400 bump vm-builder version to v0.15.4 (#4980)
817381358 Sat Aug 12 12:20:13 2023 +0300 Add term=n option to safekeeper START_REPLICATION command.
763f5c064 Mon Aug 14 09:49:51 2023 +0100 Remove dead code from walproposer_utils.c (#4525)
d3a97fdf8 Mon Aug 14 10:18:22 2023 +0100 pageserver: avoid incrementing access time when reading layers for compaction (#4971)
49c57c0b1 Mon Aug 14 14:08:51 2023 +0300 Add neon_local to docker image.
4626d89ed Mon Aug 14 17:16:49 2023 +0300 Harden retries on tenant/timeline deletion path. (#4973)
1ca08cc52 Mon Aug 14 16:07:33 2023 +0100 Changed batch query body to from [...] to { queries: [...] } (#4975)
ef4a76c01 Mon Aug 14 16:19:45 2023 +0100 Update Postgres to v15.4 and v14.9 (#4965)
ce7efbe48 Mon Aug 14 17:20:37 2023 +0200 Turn BlockCursor::{read_blob,read_blob_into_buf} async fn (#4905)
baf395983 Mon Aug 14 18:48:09 2023 +0200 Turn BlockLease associated type into an enum (#4982)
8198b865c Tue Aug 15 12:30:27 2023 +0300 Remote storage metrics follow-up (#4957)
218be9eb3 Tue Aug 15 14:52:00 2023 +0100 Added deferrable transaction option to http batch queries (#4993)
207919f5e Tue Aug 15 15:32:30 2023 +0100 Upload test results to DB right after generation (#4967)
52c2c6935 Tue Aug 15 19:24:23 2023 +0300 fsync directory before mark file removal (#4986)
13adc83fc Tue Aug 15 19:31:20 2023 +0300 Allow to enable http/pg/pg tenant only auth separately in safekeeper.
4687b2e59 Tue Aug 15 19:31:20 2023 +0300 Test that auth on pg/http services can be enabled separately in sks.
5c836ee5b Tue Aug 15 20:14:03 2023 +0300 tests: extend timeout in timeline deletion test (#4992)
1b97a3074 Tue Aug 15 20:57:56 2023 +0300 Disable neon-pool-opt-in (#4995)
fdbe8dc8e Wed Aug 16 12:57:43 2023 +0300 Fix test_s3_wal_replay flakiness.
0f47bc03e Wed Aug 16 14:08:53 2023 +0300 Fix delete_objects in UnreliableWrapper (#5002)
368b783ad Wed Aug 16 15:41:25 2023 +0200 ephemeral_file: remove FileExt impl (was only used by tests) (#5003)
96b84ace8 Wed Aug 16 17:31:16 2023 +0300 Correctly remove orphaned objects in RemoteTimelineClient::delete_all (#5000)
0bdbc39cb Wed Aug 16 18:27:18 2023 +0300 Compaction: unify key and value reference vecs (#4888)
25934ec1b Wed Aug 16 17:20:28 2023 +0100 proxy: reduce global conn pool contention (#4747)
994411f5c Wed Aug 16 18:33:47 2023 +0200 page cache: newtype the blob_io and ephemeral_file file ids (#5005)
d3612ce26 Thu Aug 17 11:47:31 2023 +0300 delta_layer: Restore generic from last week (#5014)
786c7b370 Thu Aug 17 12:48:33 2023 +0300 Refactor remote extensions index download.
957af049c Thu Aug 17 13:07:25 2023 +0300 ephemeral file: refactor write_blob impl to concentrate mutable state (#5004)
c8094ee51 Thu Aug 17 11:46:00 2023 +0100 test_compatibility: run amcheck unconditionally (#4985)
d8b0a298b Thu Aug 17 13:46:49 2023 +0300 Do not attach deleted tenants (#5008)
3e4710c59 Thu Aug 17 12:05:54 2023 +0100 proxy: add more sasl logs (#5012)
64fc7eafc Thu Aug 17 15:37:28 2023 +0300 Increase timeout once again. (#5021)
6af5f9bfe Thu Aug 17 14:30:25 2023 +0000 fix: format context (#5022)
67af24191 Thu Aug 17 19:27:30 2023 +0300 test: cleanup remote_timeline_client tests (#5013)
ec10838aa Fri Aug 18 11:44:08 2023 +0100 proxy: pool connection logs (#5020)
f4da010ae Fri Aug 18 16:36:31 2023 +0200 Make the compaction warning more tolerant (#5024)
0b9041138 Fri Aug 18 16:48:55 2023 +0100 Fix safekeeper recovery with auth (#5035)
0a082aee7 Fri Aug 18 19:36:25 2023 +0300 test: allow race with flush and stopped queue (#5027)
7a63685cd Fri Aug 18 20:31:03 2023 +0300 simplify page-caching of EphemeralFile (#4994)
ed5bce7cb Fri Aug 18 19:34:29 2023 +0200 rfcs: archive my MVCC S3 Notion Proposal (#5040)
f6c671c14 Fri Aug 18 20:48:33 2023 +0300 resume timeline deletions on attach (#5030)
30888a24d Fri Aug 18 20:49:11 2023 +0300 Avoid flakiness in test_timeline_delete_fail_before_local_delete (#5032)
5c6a692cf Fri Aug 18 14:29:20 2023 -0400 bump `VM_BUILDER_VERSION` to v0.16.2 (#5031)
368ee6c8c Sat Aug 19 01:01:44 2023 +0300 refactor: failpoint support (#5033)
a23b0773f Sat Aug 19 00:56:03 2023 +0200 Fix DeltaLayer dumping (#5045)
9140a950f Sun Aug 20 12:28:50 2023 +0300 Resume tenant deletion on attach (#5039)
130ccb4b6 Sun Aug 20 12:33:19 2023 +0300 Remove initial timeline id troubles (#5044)
b95addddd Mon Aug 21 14:29:36 2023 +0300 pageserver: do not read redundant `timeline_layers` from IndexPart, so that we can remove it later (#4972)
615a49023 Mon Aug 21 17:30:28 2023 +0100 pageserver: refactor Tenant/Timeline args into structs (#5053)
4a8bd866f Mon Aug 21 13:29:16 2023 -0400 bump vm-builder version to v0.16.3 (#5055)
0b001a000 Mon Aug 21 19:20:58 2023 +0100 proxy: remove connections on shutdown (#5051)
5cf75d92d Tue Aug 22 18:41:32 2023 +0300 Fix cargo deny errors (#5068)
8c6541fea Tue Aug 22 19:44:31 2023 +0300 chore: add supported targets to deny (#5070)
933a869f0 Tue Aug 22 20:03:14 2023 +0300 refactor: compaction becomes async again (#5058)
8cd20485f Tue Aug 22 20:08:31 2023 +0300 metrics: smgr query time: add a pre-aggregated histogram (#5064)
bf303a657 Tue Aug 22 13:32:29 2023 -0400 Trigger workflow in remote (private) repo to build and upload private extensions (#4944)
533a92636 Tue Aug 22 21:14:28 2023 +0300 refactor: pre-cleanup Layer, PersistentLayer and impls (#5059)
2f97b4331 Tue Aug 22 21:21:44 2023 +0300 build: update tar, get rid of duplicate xattr (#5071)
ad8d777c1 Tue Aug 22 22:12:05 2023 +0300 refactor: remove is_incremental=true for ImageLayers footgun (#5061)
71ccb07a4 Tue Aug 22 22:45:25 2023 +0300 ci: fix upload-postgres-extensions-to-s3 job (#5063)
d597e6d42 Wed Aug 23 16:04:08 2023 +0300 Track list of walreceivers and their voting/streaming state in shmem.
3e2f0ffb1 Thu Aug 24 14:54:46 2023 +0300 libs: make backoff::retry() take a cancellation token (#5065)
76aa01c90 Thu Aug 24 16:07:40 2023 +0300 refactor: single phase Timeline::load_layer_map (#5074)
99a1be6c4 Thu Aug 24 17:14:40 2023 +0300 remove upload step from neon, it is in private repo now (#5085)
f70871dfd Thu Aug 24 17:22:36 2023 +0300 internal-devx: pageserver future layers (#5092)
fa74d5649 Thu Aug 24 16:41:57 2023 +0200 rename `EphmeralFile::size` to `EphemeralFile::len` (#5076)
e8f9aaf78 Thu Aug 24 19:45:23 2023 +0300 Don't use non-existent docker tags (#5096)
227c87e33 Thu Aug 24 19:18:30 2023 +0200 Make EphemeralFile::write_blob function async (#5056)
3128eeff0 Thu Aug 24 15:54:37 2023 -0400 compute_ctl: add vm-monitor (#4946)
18537be29 Thu Aug 24 17:32:46 2023 -0400 monitor: listen on correct port to accept agent connections (#5100)
8c13296ad Fri Aug 25 12:28:01 2023 +0200 Remove `BlockReader::read_blk` in favour of `BlockCursor` (#5015)
faf070f28 Fri Aug 25 15:08:45 2023 +0300 proxy: dont return connection pending (#5107)
f71c82e5d Fri Aug 25 09:10:26 2023 -0400 remove obsolete `need` dependency (#5087)
024e306f7 Fri Aug 25 10:09:53 2023 -0400 monitor: improve logging (#5099)
b758bf47c Fri Aug 25 16:16:20 2023 +0100 pageserver: refactor TimelineMetadata serialization in IndexPart (#5091)
4436c8475 Fri Aug 25 19:48:16 2023 +0300 Change codeowners (#5109)
40268dcd8 Fri Aug 25 13:29:10 2023 -0400 monitor: fix filecache calculations (#5112)
7b5489a0b Fri Aug 25 15:59:12 2023 -0400 compute_ctl: start pg in cgroup for vms (#4920)
fbcd17448 Mon Aug 28 10:51:49 2023 +0300 load_layer_map: schedule deletions for any future layers (#5103)
529f8b501 Mon Aug 28 14:55:41 2023 +0200 compute_ctl: Fix switched vm-monitor args (#5117)
0fe3b3646 Mon Aug 28 20:42:18 2023 +0200 page cache: don't proactively evict EphemeralFile pages (#5129)
e40ee7c3d Mon Aug 28 13:04:57 2023 -0700 remove unused file 'vm-cgconfig.conf' (#5127)
85d6d9dc8 Tue Aug 29 02:59:27 2023 +0300 monitor/compute_ctl: remove references to the informant (#5115)
805fee148 Tue Aug 29 11:49:04 2023 +0300 page cache: small code cleanups (#5125)
babefdd3f Tue Aug 29 12:53:50 2023 +0300 Upgrade pgvector to 0.5.0 (#5132)
7e39a9644 Tue Aug 29 11:53:24 2023 +0100 scripts/flaky_tests.py: Improve flaky tests detection (#5094)
d1fcdf75b Tue Aug 29 14:48:50 2023 +0300 test: enhanced logging for curious mock_s3 (#5134)
8d2a4aa5f Tue Aug 29 12:44:48 2023 -0700 vm-monitor: Add flag for when file cache on disk (#5130)
39e3fbbeb Tue Aug 29 23:19:40 2023 +0300 Add safekeeper peers to TimelineInfo.
87f7d6bce Tue Aug 29 23:19:40 2023 +0300 Start and stop per timeline recovery task.
804ef2304 Tue Aug 29 23:19:40 2023 +0300 Rename TermSwitchEntry to TermLsn.
e98580b09 Tue Aug 29 23:19:40 2023 +0300 Add term and http endpoint to broker messaged SkTimelineInfo.
bc49c73fe Tue Aug 29 23:19:40 2023 +0300 Move wal_stream_connection_config to utils.
81b6578c4 Tue Aug 29 23:19:40 2023 +0300 Allow walsender in recovery mode give WAL till dynamic flush_lsn.
eb0a698ad Wed Aug 30 09:04:31 2023 +0200 Make page cache and read_blk async (#5023)
382473d9a Wed Aug 30 09:49:55 2023 +0100 docs: add RFC for remote storage generation numbers (#4919)
05773708d Wed Aug 30 12:21:41 2023 +0300 fix: add context for ancestor lsn wait (#5143)
e5a397cf9 Wed Aug 30 13:56:51 2023 +0300 Form archive_path for remote extensions on the fly
3b81e0c86 Wed Aug 30 15:14:03 2023 +0100 chore: remove webpki (#5069)
a7c0e4dcd Wed Aug 30 17:47:06 2023 +0300 Check if custiom extension is enabled. This check was lost in the latest refactoring.
a93274b38 Wed Aug 30 16:14:04 2023 +0100 pageserver: remove vestigial `timeline_layers` attribute (#5153)
93dcdb293 Wed Aug 30 16:20:27 2023 +0100 proxy: password hack hack (#5126)
f2c21447c Wed Aug 30 17:44:28 2023 +0200 [compute_ctl] Create check availability data during full configuration (#5084)
83ae2bd82 Thu Aug 31 09:19:34 2023 +0100 pageserver: generation number support in keys and indices (#5140)
b9c111962 Thu Aug 31 12:23:51 2023 +0300 pass JWT to management API (#5151)
300a5aa05 Thu Aug 31 10:40:46 2023 +0100 pageserver: fix test v4_indexpart_is_parsed (#5157)
43bb8bfdb Thu Aug 31 10:42:32 2023 +0100 pageserver: fix flake in test_timeline_deletion_with_files_stuck_in_upload_queue (#5149)
d11621d90 Thu Aug 31 14:30:25 2023 +0300 Proxy: proxy protocol v2 (#5028)
1b916a105 Thu Aug 31 15:50:15 2023 +0300 proxy: locked is not retriable (#5162)
616e7046c Thu Aug 31 19:01:39 2023 +0100 s3_scrubber: import into the main `neon` repository (#5141)
715077ab5 Fri Sep 1 08:36:38 2023 +0100 tests: broaden a log allow regex in `test_ignored_tenant_stays_broken_without_metadata` (#5168)
e9f2c6432 Fri Sep 1 12:59:19 2023 +0100 Wait for custom extensions build before deploy (#5170)
40ce520c0 Fri Sep 1 16:24:04 2023 +0300 remote_timeline_client: tests: run upload ops on the tokio::test runtime (#5177)
5edae96a8 Fri Sep 1 15:24:58 2023 +0200 rfc: Crash-Consistent Layer Map Updates By Leveraging index_part.json (#5086)
aa22000e6 Fri Sep 1 17:30:22 2023 +0200 FileBlockReader<File> is never used (#5181)
cfc0fb573 Fri Sep 1 18:10:40 2023 +0200 pageserver: run all Rust tests with remote storage enabled (#5164)
44da9c38e Fri Sep 1 19:21:33 2023 +0300 proxy: error typo (#5187)
41aa627ec Fri Sep 1 17:29:38 2023 +0100 tests: get test name automatically for remote storage (#5184)
7e817789d Sat Sep 2 10:06:14 2023 +0200 VirtualFile: add crash-safe overwrite abstraction & use it (#5186)
80f10d5ce Mon Sep 4 08:31:55 2023 +0100 pageserver: safe deletion for tenant directories (#5182)
6cd497bb4 Mon Sep 4 12:52:35 2023 +0200 Make VirtualFile::crashsafe_overwrite async fn (#5189)
128a85ba5 Mon Sep 4 17:05:20 2023 +0200 Convert many VirtualFile APIs to async (#5190)
77658a155 Tue Sep 5 12:45:46 2023 +0300 support deploying in IPv6-only environments (#4135)
4904613aa Tue Sep 5 12:55:45 2023 +0200 Convert `VirtualFile::{seek,metadata}` to async (#5195)
7ceddadb3 Tue Sep 5 14:02:37 2023 +0100 Merge custom extension CI jobs (#5194)
89c64e179 Tue Sep 5 20:00:47 2023 +0200 Fix corruption issue in Local File Cache (#5208)
c222320a2 Wed Sep 6 00:48:15 2023 +0100 Generate lcov coverage report (#4999)
dbfb4ea7b Wed Sep 6 10:06:55 2023 +0100 Make CI more friendly for external contributors. Second try (#5210)
15ff4e5fd Wed Sep 6 13:14:07 2023 +0300 approved-for-ci-run.yml: trigger on pull_request_target (#5212)
88b1ac48b Wed Sep 6 13:17:52 2023 +0300 Create Release PR at 7:00 UTC every Tuesday (#5213)
4fec48f2b Wed Sep 6 13:19:19 2023 +0300 chore(pageserver): remove unnecessary logging in tenant task loops (#5188)
8e25d3e79 Wed Sep 6 13:22:57 2023 +0300 test_runner: add scale parameter to tpc-h tests (#5079)
743933176 Wed Sep 6 11:55:24 2023 +0100 scrubber: add `scan-metadata` and hook into integration tests (#5176)
da60f6990 Wed Sep 6 14:55:11 2023 +0300 approved-for-ci-run.yml: use our bot (#5216)
61d661a6c Wed Sep 6 14:44:48 2023 +0100 pageserver: generation number fetch on startup and use in /attach (#5163)
d5f1858f7 Wed Sep 6 18:50:59 2023 +0300 approved-for-ci-run.yml: use different tokens (#5218)
5e00c4416 Wed Sep 6 18:17:12 2023 +0200 Add WriteBlobWriter buffering and make VirtualFile::{write,write_all} async (#5203)
76a96b074 Wed Sep 6 17:52:21 2023 +0100 Notify Slack channel about upcoming releases (#5197)
e4b1d6b30 Wed Sep 6 20:11:44 2023 +0300 Misc post-merge fixes (#5219)
dfe2e5159 Wed Sep 6 13:57:03 2023 -0400 remove the duplicate entries in postgresql.conf (#5090)
9a9187b81 Wed Sep 6 14:00:15 2023 -0400 Complete the missing metrics for files_created/bytes_written (#5120)
31e1568de Wed Sep 6 21:31:49 2023 +0300 refactor(pageserver): refactor pageserver router state creation (#5165)
3a966852a Wed Sep 6 21:40:00 2023 +0300 doc: tests expect lsof (#5226)
6243b44de Wed Sep 6 20:54:57 2023 +0200 Remove Virtual from FileBlockReaderVirtual variant name (#5225)
7ba0f5c08 Wed Sep 6 21:44:54 2023 +0200 Improve comment in page cache (#5220)
706977fb7 Thu Sep 7 14:17:18 2023 +0300 fix(pageserver): add the walreceiver state to tenant timeline GET api endpoint (#5196)
f8a91e792 Thu Sep 7 14:21:01 2023 +0100 Even better handling of `approved-for-ci-run` label (#5227)
1fee69371 Thu Sep 7 14:21:38 2023 +0100 Update `plv8` to 3.1.8 (#5230)
485a2cfdd Thu Sep 7 15:34:22 2023 +0200 Fix pg_config version parsing (#5200)
d15563f93 Thu Sep 7 19:39:42 2023 +0300 Misc workflows: fix quotes in bash (#5235)
c202f0ba1 Thu Sep 7 21:38:55 2023 +0300 Update PostGIS to version 3.3.3 (#5236)
e5adc4efb Thu Sep 7 21:39:12 2023 +0300 Upgrade h3-pg to version 4.1.3. (#5237)
d206655a6 Fri Sep 8 00:50:50 2023 +0200 Make VirtualFile::{open, open_with_options, create,sync_all,with_file} async fn (#5224)
b414360af Fri Sep 8 02:06:53 2023 +0300 Upgrade ip4r to version 2.4.2 (#5242)
252b953f1 Fri Sep 8 02:07:17 2023 +0300 Upgrade postgresql-hll to version 2.18. (#5241)
6c31a2d34 Fri Sep 8 02:10:01 2023 +0300 Upgrade prefix extension to version 1.2.10 (#5244)
57c1ea49b Fri Sep 8 03:30:11 2023 +0300 Update hypopg extension to version 1.4.0 (#5245)
b80740bf9 Fri Sep 8 01:57:38 2023 +0100 test_startup: increase timeout (#5238)
dac995e7e Fri Sep 8 10:46:02 2023 +0300 Update plpgsql_check extension to version v2.4.0 (#5249)
cdc65c185 Fri Sep 8 12:42:46 2023 +0300 Update pg_cron to version 1.6.0 (#5252)
ff87fc569 Fri Sep 8 13:54:23 2023 +0300 test: Remote storage refactorings (#5243)
720d59737 Fri Sep 8 16:28:41 2023 +0300 rust-1.72.0 changes (#5255)
499d0707d Fri Sep 8 18:05:08 2023 +0300 Perform throttling for concurrent build index which is done outside transaction (#5048)
7b6337db5 Fri Sep 8 16:19:57 2023 +0100 tests: enable multiple pageservers in `neon_local` and `neon_fixture` (#5231)
028fbae16 Fri Sep 8 16:28:09 2023 +0100 Miscellaneous fixes for tests-related things (#5259)
66633ef2a Fri Sep 8 19:36:02 2023 +0300 rust-toolchain: use 1.72.0, same as CI (#5256)
60050212e Fri Sep 8 19:40:29 2023 +0300 Update rdkit to version 2023_03_03. (#5260)
6f28da173 Fri Sep 8 20:27:00 2023 +0300 fix: LocalFs root in test_compatibility is PosixPath('...') (#5261)
ba06ea26b Sat Sep 9 17:51:16 2023 +0300 Fix issues with reanabling LFC (#5209)
f64b338ce Sat Sep 9 21:51:04 2023 +0300 Ingore DISK_FULL error when performing availability check for client (#5010)
1ea93af56 Sat Sep 9 22:02:28 2023 +0100 Create GitHub release from release tag (#5246)
853552dcb Sun Sep 10 20:15:53 2023 +0300 vm-monitor: Don't include Args in top-level span (#5264)
1cac923af Sun Sep 10 20:33:53 2023 +0300 vm-monitor: Rate-limit upscale requests (#5263)
34e39645c Sun Sep 10 20:05:07 2023 +0100 GitHub Workflows: add actionlint (#5265)
15fd188fd Sun Sep 10 20:06:10 2023 +0100 Fix GitHub Autocomment for `ci-run/pr`s (#5268)
d33e1b1b2 Sun Sep 10 20:12:38 2023 +0100 approved-for-ci-run.yml: use token to checkout the repo (#5266)
999fe668e Sun Sep 10 22:59:51 2023 +0300 Ack tenant detach before local files are deleted (#5211)
a55a78a45 Mon Sep 11 11:42:49 2023 +0300 Misc test flakyness fixes (#5233)
d7fa2dba2 Mon Sep 11 14:58:15 2023 +0300 fix(pageserver): update the `STORAGE_IO_TIME` metrics to avoid expensive operations (#5273)
c0ed36279 Mon Sep 11 09:46:06 2023 -0400 Measure pageserver wal recovery time and fix flush() method (#5240)
76cc87398 Mon Sep 11 17:35:05 2023 +0200 Use tokio locks in VirtualFile and turn with_file into macro (#5247)
a18d6d9ae Mon Sep 11 18:41:08 2023 +0200 Make File opening in VirtualFile async-compatible (#5280)
15eaf7808 Tue Sep 12 00:11:16 2023 +0000 Disallow block_in_place and Handle::block_on (#5101)
36c261851 Tue Sep 12 10:11:41 2023 +0100 s3_scrubber: remove atty dependency (#5171)
5be8d38a6 Tue Sep 12 11:23:46 2023 +0200 fix deadlock around TENANTS (#5285)
83e7e5dbb Tue Sep 12 15:11:32 2023 +0200 Feat/postgres 16 (#4761)
ab1f37e90 Tue Sep 12 17:38:31 2023 +0200 revert recent VirtualFile asyncification changes (#5291)
9c3f38e10 Tue Sep 12 16:53:13 2023 +0100 Document how to run CI for external contributors (#5279)
e1661c3c3 Tue Sep 12 19:29:26 2023 +0300 approved-for-ci-run.yml: fix ci-run/pr-* branch deletion (#5278)
2641ff3d1 Tue Sep 12 20:01:21 2023 +0100 Use CI_ACCESS_TOKEN to create release PR (#5286)
3b6b847d7 Tue Sep 12 22:02:03 2023 +0300 Fixes for Pg16: (#5292)
8556d9474 Tue Sep 12 17:13:25 2023 -0400 proxy http: reproduce issue with transactions in pool (#5293)
1697e7b31 Wed Sep 13 08:56:03 2023 +0300 Fix lfc_ensure_function which now disables LFC (#5294)
ffd146c3e Wed Sep 13 22:05:30 2023 +0300 refactor: globals in tests (#5298)
3895829bd Thu Sep 14 13:21:50 2023 +0300 vm-monitor: Fix cgroup throttling (#5303)
0501b74f5 Thu Sep 14 18:17:50 2023 +0300 Update checksum for pg_hint_plan (#5309)
bd36d1c44 Thu Sep 14 20:18:49 2023 +0300 approved-for-ci-run.yml: fix variable name and permissions (#5307)
e400a38fb Fri Sep 15 10:32:25 2023 +0300 References to old and new blocks were mixed in xlog_heap_update handler (#5312)
e6985bd09 Fri Sep 15 11:17:18 2023 +0100 Move tenant & timeline dir method to NeonPageserver and use them everywhere (#5262)
9e6b5b686 Fri Sep 15 16:50:57 2023 +0300 Add a test case for "CREATE DATABASE STRATEGY=file_copy". (#5301)
66fa176cc Fri Sep 15 17:47:29 2023 +0300 Handle update of VM in XLOG_HEAP_LOCK/XLOG_HEAP2_LOCK_UPDATED WAL records (#4896)
c5d226d9c Fri Sep 15 19:44:14 2023 +0300 refactor(consumption_metrics): prereq refactorings, tests (#5315)
00c4c8e2e Sat Sep 16 00:06:19 2023 +0300 feat(consumption_metrics): remove event deduplication support (#5316)
a7f4ee02a Sat Sep 16 01:11:01 2023 +0300 fix(consumption_metrics): exp backoff retry (#5317)
f90277720 Sat Sep 16 11:24:42 2023 +0300 fix: consumption metrics on restart (#5323)
74d99b588 Sat Sep 16 18:05:35 2023 +0300 refactor(test_consumption_metrics): split for pageserver and proxy (#5324)
9cf4ae86f Sat Sep 16 18:08:33 2023 +0300 refactor(consumption_metrics): pre-split cleanup (#5325)
a221ecb0d Sat Sep 16 18:27:19 2023 +0300 test: test_download_remote_layers_api again (#5322)
e62ab176b Sat Sep 16 18:45:08 2023 +0300 refactor(consumption_metrics): split (#5326)
55371af71 Mon Sep 18 09:24:53 2023 +0200 test: workaround known bad mock_s3 ListObjectsV2 response (#5330)
0904d8cf4 Mon Sep 18 12:55:49 2023 +0100 Downgrade plv8 for Postgres 14/15 (#5320)
70b17981a Mon Sep 18 12:58:34 2023 +0100 Enable compatibility tests on Postgres 16 (#5314)
18f3a706d Mon Sep 18 17:30:34 2023 +0000 Bump vm-builder v0.17.5 -> v0.17.10 (#5334)
722e5260b Mon Sep 18 17:47:48 2023 +0000 vm-monitor: Don't set cgroup memory.max (#5333)
5d8597c2f Mon Sep 18 23:30:01 2023 +0300 refactor(consumption_metrics): post-split cleanup (#5327)
6723a79be Tue Sep 19 21:55:36 2023 +0300 Do not handle lfc_change_limit in processes not haing PGPROC structure (#5332)
93b41cbb5 Wed Sep 20 15:55:58 2023 +0000 page cache metrics: remove unused read_accesses_ephemeral & read_hits_ephemeral (#5338)
97a571091 Thu Sep 21 10:27:58 2023 +0200 README: update for libicu dependency (#5343)
e1e1c0856 Thu Sep 21 22:28:56 2023 +0200 Forbid installation of `pg_embedding` extension (#5345)
810a355b9 Fri Sep 22 11:11:28 2023 +0000 Add script to download a basebackup from pageserver. (#5344)
ae79978ae Fri Sep 22 13:15:33 2023 +0100 build(deps): bump cryptography from 41.0.3 to 41.0.4 (#5349)
3048a5f0e Fri Sep 22 14:17:43 2023 +0100 Deploy releases to staging-preprod first (#5308)
6d33d8b09 Fri Sep 22 16:55:55 2023 +0100 Update rust to 1.72.1 (#5359)
3a2e6a03b Sat Sep 23 16:47:57 2023 +0100 Forbid installation of `hnsw` extension (#5346)
211f88242 Sat Sep 23 18:06:25 2023 +0100 Update hyper-tungstenite to 0.11 (#5361)
d8977d519 Mon Sep 25 12:27:41 2023 +0100 Altered retry timing parameters for connect to compute, to get more and quicker retries (#5358)
a0c82969a Mon Sep 25 18:30:10 2023 +0200 page cache: per-task-kind access stats (#5339)
1d98d3e4c Mon Sep 25 17:16:36 2023 +0000 VirtualFile::atomic_overwrite: add basic unit tests (#5191)
a24cd6958 Mon Sep 25 19:49:07 2023 +0100 Bump vm-builder v0.17.10 -> v0.17.11 (#5371)
c338bb742 Tue Sep 26 09:20:56 2023 +0300 Update last written LSN after walloging all createdb stuff (#5340)
3322b6c5b Tue Sep 26 10:01:09 2023 +0300 page cache: metrics: add page content kind dimension (#5373)
16f062222 Tue Sep 26 15:59:25 2023 +0100 fix: real_s3 flakyness with rust tests (#5386)
ba92668e3 Tue Sep 26 16:11:55 2023 +0100 pageserver: deletion queue & generation validation for deletions (#5207)
6cc8c31fd Wed Sep 27 10:00:21 2023 +0100 disk_usage_based_eviction: switch warmup to use full table scans (#5384)
ce45fd4cc Wed Sep 27 12:00:49 2023 +0100 test_pageserver_metric_collection: allowed synthetic size to be cancelled at shutdown (#5398)
7038ce40c Wed Sep 27 13:48:30 2023 +0200 Fix neon_zeroextend's WAL logging (#5387)
2cced770d Wed Sep 27 13:12:13 2023 +0100 pageserver: add control_plane_api_token config (#5383)
090a64439 Wed Sep 27 13:18:05 2023 +0100 metrics for resident & remote physical size without tenant/timeline dimension (#5389)
48e85460f Wed Sep 27 21:27:23 2023 -0700 vm-monitor: Unset memory.high on start + refactor cgroup handling (#5348)
5fdc80db0 Thu Sep 28 09:52:39 2023 +0200 Bump vm-builder v0.17.11 -> v0.17.12 (#5407)
6b4bb91d0 Thu Sep 28 10:07:11 2023 +0100 docs/rfcs: add RFC for fast tenant migration/failover (#5029)
af28362a4 Thu Sep 28 12:25:20 2023 +0300 tests: Default to LOCAL_FS for pageserver remote storage (#5402)
528fb1bd8 Thu Sep 28 11:38:26 2023 +0100 proxy: metrics2 (#5179)
b497d0094 Thu Sep 28 06:47:44 2023 -0700 file cache: Remove free space monitor (#5406)
ca3ca2bb9 Thu Sep 28 17:20:34 2023 +0100 pageserver: don't try and recover deletion queue if no remote storage (#5419)
1881373ec Thu Sep 28 17:34:51 2023 +0100 Update CODEOWNERS (#5421)
6a1903987 Fri Sep 29 09:15:43 2023 +0100 tests: use approximate equality in test_get_tenant_size_with_multiple_branches (#5411)
fd20bbc6c Fri Sep 29 09:40:27 2023 +0100 proxy: log params when no endpoint (#5418)
86dd28d4f Fri Sep 29 12:57:45 2023 +0100 Bump hermit-abi & num_cpus packages (#5427)
c07eef8ea Fri Sep 29 20:03:56 2023 +0200 page_cache: find_victim: don't spin while there's no chance for a slot (#5319)
89275f6c1 Fri Sep 29 19:39:28 2023 +0100 Fix invalid database resulting from failed DROP DB (#5423)
c1dcf61ca Mon Oct 2 15:52:45 2023 +0100 Update pgx-ulid extension (#5382)
00369c8c2 Mon Oct 2 23:50:27 2023 +0100 Update pg_jsonschema & pg_grapgql extensions (#5438)
de0e96d2b Tue Oct 3 11:22:11 2023 +0300 remote_storage: separate semaphores for read and write ops (#5440)
78dde3182 Tue Oct 3 11:50:27 2023 +0100 build(deps): bump urllib3 from 1.26.11 to 1.26.17 (#5442)
ace0c775f Tue Oct 3 17:00:55 2023 +0100 pageserver: prefer 503 to 500 for transient unavailability (#5439)
fec94ad5b Tue Oct 3 18:42:39 2023 +0100 Update checksums for pg_jsonschema & pg_graphql (#5455)
af6a20dfc Wed Oct 4 02:38:42 2023 +0200 Improve CrashsafeOverwriteError source printing (#5410)
db8ff9d64 Wed Oct 4 11:24:30 2023 +0300 testing: record walredo failures to test reports (#5451)
dee2bcca4 Wed Oct 4 11:01:07 2023 +0100 fix: time the reconstruction, not future creation (#5459)
25bf79156 Wed Oct 4 13:40:00 2023 +0100 metrics: distinguish page reconstruction success & failure (#5463)
fc467941f Wed Oct 4 14:19:19 2023 +0100 walredo: log retryed error (#5462)
f002b1a21 Wed Oct 4 15:01:05 2023 +0100 proxy: http limits (#5460)
25a37215f Wed Oct 4 17:52:23 2023 +0300 fix: replace all `std::PathBuf`s with `camino::Utf8PathBuf` (#5352)
7a2cafb34 Wed Oct 4 16:20:16 2023 +0100 Use zstd to compress large allure artifacts (#5458)
7dce62a9e Wed Oct 4 16:52:32 2023 +0100 test: duplicate L1 layer (#5412)
f8a749896 Wed Oct 4 22:53:34 2023 +0100 Wait for sk tli init in test_timeline_status (#5467)
6489a4ea4 Wed Oct 4 15:08:10 2023 -0700 vm-monitor: Remove mem::forget of tokio::sync::mpsc::Sender (#5441)
c5ea91f83 Thu Oct 5 01:31:17 2023 +0100 pageserver: fix loading control plane JWT token (#5470)
c216b16b0 Thu Oct 5 07:30:28 2023 +0100 proxy: fix memory leak (#5472)
baa5fa1e7 Thu Oct 5 09:55:10 2023 +0100 pageserver: location configuration API, attachment modes, secondary locations (#5299)
7cbb39063 Thu Oct 5 11:22:05 2023 +0100 tests: stabilize + extend deletion queue recovery test (#5457)
522aaca71 Thu Oct 5 14:02:20 2023 +0000 Temporary deploy staging preprod region from main (#5477)
8b15252f9 Thu Oct 5 18:48:01 2023 +0100 Move walproposer state into struct (#5364)
a3c82f19b Thu Oct 5 20:15:55 2023 +0000 tests: prettier subprocess output in test log (#5485)
ce9263818 Fri Oct 6 09:49:31 2023 +0100 test_runner: allow race in test_tenant_delete_is_resumed_on_attach (#5478)
a15f9b3ba Fri Oct 6 09:59:14 2023 +0100 pageserver: Tune 503 Resource unavailable (#5489)
bdfe27f3a Fri Oct 6 11:31:49 2023 +0100 swagger: add a 503 definition to each endpoint (#5476)
45f98dd01 Fri Oct 6 12:17:38 2023 +0100 debug_tool: get page at lsn and keyspace via http api (#5057)
ecc7a9567 Fri Oct 6 13:38:02 2023 +0200 page_cache: inline `{,try_}lock_for_write` into `memorize_materialized_page` (#5480)
bfba5e3ac Fri Oct 6 13:41:13 2023 +0100 page_cache: ensure forward progress on miss (#5482)
607b185a4 Fri Oct 6 14:17:19 2023 +0100 Fix 1.73.0 clippy lints (#5494)
547914fe1 Fri Oct 6 16:15:18 2023 +0000 pageserver: adjust timeline deletion for generations (#5453)
ea5a97e7b Fri Oct 6 17:25:21 2023 +0100 pageserver: implement emergency mode for operating without control plane (#5469)
477cb3717 Mon Oct 9 09:13:57 2023 +0100 Fix neon_local pageserver status command (#5475)
010b4d0d5 Mon Oct 9 13:54:46 2023 +0300 Move ApiError 404 to info level (#5501)
4772cd6c9 Mon Oct 9 17:03:38 2023 +0300 fix: deny branching, starting compute from not yet uploaded timelines (#5484)
7eaa7a496 Mon Oct 9 15:54:17 2023 +0100 pageserver: cancellation handling in writes to postgres client socket (#5503)
b3195afd2 Mon Oct 9 16:28:28 2023 +0100 tests: fix a race in test_deletion_queue_recovery on loaded nodes (#5495)
b91ac670e Mon Oct 9 17:07:43 2023 +0100 Update plpgsql_check extension to 2.5.3 (#5437)
fe74fac27 Tue Oct 10 07:43:37 2023 +0300 Fix handling flush error in prefetch (#5473)
bf065aabd Tue Oct 10 08:59:16 2023 +0100 proxy: update locked error retry filter (#5376)
acefee9a3 Tue Oct 10 10:46:24 2023 +0100 pageserver: flush deletion queue on detach (#5452)
aec9188d3 Tue Oct 10 13:39:38 2023 +0200 Added timeout for http requests (#5514)
5158de70f Tue Oct 10 13:17:37 2023 +0100 proxy: breakdown wake up failure metrics (#4933)
d4dc86f8e Tue Oct 10 16:33:20 2023 +0100 proxy: more connection metrics (#5464)
685add200 Tue Oct 10 20:06:25 2023 +0300 Enable /metrics without auth.
80dcdfa8b Wed Oct 11 09:47:19 2023 +0100 Update pgvector to 0.5.1 (#5525)
653044f75 Wed Oct 11 10:49:15 2023 +0100 test_runners: increase some timeouts to make tests less flaky (#5521)
39e144696 Wed Oct 11 11:50:16 2023 +0000 pageserver: clean up `mgr.rs` types that needn't be public (#5529)
e0c8ad48d Wed Oct 11 13:22:00 2023 +0100 remote_storage: log detail errors in delete_objects (#5530)
0fc3708de Wed Oct 11 15:25:08 2023 +0100 pageserver: use a backoff::retry in Deleter (#5534)
ddceb9e6c Wed Oct 11 16:24:36 2023 +0100 fix(branching): read last record lsn only after Tenant::gc_cs (#5535)
dbb21d659 Thu Oct 12 11:41:07 2023 +0200 Make http timeout configurable (#5532)
21deb81ac Thu Oct 12 14:32:49 2023 +0200 Fix case for array of jsons (#5523)
dd6990567 Fri Oct 13 14:08:23 2023 +0000 walredo: apply_batch_postgres: get a backtrace whenever it encounters an error (#5541)
c3626e343 Fri Oct 13 19:16:15 2023 +0100 walredo: remove legacy wal-redo-datadir cleanup code (#5554)
99c15907c Fri Oct 13 19:35:53 2023 +0100 walredo: trim public interfaces (#5556)
44b1c4c45 Sun Oct 15 20:23:18 2023 +0100 pageserver: fix eviction across generations (#5538)
8c522ea03 Mon Oct 16 16:31:04 2023 +0100 proxy: count cache-miss for compute latency (#5539)
e09d5ada6 Mon Oct 16 17:37:09 2023 +0200 Azure blob storage support (#5546)
ded7f4856 Mon Oct 16 18:21:37 2023 +0100 pageserver: measure startup duration spent fetching remote indices (#5564)
0ca342260 Mon Oct 16 20:46:45 2023 +0200 [compute_ctl+pgxn] Handle invalid databases after failed drop (#5561)
3666df634 Mon Oct 16 19:52:07 2023 +0100 azure_blob.rs: use division instead of left shift (#5572)
b08a0ee18 Tue Oct 17 09:55:39 2023 +0200 walredo: fix race condition where shutdown kills the wrong process (#5557)
b06dffe3d Tue Oct 17 10:21:31 2023 +0200 pageserver: fixes to `/location_config` API (#5548)
9e1449353 Tue Oct 17 10:04:56 2023 +0100 crash-consistent layer map through index_part.json (#5198)
925678827 Tue Oct 17 11:29:48 2023 +0200 limit imitate accesses concurrency, using same semaphore as compactions (#5578)
00c71bb93 Tue Oct 17 11:59:57 2023 +0100 Also try to login to Azure via SDK provided methods (#5573)
093f8c5f4 Tue Oct 17 13:13:12 2023 +0100 Update rust to 1.73.0 (#5574)
ea648cfbc Tue Oct 17 13:26:11 2023 +0100 tests: fix test_eviction_across_generations trying to evict temp files (#5579)
f775928df Tue Oct 17 13:55:52 2023 +0000 proxy: refactor how and when connections are returned to the pool (#5095)
4a5048386 Tue Oct 17 15:41:47 2023 +0100 docs: error handling: document preferred anyhow context & logging style (#5178)
3a8959a4c Tue Oct 17 15:56:16 2023 +0100 page_cache: remove dead code (#5493)
543b8153c Tue Oct 17 16:59:35 2023 +0100 proxy: add flag to reject requests without proxy protocol client ip (#5417)
9fe5cc6a8 Tue Oct 17 15:30:40 2023 -0700 vm-monitor: Switch from memory.high to polling memory.stat (#5524)
16c87b5bd Wed Oct 18 11:10:01 2023 +0200 Bump vm-builder v0.17.12 -> v0.18.1 (#5583)
9da67c4f1 Wed Oct 18 11:23:06 2023 +0100 walredo: make request_redo() an async fn (#5559)
1fa047898 Wed Oct 18 12:21:54 2023 +0100 build(deps): bump urllib3 from 1.26.17 to 1.26.18 (#5582)
607d19f0e Wed Oct 18 13:28:38 2023 +0100 pageserver: clean up page service Result handling for shutdown/disconnect (#5504)
5c88213ea Wed Oct 18 16:42:22 2023 +0300 Logical replication (#5271)
1f4805baf Wed Oct 18 17:09:26 2023 +0300 Remove remnants of num_computes field.
9a9d9eba4 Wed Oct 18 17:09:26 2023 +0300 Add test_idle_reconnections
ecf759be6 Wed Oct 18 15:16:58 2023 +0000 tests: allow-list S3 500 on DeleteObjects key (#5586)
c8637f373 Wed Oct 18 14:58:48 2023 -0500 Remove specific file references in NOTICE
d444d4dce Thu Oct 19 03:43:49 2023 +0100 build(deps): bump rustix from 0.36.14 to 0.36.16 (#5591)
f842b22b9 Thu Oct 19 04:50:49 2023 +0200 Add endpoint for querying time info for lsn (#5497)
b1d6af5eb Thu Oct 19 14:31:09 2023 +0200 Azure blobs: Simplify error conversion by addition of to_download_error (#5575)
572eda44e Thu Oct 19 14:32:19 2023 +0200 update tokio-postgres (#5597)
3a19da106 Thu Oct 19 13:49:06 2023 +0100 build(deps): bump rustix from 0.37.19 to 0.37.25 (#5596)
66f8f5f1c Thu Oct 19 14:17:15 2023 +0100 Call walproposer from Rust (#5403)
893b7bac9 Thu Oct 19 15:24:23 2023 +0100 Fix neon_extra_builds.yml : nproc is not supported in mac os (#5598)
2c8741a5e Thu Oct 19 18:10:33 2023 +0200 vm-monitor: Log full error on message handling failure (#5604)
5a8bcdccb Thu Oct 19 20:24:35 2023 +0300 Fix elog format error in wallog_mapping_file  (#5602)
2cf6a47cc Thu Oct 19 19:09:37 2023 +0100 vm-monitor: Deny not fail downscale if no memory stats yet (#5606)
ba856140e Thu Oct 19 22:20:39 2023 +0100 Fix neon_extra_build.yml (#5605)
76c702219 Fri Oct 20 10:57:59 2023 +0300 Don't use AppenRequestHeader.epoch_start_lsn.
b332268ce Fri Oct 20 10:57:59 2023 +0300 Introduce safekeeper peer recovery.
1b53b3e20 Fri Oct 20 10:57:59 2023 +0300 Make test_pageserver_http_get_wal_receiver_success not wait for keepalive.
702382e99 Fri Oct 20 10:57:59 2023 +0300 Add check that WAL segments are identical after recovery.
2fbd5ab07 Fri Oct 20 10:57:59 2023 +0300 Add safekeeper test_late_init.
a8899e1e0 Fri Oct 20 09:15:34 2023 +0100 pageserver: apply timeout when waiting for tenant loads (#5601)
b1a112615 Fri Oct 20 21:29:17 2023 +0300 Grant replication permission to newly created users (#5615)
11e523f50 Mon Oct 23 09:00:13 2023 +0100 walredo: fix EGAGAIN/"os error 11" false page reconstruction failures (#5560)
41ee75bc7 Mon Oct 23 09:19:01 2023 +0100 pageserver: do config writes in a spawn_blocking (#5603)
7d17f1719 Mon Oct 23 14:12:41 2023 +0100 reduce cancel map contention (#5555)
b514da90c Mon Oct 23 15:11:05 2023 +0100 Set up timeout for scram protocol execution (#5551)
94b4e76e1 Mon Oct 23 15:17:28 2023 +0100 proxy: latency connect outcome (#5588)
c6ca1d76d Mon Oct 23 16:31:38 2023 +0200 consumption_metrics: fix periodicness behavior & reporting (#5625)
7e805200b Mon Oct 23 15:32:34 2023 +0100 pageserver: parallel load of configs (#5607)
188f67e1d Mon Oct 23 17:51:38 2023 +0200 pageserver: forward compat: be tolerant of deletion marker in `timelines/` (#5632)
eaaa18f6e Mon Oct 23 17:30:25 2023 +0100 attachment_service: graceful SIGQUIT (#5626)
1e250cd90 Mon Oct 23 19:08:56 2023 +0100 Cleanup in azure_upload_download_works test (#5636)
a8a800af5 Tue Oct 24 12:12:11 2023 +0100 Run real Azure tests on CI (#5627)
767ef2939 Tue Oct 24 13:13:23 2023 +0100 proxy: filter out more quota exceeded errors (#5640)
a0b862a8b Tue Oct 24 13:57:01 2023 +0100 pageserver: schedule frozen layer uploads inside the layers lock (#5639)
4bef977c5 Tue Oct 24 17:16:23 2023 +0000 Use tuples instead of manual comparison chain (#5637)
44202eeb3 Tue Oct 24 16:04:28 2023 -0700 Bump vm-builder v0.18.1 -> v0.18.2 (#5646)
b2c96047d Wed Oct 25 08:30:47 2023 +0100 move wake compute after the auth quirks logic (#5642)
127837abb Wed Oct 25 10:55:45 2023 +0100 tests: de-flake test_eviction_across_generations (#5650)
c5949e1fd Wed Oct 25 14:59:43 2023 +0300 misc smaller improvements (#5527)
4ae2d1390 Wed Oct 25 15:01:19 2023 +0300 refactor(remote_timeline_client): Split deletion into unlinking + deletion (#5645)
a461c459d Wed Oct 25 13:20:45 2023 +0100 fix http pool test (#5653)
8b8be7bed Wed Oct 25 13:29:30 2023 +0100 tests: don't fail tests on torn log lines (#5655)
4778b6a12 Wed Oct 25 14:25:13 2023 +0100 Switch to querying new tests results DB (#5616)
5683ae9ea Wed Oct 25 14:55:37 2023 +0100 pageserver: suppress some of the most common spurious warnings (#5658)
32126d705 Wed Oct 25 15:43:03 2023 +0100 proxy refactor serverless (#4685)
c155cc0c3 Wed Oct 25 11:53:04 2023 -0400 Fix test instructions readme (#5644)
a673e4e7a Wed Oct 25 18:46:34 2023 +0200 Optionally return json from get_lsn_by_timestamp (#5608)
4ddbc0e46 Wed Oct 25 18:35:23 2023 +0100 Ignore missed AUX_FILES_KEY when generating image layer (#5660)
325258413 Wed Oct 25 19:29:12 2023 +0100 fix: trampling on global physical size metric (#5663)
f70019797 Wed Oct 25 22:25:43 2023 +0100 refactor(rtc): schedule compaction update (#5649)
85f4514e7 Wed Oct 25 22:54:23 2023 +0100 Get env var for real Azure tests from GitHub (#5662)
378daa358 Wed Oct 25 22:50:35 2023 +0000 build(deps): bump werkzeug from 2.2.3 to 3.0.1 (#5665)
acda65d7d Thu Oct 26 09:53:18 2023 +0100 pageserver: quieten "Failed to get info about AUX files" (#5669)
c508d3b5f Thu Oct 26 12:36:38 2023 +0300 reimpl Layer, remove remote layer, trait Layer, trait PersistentLayer (#4938)
e0ebdfc7c Thu Oct 26 10:59:24 2023 +0100 pageserver: suppress compaction/gc errors while stopping (#5670)
6129077d3 Thu Oct 26 12:21:41 2023 +0100 WALRedo: Limit logging to log_level = ERROR and above (#5587)
8360307ea Thu Oct 26 14:00:26 2023 +0100 pageserver: exponential backoff on compaction/GC failures (#5672)
de90bf466 Thu Oct 26 14:48:44 2023 +0100 pageserver: always load remote metadata (no more `spawn_load`) (#5580)
ba4fe9e10 Thu Oct 26 13:54:52 2023 +0000 pageserver: fix the second "AUX files" warning (#5673)
116c342ca Thu Oct 26 10:56:07 2023 -0700 Support changing pageserver dynamically (#5542)
39b148b74 Thu Oct 26 20:04:57 2023 +0100 Bump vm-builder v0.18.2 -> v0.18.4 (#5666)
7c16b5215 Thu Oct 26 20:36:28 2023 +0100 scrubber: add separate find/purge garbage commands (#5409)
71611f4ab Thu Oct 26 22:54:37 2023 +0100 proxy: prepare to remove high cardinality metrics (#5461)
83567f9e4 Fri Oct 27 09:23:49 2023 +0100 tests: revise perf test that interfered with local disk state (#5682)
39f8fd694 Fri Oct 27 10:47:11 2023 +0100 feat: add `build_tag` env support for `set_build_info_metric` (#5576)
68f15cf96 Fri Oct 27 11:16:01 2023 +0100 fix: schedule_compaction_update must only unlink (#5675)
262348e41 Fri Oct 27 12:09:02 2023 +0100 Fix safekeeper log spans (#5643)
a5292f7e6 Fri Oct 27 12:36:34 2023 +0100 Some minor renames in attachment service API (#5687)
c13e932c3 Fri Oct 27 14:20:04 2023 +0100 pageserver: add generation fields in openapi spec (#5690)
493b47e1d Fri Oct 27 17:17:39 2023 +0000 proxy: exclude client latencies in metrics (#5688)
2bd79906d Fri Oct 27 19:09:34 2023 +0100 fix: possible page_service hang on cancel (#5696)
bd59349af Sat Oct 28 03:47:26 2023 +0200 Fix Rust 1.74 warnings (#5702)
964c5c56b Mon Oct 30 08:38:56 2023 +0000 proxy: dont retry server errors (#5694)
87db4b441 Mon Oct 30 09:18:40 2023 +0000 pageserver: cleaner shutdown in timeline delete (#5701)
9cdffd164 Mon Oct 30 12:06:08 2023 +0200 Prevent SIGSEGV in apply_error_callback when record was not decoded (#5703)
07c2b2989 Mon Oct 30 13:24:52 2023 +0000 pageserver: fix error logging on stray timeline files (#5712)
4db8efb2c Mon Oct 30 16:21:30 2023 +0200 Layer: logging fixes (#5676)
e675f4cec Mon Oct 30 15:18:32 2023 +0000 tests: fix missing comma  in test_timeline_deletion_with_files_stuck_… (#5713)
ad99fa5f0 Mon Oct 30 15:29:25 2023 +0000 Grant BYPASSRLS and REPLICATION to exited roles (#5657)
d8c21ec70 Mon Oct 30 16:43:06 2023 +0000 fix nightly 1.75 (#5719)
9c35e1e6e Mon Oct 30 18:32:30 2023 +0000 pageserver: downgrade slow task warnings from warn to info (#5724)
158860150 Mon Oct 30 22:10:24 2023 +0100 Move release PR creation to Friday (#5721)
7ebe9ca1a Tue Oct 31 09:32:58 2023 +0100 pageserver: `/attach`: clarify semantics of 409 (#5698)
e5c81fef8 Tue Oct 31 11:44:35 2023 +0000 tests: minor improvements (#5674)
896347f30 Tue Oct 31 18:40:08 2023 +0200 refactor(layer): remove version checking with atomics (#5742)
f7067a38b Tue Oct 31 10:00:23 2023 -0700 compute_ctl: Assume --vm-monitor-addr arg is always present (#5611)
726c8e673 Tue Oct 31 12:31:14 2023 -0500 Add docs for updating Postgres for new minor versions
5952f350c Tue Oct 31 20:57:03 2023 +0200 Always handle POLLHUP in walredo error poll loop (#5716)
4f0a8e92a Wed Nov 1 09:41:48 2023 +0300 fix: Add bearer prefix to Authorization header (#5740)
e82d1ad6b Wed Nov 1 17:38:32 2023 +0200 fix(layer): reinit on access before eviction happens  (#5743)
0b790b6d0 Wed Nov 1 17:02:58 2023 -0400 Record wal size in import benchmark (#5755)
2dca4c03f Thu Nov 2 08:06:32 2023 +0000 feat(layer): cancellable get_or_maybe_download (#5744)
565013853 Thu Nov 2 09:14:26 2023 +0000 pageserver: helpers for explicitly dying on fatal I/O errors (#5651)
3737fe3a4 Thu Nov 2 11:03:38 2023 +0000 fix(layer): error out early if layer path is non-file (#5756)
098d3111a Thu Nov 2 13:06:14 2023 +0000 fix(layer): get_and_upgrade and metrics (#5767)
51570114e Thu Nov 2 10:43:59 2023 -0400 Remove outdated and flaky perf test (#5762)
367971a0e Thu Nov 2 16:06:16 2023 +0000 vm-monitor: Remove support for file cache in tmpfs (#5617)
4c7fa12a2 Thu Nov 2 16:26:15 2023 +0000 Proxy introduce allowed ips (#5729)
27bdbf5e3 Thu Nov 2 19:05:33 2023 +0000 chore(layer): restore logging, doc changes (#5766)
cdcaa329b Fri Nov 3 08:30:58 2023 +0000 proxy: no more statements (#5747)
5ceccdc7d Fri Nov 3 18:40:27 2023 +0200 Logical replication startup fixes (#5750)
306c4f996 Fri Nov 3 17:36:02 2023 +0000 s3_scrubber: prepare for scrubbing buckets with generation-aware content (#5700)
09b595452 Sun Nov 5 10:16:54 2023 +0000 refactor: use streaming in safekeeper `/v1/debug_dump` http response (#5731)
b85fc39bd Mon Nov 6 09:26:09 2023 +0200 Update control plane API path for getting compute spec. (#5357)
b3d3a2587 Mon Nov 6 11:40:03 2023 +0200 feat: improve the serde impl for several types(`Lsn`, `TenantId`, `TimelineId` ...) (#5335)
6defa2b5d Mon Nov 6 12:39:20 2023 +0000 pageserver: add `Gate` as a partner to CancellationToken for safe shutdown of `Tenant` & `Timeline` (#5711)
dc7256728 Mon Nov 6 08:58:20 2023 -0500 Layer flush minor speedup (#5765)
e6470ee92 Mon Nov 6 15:00:07 2023 +0100 Add API description for safekeeper copy endpoint (#5770)
85cd97af6 Mon Nov 6 14:03:22 2023 +0000 pageserver: add `InProgress` tenant map state, use a sync lock for the map (#5367)
b09a85170 Mon Nov 6 15:16:55 2023 +0000 Make azure blob storage not do extra metadata requests (#5777)
ad5b02e17 Mon Nov 6 17:44:44 2023 +0000 proxy: remove unsafe (#5805)
bea8efac2 Tue Nov 7 09:13:01 2023 +0100 Fix comments in 'receive_wal.rs'. (#5807)
c00651ff9 Tue Nov 7 09:06:53 2023 +0000 pageserver: start refactoring into TenantManager (#5797)
a394f49e0 Tue Nov 7 09:35:45 2023 +0000 pageserver: avoid converting an error to anyhow::Error (#5803)
4be6bc725 Tue Nov 7 10:26:25 2023 +0000 refactor: remove unnecessary unsafe (#5802)
0ac4cf67a Tue Nov 7 11:38:02 2023 +0000 Use self.tenants instead of TENANTS (#5811)
0141c9578 Tue Nov 7 12:13:05 2023 +0000 build: Add warning when missing postgres submodule during the build (#5614)
4cd47b7d4 Tue Nov 7 13:45:59 2023 +0000 Dockerfile: Set BUILD_TAG for storage services (#5812)
1d68f52b5 Tue Nov 7 14:25:51 2023 +0000 pageserver: move deletion failpoint inside backoff (#5814)
e310533ed Tue Nov 7 15:43:29 2023 +0100 Support JWT key reload in pageserver (#5594)
fc47af156 Tue Nov 7 16:49:26 2023 +0100 Passing neon options to the console (#5781)
11d9d801b Tue Nov 7 16:57:26 2023 +0000 pageserver: improve the shutdown log error (#5792)
acef742a6 Tue Nov 7 09:41:20 2023 -0800 vm-monitor: Remove dependency on workspace_hack (#5752)
b989ad192 Wed Nov 8 11:26:56 2023 +0000 extend test_change_pageserver for failure case, rework changing pageserver (#5693)
a8a39cd46 Wed Nov 8 12:41:48 2023 +0000 test: de-flake test_deletion_queue_recovery (#5822)
40441f8ad Wed Nov 8 13:00:11 2023 +0000 pageserver: use `Gate` for stronger safety check in `SlotGuard` (#5793)
e9b227a11 Wed Nov 8 16:54:33 2023 +0000 cleanup unused RemoteStorage fields (#5830)
ea118a238 Wed Nov 8 16:56:53 2023 +0000 JWT logging improvements (#5823)
87389bc93 Wed Nov 8 19:48:57 2023 +0000 Add test simulating bad connection between pageserver and compute (#5728)
049579859 Thu Nov 9 13:05:17 2023 +0000 Fix walproposer build on aarch64 (#5827)
9c30883c4 Thu Nov 9 13:50:13 2023 +0000 remote_storage: use S3 SDK's adaptive retry policy (#5813)
7cdde285a Thu Nov 9 14:14:30 2023 +0000 proxy: limit concurrent wake_compute requests per endpoint (#5799)
893616051 Thu Nov 9 15:24:43 2023 +0100 Update epic-template.md (#5709)
842223b47 Thu Nov 9 16:40:52 2023 +0200 fix(metric): remove pageserver_wal_redo_wait_seconds (#5791)
4469b1a62 Thu Nov 9 10:47:03 2023 -0500 Fix blob_io test (#5818)
e0821e1ea Thu Nov 9 16:02:59 2023 +0000 pageserver: refined Timeline shutdown (#5833)
f95f001b8 Thu Nov 9 16:12:18 2023 +0000 Lsn for get_timestamp_of_lsn should be string, not integer (#5840)
f5344fb85 Thu Nov 9 21:31:53 2023 +0000 temp: log all layer loading errors while we lose them (#5816)
8dd29f1e2 Thu Nov 9 21:36:57 2023 +0000 fix(pageserver): spawn all kinds of tenant shutdowns (#5841)
8e5e3971b Fri Nov 10 13:38:44 2023 +0100 find_lsn_for_timestamp fixes (#5844)
6e145a44f Fri Nov 10 12:45:41 2023 +0000 workflows/neon_extra_builds: run check-codestyle-rust & build-neon on arm64 (#5832)
71b380f90 Fri Nov 10 12:49:52 2023 +0000 Set BUILD_TAG for build-neon job (#5847)
a6f892e20 Fri Nov 10 15:05:22 2023 +0200 metric: add started and killed walredo processes counter (#5809)
d672e44ee Fri Nov 10 13:58:18 2023 +0000 pageserver: error type for collect_keyspace (#5846)
a05f104cc Fri Nov 10 16:05:21 2023 +0200 build: remove async-std dependency (#5848)
b7f45204a Fri Nov 10 18:02:22 2023 +0100 build: deny async-std and friends (#5849)
74d150ba4 Fri Nov 10 19:10:54 2023 +0000 build: upgrade ahash (#5851)
f7249b901 Sat Nov 11 00:32:00 2023 +0000 Fix comment in find_lsn_for_timestamp (#5855)
7709c91fe Tue Nov 14 09:51:51 2023 +0000 neon_local: use remote storage by default, add `cargo neon tenant migrate` (#5760)
31a54d663 Tue Nov 14 15:36:47 2023 +0000 Migrate links from wiki to notion (#5862)
462f04d37 Tue Nov 14 18:04:34 2023 +0100 Smaller test addition and change (#5858)
2f0d245c2 Wed Nov 15 09:15:59 2023 +0000 Proxy control plane rate limiter (#5785)
5cd5b9306 Wed Nov 15 11:08:49 2023 +0000 build(deps): bump aiohttp from 3.8.5 to 3.8.6 (#5864)
f84ac2b98 Wed Nov 15 12:40:21 2023 +0100 Fix baseline commit and branch for code coverage (#5769)
ab631e679 Wed Nov 15 23:20:21 2023 +0200 pageserver: make TenantsMap shard-aware (#5819)
6b82f22ad Thu Nov 16 12:19:13 2023 +0000 Collect number of connections by sni type (#5867)
d0a842a50 Thu Nov 16 18:17:42 2023 +0100 Update vm-builder to v0.19.0 and move its customization here (#5783)
0c243faf9 Thu Nov 16 20:46:23 2023 +0000 Proxy log pid hack (#5869)
5d13a2e42 Thu Nov 16 21:51:26 2023 +0000 Improve error message when neon.max_cluster_size reached (#4173)
cad0dca4b Sat Nov 18 12:43:54 2023 +0100 compute_ctl: Remove deprecated flag `--file-cache-on-disk` (#5622)
3b3f040be Sun Nov 19 14:16:31 2023 +0000 fix(background_tasks): first backoff, compaction error stacktraces (#5881)
d22dce2e3 Sun Nov 19 14:21:16 2023 +0000 pageserver: shut down idle walredo processes (#5877)
ac08072d2 Sun Nov 19 14:57:39 2023 +0000 fix(layer): VirtualFile opening and read errors can be caused by contention (#5880)
d98ac0413 Mon Nov 20 07:33:17 2023 +0000 chore(background_tasks): missed allowed_error change, logging change (#5883)
d2ca41091 Mon Nov 20 15:41:37 2023 +0100 build: back to opt-level=0 in debug builds, for faster compile times (#5751)
81b2cefe1 Mon Nov 20 22:39:47 2023 +0000 Disallow CREATE DATABASE WITH OWNER neon_superuser (#5887)
3e131bb3d Tue Nov 21 11:41:41 2023 +0100 Update Rust to 1.74.0 (#5873)
0d10992e4 Tue Nov 21 15:30:40 2023 +0200 Cleanup compact_level0_phase1 fsyncing (#5852)
d353fa199 Wed Nov 22 10:58:27 2023 +0000 refer to our rust-postgres.git fork by branch name (#5894)
9e3c07611 Wed Nov 22 11:08:35 2023 +0000 logging: support output to stderr (#5896)
2a12e9c46 Wed Nov 22 12:04:36 2023 +0000 Add documentation for our sample pre-commit hook (#5868)
6afbadc90 Thu Nov 23 08:59:19 2023 +0200 LFC fixes + statistics (#5727)
a0e61145c Thu Nov 23 13:33:41 2023 +0000 fix: cleanup of layers from the future can race with their re-creation (#5890)
b7a988ba4 Thu Nov 23 17:08:32 2023 +0200 Support cancellation for find_lsn_for_timestamp API (#5904)
35f243e78 Thu Nov 23 19:09:34 2023 +0200 Move weekly release PR trigger to Monday morning (#5908)
54327bbee Thu Nov 23 18:11:52 2023 +0000 Upload initdb results to S3 (#5390)
04e6c09f1 Thu Nov 23 18:53:03 2023 +0000 Add pgxn/neon/README.md
f8d9bd8d1 Thu Nov 23 18:53:03 2023 +0000 Add extension neon to all databases.
f5dfa6f14 Thu Nov 23 18:53:03 2023 +0000 Create extension neon in existing databases too
582a42762 Thu Nov 23 18:53:03 2023 +0000 update extension version in test_neon_extension
a56fd45f5 Thu Nov 23 19:11:24 2023 +0000 proxy: fix memory leak again (#5909)
ea63b4300 Fri Nov 24 08:23:00 2023 +0200 Check if LFC was intialized in local_cache_pages function (#5911)
044375732 Fri Nov 24 12:43:25 2023 +0000 test: support validating allowed_errors against a logfile (#5905)
53851ea8e Fri Nov 24 15:54:06 2023 +0200 fix: log cancelled request handler errors (#5915)
831fad46d Fri Nov 24 16:14:32 2023 +0000 tests: fix allowed_error for compaction detecting a shutdown (#5919)
6b1c4cc98 Fri Nov 24 16:17:56 2023 +0000 fix: long timeline create cancelled by tenant delete (#5917)
87b8ac3ec Sun Nov 26 08:37:01 2023 +0000 Only create neon extension in postgres database; (#5918)
b80b9e1c4 Mon Nov 27 09:31:20 2023 +0000 pageserver: remove defunct local timeline delete markers (#5699)
92bc2bb13 Mon Nov 27 12:10:23 2023 +0000 Refactor remote extensions feature to request extensions from proxy  (#5836)
a76a503b8 Mon Nov 27 12:50:19 2023 +0000 remove confusing no-op .take() of init_tenant_load_remote (#5923)
683ec2417 Mon Nov 27 15:20:54 2023 +0200 deflake: test_live_reconfig_get_evictions_low_residence_... (#5926)
5289f341c Mon Nov 27 18:57:58 2023 +0000 Use test specific directory in test_remote_extensions (#5938)
e09bb9974 Mon Nov 27 20:14:39 2023 +0000 bootstrap_timeline: rename initdb_path to pgdata_path (#5931)
316309c85 Mon Nov 27 21:45:15 2023 +0000 channel binding (#5683)
3c56a4dd1 Mon Nov 27 21:45:41 2023 +0000 Make neon extension relocatable to allow SET SCHEMA (#5942)
4c29e0594 Mon Nov 27 23:29:24 2023 +0000 Update neon extension relocatable for existing installations (#5943)
4cd18fceb Mon Nov 27 18:17:26 2023 -0800 Compile wal2json (#5893)
f290b2737 Tue Nov 28 03:14:42 2023 +0000 Fix check for if shmem is valid to take into account detached shmem (#5937)
286f34dfc Tue Nov 28 09:51:37 2023 +0000 test suite: add method for generation-aware detachment of a tenant (#5939)
ca469be1c Tue Nov 28 11:47:25 2023 +0000 pageserver: add shard indices to layer metadata (#5928)
1ab0cfc8c Tue Nov 28 13:14:51 2023 +0000 pageserver: add sharding metadata to `LocationConf` (#5932)
862546614 Tue Nov 28 14:49:31 2023 +0000 Move run_initdb to be async and guarded by max of 8 running tasks. Fixes #5895. Use tenant.cancel for cancellation (#5921)
105edc265 Tue Nov 28 19:15:21 2023 +0200 fix: remove layer_removal_cs (#5108)
5345c1c21 Tue Nov 28 17:31:42 2023 +0000 perf readme fix (#5956)
12dd6b61d Tue Nov 28 17:47:15 2023 +0000 build(deps): bump aiohttp from 3.8.6 to 3.9.0 (#5946)
65160650d Tue Nov 28 12:50:53 2023 -0500 Add walingest test (#5892)
fd440e7d7 Tue Nov 28 23:43:24 2023 +0000 neonvm: add pgbouncer patch to support DEALLOCATD/DISCARD ALL (#5958)
0d1687496 Wed Nov 29 01:24:02 2023 +0100 build(deps): bump openssl from 0.10.55 to 0.10.60 (#5965)
8c195d821 Wed Nov 29 02:16:35 2023 +0100 build(deps): bump cryptography from 41.0.4 to 41.0.6 (#5970)
a15969714 Wed Nov 29 02:17:15 2023 +0100 build(deps): bump openssl from 0.10.57 to 0.10.60 in /test_runner/pg_clients/rust/tokio-postgres (#5966)
c48cc020b Wed Nov 29 09:32:26 2023 +0000 pageserver: fix race between deletion completion and incoming requests (#5941)
78e73b20e Wed Nov 29 14:07:06 2023 +0400 Notify safekeeper readiness with systemd.
64890594a Wed Nov 29 12:08:20 2023 +0200 Optimize storing of null page in WAL (#5910)
70b5646fb Wed Nov 29 10:39:12 2023 +0000 pageserver: remove redundant serialization helpers on DeletionList (#5960)
9e55ad479 Wed Nov 29 14:52:35 2023 +0000 pageserver: refactor TenantId to TenantShardId in Tenant & Timeline (#5957)
46f20faa0 Wed Nov 29 19:38:03 2023 +0200 neon_local: fix endpoint api to prevent two primary endpoints (#5520)
ca597206b Wed Nov 29 18:44:37 2023 +0000 walredo: latency histogram for spawn duration (#5925)
f05d1b598 Thu Nov 30 10:18:59 2023 +0000 proxy: add more db error info (#5951)
fc77c42c5 Thu Nov 30 10:19:30 2023 +0000 proxy: add flag to enable http pool for all users (#5959)
50d959fdd Thu Nov 30 12:47:13 2023 +0200 refactor: use serde for TenantConf deserialization Fixes: #5300 (#5310)
292281c9d Thu Nov 30 11:34:30 2023 +0000 pagectl: add subcommand to rewrite layer file summary (#5933)
3e094e90d Thu Nov 30 14:17:58 2023 +0200 update aws sdk to 1.0.x (#5976)
1e57ddaab Thu Nov 30 14:26:11 2023 +0200 fix: flush loop should also keep the gate open (#5987)
e12e2681e Thu Nov 30 13:14:33 2023 +0000 IP allowlist on the proxy side (#5906)
8ec6033ed Thu Nov 30 14:30:17 2023 +0100 Pageserver disaster recovery RFC (#5248)
0c87d1866 Thu Nov 30 13:43:21 2023 +0000 proxy: fix wake_compute error prop (#5989)
5d3c3636f Thu Nov 30 13:44:14 2023 +0000 tests: add a log allow list entry in `test_timeline_deletion_with_files_stuck_in_upload_queue` (#5981)
3bb1030f5 Thu Nov 30 14:07:41 2023 +0000 walingest: refactor if-cascade on `decoded.xl_rmid` into match statement (#5974)
57ae9cd07 Thu Nov 30 14:22:07 2023 +0000 pageserver: add `flush_ms` and document `/location_config` API (#5860)
eba3bfc57 Thu Nov 30 15:48:40 2023 +0000 test: python needs thread safety as well (#5992)
3657a3c76 Thu Nov 30 16:33:54 2023 +0000 Proxy fix metrics record (#5996)
b451e75dc Thu Nov 30 17:31:03 2023 +0000 test: include cmdline in captured output (#5977)
f39fca004 Thu Nov 30 20:52:30 2023 +0000 proxy: chore: replace strings with SmolStr (#5786)
384277354 Thu Nov 30 21:01:25 2023 +0000 Correct RFC number for Pageserver WAL DR RFC (#5997)
b71b8ecfc Thu Nov 30 22:32:04 2023 +0100 Add existing_initdb_timeline_id param to timeline creation (#5912)
f784e59b1 Thu Nov 30 17:12:52 2023 -0600 Update timescaledb to 2.13.0 (#5975)
1ce1c82d7 Fri Dec 1 10:58:06 2023 +0000 Clean up local state if index_part.json request gives 404 (#6009)
1c88824ed Fri Dec 1 12:52:59 2023 +0100 initial logical size calculation: add a bunch of metrics (#5995)
8cd28e171 Fri Dec 1 14:16:29 2023 +0100 logical size calculation: make .current_size() infallible (#5999)
ce1652990 Fri Dec 1 14:16:29 2023 +0100 logical size: better represent level of accuracy in the type system (#5999)
7eabfc40e Fri Dec 1 13:26:19 2023 +0000 test_runner: use separate directory for each rerun (#6004)
92e7cd40e Fri Dec 1 13:40:49 2023 +0000 add sql_exporter to vm-image (#5949)
e49c21a3c Fri Dec 1 09:11:41 2023 -0500 Speed up rel extend (#5983)
fd81945a6 Fri Dec 1 09:16:24 2023 -0500 Use TEST_OUTPUT envvar in pageserver (#5984)
711425cc4 Fri Dec 1 18:30:51 2023 +0200 fix: use create_new instead of create for mutex file (#6012)
c1295bfb3 Fri Dec 1 18:19:55 2023 +0100 [compute_ctl] User correct HTTP code in the /configure errors (#6017)
e43cde7ab Fri Dec 1 22:45:04 2023 +0100 initial logical size: remove CALLS metric from hot path (#6018)
e3512340c Sun Dec 3 15:21:44 2023 +0000 Override neon.max_cluster_size for the time of compute_ctl (#5998)
1d81e70d6 Mon Dec 4 09:57:47 2023 +0000 pageserver: tweak logs for index_part loading (#6005)
e6b2f89fe Mon Dec 4 11:18:41 2023 +0000 test_pg_clients: fix test that reads from stdout (#6021)
eae49ff59 Mon Dec 4 12:35:09 2023 +0000 Perform L0 compaction before creating new image layers (#5950)
207c52727 Mon Dec 4 18:22:36 2023 +0400 Safekeepers: persist state before timeline deactivation.
12f02523a Mon Dec 4 15:00:24 2023 +0000 Enable dynamic rate limiter (#6029)
7403d5501 Mon Dec 4 16:06:41 2023 +0000 walredo: stderr cleanup & make explicitly cancel safe (#6031)
c7f1143e5 Mon Dec 4 17:22:26 2023 +0000 concurrency-limit low-priority initial logical size calculation [v2] (#6000)
85d08581e Mon Dec 4 19:54:18 2023 +0100 [compute_ctl] Introduce feature flags in the compute spec (#6016)
bad686bb7 Mon Dec 4 21:10:23 2023 +0000 Remove trusted from wal2json (#6035)
c48918d32 Tue Dec 5 10:03:07 2023 +0000 Rename metric (#6030)
f60e49fe8 Tue Dec 5 11:24:16 2023 +0100 proxy: fix panic in startup packet (#6032)
61fe9d360 Tue Dec 5 12:01:55 2023 +0000 pageserver: add Key->Shard mapping logic & use it in page service (#5980)
bc1020f96 Tue Dec 5 13:38:45 2023 +0100 compute_ctl: Notify waiters when Postgres failed to start (#6034)
be885370f Tue Dec 5 15:03:07 2023 +0000 pageserver: remove redundant unsafe_create_dir_all (#6040)
da5e03b0d Tue Dec 5 15:38:27 2023 +0000 pageserver: add a /reset API for tenants (#6014)
483caa22c Tue Dec 5 16:11:15 2023 +0000 pageserver: logging tweaks (#6039)
7fab731f6 Tue Dec 5 18:49:24 2023 +0200 Track size of FSM fork while applying records at replica (#5901)
987c9aaea Wed Dec 6 12:05:28 2023 +0000 virtual_file: fix the metric for close() calls done by VirtualFile::drop (#6051)
7501ca6ef Wed Dec 6 15:12:36 2023 +0000 Revert timescaledb for pg14 and pg15 (#6056)
a3c7d400b Thu Dec 7 07:25:22 2023 +0000 fix: avoid allocations with logging a slug (#6047)
31be301ef Thu Dec 7 10:20:40 2023 +0200 Make simple_rcu::RcuWaitList::wait() async (#6046)
10c77cb41 Thu Dec 7 09:01:08 2023 +0000 temp: increase the wait tenant activation timeout (#6058)
52718bb8f Thu Dec 7 11:39:40 2023 +0200 fix(layer): metric splitting, span rename (#5902)
b7ffe2442 Thu Dec 7 11:31:38 2023 +0000 build: update tokio to 1.34.0, tokio-utils 0.7.10 (#6061)
f9401fdd3 Thu Dec 7 11:47:16 2023 +0000 proxy: fix channel binding error messages (#6054)
e89e41f8b Thu Dec 7 12:27:16 2023 +0000 tests: update for tenant generations (#5449)
880663f6b Thu Dec 7 14:52:16 2023 +0000 tests: use tenant_create() helper in test_bulk_insert (#6064)
b492cedf5 Thu Dec 7 15:52:22 2023 +0000 fix(remote_storage): buffering, by using streams for upload and download (#5446)
f2892d379 Thu Dec 7 16:17:33 2023 +0000 virtual_file metrics: distinguish first and subsequent open() syscalls (#6066)
7aa1e5830 Thu Dec 7 12:30:42 2023 -0600 Add support for Python 3.12
37fdbc3aa Thu Dec 7 19:36:44 2023 +0000 fix: use larger buffers for remote storage (#6069)
7914eaf1e Fri Dec 8 03:33:44 2023 +0100 Buffer initdb.tar.zst to a temporary file before upload (#5944)
d9d8e9afc Fri Dec 8 08:39:45 2023 +0000 test_tenant_reattach: fix reattach mode names (#6070)
65f48c700 Fri Dec 8 14:03:13 2023 +0400 Make targets to run pgindent on core and neon extension.
1bbd6cae2 Fri Dec 8 14:03:13 2023 +0400 pgindent pgxn/neon
193e60e2b Fri Dec 8 14:03:13 2023 +0400 Fix/edit pgindent confusing places in neon.
2c544343e Fri Dec 8 10:12:37 2023 +0000 pageserver: filtered WAL ingest for sharding (#6024)
699049b8f Fri Dec 8 11:48:37 2023 +0000 proxy: make auth more type safe (#5689)
5e98855d8 Fri Dec 8 14:52:37 2023 +0000 tests: update tests that used local_fs&mock_s3 to use one or the other (#6015)
f5b9af6ac Fri Dec 8 15:27:21 2023 +0000 page cache: improve eviction-related metrics (#6077)
e1a564ace Fri Dec 8 16:21:17 2023 +0000 proxy simplify cancellation (#5916)
cf024de20 Fri Dec 8 17:23:50 2023 +0000 virtual_file metrics: expose max size of the fd cache (#6078)
e640bc7db Fri Dec 8 17:32:16 2023 +0000 tests: allow-lists for occasional failures (#6074)
df1f8e13c Fri Dec 8 19:58:36 2023 +0100 proxy: pass neon options in deep object format (#6068)
0ba4cae49 Fri Dec 8 12:55:44 2023 -0800 Fix RLS/REPLICATION granting (#6083)
f0d15cee6 Mon Dec 11 12:21:02 2023 +0100 build: update azure-* to 0.17 (#6081)
66a7a226f Mon Dec 11 15:13:27 2023 +0000 test_runner: use toml instead of formatted strings (#6088)
f1fc1fd63 Mon Dec 11 15:52:33 2023 +0000 pageserver: further refactoring from TenantId to TenantShardId (#6059)
6a922b1a7 Mon Dec 11 16:55:43 2023 +0000 tests: start adding tests for secondary mode, live migration (#5842)
036558c95 Mon Dec 11 13:08:37 2023 -0600 Fix git ownership issue in check-codestyle-rust-arm
5ab9592a2 Mon Dec 11 13:08:37 2023 -0600 Add submodule paths as safe directories as a precaution
c49fd69bd Mon Dec 11 21:08:14 2023 +0000 Add initdb_lsn to TimelineInfo (#6104)
3b04f3a74 Mon Dec 11 21:27:53 2023 +0000 fix: accidential return Ok (#6106)
20e9cf7d3 Tue Dec 12 07:19:59 2023 +0000 pageserver: tweaks to slow/hung task logging (#6098)
fead836f2 Tue Dec 12 10:39:34 2023 +0000 swagger: remove 'format: hex' from tenant IDs (#6099)
9e071e445 Tue Dec 12 11:42:51 2023 +0000 Propagate information about the protocol to console (#6102)
8bb4a1319 Tue Dec 12 14:23:45 2023 +0200 Do not materialize null images in PS (#5979)
aec1acdba Tue Dec 12 14:24:21 2023 +0200 Do not inherite replication slots in branch (#5898)
6acbee236 Tue Dec 12 16:24:13 2023 +0000 test_runner: add `from_repo_dir` method (#6087)
dfb0a6fda Tue Dec 12 16:53:08 2023 +0000 scrubber: handle initdb files, fix an issue with prefixes (#6079)
5820faaa8 Tue Dec 12 18:00:37 2023 +0100 Use extend instead of groups of append calls in tests (#6109)
7c2c87a5a Tue Dec 12 18:20:12 2023 +0100 Update azure SDK to 0.18 and use open range support (#6103)
8460654f6 Wed Dec 13 07:03:21 2023 +0200 Add per-endpoint rate limiter to proxy
c8316b7a3 Wed Dec 13 13:53:23 2023 +0000 simplify endpoint limiter (#6122)
e3778381a Wed Dec 13 14:14:38 2023 +0000 tests: make test_bulk_insert recreate tenant in same generation (#6113)
2d2266106 Wed Dec 13 14:23:19 2023 +0000 refactor: calculate_synthetic_size_worker, remove PRE::NeedsDownload (#6111)
a919b863d Wed Dec 13 18:05:33 2023 +0200 refactor: remove eviction batching (#6060)
c2528ae67 Wed Dec 13 16:23:24 2023 +0000 Increase pgbouncer pool size to 64 for VMs (#6124)
d6fcc18eb Wed Dec 13 17:18:20 2023 +0000 Add Neon-Batch- headers to OPTIONS response for SQL-over-HTTP requests (#6116)
85720616b Wed Dec 13 15:04:25 2023 -0600 Update Postgres 14 series to 14.10
c94db6adb Wed Dec 13 15:04:25 2023 -0600 Update Postgres 15 series to 15.5
158adf602 Wed Dec 13 15:04:25 2023 -0600 Update Postgres 16 series to 16.1
f401a21cf Wed Dec 13 15:04:25 2023 -0600 Fix test_simple_sync_safekeepers
904dff58b Wed Dec 13 15:04:25 2023 -0600 test_wal_restore_http: cleanup test
0cd49cac8 Wed Dec 13 15:04:25 2023 -0600 test_compatibility: make it use initdb.tar.zst
6987b5c44 Wed Dec 13 21:43:49 2023 +0000 proxy: add more rates to endpoint limiter (#6130)
c4e0ef507 Thu Dec 14 13:09:24 2023 +0000 pageserver: heatmap uploads (#6050)
aa5581d14 Thu Dec 14 16:31:41 2023 +0100 utils::logging: TracingEventCountLayer: don't use with_label_values() on hot path (#6129)
cc633585d Thu Dec 14 17:21:39 2023 +0000 gauge guards (#6138)
f01047910 Thu Dec 14 21:32:54 2023 +0200 feat(layer): pageserver_layer_redownloaded_after histogram (#6132)
f1cd1a212 Fri Dec 15 08:51:23 2023 +0000 pageserver: improved handling of concurrent timeline creations on the same ID (#6139)
5bb9ba37c Fri Dec 15 13:43:11 2023 +0400 Fix python list_segments of sk.
07508fb11 Fri Dec 15 12:18:22 2023 +0200 fix: better Json parsing errors (#6135)
0fd80484a Fri Dec 15 11:59:24 2023 +0000 fix: Timeline deletion during busy startup (#6133)
215cdd18c Fri Dec 15 12:11:25 2023 +0000 Make initdb upload retries cancellable and seek to beginning (#6147)
98629841e Fri Dec 15 12:11:50 2023 +0000 improve proxy code cov (#6141)
bd1cb1b21 Fri Dec 15 15:08:28 2023 +0000 tests: update allow list for `negative_env` (#6144)
e62569a87 Fri Dec 15 19:31:51 2023 +0400 A few comments on rust walproposer build.
de1a9c6e3 Fri Dec 15 15:48:55 2023 +0000 s3_scrubber: basic support for sharding (#6119)
1a9854bfb Fri Dec 15 18:33:45 2023 +0100 add a Rust client for Pageserver management API (#6127)
56f7d55ba Fri Dec 15 17:43:02 2023 +0000 pageserver: basic cancel/timeout for remote storage operations (#6097)
d066dad84 Fri Dec 15 20:37:47 2023 +0000 pageserver: prioritize activation of tenants with client requests (#6112)
83811491d Sat Dec 16 09:06:00 2023 +0000 update zerocopy (#6148)
8619e6295 Sat Dec 16 10:33:52 2023 +0000 CI: build build-tools image (#6082)
47873470d Sat Dec 16 10:52:48 2023 +0000 pageserver: add method to dump keyspace in mgmt api client (#6145)
9bdc25f0a Sat Dec 16 12:32:00 2023 +0000 Revert "CI: build build-tools image" (#6156)
e1935f42a Mon Dec 18 11:03:34 2023 +0400 Don't generate core dump when walproposer intentionally panics.
dbdb1d21f Mon Dec 18 10:29:19 2023 +0000 pageserver: on-demand activation cleanups (#6157)
17bde7eda Mon Dec 18 10:59:49 2023 +0000 proxy refactor large files (#6153)
33cb9a68f Mon Dec 18 13:33:23 2023 +0000 pageserver: Reduce tracing overhead in timeline::get (#6115)
00d90ce76 Mon Dec 18 16:04:47 2023 +0100 Added cache for get role secret (#6165)
4ea4812ab Mon Dec 18 15:47:09 2023 +0000 tests: update python dependencies (#6164)
1f9a7d1cd Mon Dec 18 18:17:19 2023 +0000 add a Rust client for Pageserver page_service (#6128)
62737f377 Mon Dec 18 10:54:14 2023 -0800 Grant BYPASSRLS and REPLICATION explicitly to neon_superuser roles
82215d20b Mon Dec 18 21:05:24 2023 +0200 Mark some variables 'static'
c4c48cfd6 Mon Dec 18 21:05:29 2023 +0200 Clean up #includes
6939fc3db Mon Dec 18 21:05:31 2023 +0200 Remove declarations of non-existent global variables and functions
6e6e40dd7 Mon Dec 18 23:24:22 2023 +0100 Invalidate credentials on auth failure (#6171)
c272c68e5 Tue Dec 19 11:20:56 2023 +0100 RFC: Per-Tenant GetPage@LSN Throttling (#5648)
a89d6dc76 Tue Dec 19 11:29:16 2023 +0100 Always send a json response for timeline_get_lsn_by_timestamp (#6178)
fbb979d5e Tue Dec 19 11:29:50 2023 +0100 remote_storage: move shared utilities for S3 and Azure into common module (#6176)
6ffbbb2e0 Tue Dec 19 10:32:51 2023 +0000 include timeline ids in tenant details response (#6166)
d89af4cf8 Tue Dec 19 10:38:00 2023 +0000 pageserver: downgrade 'connection reset' WAL errors (#6181)
b701394d7 Tue Dec 19 15:34:14 2023 +0400 Fix WAL waiting in walproposer for v16.
73d247c46 Tue Dec 19 11:44:25 2023 +0000 Analyze clickbench performance with explain plans and pg_stat_statements (#6161)
c52384752 Tue Dec 19 15:10:07 2023 +0200 Compile `pg_semver` extension (#6184)
a2fab3437 Tue Dec 19 13:16:53 2023 +0000 Update zstd to 0.13 (#6187)
e6bf6952b Tue Dec 19 14:46:17 2023 +0100 higher resolution histograms for getpage@lsn (#6177)
8b91bbc38 Tue Dec 19 15:45:17 2023 +0000 Update jsonwebtoken to 9 and sct to 0.7.1 (#6189)
8ff5387da Tue Dec 19 18:17:11 2023 +0200 eliminate GCC warning for unchecked result of fread (#6167)
0bd79eb06 Tue Dec 19 16:27:47 2023 +0000 Handle role deletion when project has no databases. (#6170)
82809d2ec Tue Dec 19 17:44:49 2023 +0100 fix metric `pageserver_initial_logical_size_start_calculation` (#6191)
613906ace Tue Dec 19 17:06:43 2023 +0000 Support custom types in broker (#5761)
58dbca6ce Tue Dec 19 23:48:41 2023 +0000 Bump vm-builder v0.19.0 -> v0.21.0 (#6197)
c29df8063 Wed Dec 20 10:26:06 2023 +0200 fix(layer): move backoff to spawned task (#5746)
f260f1565 Wed Dec 20 12:26:20 2023 +0000 pageserver: fixes + test updates for sharding (#6186)
0f56104a6 Wed Dec 20 15:06:55 2023 +0000 Make sk_collect_dumps also possible with teleport (#4739)
ac38d3a88 Wed Dec 20 17:00:29 2023 +0000 remote_storage: don't count 404s as errors (#6201)
48f156b8a Wed Dec 20 18:44:19 2023 +0000 feat: relative last activity based eviction (#6136)
baa1323b4 Wed Dec 20 22:38:58 2023 +0000 Use ProfileFileCredentialsProvider for AWS SDK configuration (#6202)
48890d206 Thu Dec 21 12:52:38 2023 +0100 Simplify inject_index_part test function (#6207)
2df3602a4 Thu Dec 21 12:00:10 2023 +0000 Add GC to http connection pool (#6196)
5385791ca Thu Dec 21 13:07:23 2023 +0100 add pageserver component-level benchmark (`pagebench`) (#6174)
f93d15f78 Thu Dec 21 13:34:31 2023 +0100 add comment to run vacuum for clickbench (#6212)
61b6c4cf3 Thu Dec 21 12:46:51 2023 +0000 Build dockerfile from neon repo (#6195)
7d6fc3c82 Thu Dec 21 14:23:09 2023 +0000 Use pre-generated initdb.tar.zst in test_ingest_real_wal (#6206)
1dff98be8 Thu Dec 21 14:55:24 2023 +0000 CI: fix build-tools image tag for PRs (#6217)
a21b71977 Thu Dec 21 17:28:28 2023 +0100 Use neon-github-ci-tests S3 bucket for remote_storage tests (#6216)
83000b382 Thu Dec 21 18:07:21 2023 +0100 buildtools: update protoc and mold (#6222)
e68ae2888 Fri Dec 22 10:22:22 2023 +0000 pageserver: expedite tenant activation on delete (#6190)
a7342b389 Fri Dec 22 14:13:20 2023 +0100 remote_storage: store last_modified and etag in Download (#6227)
572bc0601 Fri Dec 22 20:47:55 2023 +0200 Do not copy WAL for lagged slots (#6221)
cdb08f036 Tue Dec 26 14:12:53 2023 +0400 Introduce NeonWALReader downloading sk -> compute WAL on demand.
14913c644 Tue Dec 26 14:12:53 2023 +0400 Adapt rust walproposer to neon_walreader.
df760e6de Tue Dec 26 14:12:53 2023 +0400 Add test_lagging_sk.
9c493869c Tue Dec 26 14:12:53 2023 +0400 Perform synchronous WAL download in wp only for logical replication.
854df0f56 Tue Dec 26 14:12:53 2023 +0400 Do PQgetCopyData before PQconsumeInput in libpqwp_async_read.
1f1c50e8c Tue Dec 26 14:12:53 2023 +0400 Don't re-add neon_walreader socket to waiteventset if possible.
d5fbfe239 Tue Dec 26 14:12:53 2023 +0400 Remove test_wal_deleted_after_broadcast.
bfc98f36e Tue Dec 26 14:12:53 2023 +0400 Refactor handling responses in walproposer.
ddc431fc8 Tue Dec 26 14:12:53 2023 +0400 pgindent walproposer condvar comment
6e4090056 Tue Dec 26 15:17:09 2023 +0000 Manage pgbouncer configuration from compute_ctl: - add pgbouncer_settings section to compute spec; - add pgbouncer-connstr option to compute_ctl. - add pgbouncer-ini-path option to compute_ctl. Default: /etc/pgbouncer/pgbouncer.ini
136aab547 Wed Dec 27 08:39:00 2023 -0800 Bump postgres submodule versions
e5a3b6dfd Wed Dec 27 18:15:17 2023 +0100 Pg stat statements reset for neon superuser (#6232)
1c037209c Fri Dec 29 09:32:24 2023 +0000 proxy: fix compute addr parsing (#6237)
f28bdb652 Sat Dec 30 13:45:31 2023 +0000 Use nextest for rust unittests (#6223)
9a43c04a1 Mon Jan 1 20:44:05 2024 +0400 compute_ctl: kill postgres and sync-safekeeprs on exit.
90ef48aab Mon Jan 1 20:44:05 2024 +0400 Fix safekeeper START_REPLICATION (term=n).
dbd36e40d Tue Jan 2 10:50:20 2024 +0400 Move failpoint support code to utils.
e79a19339 Tue Jan 2 10:50:20 2024 +0400 Add failpoint support to safekeeper.
aaaa39d9f Tue Jan 2 10:50:20 2024 +0400 Add large insertion and slow WAL sending to test_hot_standby.
e92c9f42c Tue Jan 2 10:50:20 2024 +0400 Don't split WAL record across two XLogData's when sending from safekeepers.
ea9fad419 Tue Jan 2 06:28:49 2024 -0800 Add exponential backoff to page_server->send
091a0cda9 Tue Jan 2 06:28:49 2024 -0800 Switch to rate-limiting strategy
4e1d16f31 Tue Jan 2 06:28:49 2024 -0800 Switch to exponential rate-limiting
ce13281d5 Tue Jan 2 06:28:49 2024 -0800 MIN not MAX
946c6a000 Tue Jan 2 15:22:16 2024 +0000 scrubber: use adaptive config with retries, check subset of tenants (#6219)
aa9f1d4b6 Tue Jan 2 16:57:29 2024 +0000 pagebench get-page: default to latest=true, make configurable via flag (#6252)
ae3eaf999 Wed Jan 3 11:10:27 2024 +0400 Add [WP] prefix to all walproposer logging.
f71110383 Wed Jan 3 13:13:32 2024 +0400 Remove second check for max_slot_wal_keep_size download size.
42f41afcb Wed Jan 3 10:36:53 2024 +0000 tests: update pytest and boto3 dependencies (#6253)
fb518aea0 Wed Jan 3 10:41:58 2024 +0000 Add batch ingestion mechanism to avoid high contention (#5886)
673a86505 Wed Jan 3 11:50:58 2024 +0000 tests: tolerate 304 when evicting layers (#6261)
17b256679 Wed Jan 3 13:02:04 2024 +0000 vm-image-spec: build pgbouncer from Neon's fork (#6249)
65b4e6e7d Wed Jan 3 18:20:19 2024 +0400 Remove empty safekeeper init since truncateLsn.
edc962f1d Wed Jan 3 14:22:17 2024 +0000 test_runner: test_issue_5878 log allow list (#6259)
753d97bd7 Wed Jan 3 14:22:40 2024 +0000 pageserver: don't delete ancestor shard layers
6c79e1263 Wed Jan 3 14:22:40 2024 +0000 pageserver: drop unwanted keys during compaction after split
ef7c9c2cc Wed Jan 3 14:22:40 2024 +0000 pageserver: fix active tenant lookup hitting secondaries with sharding
34ebfbdd6 Wed Jan 3 14:22:40 2024 +0000 pageserver: fix handling getpage with multiple shards on one node
73a944205 Wed Jan 3 14:22:40 2024 +0000 pageserver: log details on shard routing error
a2e083ebe Wed Jan 3 14:22:40 2024 +0000 pageserver: make walredo shard-aware
c119af8dd Wed Jan 3 14:22:40 2024 +0000 pageserver: run at least 2 background task threads
7662df6ca Wed Jan 3 21:09:19 2024 -0800 Fix minimum backoff to 1ms
18e920815 Thu Jan 4 10:40:03 2024 +0000 pageserver: improved error handling for shard routing error, timeline not found (#6262)
f3b5db144 Thu Jan 4 17:40:38 2024 +0000 Add API for safekeeper timeline copy (#6091)
d260426a1 Fri Jan 5 11:48:06 2024 +0100 is_rel_block_key: exclude the relsize key (#6266)
3c560d27a Fri Jan 5 12:29:20 2024 +0000 pageserver: implement secondary-mode downloads (#6123)
7de829e47 Fri Jan 5 15:35:07 2024 +0000 test_runner: replace black with ruff format (#6268)
a41c4122e Sat Jan 6 01:24:44 2024 +0400 Don't suspend compute if there is active LR subscriber.
d1c0232e2 Mon Jan 8 03:53:15 2024 +0000 pageserver: use `pub(crate)` in metrics.rs, and clean up unused items (#6275)
b5ed6f22a Mon Jan 8 09:19:00 2024 +0000 pageserver: clean up a TODO comment (#6282)
b3a681d12 Mon Jan 8 09:19:10 2024 +0000 s3_scrubber: updates for sharding (#6281)
a4ac8e26e Mon Jan 8 11:46:16 2024 +0100 Update Rust to 1.75.0 (#6285)
8a646cb75 Mon Jan 8 11:42:43 2024 +0000 proxy: add request context for observability and blocking (#6160)
66c52a629 Mon Jan 8 15:00:01 2024 +0000 RFC: vectored `Timeline::get` (#6250)
d5e343437 Tue Jan 9 04:22:36 2024 +0000 Also allow unnecessary_fallible_conversions lint (#6294)
9bf766404 Mon Jan 8 21:12:39 2024 -0800 vm-monitor: Remove spammy log line (#6284)
4b6004e8c Tue Jan 9 10:22:43 2024 +0100 fix(page_service client): correctly deserialize pagestream errors (#6302)
90e0219b2 Tue Jan 9 10:15:46 2024 +0000 python tests: support overlayfs for NeonEnvBuilder.from_repo_dir (#6295)
8186f6b6f Tue Jan 9 11:20:08 2024 +0100 Drop async_trait usage from three internal traits (#6305)
4b9b4c2c3 Tue Jan 9 10:37:54 2024 +0000 pageserver: cleanup redundant create/attach code, fix detach while attaching (#6277)
f94abbab9 Tue Jan 9 12:10:15 2024 +0000 pageserver: clean up a redundant tenant_id attribute (#6280)
4e1b0b84e Tue Jan 9 19:00:37 2024 +0100 pagebench: fixup after is_rel_block_key changes in #6266 (#6303)
76372ce00 Wed Jan 10 11:51:05 2024 +0000 Added auth info cache with notifiations to redis. (#6208)
71beabf82 Wed Jan 10 15:11:43 2024 +0000 Join multiline postgres logs in compute_ctl (#5903)
544284cce Wed Jan 10 22:25:28 2024 +0400 Collapse multiline queries in compute_ctl (#6316)
fc66ba43c Thu Jan 11 11:29:14 2024 +0100 Revert "revert recent VirtualFile asyncification changes (#5291)" (#6309)
3ee981889 Thu Jan 11 10:32:39 2024 +0000 compaction: avoid no-op timeline dir fsync (#6311)
a84935d26 Thu Jan 11 12:09:26 2024 +0000 Extend unsupported startup parameter error message (#6318)
551f0cc09 Thu Jan 11 14:58:31 2024 +0000 proxy: refactor how neon-options are handled (#6306)
da7a7c867 Thu Jan 11 15:55:32 2024 +0000 pageserver: do not bump priority of background task for timeline status requests (#6301)
915fba146 Thu Jan 11 17:42:11 2024 +0000 pagebench: getpage: optional keyspace cache file (#6324)
087526b81 Thu Jan 11 18:11:44 2024 +0000 neon_local init: add `--force` mode that allows an empty dir (#6328)
8551a6101 Thu Jan 11 19:49:28 2024 +0000 build(deps): bump jinja2 from 3.1.2 to 3.1.3 (#6333)
1eb30b40a Thu Jan 11 15:30:33 2024 -0800 Bump postgres version to support CREATE PUBLICATION FOR ALL TABLES
7f828890c Fri Jan 12 10:58:22 2024 +0400 Extract safekeeper per timeline state from safekeeper.rs
42613d4c3 Fri Jan 12 10:23:21 2024 +0100 refactor(NeonEnv): shutdown of child processes (#6327)
8b657a148 Fri Jan 12 11:53:18 2024 +0100 pagebench: getpage: cancellation & better logging (#6325)
eae74383c Fri Jan 12 11:07:16 2024 +0000 pageserver client: mgmt_api: expose reset API (#6326)
aafe79873 Fri Jan 12 12:43:14 2024 +0000 page_service: handle GetActiveTenantError::Cancelled (#6344)
7af4c676c Fri Jan 12 15:32:27 2024 +0100 pageserver: only upload initdb from shard 0 (#6331)
02c6abadf Fri Jan 12 17:11:19 2024 +0000 pageserver: remove depenency of pagebench on pageserver (#6334)
1c432d549 Fri Jan 12 18:15:41 2024 +0100 [compute_ctl] Do not miss short-living connections (#6008)
cd48ea784 Fri Jan 12 18:27:11 2024 +0100 TenantInfo: expose generation number (#6348)
97b48c23f Fri Jan 12 18:24:22 2024 +0000 Compact some compute_ctl logs (#6346)
b76454ae4 Fri Jan 12 19:25:17 2024 +0000 add script to set up EC2 storage-optimized instance store for benchmarking (#6350)
60ced0658 Sat Jan 13 09:15:58 2024 +0100 Fix timeline creation and tenant deletion race (#6310)
31a4eb40b Sun Jan 14 09:33:57 2024 +0200 Do not suspend compute if autovacuum is active (#6322)
0e1ef3713 Mon Jan 15 08:54:19 2024 +0000 fix(pagebench): #6325 broke running without `--runtime` (#6351)
0bac8ddd7 Mon Jan 15 16:43:19 2024 +0100 proxy: fix serverless error message info (#6279)
d34adf46b Mon Jan 15 16:15:34 2024 +0000 do not provide disclaimer input for the deploy-prod workflow (#6360)
2a3cfc966 Mon Jan 15 17:19:19 2024 +0100 Remove PAGE_CACHE_ACQUIRE_PINNED_SLOT_TIME histogram. (#6356)
3f2187eb9 Tue Jan 16 08:42:13 2024 +0000 Proxy relax sni check (#6323)
df9e9de54 Tue Jan 16 09:21:00 2024 +0000 pageserver: API updates for sharding (#6330)
887e94d7d Tue Jan 16 09:39:19 2024 +0000 page_service: more efficient page_service -> shard lookup (#6037)
bf4e70864 Tue Jan 16 10:29:26 2024 +0000 pageserver: eviction for secondary mode tenants (#6225)
4b0204ede Tue Jan 16 12:07:20 2024 +0000 Add copy operation tests and implement them for azure blobs (#6362)
6ffdcfe6a Tue Jan 16 18:45:19 2024 +0100 remote_storage: unify azure and S3 tests (#6364)
ab86060d9 Wed Jan 17 12:42:42 2024 +0100 Copy initdb if loading from different timeline ID (#6363)
4cec95ba1 Wed Jan 17 13:34:51 2024 +0000 pageserver: add list API for LocationConf (#6329)
b6ec11ad7 Wed Jan 17 18:01:08 2024 +0000 control_plane: generalize attachment_service to handle sharding (#6251)
0dc4c9b0b Wed Jan 17 20:34:30 2024 +0200 Relsize hash lru eviction (#6353)
e247ddbdd Thu Jan 18 09:54:15 2024 +0000 build: update h2 (#6383)
a584e300d Thu Jan 18 12:39:45 2024 +0200 test: figure out the relative eviction order assertions (#6375)
bd19290d9 Thu Jan 18 10:52:18 2024 +0000 pageserver: add shard_id to metric labels (#6308)
e6e013b3b Thu Jan 18 11:27:12 2024 +0000 Fix pgbouncer settings update:
02b916d3c Thu Jan 18 17:08:34 2024 +0200 Use [NEON_SMGR] tag for all messages in neon extension (#6313)
57155ada7 Thu Jan 18 17:21:08 2024 +0200 temp: human readable summaries for relative access time compared to absolute (#6384)
00936d19e Thu Jan 18 18:39:38 2024 +0000 pagebench: use tracing panic hook (#6393)
e8f773387 Thu Jan 18 18:50:42 2024 +0000 pagebench: avoid noise about `CopyFail` in PS logs (#6392)
a092127b1 Thu Jan 18 18:55:24 2024 +0000 Fix truncateLsn initialization (#6396)
c65ac37a6 Thu Jan 18 20:59:43 2024 +0000 zenbenchmark: attach perf results to allure report (#6395)
88df05753 Fri Jan 19 20:11:24 2024 +0400 Delete WAL segments from s3 when timeline is deleted.
760a48207 Fri Jan 19 19:16:01 2024 +0000 fixup(#6037): page_service hangs up within 10ms if there's no message (#6388)
7e7e9f519 Sat Jan 20 09:38:11 2024 +0000 proxy: add more columns to parquet upload (#6405)
f003dd6ad Sat Jan 20 10:20:53 2024 +0000 Remove rename in parameters (#6411)
c77981289 Sat Jan 20 17:41:55 2024 +0200 build: terminate long running tests (#6389)
e4898a6e6 Sat Jan 20 18:04:16 2024 +0200 Don't pass InvalidTransactionId to update_next_xid. (#6410)
9ace36d93 Sat Jan 20 16:14:53 2024 +0000 Proxy: do not store empty key (#6415)
34ddec67d Sun Jan 21 09:58:42 2024 +0100 proxy small tweaks (#6398)
1aea65eb9 Sun Jan 21 22:11:00 2024 +0200 Fix potential overflow in update_next_xid (#6412)
5559b1695 Mon Jan 22 09:14:30 2024 +0000 bump shlex (#6421)
efdb2bf94 Mon Jan 22 11:05:27 2024 +0000 Added missing PG_VERSION arg into compute node dockerfile (#6382)
3290fb09b Mon Jan 22 13:24:10 2024 +0000 Proxy: fix gc (#6426)
15c0df4de Mon Jan 22 14:27:29 2024 +0000 fixup(#6037): actually fix the issue, #6388 failed to do so (#6429)
93572a3e9 Mon Jan 22 15:50:32 2024 +0000 pageserver: mark tenant broken when cancelling attach (#6430)
205b6111e Mon Jan 22 18:27:05 2024 +0000 attachment_service: /attach-hook: correctly handle detach (#6433)
b41ee8130 Mon Jan 22 18:38:05 2024 +0000 Log warning on slow WAL removal (#6432)
f1901833a Mon Jan 22 19:16:38 2024 +0000 pageserver_api: migrate keyspace related functions from `pgdatadir_mapping` (#6406)
1bf8bb88c Mon Jan 22 14:53:29 2024 -0800 Add support for migrations within compute_ctl
a40ed86d8 Mon Jan 22 14:53:29 2024 -0800 Add test for migrations, add initial migration
3f90b2d33 Mon Jan 22 14:53:29 2024 -0800 Fix test_ddl_forwarding
2eac1adcb Mon Jan 22 14:53:29 2024 -0800 Make clippy happy
a71828790 Mon Jan 22 14:53:29 2024 -0800 Make migrations happen on a separate thread
394ef013d Mon Jan 22 14:53:29 2024 -0800 Push the migrations test
11a91eaf7 Mon Jan 22 14:53:29 2024 -0800 Uncomment the thread
869acfe29 Mon Jan 22 14:53:29 2024 -0800 Make migrations transactional
30064eb19 Mon Jan 22 14:53:29 2024 -0800 Add scary comment
3c3b53f8a Mon Jan 22 14:53:29 2024 -0800 Update test
6d8df2579 Mon Jan 22 14:53:29 2024 -0800 Fix dumb thing
844303255 Mon Jan 22 14:53:29 2024 -0800 Cargo fmt
b2e724997 Mon Jan 22 14:53:29 2024 -0800 Sleep
65a98e425 Mon Jan 22 14:53:29 2024 -0800 Switch to bigint
585687d56 Mon Jan 22 14:53:29 2024 -0800 Fix syntax error
9f186b4d3 Mon Jan 22 14:53:29 2024 -0800 Fix query
55aede276 Mon Jan 22 14:53:29 2024 -0800 Prevnet duplicate insertions
27587e155 Mon Jan 22 14:53:29 2024 -0800 Fix test
d90b2b99d Mon Jan 22 14:53:29 2024 -0800 Fix test again
55bfa91bd Mon Jan 22 14:53:29 2024 -0800 Fix test again again
0a7e05014 Mon Jan 22 14:53:29 2024 -0800 Fix test one last time
71f495c7f Mon Jan 22 14:53:29 2024 -0800 Gate it behind feature flags
00d9bf5b6 Tue Jan 23 07:55:05 2024 +0200 Implement lockless update of pageserver_connstring GUC in shared memory (#6314)
72de1cb51 Tue Jan 23 11:17:15 2024 +0000 remove some duped deps (#6422)
1905f0bce Tue Jan 23 13:15:05 2024 +0100 proxy: store role not found in cache (#6439)
e03f8abba Tue Jan 23 13:25:01 2024 +0000 eager parsing of ip addr (#6446)
50288c16b Tue Jan 23 15:11:32 2024 +0100 fix(pagebench): avoid CopyFail error in success case (#6443)
37638fce7 Tue Jan 23 14:23:53 2024 +0000 pageserver: introduce vectored Timeline::get interface (#6372)
42c17a6fc Tue Jan 23 17:21:06 2024 +0100 attachment_service: use atomic overwrite to persist attachments.json (#6444)
001f0d6db Tue Jan 23 18:07:01 2024 +0100 pageserver: fix import failure caused by merge race (#6448)
faf275d4a Tue Jan 23 18:22:59 2024 +0000 Remove initdb on timeline delete (#6387)
743f6dfb9 Tue Jan 23 19:14:32 2024 +0000 fix(attachment_service): corrupted attachments.json when parallel requests (#6450)
4f5182482 Tue Jan 23 22:41:00 2024 -0800 Fix creating publications for all tables
a72af29d1 Wed Jan 24 12:49:30 2024 +0100 control_plane/attachment_service: implement PlacementPolicy::Detached (#6458)
996abc956 Wed Jan 24 12:51:53 2024 +0100 pagebench-based GetPage@LSN performance test (#6214)
d820aa1d0 Wed Jan 24 13:06:05 2024 +0100 Disable initdb cancellation (#6451)
a0a3ba85e Wed Jan 24 15:47:17 2024 +0000 fix(page_service): walredo logging problem (#6460)
210700d0d Wed Jan 24 16:38:10 2024 +0000 proxy: add newtype wrappers for string based IDs (#6445)
8cb8c8d7b Wed Jan 24 16:48:56 2024 +0000 Allow remove_wal.rs to run on inactive timelines (#6462)
b92be77e1 Wed Jan 24 21:27:54 2024 +0100 Make RemoteStorage not use async_trait (#6464)
c9b1657e4 Thu Jan 25 12:35:52 2024 +0000 pageserver: fixes for creation operations overlapping with shutdown/startup (#6436)
463b6a26b Thu Jan 25 15:38:28 2024 +0200 test: show relative order eviction with "fast growing tenant" (#6377)
19ed23070 Thu Jan 25 15:53:31 2024 +0200 Add support for PS sharding in compute (#6205)
8dee9908f Thu Jan 25 18:45:17 2024 +0200 fix(compaction_task): wrong log levels (#6442)
d52b81340 Thu Jan 25 18:23:18 2024 +0100 S3 based recovery (#6155)
fd4cce941 Thu Jan 25 18:17:53 2024 +0000 test_pageserver_max_throughput_getpage_at_latest_lsn: remove n_tenants=100 combination (#6477)
689ad72e9 Thu Jan 25 19:20:02 2024 +0100 fix(neon_local): leaks child process if it fails to start & pass checks (#6474)
d36623ad7 Thu Jan 25 19:25:29 2024 +0000 CI: cancel old e2e-tests on new commits (#6463)
918b03b3b Fri Jan 26 09:25:07 2024 +0100 integrate tokio-epoll-uring as alternative VirtualFile IO engine (#5824)
12e9b2a90 Fri Jan 26 09:56:11 2024 +0000 Update plv8 (#6465)
26c55b025 Fri Jan 26 12:39:20 2024 +0000 Compute: fix rdkit extension build (#6488)
5b34d5f56 Fri Jan 26 13:40:03 2024 +0000 pageserver: add vectored get latency histogram (#6461)
55b7cde66 Fri Jan 26 14:40:47 2024 +0000 tests: add basic coverage for sharding (#6380)
4c245b0f5 Fri Jan 26 16:12:49 2024 +0000 update_build_tools_image.yml: Push build-tools image to Docker Hub (#6481)
dcc7610ad Fri Jan 26 16:43:56 2024 +0000 Do backoff::retry in s3 timetravel test (#6493)
58f6cb649 Fri Jan 26 17:20:44 2024 +0000 control_plane: database persistence for attachment_service (#6468)
3a36a0a22 Fri Jan 26 18:23:53 2024 +0000 fix(test suite): some tests leak child processes (#6497)
e34166a28 Fri Jan 26 22:48:34 2024 +0100 CI: switch back to std-fs io engine for soak time before next release (#6492)
734755eac Sat Jan 27 05:16:11 2024 +0100 Enable nextest retries for the arm build (#6496)
3a8243043 Sun Jan 28 00:15:11 2024 +0100 fixup(#6492): also switch the benchmarks that runs on merge-to-main back to std-fs (#6501)
8253cf193 Sun Jan 28 21:27:14 2024 +0000 proxy: Relax endpoint check (#6503)
c1148dc9a Mon Jan 29 07:39:16 2024 +0200 Fix calculation of maximal multixact in ingest_multixact_create_record (#6502)
511e730cc Mon Jan 29 07:26:20 2024 +0000 hll experiment (#6312)
1e9a50bca Mon Jan 29 10:38:40 2024 +0200 disk_usage_eviction_task: cleanup summaries (#6490)
0c7b89235 Mon Jan 29 09:47:12 2024 +0000 pageserver: add range layer map search implementation (#6469)
b04a6acd6 Mon Jan 29 13:31:56 2024 +0000 docker: add attachment_service binary (#6506)
6a85a06e1 Mon Jan 29 16:16:37 2024 +0000 Compute: build rdkit without freetype support (#6495)
b844c6f0c Mon Jan 29 17:59:26 2024 +0100 Do pagination in list_object_versions call (#6500)
ec8dcc223 Mon Jan 29 17:38:03 2024 +0000 flatten proxy flow (#6447)
2ff1a5cec Mon Jan 29 18:20:57 2024 +0000 Patch safekeeper control file on HTTP request (#6455)
8e4da5206 Tue Jan 30 09:29:45 2024 +0000 Compute: pgvector 0.6.0 (#6517)
c70bf9150 Tue Jan 30 10:46:49 2024 +0000 build(deps): bump aiohttp from 3.9.0 to 3.9.2 (#6518)
e3cb715e8 Tue Jan 30 14:07:58 2024 +0100 fix: capture initdb stderr, discard others (#6524)
79137a089 Tue Jan 30 13:10:48 2024 +0000 fix(#6366): pageserver: incorrect log level for Tenant not found during basebackup (#6400)
08532231e Tue Jan 30 18:05:22 2024 +0400 Fix find_end_of_wal busy loop.
bc684e9d3 Tue Jan 30 18:05:22 2024 +0400 Make WAL segment init atomic.
6928a34f5 Tue Jan 30 15:57:27 2024 +0000 S3 DR: Large prefix improvements (#6515)
3c3ee8f3e Tue Jan 30 17:33:24 2024 +0000 Compute: add compatibility patch for pgvector (#6527)
e8c9a5127 Tue Jan 30 22:32:33 2024 -0800 Allow creating subscriptions as neon_superuser (#6484)
e10a7ee39 Wed Jan 31 09:17:32 2024 +0200 Prevent to frequent reconnects in case of race condition errors returned by PS (tenant not found) (#6522)
4010adf65 Wed Jan 31 12:23:06 2024 +0000 control_plane/attachment_service: complete APIs (#6394)
c7b02ce8e Wed Jan 31 14:51:11 2024 +0100 proxy: use jemalloc (#6531)
47380be12 Wed Jan 31 15:30:19 2024 +0100 Remove version param from get_lsn_by_timestamp (#6551)
799db161d Wed Jan 31 17:37:25 2024 +0200 tests: support for running on single pg version, use in one place (#6525)
2bfc831c6 Wed Jan 31 17:02:41 2024 +0000 control_plane/attachment_service: make --path optional (#6545)
9a9d9beae Wed Jan 31 21:39:18 2024 +0200 Download SLRU segments on demand (#6151)
66719d7ea Wed Jan 31 20:52:00 2024 +0000 logging: fix span usage (#6549)
3d5fab127 Wed Jan 31 22:15:58 2024 +0000 rewrite Gate impl for better observability (#6542)
271133d96 Wed Jan 31 22:16:56 2024 +0000 Proxy: reduce number of get role secret calls (#6557)
0ac1e7152 Wed Jan 31 22:54:54 2024 +0000 update tokio-epoll-uring (#6558)
e82625b77 Wed Jan 31 23:25:57 2024 +0000 refactor(pageserver main): signal handling (#6554)
4c173456d Wed Jan 31 23:29:48 2024 +0000 pagebench: fix percentiles reporting (#6547)
221531c9d Thu Feb 1 10:35:18 2024 +0000 pageserver: lift ancestor timeline logic from read path (#6543)
d2c410c74 Thu Feb 1 13:14:35 2024 +0000 pageserver_api: remove overlaps from KeySpace (#6544)
fa52cd575 Thu Feb 1 13:36:55 2024 +0000 Remove old tests results and old coverage collection (#6376)
39be2b010 Thu Feb 1 17:34:48 2024 +0000 Makefile: set PQ_LIB_DIR to avoid linkage with system libpq (#6538)
527cdbc01 Thu Feb 1 20:18:07 2024 +0000 Don't require AWS access keys for S3 pytests (#6556)
352508003 Thu Feb 1 20:48:31 2024 +0000 Fix pgvector 0.6.0 with Neon. (#6571)
be3038890 Thu Feb 1 20:50:04 2024 +0000 Add retry to fetching basebackup (#6537)
7a70ef991 Thu Feb 1 21:59:40 2024 +0100 feat(walredo): various observability improvements (#6573)
1be5e564c Thu Feb 1 22:38:34 2024 +0100 feat(walredo): use posix_spawn by moving close_fds() work to walredo C code (#6574)
350865392 Fri Feb 2 01:35:31 2024 +0200 Print checkpoint key contents with "pagectl print-layer-file" (#6541)
23f58145e Fri Feb 2 11:22:32 2024 +0100 Update wording for better readability (#6559)
24e916d37 Fri Feb 2 10:35:09 2024 +0000 pageserver: fix a syntax error in swagger (#6566)
30c9e145d Fri Feb 2 10:51:20 2024 +0000 check-macos-build: switch job to macos-14 (M1) (#6539)
4133d14a7 Fri Feb 2 11:49:11 2024 +0000 Compute: pgbouncer 1.22.0 (#6582)
0856fe667 Fri Feb 2 12:28:48 2024 +0000 proxy: remove per client bytes (#5466)
48b05b7c5 Fri Feb 2 14:52:12 2024 +0100 Add a time_travel_remote_storage http endpoint (#6533)
56171cbe8 Fri Feb 2 15:14:42 2024 +0100 pageserver: more permissive activation timeout when testing (#6564)
46fb1a90c Fri Feb 2 15:52:03 2024 +0000 pageserver: avoid calculating/sending logical sizes on shard !=0 (#6567)
6506fd14c Fri Feb 2 16:07:35 2024 +0000 proxy: more refactors (#6526)
7e2436695 Fri Feb 2 16:57:11 2024 +0000 storage controller: use AWS Secrets Manager for database URL, etc (#6585)
caf868e27 Fri Feb 2 19:46:47 2024 +0200 test: assert we eventually free space (#6536)
2e5eab69c Fri Feb 2 18:20:18 2024 +0000 tests: remove test_gc_cutoff (#6587)
0b91edb94 Fri Feb 2 18:36:31 2024 +0000 Revert pgvector 0.6.0 (#6592)
786e9cf75 Fri Feb 2 19:22:03 2024 +0000 control_plane: implement HTTP compute hook for attachment service (#6471)
c9876b099 Fri Feb 2 21:49:11 2024 +0200 Fix double-free bug in walredo process. (#6534)
2fd8e24c8 Fri Feb 2 21:32:40 2024 +0000 Switch sleeps to wait_until (#6575)
f2aa96f00 Fri Feb 2 23:41:55 2024 +0200 Console split RFC (#1997)
d820d64e3 Fri Feb 2 22:39:20 2024 +0000 Bump vm-builder v0.21.0 -> v0.23.2 (#6480)
0ac2606c8 Fri Feb 2 23:45:57 2024 +0100 S3 restore test: Use a workaround to enable moto's self-copy support (#6594)
3d1b08496 Sat Feb 3 00:59:39 2024 +0000 Update words in docs for better readability (#6600)
aac8eb2c3 Sat Feb 3 02:16:20 2024 +0100 Minor logging improvements (#6593)
c96aead50 Sat Feb 3 09:19:37 2024 +0200 Reorganize .dockerignore
647b85fc1 Sat Feb 3 09:19:37 2024 +0200 Update pgvector to v0.6.0, third attempt
9dd69194d Sat Feb 3 22:15:59 2024 +0000 refactor(proxy): std::io::Write for BytesMut exists (#6606)
09519c177 Sun Feb 4 19:33:38 2024 +0000 chore: update wording in docs to improve readability (#6607)
7e8529bec Sun Feb 4 22:27:07 2024 +0000 Revert "Update pgvector to v0.6.0, third attempt" (#6610)
70f646ffe Mon Feb 5 09:34:03 2024 +0200 More logging fixes (#6584)
df7bee7cf Mon Feb 5 11:50:45 2024 +0200 Fix compilation with recent glibc headers with close_range(2).
56cf36043 Mon Feb 5 09:53:37 2024 +0000 Don't preserve temp files on creation errors of delta layers (#6612)
01c57ec54 Mon Feb 5 10:08:20 2024 +0000 Removed Uploading of perf result to git repo 'zenith-perf-data' (#6590)
db89b13aa Mon Feb 5 13:10:08 2024 +0100 fix: use the shared constant download buffer size (#6620)
5e8deca26 Mon Feb 5 14:49:35 2024 +0200 metrics: remove broken tenants (#6586)
74c5e3d9b Mon Feb 5 14:27:25 2024 +0000 use string interner for project cache (#6578)
cb7c89332 Mon Feb 5 14:29:05 2024 +0000 control_plane: fix tenant GET, clean up endpoints (#6553)
8e114bd61 Mon Feb 5 20:31:55 2024 +0100 control_plane/attachment_service: make --database-url optional (#6636)
947165788 Tue Feb 6 09:39:06 2024 +0200 refactor: needless cancellation token cloning (#6618)
e196d974c Tue Feb 6 10:34:16 2024 +0100 pagebench: actually implement `--num_clients` (#6640)
edcde05c1 Tue Feb 6 09:44:49 2024 +0000 refactor(walredo): split up the massive `walredo.rs` (#6583)
431f4234d Tue Feb 6 10:07:10 2024 +0000 storage controller: embed database migrations in binary (#6637)
53743991d Tue Feb 6 11:34:13 2024 +0000 uploader: avoid cloning vecs just to get Bytes (#6645)
0de46fd6f Tue Feb 6 14:04:15 2024 +0200 heavier_once_cell: switch to tokio::sync::RwLock (#6589)
dae56ef60 Tue Feb 6 12:15:42 2024 +0000 Do not suspend compute if there is an active logical replication subscription. (#6570)
629784331 Tue Feb 6 12:49:41 2024 +0000 tests: flakiness fixes in pageserver tests (#6632)
27a3c9ecb Tue Feb 6 13:15:07 2024 +0000 build(deps): bump cryptography from 41.0.6 to 42.0.0 (#6643)
53a3ed0a7 Tue Feb 6 14:43:33 2024 +0000 debug_assert presence of `shard_id` tracing field (#6572)
d7b29aace Tue Feb 6 16:20:02 2024 +0100 refactor(walredo): don't create WalRedoManager for broken tenants  (#6597)
bb9272116 Tue Feb 6 15:53:04 2024 +0000 build: migrate check-style-rust to small runners (#6588)
e65f0fe87 Tue Feb 6 17:00:55 2024 +0000 CI(benchmarks): make job split consistent across reruns (#6614)
dc811d192 Tue Feb 6 20:37:35 2024 +0200 Add a span to 'create_neon_superuser' for better OpenTelemetry traces (#6644)
4f57dc6cc Tue Feb 6 19:08:39 2024 +0000 control_plane/attachment_service: take public key as value (#6651)
f4cc7cae1 Tue Feb 6 20:30:43 2024 +0000  CI(build-tools): Update Python from 3.9.2 to 3.9.18 (#6615)
9f75da7c0 Wed Feb 7 00:31:26 2024 +0000 test_lazy_startup: fix statement_timeout setting (#6654)
f3d7d2380 Wed Feb 7 08:47:19 2024 +0200 Some small WAL records can write a lot of data to KV storage, so perform checkpoint check more frequently (#6639)
f7516df6c Wed Feb 7 12:56:53 2024 +0100 Pass timestamp as a datetime (#6656)
3d4fe205b Wed Feb 7 13:08:09 2024 +0000 control_plane/attachment_service: database connection pool (#6622)
090a78940 Wed Feb 7 13:24:10 2024 +0000 storage controller: use PUT instead of POST (#6659)
75f1a01d4 Wed Feb 7 16:14:10 2024 +0000 Optimise e2e run (#6513)
7b49e5e5c Wed Feb 7 07:55:55 2024 -0900 Remove compute migrations feature flag (#6653)
51f9385b1 Wed Feb 7 17:47:55 2024 +0000 live-reconfigurable virtual_file::IoEngine (#6552)
2e9b1f7aa Wed Feb 7 11:10:48 2024 -0800 Update Postgres 14 to 14.11
5541244dc Wed Feb 7 11:10:48 2024 -0800 Update Postgres 15 to 15.6
128fae705 Wed Feb 7 11:10:48 2024 -0800 Update Postgres 16 to 16.2
3bd2a4fd5 Wed Feb 7 19:14:18 2024 +0000 control_plane: avoid feedback loop with /location_config if compute hook fails. (#6668)
c561ad4e2 Wed Feb 7 19:39:52 2024 +0000 feat: expose locked memory in pageserver `/metrics` (#6669)
9a017778a Thu Feb 8 00:48:31 2024 +0100 Update copyright notice, set it to current year (#6671)
c52495774 Wed Feb 7 23:58:54 2024 +0000 tokio-epoll-uring: expose its metrics in pageserver's `/metrics` (#6672)
c63e3e7e8 Thu Feb 8 12:57:05 2024 +0100 Proxy: improve http-pool  (#6577)
6c34d4cd1 Thu Feb 8 13:52:04 2024 +0000 Proxy: set timeout on establishing connection (#6679)
43eae17f0 Thu Feb 8 17:31:15 2024 +0200 Drop unused replication slots (#6655)
af91a2893 Thu Feb 8 15:35:13 2024 +0000 pageserver: shard splitting (#6379)
e8d2843df Thu Feb 8 18:00:53 2024 +0000 storage controller: improved handling of node availability on restart (#6658)
c0e0fc815 Thu Feb 8 19:57:02 2024 +0100 Update Rust to 1.76.0 (#6683)
9a3131199 Thu Feb 8 22:40:14 2024 +0200 fix(heavier_once_cell): assertion failure can be hit (#6652)
c09993396 Fri Feb 9 00:37:57 2024 +0200 fix: secondary tenant relative order eviction (#6491)
529a79d26 Fri Feb 9 08:14:41 2024 +0200 Increment generation which LFC is disabled by assigning 0 to neon.file_cache_size_limit (#6692)
a18aa1475 Fri Feb 9 09:01:07 2024 +0000 test: shutdown endpoints before deletion (#6619)
568f91420 Fri Feb 9 11:34:15 2024 +0200 tests: try to make restored-datadir comparison tests not flaky (#6666)
951c9bf4c Fri Feb 9 10:12:40 2024 +0000 control_plane: fix shard splitting on unsharded tenant (#6689)
ea089dc97 Fri Feb 9 10:29:20 2024 +0000 proxy: add per query array mode flag (#6678)
eec1e1a19 Fri Feb 9 12:32:07 2024 +0000 Pre-install anon extension from compute_ctl if anon is in shared_preload_libraries. Users cannot install it themselves, because superuser is required.
eb919cab8 Fri Feb 9 12:52:58 2024 +0000 prepare to move timeouts and cancellation handling to remote_storage (#6696)
8d98981fe Fri Feb 9 13:20:04 2024 +0000 tests: deflake test_sharding_split_unsharded (#6699)
84a0e7b02 Fri Feb 9 15:56:41 2024 +0200 tests: Allow setting shutdown mode separately from 'destroy' flag
5239cdc29 Fri Feb 9 15:56:41 2024 +0200 Fix test_vm_bit_clear_on_heap_lock test
89a5c654b Fri Feb 9 14:26:50 2024 +0000 control_plane: follow up for embedded migrations (#6647)
96d89cde5 Fri Feb 9 15:50:51 2024 +0000 Proxy error reworking (#6453)
1bb9abebf Fri Feb 9 22:11:53 2024 +0400 Remove WAL segments from s3 in batches.
ca818c8bd Fri Feb 9 20:09:37 2024 +0100 fix(test_ondemand_download_timetravel): occasionally fails with slightly higher physical size (#6687)
cbd3a32d4 Fri Feb 9 19:22:23 2024 +0000 proxy: decode username and password (#6700)
1a4dd58b7 Fri Feb 9 20:22:53 2024 +0000 Grant pg_monitor to neon_superuser (#6691)
5779c7908 Fri Feb 9 22:22:40 2024 +0000 revert two recent `heavier_once_cell` changes (#6704)
0fd3cd27c Sat Feb 10 12:05:02 2024 +0200 Tighten up the check for garbage after end-of-tar.
df5e2729a Sat Feb 10 12:05:02 2024 +0200 Remove now unused allowlisted errors.
12b39c9db Sat Feb 10 11:56:52 2024 +0000 control_plane: add debug APIs for force-dropping tenant/node (#6702)
da626fb1f Sun Feb 11 01:34:31 2024 +0200 tests: Remove "postgres is running on  ... branch" messages
241dcbf70 Sun Feb 11 01:34:31 2024 +0200 tests: Remove "Running in ..." log message from every CLI call
d77583c86 Sun Feb 11 01:34:31 2024 +0200 tests: Remove obsolete allowlist entries
e5daf366a Sun Feb 11 01:34:31 2024 +0200 tests: Remove unnecessary port config with VanillaPostgres class
aeda82a01 Mon Feb 12 09:57:29 2024 +0000 fix(heavier_once_cell): assertion failure can be hit (#6722)
c77411e90 Mon Feb 12 14:52:20 2024 +0200 cleanup around `attach` (#6621)
020e60763 Mon Feb 12 14:04:46 2024 +0100 Proxy: copy bidirectional fork (#6720)
98ec5c5c4 Mon Feb 12 13:14:06 2024 +0000 proxy: some more parquet data (#6711)
242dd8398 Mon Feb 12 15:58:55 2024 +0100 refactor(blob_io): use owned buffers (#6660)
789a71c4e Mon Feb 12 15:03:45 2024 +0000 proxy: add more http logging (#6726)
7ea593db2 Mon Feb 12 17:13:35 2024 +0200 refactor(LayerManager): resident layers query (#6634)
8b8ff88e4 Mon Feb 12 15:25:33 2024 +0000 GH actions: label to disable CI runs completely (#6677)
a1f37cba1 Mon Feb 12 19:15:21 2024 +0100 Add test that runs the S3 scrubber (#6641)
fac50a626 Mon Feb 12 18:41:02 2024 +0000 Proxy refactor auth+connect (#6708)
4be2223a4 Mon Feb 12 20:29:57 2024 +0000 Discrete event simulation for safekeepers (#5804)
a8eb4042b Tue Feb 13 09:00:50 2024 +0200 tests: test_secondary_mode_eviction: avoid use of mocked statvfs (#6698)
331935df9 Tue Feb 13 17:58:58 2024 +0100 Proxy: send cancel notifications to all instances (#6719)
7fa732c96 Tue Feb 13 18:46:25 2024 +0100 refactor(virtual_file): take owned buffer in VirtualFile::write_all (#6664)
b6e070bf8 Tue Feb 13 20:41:17 2024 +0200 Do not perform fast exit for catalog pages in redo filter (#6730)
ee7bbdda0 Wed Feb 14 02:12:00 2024 +0100 Create new metric for directory counts (#6736)
a5114a99b Wed Feb 14 11:37:52 2024 +0200 Create a symlink from pg_dynshmem to /dev/shm
a97b54e3b Wed Feb 14 11:37:52 2024 +0200 Cherry-pick Postgres bugfix to 'mmap' DSM implementation
a9ec4eb4f Wed Feb 14 10:26:32 2024 +0000 hold cancel session (#6750)
f39b0fce9 Wed Feb 14 10:57:01 2024 +0000 Revert #6666 "tests: try to make restored-datadir comparison tests not flaky" (#6751)
df5d588f6 Wed Feb 14 14:22:41 2024 +0000 refactor(VirtualFile::crashsafe_overwrite): avoid Handle::block_on in callers (#6731)
774a6e747 Wed Feb 14 15:59:06 2024 +0100 refactor(virtual_file) make write_all_at take owned buffers (#6673)
840abe395 Wed Feb 14 15:01:16 2024 +0000 pageserver: store aux files as deltas (#6742)
7d3cdc05d Wed Feb 14 17:01:15 2024 +0000 fix(pageserver): pagebench doesn't work with released artifacts (#6757)
a2d0d44b4 Wed Feb 14 18:16:05 2024 +0000 Remove unused allow's (#6760)
c7538a2c2 Wed Feb 14 18:43:52 2024 +0000 Proxy: remove fail fast logic to connect to compute (#6759)
fff2468aa Wed Feb 14 18:45:05 2024 +0000 Add resource consume test funcs (#6747)
024372a3d Wed Feb 14 19:17:12 2024 +0000 Revert "refactor(VirtualFile::crashsafe_overwrite): avoid Handle::block_on in callers" (#6765)
80854b98f Wed Feb 14 23:24:07 2024 +0000 move timeouts and cancellation handling to remote_storage (#6697)
5fa747e49 Thu Feb 15 10:21:53 2024 +0200 pageserver: shard splitting refinements (parent deletion, hard linking) (#6725)
1af047dd3 Thu Feb 15 14:34:19 2024 +0200 Fix typo in CI message (#6749)
936f2ee2a Thu Feb 15 13:48:44 2024 +0000 fix: accidential wide span in tests (#6772)
9ad940086 Thu Feb 15 14:59:13 2024 +0000 fix superuser permission check for extensions (#6733)
cd3e4ac18 Thu Feb 15 15:14:51 2024 +0000 Rename TEST_IMG function to test_img (#6762)
c72cb4421 Thu Feb 15 15:53:58 2024 +0000 test_runner/performance: parametrize benchmarks (#6744)
046d9c69e Thu Feb 15 16:58:26 2024 +0000 fix: require wider jwt for changing the io engine (#6770)
f0d8bd785 Thu Feb 15 19:48:50 2024 +0000 Update Makefile (#6779)
6b980f38d Thu Feb 15 21:59:39 2024 +0000 libs: refactor ShardCount.0 to private (#6690)
45e929c06 Fri Feb 16 09:35:11 2024 +0000 stop reading local `metadata` file (#6777)
568bc1fde Fri Feb 16 10:12:34 2024 +0000 fix(build): production flamegraphs are useless (#6764)
f2e5212fe Fri Feb 16 13:00:53 2024 +0000 storage controller: background reconcile, graceful shutdown, better logging (#6709)
c19625a29 Fri Feb 16 14:50:09 2024 +0000 Support sharding for compute_ctl (#6787)
0f3b87d02 Fri Feb 16 14:53:36 2024 +0000 Add test for pageserver_directory_entries_count metric (#6767)
59c5b374d Fri Feb 16 15:30:04 2024 +0000 test_pageserver_max_throughput_getpage_at_latest_lsn: disable on CI (#6785)
36e110094 Fri Feb 16 16:31:54 2024 +0100 bench_walredo: use tokio multi-threaded runtime (#6743)
5d039c6e9 Fri Feb 16 15:53:09 2024 +0000 libs: add 'generations_api' auth scope (#6783)
ca07fa5f8 Fri Feb 16 21:26:59 2024 +0100 per-TenantShard read throttling (#6706)
29fb67543 Fri Feb 16 20:50:09 2024 +0000 Revert "fix superuser permission check for extensions (#6733)" (#6791)
9b714c857 Sat Feb 17 19:15:21 2024 +0000 build(deps): bump cryptography from 42.0.0 to 42.0.2 (#6792)
e3ded64d1 Sat Feb 17 22:13:25 2024 +0200 Support pg-ivm extension (#6793)
24014d838 Sun Feb 18 08:51:12 2024 +0000 pageserver: fix sharding emitting empty image layers during compaction (#6776)
61f99d703 Sun Feb 18 12:16:07 2024 +0000  test_create_snapshot: do not try to copy pg_dynshmem dir (#6796)
5667372c6 Sun Feb 18 15:55:19 2024 +0000 pageserver: during shard split, wait for child to activate (#6789)
4d2bf55e6 Mon Feb 19 11:07:27 2024 +0000 CI: temporary disable coverage report for regression tests (#6798)
587cb705b Mon Feb 19 12:34:27 2024 +0000 pageserver: roll open layer in timeline writer (#6661)
d0d487168 Mon Feb 19 12:54:17 2024 +0000 proxy: use postgres_protocol scram/sasl code (#4748)
349b37501 Mon Feb 19 14:01:36 2024 +0000 pageserver: remove heatmap file during tenant delete (#6806)
7e4280955 Mon Feb 19 14:12:20 2024 +0000 control_plane/attachment_service: improve Scheduler (#6633)
2f8a2681b Mon Feb 19 15:07:07 2024 +0000 pageserver: ensure we never try to save empty delta layer (#6805)
e0c12faab Mon Feb 19 17:27:02 2024 +0100 Allow initdb preservation for broken tenants (#6790)
4f7704af2 Mon Feb 19 17:44:20 2024 +0000 storage controller: fix spurious reconciles after pageserver restarts (#6814)
0c105ef35 Mon Feb 19 20:29:23 2024 +0000 storage controller: debug observability endpoints and self-test (#6820)
feb359b45 Mon Feb 19 21:46:22 2024 +0000 CI: Update deprecated GitHub Actions (#6822)
02a8b7fbe Tue Feb 20 10:13:21 2024 +0000 storage controller: issue timeline create/delete calls concurrently (#6827)
686b3c79c Tue Feb 20 10:44:46 2024 +0000 http2 alpn (#6815)
21a86487a Tue Feb 20 11:58:01 2024 +0100 proxy: fix #6529 (#6807)
a48b23d77 Tue Feb 20 14:06:25 2024 +0100 fix(startup + remote_timeline_client): no-op deletion ops scheduled during startup (#6825)
b467d8067 Tue Feb 20 14:09:15 2024 +0100 fix(test_ondemand_download_timetravel): occasionally fails with WAL timeout during layer creation (#6818)
d152d4f16 Tue Feb 20 13:40:46 2024 +0000 pageserver: fix treating all download errors as 'Other' (#6836)
9b8df2634 Tue Feb 20 15:55:51 2024 +0000 Fix active_timelines_count metric (#6839)
eb02f4619 Tue Feb 20 17:34:12 2024 +0100 tests: add a shutdown log noise case to test_location_conf_churn (#6828)
e49602ecf Tue Feb 20 17:52:23 2024 +0100 feat(metrics): per-timeline metric for on-demand downloads, remove calls_started histogram (#6834)
cbb599f35 Tue Feb 20 19:42:36 2024 +0200 Add /terminate API (#6745)
fcbe9fb18 Tue Feb 20 19:42:54 2024 +0000 test: adjust checkpoint distance in `test_layer_map` (#6842)
04190a1fe Tue Feb 20 20:45:00 2024 +0000 CI(test_runner): misc small changes (#6801)
3882f5700 Wed Feb 21 00:20:42 2024 +0000 neon_local: add flag to create test user and database (#6848)
5d6083bfc Wed Feb 21 09:49:46 2024 +0000 pageserver: add vectored get implementation (#6576)
e7452d375 Wed Feb 21 09:54:25 2024 +0000 storage controller: concurrency + deadlines during startup reconcile (#6823)
e0af945f8 Wed Feb 21 10:04:09 2024 +0000 proxy: improve error classification (#6841)
428d9fe69 Wed Feb 21 12:36:57 2024 +0000 tests: Make test_vm_bit_clear_on_heap_lock more robust again. (#6714)
84f027357 Wed Feb 21 14:12:35 2024 +0000 pageserver: adjust checkpoint distance for sharded tenants (#6852)
7257ffbf7 Wed Feb 21 16:57:30 2024 +0200 feat: imitiation_only eviction_task policy (#6598)
41464325c Wed Feb 21 15:20:59 2024 +0000 fix: remaining missed cancellations and timeouts (#6843)
4de2f0f3e Wed Feb 21 16:35:37 2024 +0100 Implement a sharded time travel recovery endpoint (#6821)
532b0fa52 Wed Feb 21 15:45:22 2024 +0000 Revise CODEOWNERS (#6840)
ce1673a8c Wed Feb 21 16:00:17 2024 +0000 tests: improve stability of  tests using `wait_for_upload_queue_empty` (#6856)
afda4420b Wed Feb 21 17:03:55 2024 +0000 test_sharding_ingress: bigger data, skip in debug mode (#6859)
60e5a56a5 Wed Feb 21 18:24:59 2024 +0100 proxy: include client IP in ip deny message (#6854)
03f8a42ed Wed Feb 21 19:09:40 2024 +0000 Add walsenders_keep_horizon option (#6860)
76b92e338 Wed Feb 21 13:22:30 2024 -0600 Fix multithreaded postmaster on macOS
f2767d205 Wed Feb 21 20:32:12 2024 +0100 CI: run check-permissions before all jobs (#6794)
20fff0569 Wed Feb 21 19:39:14 2024 +0000 Remove stray del and TODO (#6867)
6921577ce Wed Feb 21 16:09:34 2024 -0500 compute_ctl: grant default privileges on table to `neon_superuser` (#6845)
555ee9fdd Wed Feb 21 21:41:51 2024 +0000 build(deps): bump cryptography from 42.0.2 to 42.0.4 (#6870)
8107ae837 Wed Feb 21 23:42:24 2024 +0100 README: Fix the link to the free tier request (#6858)
1718c0b59 Wed Feb 21 22:43:55 2024 +0000 Proxy: cancel query on connection drop (#6832)
c1095f4c5 Thu Feb 22 09:32:27 2024 +0000 pageserver: don't warn on tempfiles in secondary location (#6837)
b5246753b Thu Feb 22 09:33:40 2024 +0000 storage controller: miscellaneous improvements (#6800)
bc7a82caf Thu Feb 22 13:58:59 2024 +0200 feat: bare-bones /v1/utilization (#6831)
c671aeacd Thu Feb 22 14:19:11 2024 +0100 fix(per-tenant throttling): incorrect `allowed_rps` field in log message (#6869)
9c48b5c4a Thu Feb 22 14:01:06 2024 +0000 controller: improved handling of offline nodes (#6846)
cf3baf603 Thu Feb 22 14:10:49 2024 +0000 storage controller: fix consistency check (#6855)
2424d9088 Thu Feb 22 17:15:18 2024 +0100 CI: Split Proxy and Storage releases (#6797)
9c6145f0a Thu Feb 22 16:51:46 2024 +0000 control_plane: fix a compilation error from racing PRs (#6882)
837988b6c Thu Feb 22 17:49:02 2024 +0000 compute_ctl: run migrations to grant default grantable privileges (#6884)
d669dacd7 Thu Feb 22 10:05:37 2024 -0800 Add pgpartman (#6849)
47657f2df Thu Feb 22 21:33:38 2024 +0200 Flush logical messages with snapshots and replication origin (#6826)
5bcae3a86 Fri Feb 23 01:12:49 2024 +0400 Drop LR slots if too many .snap files are found.
12487e662 Thu Feb 22 17:00:03 2024 -0500 compute_ctl: move default privileges grants to handle_grants (#6885)
6f8f7c7de Fri Feb 23 12:36:18 2024 +0100 CI: Build images using docker buildx instead of kaniko (#6871)
cd449d66e Fri Feb 23 14:33:47 2024 +0100 stop writing `metadata` file (#6769)
a12e4261a Fri Feb 23 13:56:41 2024 +0000 Add neon.primary_is_running GUC. (#6705)
94f6b488e Fri Feb 23 14:12:09 2024 +0000 CI(release-proxy): fix a couple missed release-proxy branch handling (#6892)
ec3efc56a Fri Feb 23 17:16:43 2024 +0100 Revert "Revert "refactor(VirtualFile::crashsafe_overwrite): avoid Handle::block_on in callers"" (#6775)
b8f9e3a9e Sat Feb 24 21:32:41 2024 +0000 fix(flaky): typo Stopping/Stopped (#6894)
8283779ee Sun Feb 25 14:53:17 2024 +0000 pageserver: remove legacy attach/detach APIs from swagger (#6883)
dedf66ba5 Mon Feb 26 10:05:24 2024 +0100 remove `gc_feedback` mechanism (#6863)
5273c94c5 Mon Feb 26 09:19:24 2024 +0000 pageserver: remove two obsolete/unused per-timeline metrics (#6893)
ceedc3ef7 Mon Feb 26 11:22:15 2024 +0100 Timeline::repartition: enforce no concurrent callers & lsn to not move backwards (#6862)
256058f2a Mon Feb 26 10:24:58 2024 +0000 pageserver: only write out legacy tenant config if no generation (#6891)
51a43b121 Mon Feb 26 13:21:40 2024 +0100 Fix test_remote_storage_upload_queue_retries flakiness (#6898)
459c2af8c Mon Feb 26 10:36:11 2024 -0500 Expose LFC cache size limit from sql_exporter (#6912)
75baf83fc Mon Feb 26 16:06:00 2024 +0000 externalize statistics on LFC cache usage (#6906)
c4059939e Mon Feb 26 17:28:00 2024 +0100 fixup(#6893): report_size() still used pageserver_created_persistent_* metrics (#6909)
975786265 Mon Feb 26 18:17:22 2024 +0100 CI: Delete GitHub Actions caches once PR is closed (#6900)
0881d4f9e Mon Feb 26 18:53:48 2024 +0100 Update README, include cleanup details (#6816)
5accf6e24 Mon Feb 26 18:17:06 2024 +0000 attachment_service: JWT auth enforcement (#6897)
b2bbc2031 Mon Feb 26 11:48:56 2024 -0900 fix: only alter default privileges when public schema exists (#6914)
