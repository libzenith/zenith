<?xml version="1.0" encoding="UTF-8"?>
<!-- Do not edit this file with editors other than diagrams.net -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1284px" height="891px" viewBox="-0.5 -0.5 1284 891" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2022-07-25T12:13:45.926Z&quot; agent=&quot;5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36&quot; etag=&quot;cavMkLHYIw3I1b5SoP59&quot; version=&quot;20.2.0&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;O-UwVOdaADe9p4iTUtC-&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs><clipPath id="mx-clip-415-100-332-70-0"><rect x="415" y="100" width="332" height="70"/></clipPath><clipPath id="mx-clip-875-100-362-120-0"><rect x="875" y="100" width="362" height="120"/></clipPath><clipPath id="mx-clip-25-510-302-70-0"><rect x="25" y="510" width="302" height="70"/></clipPath><clipPath id="mx-clip-25-270-302-70-0"><rect x="25" y="270" width="302" height="70"/></clipPath><clipPath id="mx-clip-875-250-362-90-0"><rect x="875" y="250" width="362" height="90"/></clipPath><clipPath id="mx-clip-25-630-302-60-0"><rect x="25" y="630" width="302" height="60"/></clipPath><clipPath id="mx-clip-25-390-302-70-0"><rect x="25" y="390" width="302" height="70"/></clipPath><clipPath id="mx-clip-25-70-302-70-0"><rect x="25" y="70" width="302" height="70"/></clipPath><clipPath id="mx-clip-415-200-332-90-0"><rect x="415" y="200" width="332" height="90"/></clipPath></defs><g><path d="M 1 20 L 1 0 L 1281 0 L 1281 20" fill="rgb(255, 255, 255)" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 1 20 L 1 890 L 1281 890 L 1281 20" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 1 20 L 1281 20" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" font-size="12px"><text x="2.5" y="14.5">                                             Tasks                                                                                                                                                                   State</text></g><path d="M 661 740 L 661 740 L 741 740 L 741 740" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 661 740 L 661 770 L 741 770 L 741 740" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="700.5" y="758.5">Layer 1</text></g><path d="M 751 740 L 751 740 L 831 740 L 831 740" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 751 740 L 751 770 L 831 770 L 831 740" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="790.5" y="758.5">Layer 2</text></g><path d="M 961 770 L 961 790 L 961 780 L 961 789.9" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 961 796.65 L 956.5 787.65 L 961 789.9 L 965.5 787.65 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 785px; margin-left: 961px;"><div data-drawio-colors="color: #000000; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; background-color: rgb(255, 255, 255); white-space: nowrap;">contained in</div></div></div></foreignObject><text x="961" y="788" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">contained in</text></switch></g><path d="M 921 740 L 921 740 L 1001 740 L 1001 740" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 921 740 L 921 770 L 1001 770 L 1001 740" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="960.5" y="758.5">metadata</text></g><path d="M 661 800 L 661 800 L 741 800 L 741 800" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 661 800 L 661 830 L 741 830 L 741 800" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="700.5" y="818.5">Layer 1</text></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 815px; margin-left: 866px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; font-weight: bold; white-space: nowrap;">...</div></div></div></foreignObject><text x="866" y="819" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">...</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 765px; margin-left: 866px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; font-weight: bold; white-space: nowrap;">...</div></div></div></foreignObject><text x="866" y="769" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">...</text></switch></g><path d="M 906 800 L 906 800 L 1016 800 L 1016 800" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 906 800 L 906 830 L 1016 830 L 1016 800" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="960.5" y="818.5">index_part.json</text></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 815px; margin-left: 1171px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; font-weight: bold; white-space: nowrap;">Files in the remote storage</div></div></div></foreignObject><text x="1171" y="819" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">Files in the remote storage</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 760px; margin-left: 1151px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; font-weight: bold; white-space: nowrap;">Files in the local FS</div></div></div></foreignObject><text x="1151" y="764" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">Files in the local FS</text></switch></g><path d="M 411 100 L 411 70 L 751 70 L 751 100" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 411 100 L 411 170 L 751 170 L 751 100" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 411 100 L 751 100" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="580.5" y="89.5">data_storage</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-415-100-332-70-0)" font-size="12px"><text x="416.5" y="126.5">a number of maps with Arc&lt;RwLock&lt;Data&gt;&gt; pattern</text><text x="416.5" y="140.5">for tenants, timelines, gc, walreceiver, remove storage, etc. </text><text x="416.5" y="154.5">metadata</text></g><path d="M 871 100 L 871 70 L 1241 70 L 1241 100" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 871 100 L 871 220 L 1241 220 L 1241 100" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 871 100 L 1241 100" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="1055.5" y="89.5">LayeredTimeline</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-875-100-362-120-0)" font-size="12px"><text x="876.5" y="112.5">write_lock: Mutex&lt;()&gt;</text><text x="876.5" y="140.5">latest_gc_cutoff_lsn: RwLock&lt;Lsn&gt;</text><text x="876.5" y="168.5">process: Mutex&lt;Option&lt;PostgresRedoPorcess&gt;&gt; inside</text><text x="876.5" y="182.5">               PostgresRedoManager</text></g><path d="M 21 510 L 21 480 L 331 480 L 331 510" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 21 510 L 21 580 L 331 580 L 331 510" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 21 510 L 331 510" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="175.5" y="499.5">compaction</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-25-510-302-70-0)" font-size="12px"><text x="26.5" y="528.5">Periodically runs on all tenant timelines, </text><text x="26.5" y="542.5">each processed separately. </text><text x="26.5" y="570.5">Merges (removes and adds) layer files</text></g><path d="M 21 270 L 21 240 L 331 240 L 331 270" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 21 270 L 21 340 L 331 340 L 331 270" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 21 270 L 331 270" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="175.5" y="259.5">walreceiver tasks</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-25-270-302-70-0)" font-size="12px"><text x="26.5" y="302.5">etcd subscriptions, periodic timeline writes </text><text x="26.5" y="316.5">and checkpoints</text></g><path d="M 471 740 L 471 740 L 611 740 L 611 740" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 471 740 L 471 770 L 611 770 L 611 740" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="540.5" y="758.5">tenant config file</text></g><path d="M 871 250 L 871 220 L 1241 220 L 1241 250" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 871 250 L 871 340 L 1241 340 L 1241 250" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 871 250 L 1241 250" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="1055.5" y="239.5">LowLevelLayeredTimeline</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-875-250-362-90-0)" font-size="12px"><text x="876.5" y="278.5">partitioning: Mutex&lt;(KeyPartitioning, Lsn)&gt;</text><text x="876.5" y="306.5">layers: RwLock&lt;LayerMap&gt;</text></g><path d="M 751 133.82 L 859.79 133.07" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 866.54 133.02 L 857.57 137.59 L 859.79 133.07 L 857.51 128.59 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 1 711 L 1281 710" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 21 630 L 21 600 L 331 600 L 331 630" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 21 630 L 21 690 L 331 690 L 331 630" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 21 630 L 331 630" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="175.5" y="619.5">remote storage sync</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-25-630-302-60-0)" font-size="12px"><text x="26.5" y="657.5">storage sync queue and S3 connections</text><text x="26.5" y="671.5">periodically writes into the remote index</text></g><path d="M 21 390 L 21 360 L 331 360 L 331 390" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 21 390 L 21 460 L 331 460 L 331 390" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 21 390 L 331 390" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="175.5" y="379.5">gc</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-25-390-302-70-0)" font-size="12px"><text x="26.5" y="408.5">Periodically runs on all tenant timelines, </text><text x="26.5" y="422.5">with shared context.</text><text x="26.5" y="450.5">Removes layer files</text></g><path d="M 858.31 311.62 L 351 310" fill="none" stroke="#ff1a12" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 865.06 311.64 L 856.04 316.11 L 858.31 311.62 L 856.07 307.11 Z" fill="#ff1a12" stroke="#ff1a12" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 331px; margin-left: 532px;"><div data-drawio-colors="color: #000000; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; background-color: rgb(255, 255, 255); white-space: nowrap;"><font color="#ff1a12">Tasks interact with layers, via LayerMap</font></div></div></div></foreignObject><text x="532" y="334" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">Tasks interact with layers, via LayerMap</text></switch></g><path d="M 21 70 L 21 40 L 331 40 L 331 70" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 21 70 L 21 140 L 331 140 L 331 70" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 21 70 L 331 70" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="175.5" y="59.5">task_manager</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-25-70-302-70-0)" font-size="12px"><text x="26.5" y="95.5">runtime, threadpools, shared connections (etcd), etc.</text><text x="26.5" y="123.5">logic to manage tenant/timeline tasks</text></g><path d="M 471 800 L 471 800 L 611 800 L 611 800" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 471 800 L 471 830 L 611 830 L 611 800" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="540.5" y="811.5">tenant config file </text><text x="540.5" y="825.5">in any form</text></g><path d="M 881 320 L 339.94 605.29" fill="none" stroke="#ff1a12" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 333.97 608.44 L 339.83 600.26 L 339.94 605.29 L 344.03 608.22 Z" fill="#ff1a12" stroke="#ff1a12" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 461px; margin-left: 608px;"><div data-drawio-colors="color: #000000; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; background-color: rgb(255, 255, 255); white-space: nowrap;"><font color="#ff1a12">layer map schedules sync tasks <br />and calls logic on their completion</font></div></div></div></foreignObject><text x="608" y="464" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">layer map schedules sync tasks...</text></switch></g><path d="M 411 200 L 411 170 L 751 170 L 751 200" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 411 200 L 411 290 L 751 290 L 751 200" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 411 200 L 751 200" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="580.5" y="189.5">page cache</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-415-200-332-90-0)" font-size="12px"><text x="416.5" y="221.5">materialized_page_map: RwLock&lt;HashMap&lt;...&gt;&gt;</text><text x="416.5" y="249.5">ephemeral_page_map: RwLock&lt;HashMap&lt;...&gt;&gt;</text><text x="416.5" y="277.5">immutable_page_map: RwLock&lt;HashMap&lt;...&gt;&gt;</text></g><path d="M 351 710 L 351 20" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 879.41 324.08 L 794.18 710.13" fill="none" stroke="#ff1a12" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 792.72 716.72 L 790.27 706.97 L 794.18 710.13 L 799.06 708.91 Z" fill="#ff1a12" stroke="#ff1a12" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 502px; margin-left: 932px;"><div data-drawio-colors="color: #000000; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; background-color: rgb(255, 255, 255); white-space: nowrap;"><font color="#ff1a12">layer map manages local and remote files<br />in a queue-based manner<br /></font></div></div></div></foreignObject><text x="932" y="506" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">layer map manages local and remote files...</text></switch></g><path d="M 404.7 154.58 L 352 310" fill="none" stroke="#ff1a12" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 406.86 148.19 L 408.23 158.15 L 404.7 154.58 L 399.71 155.26 Z" fill="#ff1a12" stroke="#ff1a12" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 200px; margin-left: 267px;"><div data-drawio-colors="color: #000000; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; background-color: rgb(255, 255, 255); white-space: nowrap;"><font color="#ff1a12">tasks update or read metadata via the storage</font></div></div></div></foreignObject><text x="267" y="204" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">tasks update or read metadata via the storage</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>